<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Rigs of Rods: source/main/physics/input_output/RigSpawner.cpp Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="rorlogo.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">Rigs of Rods
   
   </div>
   <div id="projectbrief">Soft-body Physics Simulation</div>
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="dynsections.js"></script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">source/main/physics/input_output/RigSpawner.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="_rig_spawner_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*</span>
<a name="l00002"></a>00002 <span class="comment">    This source file is part of Rigs of Rods</span>
<a name="l00003"></a>00003 <span class="comment">    Copyright 2005-2012 Pierre-Michel Ricordel</span>
<a name="l00004"></a>00004 <span class="comment">    Copyright 2007-2012 Thomas Fischer</span>
<a name="l00005"></a>00005 <span class="comment">    Copyright 2013-2014 Petr Ohlidal</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">    For more information, see http://www.rigsofrods.com/</span>
<a name="l00008"></a>00008 <span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">    Rigs of Rods is free software: you can redistribute it and/or modify</span>
<a name="l00010"></a>00010 <span class="comment">    it under the terms of the GNU General Public License version 3, as</span>
<a name="l00011"></a>00011 <span class="comment">    published by the Free Software Foundation.</span>
<a name="l00012"></a>00012 <span class="comment"></span>
<a name="l00013"></a>00013 <span class="comment">    Rigs of Rods is distributed in the hope that it will be useful,</span>
<a name="l00014"></a>00014 <span class="comment">    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00015"></a>00015 <span class="comment">    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00016"></a>00016 <span class="comment">    GNU General Public License for more details.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment">    You should have received a copy of the GNU General Public License</span>
<a name="l00019"></a>00019 <span class="comment">    along with Rigs of Rods.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span>
<a name="l00020"></a>00020 <span class="comment">*/</span>
<a name="l00021"></a>00021 
<a name="l00029"></a>00029 <span class="comment">/*</span>
<a name="l00030"></a>00030 <span class="comment">    DISABLED:</span>
<a name="l00031"></a>00031 <span class="comment">        Hashing</span>
<a name="l00032"></a>00032 <span class="comment">        ScopeLog (What is it for?)</span>
<a name="l00033"></a>00033 <span class="comment">*/</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="_ro_r_prerequisites_8h.html">RoRPrerequisites.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;<a class="code" href="_rig_spawner_8h.html" title="Vehicle spawning logic.">RigSpawner.h</a>&quot;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="_air_brake_8h.html">AirBrake.h</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;<a class="code" href="_airfoil_8h.html">Airfoil.h</a>&quot;</span>
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;<a class="code" href="_application_8h.html" title="Central object manager and communications hub.">Application.h</a>&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="_auto_pilot_8h.html">AutoPilot.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="_beam_8h.html">Beam.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="_beam_engine_8h.html">BeamEngine.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="_bit_flags_8h.html">BitFlags.h</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="_buoyance_8h.html">Buoyance.h</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="_cmd_key_inertia_8h.html">CmdKeyInertia.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="_collisions_8h.html">Collisions.h</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="_console_8h.html">Console.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="_dash_board_manager_8h.html">DashBoardManager.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &quot;<a class="code" href="_differentials_8h.html">Differentials.h</a>&quot;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &quot;<a class="code" href="_dust_manager_8h.html">DustManager.h</a>&quot;</span>
<a name="l00052"></a>00052 <span class="preprocessor">#include &quot;<a class="code" href="_flex_airfoil_8h.html">FlexAirfoil.h</a>&quot;</span>
<a name="l00053"></a>00053 <span class="preprocessor">#include &quot;<a class="code" href="_flex_body_8h.html">FlexBody.h</a>&quot;</span>
<a name="l00054"></a>00054 <span class="preprocessor">#include &quot;<a class="code" href="_flex_mesh_8h.html">FlexMesh.h</a>&quot;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &quot;<a class="code" href="_flex_mesh_wheel_8h.html">FlexMeshWheel.h</a>&quot;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &quot;<a class="code" href="_flex_obj_8h.html">FlexObj.h</a>&quot;</span>
<a name="l00057"></a>00057 <span class="preprocessor">#include &quot;<a class="code" href="_input_engine_8h.html" title="Input logic.">InputEngine.h</a>&quot;</span>
<a name="l00058"></a>00058 <span class="preprocessor">#include &quot;<a class="code" href="_material_function_mapper_8h.html">MaterialFunctionMapper.h</a>&quot;</span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &quot;<a class="code" href="_material_replacer_8h.html">MaterialReplacer.h</a>&quot;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &quot;<a class="code" href="_mesh_object_8h.html">MeshObject.h</a>&quot;</span>
<a name="l00061"></a>00061 <span class="preprocessor">#include &quot;<a class="code" href="_point_col_detector_8h.html">PointColDetector.h</a>&quot;</span>
<a name="l00062"></a>00062 <span class="preprocessor">#include &quot;<a class="code" href="_rig_loading_profiler_control_8h.html" title="Allows configuration of various profiling mechanisms.">RigLoadingProfilerControl.h</a>&quot;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &quot;<a class="code" href="_screw_prop_8h.html">ScrewProp.h</a>&quot;</span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="_settings_8h.html">Settings.h</a>&quot;</span>
<a name="l00065"></a>00065 <span class="preprocessor">#include &quot;<a class="code" href="_skin_8h.html">Skin.h</a>&quot;</span>
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="_slide_node_8h.html">SlideNode.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &quot;<a class="code" href="_sound_script_manager_8h.html">SoundScriptManager.h</a>&quot;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &quot;<a class="code" href="_terrain_manager_8h.html">TerrainManager.h</a>&quot;</span>
<a name="l00069"></a>00069 <span class="preprocessor">#include &quot;<a class="code" href="_thread_pool_8h.html">ThreadPool.h</a>&quot;</span>
<a name="l00070"></a>00070 <span class="preprocessor">#include &quot;<a class="code" href="_torque_curve_8h.html" title="torquecurve loader.">TorqueCurve.h</a>&quot;</span>
<a name="l00071"></a>00071 <span class="preprocessor">#include &quot;<a class="code" href="_turbo_jet_8h.html">TurboJet.h</a>&quot;</span>
<a name="l00072"></a>00072 <span class="preprocessor">#include &quot;<a class="code" href="_turbo_prop_8h.html">TurboProp.h</a>&quot;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#include &quot;<a class="code" href="_video_camera_8h.html">VideoCamera.h</a>&quot;</span>
<a name="l00074"></a>00074 <span class="preprocessor">#include &quot;<a class="code" href="_g_u_i_manager_8h.html">GUIManager.h</a>&quot;</span>
<a name="l00075"></a>00075 
<a name="l00076"></a>00076 <span class="preprocessor">#include &lt;OgreMaterialManager.h&gt;</span>
<a name="l00077"></a>00077 <span class="preprocessor">#include &lt;OgreSceneManager.h&gt;</span>
<a name="l00078"></a>00078 <span class="preprocessor">#include &lt;OgreMovableObject.h&gt;</span>
<a name="l00079"></a>00079 <span class="preprocessor">#include &lt;OgreParticleSystem.h&gt;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &lt;OgreEntity.h&gt;</span>
<a name="l00081"></a>00081 
<a name="l00082"></a>00082 <span class="keyword">using namespace </span>RoR;
<a name="l00083"></a>00083 
<a name="l00084"></a>00084 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l00085"></a>00085 <span class="comment">/* Prepare for loading</span>
<a name="l00086"></a>00086 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l00087"></a>00087 
<a name="l00088"></a><a class="code" href="class_rig_spawner.html#ab9e69ed800b4c2fcfe253c7b4337ad91">00088</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ab9e69ed800b4c2fcfe253c7b4337ad91">RigSpawner::Setup</a>( 
<a name="l00089"></a>00089     <a class="code" href="class_beam.html">Beam</a> *rig,
<a name="l00090"></a>00090     boost::shared_ptr&lt;RigDef::File&gt; file,
<a name="l00091"></a>00091     Ogre::SceneNode *parent,
<a name="l00092"></a>00092     Ogre::Vector3 <span class="keyword">const</span> &amp; spawn_position,
<a name="l00093"></a>00093     Ogre::Quaternion <span class="keyword">const</span> &amp; spawn_rotation,
<a name="l00094"></a>00094     <span class="keywordtype">int</span> cache_entry_number
<a name="l00095"></a>00095 )
<a name="l00096"></a>00096 {
<a name="l00097"></a>00097     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     m_rig = rig;
<a name="l00100"></a>00100     m_file = file;
<a name="l00101"></a>00101     m_cache_entry_number = cache_entry_number;
<a name="l00102"></a>00102     m_parent_scene_node = parent;
<a name="l00103"></a>00103     m_spawn_position = spawn_position;
<a name="l00104"></a>00104     m_spawn_rotation = spawn_rotation;
<a name="l00105"></a>00105     m_current_keyword = <a class="code" href="struct_rig_def_1_1_file.html#add5bea6329504fe29cc675aa7f8a75c3a1c5772b1ec3afd9b63e87fb3d53293bc">RigDef::File::KEYWORD_INVALID</a>;
<a name="l00106"></a>00106     m_enable_background_loading = <a class="code" href="_settings_8h.html#af577ee09bf1afff38ddb26d32ce320fb">BSETTING</a>(<span class="stringliteral">&quot;Background Loading&quot;</span>, <span class="keyword">false</span>);
<a name="l00107"></a>00107     m_wing_area = 0.f;
<a name="l00108"></a>00108     m_fuse_z_min = 1000.0f;
<a name="l00109"></a>00109     m_fuse_z_max = -1000.0f;
<a name="l00110"></a>00110     m_fuse_y_min = 1000.0f;
<a name="l00111"></a>00111     m_fuse_y_max = -1000.0f;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     m_generate_wing_position_lights = <span class="keyword">true</span>;
<a name="l00114"></a>00114     <span class="comment">// TODO: Handle modules</span>
<a name="l00115"></a>00115     <span class="keywordflow">if</span> (file-&gt;root_module-&gt;engine.get() != <span class="keyword">nullptr</span>) <span class="comment">// Engine present =&gt; it&#39;s a land vehicle.</span>
<a name="l00116"></a>00116     {
<a name="l00117"></a>00117         m_generate_wing_position_lights = <span class="keyword">false</span>; <span class="comment">// Disable aerial pos. lights for land vehicles.</span>
<a name="l00118"></a>00118     }
<a name="l00119"></a>00119 
<a name="l00120"></a>00120     <span class="comment">// add custom include path</span>
<a name="l00121"></a>00121     <span class="keywordflow">if</span> (!<a class="code" href="_settings_8h.html#a59d79e9512ab19f4eb8a322f1e32dc11">SSETTING</a>(<span class="stringliteral">&quot;resourceIncludePath&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).empty())
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123         Ogre::ResourceGroupManager::getSingleton().addResourceLocation(
<a name="l00124"></a>00124             <a class="code" href="_settings_8h.html#a59d79e9512ab19f4eb8a322f1e32dc11">SSETTING</a>(<span class="stringliteral">&quot;resourceIncludePath&quot;</span>, <span class="stringliteral">&quot;&quot;</span>), 
<a name="l00125"></a>00125             <span class="stringliteral">&quot;FileSystem&quot;</span>, 
<a name="l00126"></a>00126             <span class="stringliteral">&quot;customInclude&quot;</span>
<a name="l00127"></a>00127         );
<a name="l00128"></a>00128     }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130     <span class="comment">// initialize custom include path</span>
<a name="l00131"></a>00131     <span class="keywordflow">if</span> (!<a class="code" href="_settings_8h.html#a59d79e9512ab19f4eb8a322f1e32dc11">SSETTING</a>(<span class="stringliteral">&quot;resourceIncludePath&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).empty())
<a name="l00132"></a>00132     {
<a name="l00133"></a>00133         Ogre::ResourceBackgroundQueue::getSingleton().initialiseResourceGroup(<span class="stringliteral">&quot;customInclude&quot;</span>);
<a name="l00134"></a>00134     }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136     m_messages_num_errors = 0;
<a name="l00137"></a>00137     m_messages_num_warnings = 0;
<a name="l00138"></a>00138     m_messages_num_other = 0;
<a name="l00139"></a>00139 }
<a name="l00140"></a>00140 
<a name="l00141"></a><a class="code" href="class_rig_spawner.html#ab809acb388f153ec16f847a4c9147150">00141</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ab809acb388f153ec16f847a4c9147150">RigSpawner::InitializeRig</a>()
<a name="l00142"></a>00142 {
<a name="l00143"></a>00143     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00144"></a>00144 
<a name="l00145"></a>00145     m_rig-&gt;mCamera = <span class="keyword">nullptr</span>;
<a name="l00146"></a>00146     <span class="comment">// clear rig parent structure</span>
<a name="l00147"></a>00147     memset(m_rig-&gt;nodes, 0, <span class="keyword">sizeof</span>(<a class="code" href="structnode__t.html">node_t</a>) * <a class="code" href="_beam_data_8h.html#acc4b987a9b4c8d2ff8bcbdb08c5343e5" title="maximum number of nodes per truck">MAX_NODES</a>);
<a name="l00148"></a>00148     m_rig-&gt;free_node = 0;
<a name="l00149"></a>00149     memset(m_rig-&gt;beams, 0, <span class="keyword">sizeof</span>(<a class="code" href="structbeam__t.html">beam_t</a>) * <a class="code" href="_beam_data_8h.html#aaabcdd3815618aaf2d54ce6a8aa5f8fc" title="maximum number of beams per truck">MAX_BEAMS</a>);
<a name="l00150"></a>00150     m_rig-&gt;free_beam = 0;
<a name="l00151"></a>00151     memset(m_rig-&gt;contacters, 0, <span class="keyword">sizeof</span>(<a class="code" href="structcontacter__t.html">contacter_t</a>) * <a class="code" href="_beam_data_8h.html#a789e243856b2e49753445daa2ca6002a" title="maximum number of contacters per truck">MAX_CONTACTERS</a>);
<a name="l00152"></a>00152     m_rig-&gt;free_contacter = 0;
<a name="l00153"></a>00153     memset(m_rig-&gt;rigidifiers, 0, <span class="keyword">sizeof</span>(<a class="code" href="structrigidifier__t.html">rigidifier_t</a>) * <a class="code" href="_beam_data_8h.html#ac58b53027fc6c40f8978d46a80ab2147" title="maximum number of rigifiers per truck">MAX_RIGIDIFIERS</a>);
<a name="l00154"></a>00154     m_rig-&gt;free_rigidifier = 0;
<a name="l00155"></a>00155     memset(m_rig-&gt;wheels, 0, <span class="keyword">sizeof</span>(<a class="code" href="structwheel__t.html">wheel_t</a>) * <a class="code" href="_beam_data_8h.html#a7bc15dd4ec4eb931d4e179788511fa3a" title="maximum number of wheels per truck">MAX_WHEELS</a>);
<a name="l00156"></a>00156     m_rig-&gt;free_wheel = 0;
<a name="l00157"></a>00157     memset(m_rig-&gt;vwheels, 0, <span class="keyword">sizeof</span>(<a class="code" href="structvwheel__t.html">vwheel_t</a>) * MAX_WHEELS);
<a name="l00158"></a>00158     m_rig-&gt;ropes.clear();
<a name="l00159"></a>00159     m_rig-&gt;ropables.clear();
<a name="l00160"></a>00160     m_rig-&gt;ties.clear();
<a name="l00161"></a>00161     m_rig-&gt;hooks.clear();
<a name="l00162"></a>00162     memset(m_rig-&gt;wings, 0, <span class="keyword">sizeof</span>(<a class="code" href="structwing__t.html">wing_t</a>) * <a class="code" href="_beam_data_8h.html#aabd8726ff4e12bb01fb489f87225151b" title="maximum number of wings per truck">MAX_WINGS</a>);
<a name="l00163"></a>00163     m_rig-&gt;free_wing = 0;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165     <span class="comment">// commands contain complex data structures, do not memset them ...</span>
<a name="l00166"></a>00166     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="_beam_data_8h.html#ab666a57e1a89c01fb894ac44469612ba" title="maximum number of commands per truck">MAX_COMMANDS</a>+1;i++)
<a name="l00167"></a>00167     {
<a name="l00168"></a>00168         m_rig-&gt;commandkey[i].commandValue=0;
<a name="l00169"></a>00169         m_rig-&gt;commandkey[i].beams.clear();
<a name="l00170"></a>00170         m_rig-&gt;commandkey[i].rotators.clear();
<a name="l00171"></a>00171         m_rig-&gt;commandkey[i].description=<span class="stringliteral">&quot;&quot;</span>;
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173 
<a name="l00174"></a>00174     memset(m_rig-&gt;rotators, 0, <span class="keyword">sizeof</span>(<a class="code" href="structrotator__t.html">rotator_t</a>) * <a class="code" href="_beam_data_8h.html#afc65fb8bf8a716d476f7caf3adf3d244" title="maximum number of rotators per truck">MAX_ROTATORS</a>);
<a name="l00175"></a>00175     m_rig-&gt;free_rotator = 0;
<a name="l00176"></a>00176     m_rig-&gt;flares.clear();
<a name="l00177"></a>00177     m_rig-&gt;free_flare = 0;
<a name="l00178"></a>00178     memset(m_rig-&gt;props, 0, <span class="keyword">sizeof</span>(<a class="code" href="structprop__t.html">prop_t</a>) * <a class="code" href="_beam_data_8h.html#af876256b421729dad97404a478d3b67e" title="maximum number of props per truck">MAX_PROPS</a>);
<a name="l00179"></a>00179     m_rig-&gt;free_prop = 0;
<a name="l00180"></a>00180     memset(m_rig-&gt;shocks, 0, <span class="keyword">sizeof</span>(<a class="code" href="structshock__t.html">shock_t</a>) * <a class="code" href="_beam_data_8h.html#a347e9ed33415367f068cc850aca3f1bf" title="maximum number of shocks per truck">MAX_SHOCKS</a>);
<a name="l00181"></a>00181     m_rig-&gt;free_shock = 0;
<a name="l00182"></a>00182     m_rig-&gt;free_active_shock = 0;
<a name="l00183"></a>00183     m_rig-&gt;exhausts.clear();
<a name="l00184"></a>00184     memset(m_rig-&gt;cparticles, 0, <span class="keyword">sizeof</span>(<a class="code" href="structcparticle__t.html">cparticle_t</a>) * <a class="code" href="_beam_data_8h.html#a765529327415100d437d11398bfd96a8" title="maximum number of custom particles per truck">MAX_CPARTICLES</a>);
<a name="l00185"></a>00185     m_rig-&gt;free_cparticle = 0;
<a name="l00186"></a>00186     m_rig-&gt;nodes_debug.clear();
<a name="l00187"></a>00187     m_rig-&gt;beams_debug.clear();
<a name="l00188"></a>00188     memset(m_rig-&gt;soundsources, 0, <span class="keyword">sizeof</span>(<a class="code" href="structsoundsource__t.html">soundsource_t</a>) * <a class="code" href="_beam_data_8h.html#ac94a83da980ae8f4c68a8c758f0eabe0" title="maximum number of soundsscripts per truck">MAX_SOUNDSCRIPTS_PER_TRUCK</a>);
<a name="l00189"></a>00189     m_rig-&gt;free_soundsource = 0;
<a name="l00190"></a>00190     memset(m_rig-&gt;pressure_beams, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="_beam_data_8h.html#a0a5210bdb798200461f6211c4b5ba74e" title="maximum number of pressure beams per truck">MAX_PRESSURE_BEAMS</a>);
<a name="l00191"></a>00191     m_rig-&gt;free_pressure_beam = 0;
<a name="l00192"></a>00192     memset(m_rig-&gt;aeroengines, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_aero_engine.html">AeroEngine</a> *) * <a class="code" href="_beam_data_8h.html#a62b87e1996c61822575d31c11175814c" title="maximum number of aero engines per truck">MAX_AEROENGINES</a>);
<a name="l00193"></a>00193     m_rig-&gt;free_aeroengine = 0;
<a name="l00194"></a>00194     memset(m_rig-&gt;cabs, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * (<a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a>*3));
<a name="l00195"></a>00195     m_rig-&gt;free_cab = 0;
<a name="l00196"></a>00196     memset(m_rig-&gt;subisback, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="_beam_data_8h.html#a959c5481bfa137d1373cad16bd46ca7c" title="maximum number of submeshes per truck">MAX_SUBMESHES</a>);
<a name="l00197"></a>00197     memset(m_rig-&gt;hydro, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="_beam_data_8h.html#a4686970bc9a4c77850f6654d2ef35b2f" title="maximum number of hydros per truck">MAX_HYDROS</a>);
<a name="l00198"></a>00198     m_rig-&gt;free_hydro = 0;
<a name="l00199"></a>00199     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;<a class="code" href="_beam_data_8h.html#acb4973acaec83598dfc3ec3ad794139f" title="maximum number of texture coordinates per truck">MAX_TEXCOORDS</a>;i++) m_rig-&gt;texcoords[i] = Ogre::Vector3::ZERO;
<a name="l00200"></a>00200     m_rig-&gt;free_texcoord=0;
<a name="l00201"></a>00201     memset(m_rig-&gt;subtexcoords, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * MAX_SUBMESHES);
<a name="l00202"></a>00202     m_rig-&gt;free_sub = 0;
<a name="l00203"></a>00203     memset(m_rig-&gt;subcabs, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * MAX_SUBMESHES);
<a name="l00204"></a>00204     memset(m_rig-&gt;collcabs, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a>);
<a name="l00205"></a>00205     memset(m_rig-&gt;collcabstype, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * MAX_CABS);
<a name="l00206"></a>00206     memset(m_rig-&gt;inter_collcabrate, 0, <span class="keyword">sizeof</span>(<a class="code" href="structcollcab__rate__t.html">collcab_rate_t</a>) * MAX_CABS);
<a name="l00207"></a>00207     m_rig-&gt;free_collcab = 0;
<a name="l00208"></a>00208     memset(m_rig-&gt;intra_collcabrate, 0, <span class="keyword">sizeof</span>(<a class="code" href="structcollcab__rate__t.html">collcab_rate_t</a>) * MAX_CABS);
<a name="l00209"></a>00209     memset(m_rig-&gt;buoycabs, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * MAX_CABS);
<a name="l00210"></a>00210     m_rig-&gt;free_buoycab = 0;
<a name="l00211"></a>00211     memset(m_rig-&gt;buoycabtypes, 0, <span class="keyword">sizeof</span>(<span class="keywordtype">int</span>) * MAX_CABS);
<a name="l00212"></a>00212     memset(m_rig-&gt;airbrakes, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_airbrake.html">Airbrake</a> *) * <a class="code" href="_beam_data_8h.html#ae28484a1e4d0ddc88cd0eaae3b0c119e" title="maximum number of airbrakes per truck">MAX_AIRBRAKES</a>);
<a name="l00213"></a>00213     m_rig-&gt;free_airbrake = 0;
<a name="l00214"></a>00214     memset(m_rig-&gt;skidtrails, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_skidmark.html">Skidmark</a> *) * (MAX_WHEELS*2));
<a name="l00215"></a>00215     memset(m_rig-&gt;flexbodies, 0, <span class="keyword">sizeof</span>(<a class="code" href="class_flex_body.html">FlexBody</a> *) * <a class="code" href="_beam_data_8h.html#a362bb9882ac976f00f9d374003efddf6" title="maximum number of flexbodies per truck">MAX_FLEXBODIES</a>);
<a name="l00216"></a>00216     m_rig-&gt;free_flexbody = 0;
<a name="l00217"></a>00217     m_rig-&gt;vidcams.clear();
<a name="l00218"></a>00218     m_rig-&gt;description.clear();
<a name="l00219"></a>00219     m_rig-&gt;free_axle = 0;
<a name="l00220"></a>00220     m_rig-&gt;free_camerarail = 0;
<a name="l00221"></a>00221     m_rig-&gt;free_screwprop = 0;
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     memset(m_rig-&gt;guid, 0, 128);
<a name="l00224"></a>00224     
<a name="l00225"></a>00225     m_rig-&gt;wingstart=-1;
<a name="l00226"></a>00226     
<a name="l00227"></a>00227     m_rig-&gt;realtruckname = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00228"></a>00228     m_rig-&gt;loading_finished=<span class="keyword">false</span>;
<a name="l00229"></a>00229     m_rig-&gt;forwardcommands=<span class="keyword">false</span>;
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     m_rig-&gt;wheel_contact_requested = <span class="keyword">false</span>;
<a name="l00232"></a>00232     m_rig-&gt;rescuer = <span class="keyword">false</span>;
<a name="l00233"></a>00233     m_rig-&gt;disable_default_sounds=<span class="keyword">false</span>;
<a name="l00234"></a>00234     m_rig-&gt;slopeBrake=<span class="keyword">false</span>;
<a name="l00235"></a>00235     m_rig-&gt;categoryid=-1;
<a name="l00236"></a>00236     m_rig-&gt;truckversion=-1;
<a name="l00237"></a>00237     m_rig-&gt;externalcameramode=0;
<a name="l00238"></a>00238     m_rig-&gt;externalcameranode=-1;
<a name="l00239"></a>00239     m_rig-&gt;authors.clear();
<a name="l00240"></a>00240     m_rig-&gt;slideNodesConnectInstantly=<span class="keyword">false</span>;
<a name="l00241"></a>00241 
<a name="l00242"></a>00242     m_rig-&gt;default_beam_diameter=<a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l00243"></a>00243     m_rig-&gt;skeleton_beam_diameter=<a class="code" href="_beam_data_8h.html#a018080ca3655ac538532b41b299db78b">BEAM_SKELETON_DIAMETER</a>;
<a name="l00244"></a>00244     strcpy(m_rig-&gt;default_beam_material, <span class="stringliteral">&quot;tracks/beam&quot;</span>);
<a name="l00245"></a>00245     m_rig-&gt;default_plastic_coef=0;
<a name="l00246"></a>00246     m_rig-&gt;default_node_friction=<a class="code" href="_beam_data_8h.html#ac09362aa1c172297e2183bc83c304821">NODE_FRICTION_COEF_DEFAULT</a>;
<a name="l00247"></a>00247     m_rig-&gt;default_node_volume=<a class="code" href="_beam_data_8h.html#aae1a4ddb7908bd67fc3e4a3b1ffb4130">NODE_VOLUME_COEF_DEFAULT</a>;
<a name="l00248"></a>00248     m_rig-&gt;default_node_surface=<a class="code" href="_beam_data_8h.html#aa0c8f23d8de6d37037c90f6e738cf91d">NODE_SURFACE_COEF_DEFAULT</a>;
<a name="l00249"></a>00249     m_rig-&gt;default_node_loadweight=<a class="code" href="_beam_data_8h.html#a78a2dfb0b752eaef12044bc13eabaaa2">NODE_LOADWEIGHT_DEFAULT</a>;
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     m_rig-&gt;odometerTotal = 0;
<a name="l00252"></a>00252     m_rig-&gt;odometerUser  = 0;
<a name="l00253"></a>00253     m_rig-&gt;dashBoardLayouts.clear();
<a name="l00254"></a>00254 
<a name="l00255"></a>00255     memset(m_rig-&gt;default_node_options, 0, 49);
<a name="l00256"></a>00256     memset(m_rig-&gt;texname, 0, 1023);
<a name="l00257"></a>00257     memset(m_rig-&gt;helpmat, 0, 255);
<a name="l00258"></a>00258     
<a name="l00259"></a>00259     m_rig-&gt;fadeDist=150.0;
<a name="l00260"></a>00260     m_rig-&gt;collrange=<a class="code" href="_beam_data_8h.html#a498129456e8c48d0afc634c3a1b3f799">DEFAULT_COLLISION_RANGE</a>;
<a name="l00261"></a>00261     m_rig-&gt;masscount=0;
<a name="l00262"></a>00262     m_rig-&gt;disable_smoke = !<a class="code" href="_settings_8h.html#aa2d5c758628dddfa26e73ca5a245222a">SETTINGS</a>.getBooleanSetting(<span class="stringliteral">&quot;Particles&quot;</span>, <span class="keyword">true</span>);
<a name="l00263"></a>00263     m_rig-&gt;smokeId=0;
<a name="l00264"></a>00264     m_rig-&gt;smokeRef=0;
<a name="l00265"></a>00265     m_rig-&gt;editorId=-1;
<a name="l00266"></a>00266     m_rig-&gt;beambreakdebug  = <a class="code" href="_settings_8h.html#aa2d5c758628dddfa26e73ca5a245222a">SETTINGS</a>.getBooleanSetting(<span class="stringliteral">&quot;Beam Break Debug&quot;</span>, <span class="keyword">false</span>);
<a name="l00267"></a>00267     m_rig-&gt;beamdeformdebug = <a class="code" href="_settings_8h.html#aa2d5c758628dddfa26e73ca5a245222a">SETTINGS</a>.getBooleanSetting(<span class="stringliteral">&quot;Beam Deform Debug&quot;</span>, <span class="keyword">false</span>);
<a name="l00268"></a>00268     m_rig-&gt;triggerdebug    = <a class="code" href="_settings_8h.html#aa2d5c758628dddfa26e73ca5a245222a">SETTINGS</a>.getBooleanSetting(<span class="stringliteral">&quot;Trigger Debug&quot;</span>, <span class="keyword">false</span>);
<a name="l00269"></a>00269     m_rig-&gt;rotaInertia = <span class="keyword">nullptr</span>;
<a name="l00270"></a>00270     m_rig-&gt;hydroInertia = <span class="keyword">nullptr</span>;
<a name="l00271"></a>00271     m_rig-&gt;cmdInertia = <span class="keyword">nullptr</span>;
<a name="l00272"></a>00272     m_rig-&gt;truckmass=0;
<a name="l00273"></a>00273     m_rig-&gt;loadmass=0;
<a name="l00274"></a>00274     m_rig-&gt;buoyance = <span class="keyword">nullptr</span>;
<a name="l00275"></a>00275 
<a name="l00276"></a>00276     m_rig-&gt;free_fixes=0;
<a name="l00277"></a>00277     m_rig-&gt;propwheelcount=0;
<a name="l00278"></a>00278     m_rig-&gt;free_commands=0;
<a name="l00279"></a>00279     m_rig-&gt;fileformatversion=0;
<a name="l00280"></a>00280     m_rig-&gt;sectionconfigs.clear();
<a name="l00281"></a>00281 
<a name="l00282"></a>00282     m_rig-&gt;origin=Ogre::Vector3::ZERO;
<a name="l00283"></a>00283     m_rig-&gt;mSlideNodes.clear();
<a name="l00284"></a>00284 
<a name="l00285"></a>00285     m_rig-&gt;engine = <span class="keyword">nullptr</span>;
<a name="l00286"></a>00286     m_rig-&gt;hascommands=0;
<a name="l00287"></a>00287     m_rig-&gt;hashelp=0;
<a name="l00288"></a>00288     m_rig-&gt;cinecameranodepos[0]=-1;
<a name="l00289"></a>00289     m_rig-&gt;freecinecamera=0;
<a name="l00290"></a>00290     m_rig-&gt;cablight = <span class="keyword">nullptr</span>;
<a name="l00291"></a>00291     m_rig-&gt;cablightNode = <span class="keyword">nullptr</span>;
<a name="l00292"></a>00292     m_rig-&gt;deletion_sceneNodes.clear();
<a name="l00293"></a>00293     m_rig-&gt;deletion_Objects.clear();
<a name="l00294"></a>00294     m_rig-&gt;netCustomLightArray[0] = -1;
<a name="l00295"></a>00295     m_rig-&gt;netCustomLightArray[1] = -1;
<a name="l00296"></a>00296     m_rig-&gt;netCustomLightArray[2] = -1;
<a name="l00297"></a>00297     m_rig-&gt;netCustomLightArray[3] = -1;
<a name="l00298"></a>00298     m_rig-&gt;netCustomLightArray_counter = 0;
<a name="l00299"></a>00299     m_rig-&gt;materialFunctionMapper = <span class="keyword">nullptr</span>;
<a name="l00300"></a>00300 
<a name="l00301"></a>00301     m_rig-&gt;driversseatfound=<span class="keyword">false</span>;
<a name="l00302"></a>00302     m_rig-&gt;ispolice=<span class="keyword">false</span>;
<a name="l00303"></a>00303     m_rig-&gt;state=<a class="code" href="_beam_data_8h.html#aaf8fd5f0e57d456151c951e0f3715fc4a488282601451a751e0f0e770b15d4235" title="not active, sleeping">SLEEPING</a>;
<a name="l00304"></a>00304     m_rig-&gt;heathaze=<span class="keyword">false</span>;
<a name="l00305"></a>00305     m_rig-&gt;autopilot = <span class="keyword">nullptr</span>;
<a name="l00306"></a>00306     m_rig-&gt;hfinder = <span class="keyword">nullptr</span>;
<a name="l00307"></a>00307     m_rig-&gt;fuseAirfoil = <span class="keyword">nullptr</span>;
<a name="l00308"></a>00308     m_rig-&gt;fuseFront = <span class="keyword">nullptr</span>;
<a name="l00309"></a>00309     m_rig-&gt;fuseBack = <span class="keyword">nullptr</span>;
<a name="l00310"></a>00310     m_rig-&gt;fuseWidth=0;
<a name="l00311"></a>00311     m_rig-&gt;brakeforce=30000.0;
<a name="l00312"></a>00312     m_rig-&gt;hbrakeforce = 2 * m_rig-&gt;brakeforce;
<a name="l00313"></a>00313     m_rig-&gt;debugVisuals = <a class="code" href="_settings_8h.html#aa2d5c758628dddfa26e73ca5a245222a">SETTINGS</a>.getBooleanSetting(<span class="stringliteral">&quot;DebugBeams&quot;</span>, <span class="keyword">false</span>);
<a name="l00314"></a>00314     m_rig-&gt;shadowOptimizations = <a class="code" href="_settings_8h.html#aa2d5c758628dddfa26e73ca5a245222a">SETTINGS</a>.getBooleanSetting(<span class="stringliteral">&quot;Shadow optimizations&quot;</span>, <span class="keyword">true</span>);
<a name="l00315"></a>00315 
<a name="l00316"></a>00316     m_rig-&gt;proped_wheels=0;
<a name="l00317"></a>00317     m_rig-&gt;braked_wheels=0;
<a name="l00318"></a>00318 
<a name="l00319"></a>00319     m_rig-&gt;speedomat = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00320"></a>00320     m_rig-&gt;tachomat = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00321"></a>00321     m_rig-&gt;speedoMax=140;
<a name="l00322"></a>00322     m_rig-&gt;useMaxRPMforGUI=<span class="keyword">false</span>;
<a name="l00323"></a>00323     m_rig-&gt;minimass=50.0;
<a name="l00324"></a>00324     m_rig-&gt;cparticle_enabled=<span class="keyword">false</span>;
<a name="l00325"></a>00325     m_rig-&gt;advanced_drag=<span class="keyword">false</span>;
<a name="l00326"></a>00326     m_rig-&gt;advanced_node_drag=0;
<a name="l00327"></a>00327     m_rig-&gt;advanced_total_drag=0;
<a name="l00328"></a>00328     m_rig-&gt;freecamera=0;
<a name="l00329"></a>00329     m_rig-&gt;hasEmissivePass=0;
<a name="l00330"></a>00330     m_rig-&gt;cabMesh = <span class="keyword">nullptr</span>;
<a name="l00331"></a>00331     m_rig-&gt;cabNode = <span class="keyword">nullptr</span>;
<a name="l00332"></a>00332     m_rig-&gt;cameranodepos[0]=-1;
<a name="l00333"></a>00333     m_rig-&gt;cameranodedir[0]=-1;
<a name="l00334"></a>00334     m_rig-&gt;cameranoderoll[0]=-1;
<a name="l00335"></a>00335     m_rig-&gt;lowestnode=0;
<a name="l00336"></a>00336 
<a name="l00337"></a>00337     m_rig-&gt;subMeshGroundModelName = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     m_rig-&gt;materialReplacer = <span class="keyword">new</span> <a class="code" href="class_material_replacer.html">MaterialReplacer</a>();
<a name="l00340"></a>00340 
<a name="l00341"></a>00341     m_rig-&gt;beamHash = <span class="stringliteral">&quot;&quot;</span>;
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     <span class="comment">/* Init code from Beam::Beam() */</span>
<a name="l00344"></a>00344 
<a name="l00345"></a>00345     m_rig-&gt;airbrakeval = 0;
<a name="l00346"></a>00346     m_rig-&gt;alb_minspeed = 0.0f;
<a name="l00347"></a>00347     m_rig-&gt;alb_mode = 0;
<a name="l00348"></a>00348     m_rig-&gt;alb_notoggle = <span class="keyword">false</span>;
<a name="l00349"></a>00349     m_rig-&gt;alb_notoggle = <span class="keyword">false</span>;
<a name="l00350"></a>00350     m_rig-&gt;alb_present = <span class="keyword">false</span>;
<a name="l00351"></a>00351     m_rig-&gt;alb_pulse = 1;
<a name="l00352"></a>00352     m_rig-&gt;alb_pulse_state = <span class="keyword">false</span>;
<a name="l00353"></a>00353     m_rig-&gt;alb_ratio = 0.0f;
<a name="l00354"></a>00354     m_rig-&gt;animTimer = 0.0f;
<a name="l00355"></a>00355     m_rig-&gt;antilockbrake = 0;
<a name="l00356"></a>00356 
<a name="l00357"></a>00357     m_rig-&gt;cabMesh = <span class="keyword">nullptr</span>;
<a name="l00358"></a>00358     m_rig-&gt;cablight = <span class="keyword">nullptr</span>;
<a name="l00359"></a>00359     m_rig-&gt;cablightNode = <span class="keyword">nullptr</span>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361     m_rig-&gt;cc_mode = <span class="keyword">false</span>;
<a name="l00362"></a>00362     m_rig-&gt;cc_can_brake = <span class="keyword">false</span>;
<a name="l00363"></a>00363     m_rig-&gt;cc_target_rpm = 0.0f;
<a name="l00364"></a>00364     m_rig-&gt;cc_target_speed = 0.0f;
<a name="l00365"></a>00365     m_rig-&gt;cc_target_speed_lower_limit = 0.0f;
<a name="l00366"></a>00366 
<a name="l00367"></a>00367     m_rig-&gt;collisionRelevant = <span class="keyword">false</span>;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369     m_rig-&gt;debugVisuals = 0;
<a name="l00370"></a>00370 
<a name="l00371"></a>00371     m_rig-&gt;driverSeat = <span class="keyword">nullptr</span>;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373     m_rig-&gt;heathaze = !m_rig-&gt;disable_smoke &amp;&amp; <a class="code" href="_settings_8h.html#af577ee09bf1afff38ddb26d32ce320fb">BSETTING</a>(<span class="stringliteral">&quot;HeatHaze&quot;</span>, <span class="keyword">false</span>);
<a name="l00374"></a>00374     m_rig-&gt;hideInChooser = <span class="keyword">false</span>;
<a name="l00375"></a>00375 
<a name="l00376"></a>00376     m_rig-&gt;previousCrank = 0.f;
<a name="l00377"></a>00377 
<a name="l00378"></a>00378     m_rig-&gt;sl_enabled = <span class="keyword">false</span>;
<a name="l00379"></a>00379     m_rig-&gt;sl_speed_limit = 0.f;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381     m_rig-&gt;tc_fade = 0.f;
<a name="l00382"></a>00382     m_rig-&gt;tc_mode = 0;
<a name="l00383"></a>00383     m_rig-&gt;tc_present = <span class="keyword">false</span>;
<a name="l00384"></a>00384     m_rig-&gt;tc_pulse = 1;
<a name="l00385"></a>00385     m_rig-&gt;tc_pulse_state = <span class="keyword">false</span>;
<a name="l00386"></a>00386     m_rig-&gt;tc_ratio = 0.f;
<a name="l00387"></a>00387     m_rig-&gt;tc_wheelslip = 0.f;
<a name="l00388"></a>00388     m_rig-&gt;tcalb_timer = 0.f;
<a name="l00389"></a>00389 
<a name="l00390"></a>00390     m_rig-&gt;tractioncontrol = 0;
<a name="l00391"></a>00391 
<a name="l00392"></a>00392 <span class="preprocessor">#ifdef USE_MYGUI</span>
<a name="l00393"></a>00393 <span class="preprocessor"></span>    m_rig-&gt;dash = <span class="keyword">new</span> DashBoardManager();
<a name="l00394"></a>00394 <span class="preprocessor">#endif // USE_MYGUI</span>
<a name="l00395"></a>00395 <span class="preprocessor"></span>
<a name="l00396"></a>00396 <span class="preprocessor">#ifdef FEAT_TIMING</span>
<a name="l00397"></a>00397 <span class="preprocessor"></span>    <span class="comment">// this enables beam engine timing statistics</span>
<a name="l00398"></a>00398     statistics = BES.getClient(tnum, BES_CORE);
<a name="l00399"></a>00399     statistics_gfx = BES.getClient(tnum, BES_GFX);
<a name="l00400"></a>00400 <span class="preprocessor">#endif</span>
<a name="l00401"></a>00401 <span class="preprocessor"></span>
<a name="l00402"></a>00402     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;<a class="code" href="_beam_data_8h.html#a959c5481bfa137d1373cad16bd46ca7c" title="maximum number of submeshes per truck">MAX_SUBMESHES</a>; i++)
<a name="l00403"></a>00403     {
<a name="l00404"></a>00404         m_rig-&gt;subisback[i] = 0;
<a name="l00405"></a>00405     }
<a name="l00406"></a>00406 
<a name="l00407"></a>00407     m_rig-&gt;simpleSkeletonNode = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l00408"></a>00408     m_rig-&gt;deletion_sceneNodes.emplace_back(m_rig-&gt;simpleSkeletonNode);
<a name="l00409"></a>00409     
<a name="l00410"></a>00410     m_rig-&gt;beamsRoot = m_parent_scene_node;
<a name="l00411"></a>00411 
<a name="l00412"></a>00412     <span class="comment">/* Collisions */</span>
<a name="l00413"></a>00413 
<a name="l00414"></a>00414     m_rig-&gt;disableTruckTruckCollisions = <a class="code" href="_settings_8h.html#af577ee09bf1afff38ddb26d32ce320fb">BSETTING</a>(<span class="stringliteral">&quot;DisableCollisions&quot;</span>, <span class="keyword">false</span>);
<a name="l00415"></a>00415     <span class="keywordflow">if</span> (! m_rig-&gt;disableTruckTruckCollisions)
<a name="l00416"></a>00416     {
<a name="l00417"></a>00417         m_rig-&gt;interPointCD.emplace_back(<span class="keyword">new</span> <a class="code" href="class_point_col_detector.html">PointColDetector</a>());
<a name="l00418"></a>00418 
<a name="l00419"></a>00419         <span class="keywordflow">if</span> (<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#a5b16b464ffb3cd25e416587a6d8bb9e6">threadPool</a> != <span class="keyword">nullptr</span>)
<a name="l00420"></a>00420         {
<a name="l00421"></a>00421             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#a5b16b464ffb3cd25e416587a6d8bb9e6">threadPool</a>-&gt;<a class="code" href="class_thread_pool.html#a65dde5de8c8cd0a58edf75897182089e">getSize</a>(); i++)
<a name="l00422"></a>00422             {
<a name="l00423"></a>00423                 m_rig-&gt;interPointCD.emplace_back(<span class="keyword">new</span> <a class="code" href="class_point_col_detector.html">PointColDetector</a>());
<a name="l00424"></a>00424             }
<a name="l00425"></a>00425         }
<a name="l00426"></a>00426     }
<a name="l00427"></a>00427     m_rig-&gt;disableTruckTruckSelfCollisions = <a class="code" href="_settings_8h.html#af577ee09bf1afff38ddb26d32ce320fb">BSETTING</a>(<span class="stringliteral">&quot;DisableSelfCollisions&quot;</span>, <span class="keyword">false</span>);
<a name="l00428"></a>00428     <span class="keywordflow">if</span> (! m_rig-&gt;disableTruckTruckSelfCollisions)
<a name="l00429"></a>00429     {
<a name="l00430"></a>00430         m_rig-&gt;intraPointCD.emplace_back(<span class="keyword">new</span> <a class="code" href="class_point_col_detector.html">PointColDetector</a>());
<a name="l00431"></a>00431 
<a name="l00432"></a>00432         <span class="keywordflow">if</span> (<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#a5b16b464ffb3cd25e416587a6d8bb9e6">threadPool</a> != <span class="keyword">nullptr</span>)
<a name="l00433"></a>00433         {
<a name="l00434"></a>00434             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=1; i&lt;<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#a5b16b464ffb3cd25e416587a6d8bb9e6">threadPool</a>-&gt;<a class="code" href="class_thread_pool.html#a65dde5de8c8cd0a58edf75897182089e">getSize</a>(); i++)
<a name="l00435"></a>00435             {
<a name="l00436"></a>00436                 m_rig-&gt;intraPointCD.emplace_back(<span class="keyword">new</span> <a class="code" href="class_point_col_detector.html">PointColDetector</a>());
<a name="l00437"></a>00437             }
<a name="l00438"></a>00438         }
<a name="l00439"></a>00439     }
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     m_rig-&gt;submesh_ground_model = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#ade116fce13c1146004478e54b19ce5d3">collisions</a>-&gt;<a class="code" href="class_collisions.html#aa8d0184cb98d4141bccad32cc50fde1d">defaultgm</a>;
<a name="l00442"></a>00442     m_rig-&gt;cparticle_enabled = <a class="code" href="_settings_8h.html#af577ee09bf1afff38ddb26d32ce320fb">BSETTING</a>(<span class="stringliteral">&quot;Particles&quot;</span>, <span class="keyword">true</span>);
<a name="l00443"></a>00443     m_rig-&gt;dustp   = <a class="code" href="class_ro_r_singleton_no_creation.html#a5e7a47f4b2d6d0abaa3a1ea5ca1f216a">DustManager::getSingleton</a>().<a class="code" href="class_dust_manager.html#a01145e464e1e5fb0fd2d90b115504640">getDustPool</a>(<span class="stringliteral">&quot;dust&quot;</span>);
<a name="l00444"></a>00444     m_rig-&gt;dripp   = <a class="code" href="class_ro_r_singleton_no_creation.html#a5e7a47f4b2d6d0abaa3a1ea5ca1f216a">DustManager::getSingleton</a>().<a class="code" href="class_dust_manager.html#a01145e464e1e5fb0fd2d90b115504640">getDustPool</a>(<span class="stringliteral">&quot;dripp&quot;</span>);
<a name="l00445"></a>00445     m_rig-&gt;sparksp = <a class="code" href="class_ro_r_singleton_no_creation.html#a5e7a47f4b2d6d0abaa3a1ea5ca1f216a">DustManager::getSingleton</a>().<a class="code" href="class_dust_manager.html#a01145e464e1e5fb0fd2d90b115504640">getDustPool</a>(<span class="stringliteral">&quot;sparks&quot;</span>);
<a name="l00446"></a>00446     m_rig-&gt;clumpp  = <a class="code" href="class_ro_r_singleton_no_creation.html#a5e7a47f4b2d6d0abaa3a1ea5ca1f216a">DustManager::getSingleton</a>().<a class="code" href="class_dust_manager.html#a01145e464e1e5fb0fd2d90b115504640">getDustPool</a>(<span class="stringliteral">&quot;clump&quot;</span>);
<a name="l00447"></a>00447     m_rig-&gt;splashp = <a class="code" href="class_ro_r_singleton_no_creation.html#a5e7a47f4b2d6d0abaa3a1ea5ca1f216a">DustManager::getSingleton</a>().<a class="code" href="class_dust_manager.html#a01145e464e1e5fb0fd2d90b115504640">getDustPool</a>(<span class="stringliteral">&quot;splash&quot;</span>);
<a name="l00448"></a>00448     m_rig-&gt;ripplep = <a class="code" href="class_ro_r_singleton_no_creation.html#a5e7a47f4b2d6d0abaa3a1ea5ca1f216a">DustManager::getSingleton</a>().<a class="code" href="class_dust_manager.html#a01145e464e1e5fb0fd2d90b115504640">getDustPool</a>(<span class="stringliteral">&quot;ripple&quot;</span>);
<a name="l00449"></a>00449 
<a name="l00450"></a>00450     m_rig-&gt;materialFunctionMapper = <span class="keyword">new</span> <a class="code" href="class_material_function_mapper.html">MaterialFunctionMapper</a>();
<a name="l00451"></a>00451     m_rig-&gt;cmdInertia   = <span class="keyword">new</span> <a class="code" href="class_cmd_key_inertia.html">CmdKeyInertia</a>();
<a name="l00452"></a>00452     m_rig-&gt;hydroInertia = <span class="keyword">new</span> <a class="code" href="class_cmd_key_inertia.html">CmdKeyInertia</a>();
<a name="l00453"></a>00453     m_rig-&gt;rotaInertia  = <span class="keyword">new</span> <a class="code" href="class_cmd_key_inertia.html">CmdKeyInertia</a>();
<a name="l00454"></a>00454 
<a name="l00455"></a>00455     <span class="comment">// Lights mode</span>
<a name="l00456"></a>00456     m_rig-&gt;flaresMode = <a class="code" href="class_ro_r_singleton.html#a18a797fc35bd8cfa8a2affdd197cbfee">Settings::getSingleton</a>().<a class="code" href="class_settings.html#a26a86d7eb0e754bc7bf3d13e0b266706">GetFlaresMode</a>(); <span class="comment">// Default = 2 (All vehicles, main lights)</span>
<a name="l00457"></a>00457 
<a name="l00458"></a>00458     m_flex_factory = <a class="code" href="class_ro_r_1_1_flex_factory.html">RoR::FlexFactory</a>(
<a name="l00459"></a>00459         m_rig-&gt;materialFunctionMapper, 
<a name="l00460"></a>00460         m_rig-&gt;materialReplacer, 
<a name="l00461"></a>00461         m_rig-&gt;usedSkin, 
<a name="l00462"></a>00462         m_rig-&gt;nodes,
<a name="l00463"></a>00463         <a class="code" href="_settings_8h.html#af577ee09bf1afff38ddb26d32ce320fb">BSETTING</a>(<span class="stringliteral">&quot;Flexbody_UseCache&quot;</span>, <span class="keyword">false</span>),
<a name="l00464"></a>00464         m_cache_entry_number
<a name="l00465"></a>00465         );
<a name="l00466"></a>00466 
<a name="l00467"></a>00467     m_flex_factory.CheckAndLoadFlexbodyCache();
<a name="l00468"></a>00468 }
<a name="l00469"></a>00469 
<a name="l00470"></a><a class="code" href="class_rig_spawner.html#a5396849b5b3d28cdd02a408803e14851">00470</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a5396849b5b3d28cdd02a408803e14851">RigSpawner::FinalizeRig</a>()
<a name="l00471"></a>00471 {
<a name="l00472"></a>00472     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00473"></a>00473 
<a name="l00474"></a>00474     <span class="comment">// we should post-process the torque curve if existing</span>
<a name="l00475"></a>00475     <span class="keywordflow">if</span> (m_rig-&gt;engine)
<a name="l00476"></a>00476     {
<a name="l00477"></a>00477         <span class="keywordtype">int</span> result = m_rig-&gt;engine-&gt;getTorqueCurve()-&gt;spaceCurveEvenly(m_rig-&gt;engine-&gt;getTorqueCurve()-&gt;getUsedSpline());
<a name="l00478"></a>00478         <span class="keywordflow">if</span> (result)
<a name="l00479"></a>00479         {
<a name="l00480"></a>00480             m_rig-&gt;engine-&gt;getTorqueCurve()-&gt;setTorqueModel(<span class="stringliteral">&quot;default&quot;</span>);
<a name="l00481"></a>00481             <span class="keywordflow">if</span> (result == 1)
<a name="l00482"></a>00482             {
<a name="l00483"></a>00483                 AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;TorqueCurve: Points (rpm) must be in an ascending order. Using default curve&quot;</span>);
<a name="l00484"></a>00484             }
<a name="l00485"></a>00485         }
<a name="l00486"></a>00486 
<a name="l00487"></a>00487         <span class="comment">//Gearbox</span>
<a name="l00488"></a>00488         m_rig-&gt;engine-&gt;setAutoMode(<a class="code" href="class_ro_r_singleton.html#a18a797fc35bd8cfa8a2affdd197cbfee">Settings::getSingleton</a>().GetGearBoxMode());
<a name="l00489"></a>00489     }
<a name="l00490"></a>00490     
<a name="l00491"></a>00491     <span class="comment">//calculate gwps height offset</span>
<a name="l00492"></a>00492     <span class="comment">//get a starting value</span>
<a name="l00493"></a>00493     m_rig-&gt;posnode_spawn_height=m_rig-&gt;nodes[0].RelPosition.y;
<a name="l00494"></a>00494     <span class="comment">//start at 0 to avoid a crash whith a 1-node truck</span>
<a name="l00495"></a>00495     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;m_rig-&gt;free_node; i++)
<a name="l00496"></a>00496     {
<a name="l00497"></a>00497         <span class="comment">// scan and store the y-coord for the lowest node of the truck</span>
<a name="l00498"></a>00498         <span class="keywordflow">if</span> (m_rig-&gt;nodes[i].RelPosition.y &lt;= m_rig-&gt;posnode_spawn_height)
<a name="l00499"></a>00499         {
<a name="l00500"></a>00500             m_rig-&gt;posnode_spawn_height = m_rig-&gt;nodes[i].RelPosition.y;
<a name="l00501"></a>00501         }
<a name="l00502"></a>00502     }
<a name="l00503"></a>00503 
<a name="l00504"></a>00504     <span class="keywordflow">if</span> (m_rig-&gt;cameranodepos[0] &gt; 0)
<a name="l00505"></a>00505     {
<a name="l00506"></a>00506         <span class="comment">// store the y-difference between the trucks lowest node and the campos-node for the gwps system</span>
<a name="l00507"></a>00507         m_rig-&gt;posnode_spawn_height = m_rig-&gt;nodes[m_rig-&gt;cameranodepos[0]].RelPosition.y - m_rig-&gt;posnode_spawn_height;
<a name="l00508"></a>00508     } 
<a name="l00509"></a>00509     <span class="keywordflow">else</span>
<a name="l00510"></a>00510     {
<a name="l00511"></a>00511         <span class="comment">//this can not be an airplane, just set it to 0.</span>
<a name="l00512"></a>00512         m_rig-&gt;posnode_spawn_height = 0.0f;
<a name="l00513"></a>00513     }
<a name="l00514"></a>00514 
<a name="l00515"></a>00515     <span class="comment">//cameras workaround</span>
<a name="l00516"></a>00516     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;m_rig-&gt;freecamera; i++)
<a name="l00517"></a>00517     {
<a name="l00518"></a>00518         <span class="comment">//LogManager::getSingleton().logMessage(&quot;Camera dir=&quot;+StringConverter::toString(nodes[cameranodedir[i]].RelPosition-nodes[cameranodepos[i]].RelPosition)+&quot; roll=&quot;+StringConverter::toString(nodes[cameranoderoll[i]].RelPosition-nodes[cameranodepos[i]].RelPosition));</span>
<a name="l00519"></a>00519         Ogre::Vector3 dir_node_offset = GetNode(m_rig-&gt;cameranodedir[i]).RelPosition - GetNode(m_rig-&gt;cameranodepos[i]).RelPosition;
<a name="l00520"></a>00520         Ogre::Vector3 roll_node_offset = GetNode(m_rig-&gt;cameranoderoll[i]).RelPosition - GetNode(m_rig-&gt;cameranodepos[i]).RelPosition;
<a name="l00521"></a>00521         Ogre::Vector3 cross = dir_node_offset.crossProduct(roll_node_offset);
<a name="l00522"></a>00522         
<a name="l00523"></a>00523         m_rig-&gt;revroll[i]=cross.y &gt; 0;<span class="comment">//(nodes[cameranodedir[i]].RelPosition-nodes[cameranodepos[i]].RelPosition).crossProduct(nodes[cameranoderoll[i]].RelPosition-nodes[cameranodepos[i]].RelPosition).y&gt;0;</span>
<a name="l00524"></a>00524         <span class="keywordflow">if</span> (m_rig-&gt;revroll[i])
<a name="l00525"></a>00525         {
<a name="l00526"></a>00526             AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;camera definition is probably invalid and has been corrected. It should be center, back, left&quot;</span>);
<a name="l00527"></a>00527         }
<a name="l00528"></a>00528     }
<a name="l00529"></a>00529     
<a name="l00530"></a>00530     <span class="comment">//wing closure</span>
<a name="l00531"></a>00531     <span class="keywordflow">if</span> (m_rig-&gt;wingstart!=-1)
<a name="l00532"></a>00532     {
<a name="l00533"></a>00533         <span class="keywordflow">if</span> (m_rig-&gt;autopilot != <span class="keyword">nullptr</span>) 
<a name="l00534"></a>00534         {
<a name="l00535"></a>00535             m_rig-&gt;autopilot-&gt;setInertialReferences(
<a name="l00536"></a>00536                 &amp; GetNode(m_airplane_left_light),
<a name="l00537"></a>00537                 &amp; GetNode(m_airplane_right_light),
<a name="l00538"></a>00538                 m_rig-&gt;fuseBack,
<a name="l00539"></a>00539                 &amp; GetNode(m_rig-&gt;cameranodepos[0])
<a name="l00540"></a>00540                 );
<a name="l00541"></a>00541         }
<a name="l00542"></a>00542         <span class="comment">//inform wing segments</span>
<a name="l00543"></a>00543         <span class="keywordtype">float</span> span=GetNode(m_rig-&gt;wings[m_rig-&gt;wingstart].fa-&gt;nfrd).RelPosition.distance(GetNode(m_rig-&gt;wings[m_rig-&gt;free_wing-1].fa-&gt;nfld).RelPosition);
<a name="l00544"></a>00544         
<a name="l00545"></a>00545         <span class="comment">//parser_warning(c, &quot;Full Wing &quot;+TOSTRING(wingstart)+&quot;-&quot;+TOSTRING(free_wing-1)+&quot; SPAN=&quot;+TOSTRING(span)+&quot; AREA=&quot;+TOSTRING(wingarea), PARSER_INFO);</span>
<a name="l00546"></a>00546         m_rig-&gt;wings[m_rig-&gt;wingstart].fa-&gt;enableInducedDrag(span,m_wing_area, <span class="keyword">false</span>);
<a name="l00547"></a>00547         m_rig-&gt;wings[m_rig-&gt;free_wing-1].fa-&gt;enableInducedDrag(span,m_wing_area, <span class="keyword">true</span>);
<a name="l00548"></a>00548         <span class="comment">//wash calculator</span>
<a name="l00549"></a>00549         WashCalculator(m_spawn_rotation);
<a name="l00550"></a>00550     }
<a name="l00551"></a>00551     <span class="comment">//add the cab visual</span>
<a name="l00552"></a>00552     <span class="keywordflow">if</span> (m_rig-&gt;free_texcoord&gt;0 &amp;&amp; m_rig-&gt;free_cab&gt;0)
<a name="l00553"></a>00553     {
<a name="l00554"></a>00554         <span class="comment">//closure</span>
<a name="l00555"></a>00555         m_rig-&gt;subtexcoords[m_rig-&gt;free_sub]=m_rig-&gt;free_texcoord;
<a name="l00556"></a>00556         m_rig-&gt;subcabs[m_rig-&gt;free_sub]=m_rig-&gt;free_cab;
<a name="l00557"></a>00557         <span class="keywordtype">char</span> wname[256];
<a name="l00558"></a>00558         sprintf(wname, <span class="stringliteral">&quot;cab-%s&quot;</span>,m_rig-&gt;truckname);
<a name="l00559"></a>00559         <span class="keywordtype">char</span> wnamei[256];
<a name="l00560"></a>00560         sprintf(wnamei, <span class="stringliteral">&quot;cabobj-%s&quot;</span>,m_rig-&gt;truckname);
<a name="l00561"></a>00561         <span class="comment">//the cab materials are as follow:</span>
<a name="l00562"></a>00562         <span class="comment">//texname: base texture with emissive(2 pass) or without emissive if none available(1 pass), alpha cutting</span>
<a name="l00563"></a>00563         <span class="comment">//texname-trans: transparency texture (1 pass)</span>
<a name="l00564"></a>00564         <span class="comment">//texname-back: backface texture: black+alpha cutting (1 pass)</span>
<a name="l00565"></a>00565         <span class="comment">//texname-noem: base texture without emissive (1 pass), alpha cutting</span>
<a name="l00566"></a>00566 
<a name="l00567"></a>00567         <span class="comment">//material passes must be:</span>
<a name="l00568"></a>00568         <span class="comment">//0: normal texture</span>
<a name="l00569"></a>00569         <span class="comment">//1: transparent (windows)</span>
<a name="l00570"></a>00570         <span class="comment">//2: emissive</span>
<a name="l00571"></a>00571         <span class="comment">/*strcpy(texname, &quot;testtex&quot;);</span>
<a name="l00572"></a>00572 <span class="comment">        char transmatname[256];</span>
<a name="l00573"></a>00573 <span class="comment">        sprintf(transmatname, &quot;%s-trans&quot;, texname);</span>
<a name="l00574"></a>00574 <span class="comment">        char backmatname[256];</span>
<a name="l00575"></a>00575 <span class="comment">        sprintf(backmatname, &quot;%s-back&quot;, texname);</span>
<a name="l00576"></a>00576 <span class="comment">        hasEmissivePass=1;*/</span>
<a name="l00577"></a>00577 
<a name="l00578"></a>00578         Ogre::MaterialPtr mat=Ogre::MaterialManager::getSingleton().getByName(m_rig-&gt;texname);
<a name="l00579"></a>00579         <span class="keywordflow">if</span> (mat.isNull())
<a name="l00580"></a>00580         {
<a name="l00581"></a>00581             
<a name="l00582"></a>00582 <span class="preprocessor">#ifdef USE_MYGUI</span>
<a name="l00583"></a>00583 <span class="preprocessor"></span>            RoR::Console *console = <a class="code" href="class_ro_r_1_1_application.html#ad66b6a7000f93454d75f1150d6959141">RoR::Application::GetConsole</a>();
<a name="l00584"></a>00584             <span class="keywordflow">if</span> (console) console-&gt;putMessage(
<a name="l00585"></a>00585                 Console::CONSOLE_MSGTYPE_INFO, 
<a name="l00586"></a>00586                 Console::CONSOLE_SYSTEM_ERROR, 
<a name="l00587"></a>00587                 <span class="stringliteral">&quot;unable to load vehicle (Material &#39;&quot;</span>+Ogre::String(m_rig-&gt;texname)+<span class="stringliteral">&quot;&#39; missing!): &quot;</span> + m_rig-&gt;realtruckname, 
<a name="l00588"></a>00588                 <span class="stringliteral">&quot;error.png&quot;</span>, 
<a name="l00589"></a>00589                 30000, 
<a name="l00590"></a>00590                 <span class="keyword">true</span>
<a name="l00591"></a>00591             );
<a name="l00592"></a>00592             <a class="code" href="class_ro_r_1_1_application.html#a3db1b8c7dc6bf465f5ed653ef4a8ce9a">RoR::Application::GetGuiManager</a>()-&gt;<a class="code" href="class_ro_r_1_1_g_u_i_manager.html#ae4edd69226416a7be139959fd71319ea">PushNotification</a>(<span class="stringliteral">&quot;Notice:&quot;</span>, <span class="stringliteral">&quot;unable to load vehicle (Material &#39;&quot;</span> + Ogre::String(m_rig-&gt;texname) + <span class="stringliteral">&quot;&#39; missing!): &quot;</span> + m_rig-&gt;realtruckname);
<a name="l00593"></a>00593 <span class="preprocessor">#endif // USE_MYGUI</span>
<a name="l00594"></a>00594 <span class="preprocessor"></span>
<a name="l00595"></a>00595             Ogre::String msg = <span class="stringliteral">&quot;Material &#39;&quot;</span>+Ogre::String(m_rig-&gt;texname)+<span class="stringliteral">&quot;&#39; missing!&quot;</span>;
<a name="l00596"></a>00596             AddMessage(Message::TYPE_ERROR, msg);
<a name="l00597"></a>00597             <span class="keywordflow">return</span>;
<a name="l00598"></a>00598         }
<a name="l00599"></a>00599 
<a name="l00600"></a>00600         <span class="comment">//-trans</span>
<a name="l00601"></a>00601         <span class="keywordtype">char</span> transmatname[256];
<a name="l00602"></a>00602         sprintf(transmatname, <span class="stringliteral">&quot;%s-trans&quot;</span>, m_rig-&gt;texname);
<a name="l00603"></a>00603         Ogre::MaterialPtr transmat=mat-&gt;clone(transmatname);
<a name="l00604"></a>00604         <span class="keywordflow">if</span> (mat-&gt;getTechnique(0)-&gt;getNumPasses()&gt;1)
<a name="l00605"></a>00605         {
<a name="l00606"></a>00606             transmat-&gt;getTechnique(0)-&gt;removePass(1);
<a name="l00607"></a>00607         }
<a name="l00608"></a>00608         transmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;setAlphaRejectSettings(Ogre::CMPF_LESS_EQUAL, 128);
<a name="l00609"></a>00609         transmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;setDepthWriteEnabled(<span class="keyword">false</span>);
<a name="l00610"></a>00610         <span class="keywordflow">if</span> (transmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;getNumTextureUnitStates()&gt;0)
<a name="l00611"></a>00611         {
<a name="l00612"></a>00612             transmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;getTextureUnitState(0)-&gt;setTextureFiltering(Ogre::TFO_NONE);
<a name="l00613"></a>00613         }
<a name="l00614"></a>00614         transmat-&gt;compile();
<a name="l00615"></a>00615 
<a name="l00616"></a>00616         <span class="comment">//-back</span>
<a name="l00617"></a>00617         <span class="keywordtype">char</span> backmatname[256];
<a name="l00618"></a>00618         sprintf(backmatname, <span class="stringliteral">&quot;%s-back&quot;</span>, m_rig-&gt;texname);
<a name="l00619"></a>00619         Ogre::MaterialPtr backmat=mat-&gt;clone(backmatname);
<a name="l00620"></a>00620         <span class="keywordflow">if</span> (mat-&gt;getTechnique(0)-&gt;getNumPasses()&gt;1)
<a name="l00621"></a>00621         {
<a name="l00622"></a>00622             backmat-&gt;getTechnique(0)-&gt;removePass(1);
<a name="l00623"></a>00623         }
<a name="l00624"></a>00624         <span class="keywordflow">if</span> (transmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;getNumTextureUnitStates()&gt;0)
<a name="l00625"></a>00625         {
<a name="l00626"></a>00626             backmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;getTextureUnitState(0)-&gt;setColourOperationEx(
<a name="l00627"></a>00627                 Ogre::LBX_SOURCE1, 
<a name="l00628"></a>00628                 Ogre::LBS_MANUAL, 
<a name="l00629"></a>00629                 Ogre::LBS_MANUAL, 
<a name="l00630"></a>00630                 Ogre::ColourValue(0,0,0),
<a name="l00631"></a>00631                 Ogre::ColourValue(0,0,0)
<a name="l00632"></a>00632             );
<a name="l00633"></a>00633         }
<a name="l00634"></a>00634         <span class="keywordflow">if</span> (m_rig-&gt;shadowOptimizations)
<a name="l00635"></a>00635         {
<a name="l00636"></a>00636             backmat-&gt;setReceiveShadows(<span class="keyword">false</span>);
<a name="l00637"></a>00637         }
<a name="l00638"></a>00638         <span class="comment">//just in case</span>
<a name="l00639"></a>00639         <span class="comment">//backmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;setSceneBlending(SBT_TRANSPARENT_ALPHA);</span>
<a name="l00640"></a>00640         <span class="comment">//backmat-&gt;getTechnique(0)-&gt;getPass(0)-&gt;setAlphaRejectSettings(CMPF_GREATER, 128);</span>
<a name="l00641"></a>00641         backmat-&gt;compile();
<a name="l00642"></a>00642 
<a name="l00643"></a>00643         <span class="comment">//-noem and -noem-trans</span>
<a name="l00644"></a>00644         <span class="keywordflow">if</span> (mat-&gt;getTechnique(0)-&gt;getNumPasses()&gt;1)
<a name="l00645"></a>00645         {
<a name="l00646"></a>00646             m_rig-&gt;hasEmissivePass=1;
<a name="l00647"></a>00647             <span class="keywordtype">char</span> clomatname[256];
<a name="l00648"></a>00648             sprintf(clomatname, <span class="stringliteral">&quot;%s-noem&quot;</span>, m_rig-&gt;texname);
<a name="l00649"></a>00649             Ogre::MaterialPtr clomat=mat-&gt;clone(clomatname);
<a name="l00650"></a>00650             clomat-&gt;getTechnique(0)-&gt;removePass(1);
<a name="l00651"></a>00651             clomat-&gt;compile();
<a name="l00652"></a>00652         }
<a name="l00653"></a>00653 
<a name="l00654"></a>00654         <span class="comment">//base texture is not modified</span>
<a name="l00655"></a>00655         <span class="comment">//  mat-&gt;compile();</span>
<a name="l00656"></a>00656 
<a name="l00657"></a>00657 
<a name="l00658"></a>00658         <span class="comment">//parser_warning(c, &quot;creating mesh&quot;, PARSER_INFO);</span>
<a name="l00659"></a>00659         m_rig-&gt;cabMesh =<span class="keyword">new</span> <a class="code" href="class_flex_obj.html">FlexObj</a>(
<a name="l00660"></a>00660             m_rig-&gt;nodes, 
<a name="l00661"></a>00661             m_rig-&gt;free_texcoord, 
<a name="l00662"></a>00662             m_rig-&gt;texcoords, 
<a name="l00663"></a>00663             m_rig-&gt;free_cab, 
<a name="l00664"></a>00664             m_rig-&gt;cabs, 
<a name="l00665"></a>00665             m_rig-&gt;free_sub, 
<a name="l00666"></a>00666             m_rig-&gt;subtexcoords, 
<a name="l00667"></a>00667             m_rig-&gt;subcabs, 
<a name="l00668"></a>00668             m_rig-&gt;texname, 
<a name="l00669"></a>00669             wname, 
<a name="l00670"></a>00670             m_rig-&gt;subisback, 
<a name="l00671"></a>00671             backmatname, 
<a name="l00672"></a>00672             transmatname
<a name="l00673"></a>00673         );
<a name="l00674"></a>00674         <span class="comment">//parser_warning(c, &quot;creating entity&quot;, PARSER_INFO);</span>
<a name="l00675"></a>00675 
<a name="l00676"></a>00676         
<a name="l00677"></a>00677         <span class="comment">//parser_warning(c, &quot;creating cabnode&quot;, PARSER_INFO);</span>
<a name="l00678"></a>00678         m_rig-&gt;cabNode = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l00679"></a>00679         Ogre::Entity *ec = <span class="keyword">nullptr</span>;
<a name="l00680"></a>00680         <span class="keywordflow">try</span>
<a name="l00681"></a>00681         {
<a name="l00682"></a>00682             <span class="comment">//parser_warning(c, &quot;loading cab&quot;, PARSER_INFO);</span>
<a name="l00683"></a>00683             ec = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createEntity(wnamei, wname);
<a name="l00684"></a>00684             <span class="comment">//      ec-&gt;setRenderQueueGroup(RENDER_QUEUE_6);</span>
<a name="l00685"></a>00685             <span class="comment">//parser_warning(c, &quot;attaching cab&quot;, PARSER_INFO);</span>
<a name="l00686"></a>00686             <span class="keywordflow">if</span> (ec)
<a name="l00687"></a>00687             {
<a name="l00688"></a>00688                 m_rig-&gt;deletion_Entities.emplace_back(ec);
<a name="l00689"></a>00689                 m_rig-&gt;cabNode-&gt;attachObject(ec);
<a name="l00690"></a>00690             }
<a name="l00691"></a>00691         } <span class="keywordflow">catch</span>(...)
<a name="l00692"></a>00692         {
<a name="l00693"></a>00693             <span class="comment">//parser_warning(c, &quot;error loading mesh: &quot;+String(wname));</span>
<a name="l00694"></a>00694             Ogre::String msg = <span class="stringliteral">&quot;error loading mesh: &quot;</span>+Ogre::String(wname);
<a name="l00695"></a>00695             AddMessage(Message::TYPE_ERROR, msg);
<a name="l00696"></a>00696         }
<a name="l00697"></a>00697         <a class="code" href="class_material_function_mapper.html#abee8fd1cc0b52699d3babb4b5e84b477">MaterialFunctionMapper::replaceSimpleMeshMaterials</a>(ec, Ogre::ColourValue(0.5, 1, 0.5));
<a name="l00698"></a>00698         <span class="keywordflow">if</span> (m_rig-&gt;materialFunctionMapper != <span class="keyword">nullptr</span>)
<a name="l00699"></a>00699         {
<a name="l00700"></a>00700             m_rig-&gt;materialFunctionMapper-&gt;replaceMeshMaterials(ec);
<a name="l00701"></a>00701         }
<a name="l00702"></a>00702         <span class="keywordflow">if</span> (m_rig-&gt;materialReplacer != <span class="keyword">nullptr</span>) 
<a name="l00703"></a>00703         {
<a name="l00704"></a>00704             m_rig-&gt;materialReplacer-&gt;replaceMeshMaterials(ec);
<a name="l00705"></a>00705         }
<a name="l00706"></a>00706         <span class="keywordflow">if</span> (m_rig-&gt;usedSkin != <span class="keyword">nullptr</span>) 
<a name="l00707"></a>00707         {
<a name="l00708"></a>00708             m_rig-&gt;usedSkin-&gt;replaceMeshMaterials(ec);
<a name="l00709"></a>00709         }
<a name="l00710"></a>00710         
<a name="l00711"></a>00711     };
<a name="l00712"></a>00712     <span class="comment">//parser_warning(c, &quot;cab ok&quot;, PARSER_INFO);</span>
<a name="l00713"></a>00713     <span class="comment">//  mWindow-&gt;setDebugText(&quot;Beam number:&quot;+ TOSTRING(free_beam));</span>
<a name="l00714"></a>00714 <span class="comment">/*</span>
<a name="l00715"></a>00715 <span class="comment">    if (c.mode == BTS_DESCRIPTION)</span>
<a name="l00716"></a>00716 <span class="comment">        parser_warning(c, &quot;description section not closed with end_description&quot;, PARSER_ERROR);</span>
<a name="l00717"></a>00717 <span class="comment"></span>
<a name="l00718"></a>00718 <span class="comment">    if (c.mode == BTS_COMMENT)</span>
<a name="l00719"></a>00719 <span class="comment">        parser_warning(c, &quot;comment section not closed with end_comment&quot;, PARSER_ERROR);</span>
<a name="l00720"></a>00720 <span class="comment"></span>
<a name="l00721"></a>00721 <span class="comment">    if (c.mode == BTS_SECTION)</span>
<a name="l00722"></a>00722 <span class="comment">        parser_warning(c, &quot;section section not closed with end_section&quot;, PARSER_ERROR);</span>
<a name="l00723"></a>00723 <span class="comment">*/</span>
<a name="l00724"></a>00724     <span class="comment">// check for some things</span>
<a name="l00725"></a>00725     <span class="keywordflow">if</span> (<a class="code" href="_configurator_8cpp.html#a105f80a57069a60fd80f602cbd20d0f4">strnlen</a>(m_rig-&gt;guid, 128) == 0)
<a name="l00726"></a>00726     {
<a name="l00727"></a>00727         <span class="comment">//parser_warning(c, &quot;vehicle uses no GUID, skinning will be impossible&quot;, PARSER_OBSOLETE);</span>
<a name="l00728"></a>00728         AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;vehicle uses no GUID, skinning will be impossible&quot;</span>);
<a name="l00729"></a>00729     }
<a name="l00730"></a>00730 
<a name="l00731"></a>00731     m_rig-&gt;lowestnode = FindLowestNodeInRig();
<a name="l00732"></a>00732 
<a name="l00733"></a>00733     UpdateCollcabContacterNodes();
<a name="l00734"></a>00734 
<a name="l00735"></a>00735     m_flex_factory.SaveFlexbodiesToCache();
<a name="l00736"></a>00736 
<a name="l00737"></a>00737 <span class="preprocessor">#if 0 // hashing + scope_log disabled</span>
<a name="l00738"></a>00738 <span class="preprocessor"></span>
<a name="l00739"></a>00739    <span class="comment">// now generate the hash of it</span>
<a name="l00740"></a>00740     {
<a name="l00741"></a>00741         <span class="comment">// copy whole truck into a string</span>
<a name="l00742"></a>00742         Ogre::String code;
<a name="l00743"></a>00743         ds-&gt;seek(0); <span class="comment">// from start</span>
<a name="l00744"></a>00744         code.resize(ds-&gt;size());
<a name="l00745"></a>00745         ds-&gt;read(&amp;code[0], ds-&gt;size());
<a name="l00746"></a>00746 
<a name="l00747"></a>00747         <span class="comment">// and build the hash over it</span>
<a name="l00748"></a>00748         <span class="keywordtype">char</span> hash_result[250];
<a name="l00749"></a>00749         memset(hash_result, 0, 249);
<a name="l00750"></a>00750         <a class="code" href="class_ro_r_1_1_c_s_h_a1.html">RoR::CSHA1</a> sha1;
<a name="l00751"></a>00751         sha1.<a class="code" href="class_ro_r_1_1_c_s_h_a1.html#a405de4baf54dcb38af5903e01221454e">UpdateHash</a>((uint8_t *)code.c_str(), (uint32_t)code.size());
<a name="l00752"></a>00752         sha1.<a class="code" href="class_ro_r_1_1_c_s_h_a1.html#afbdaab3f2a2946d26a6144af3fec5fd8">Final</a>();
<a name="l00753"></a>00753         sha1.<a class="code" href="class_ro_r_1_1_c_s_h_a1.html#a22ddf4fbd88ea7a76638104a56bb7c30">ReportHash</a>(hash_result, <a class="code" href="class_ro_r_1_1_c_s_h_a1.html#a97d48422d91c9690f8ec0d0a2225440fa4ebea8e3628872ff58becb1302232efa">RoR::CSHA1::REPORT_HEX_SHORT</a>);
<a name="l00754"></a>00754         beamHash = String(hash_result);
<a name="l00755"></a>00755     }
<a name="l00756"></a>00756 
<a name="l00757"></a>00757 
<a name="l00758"></a>00758 
<a name="l00759"></a>00759 
<a name="l00760"></a>00760     <span class="comment">// WARNING: this must come LAST</span>
<a name="l00761"></a>00761     <span class="keywordflow">if</span> (!<a class="code" href="_settings_8h.html#a59d79e9512ab19f4eb8a322f1e32dc11">SSETTING</a>(<span class="stringliteral">&quot;vehicleOutputFile&quot;</span>, <span class="stringliteral">&quot;&quot;</span>).empty())
<a name="l00762"></a>00762     {
<a name="l00763"></a>00763         <span class="comment">// serialize the truck in a special format :)</span>
<a name="l00764"></a>00764         String fn = <a class="code" href="_settings_8h.html#a59d79e9512ab19f4eb8a322f1e32dc11">SSETTING</a>(<span class="stringliteral">&quot;vehicleOutputFile&quot;</span>, <span class="stringliteral">&quot;&quot;</span>);
<a name="l00765"></a>00765         serialize(fn, &amp;scope_log);
<a name="l00766"></a>00766     }
<a name="l00767"></a>00767     
<a name="l00768"></a>00768 <span class="preprocessor">#endif</span>
<a name="l00769"></a>00769 <span class="preprocessor"></span>}
<a name="l00770"></a>00770 
<a name="l00771"></a>00771 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l00772"></a>00772 <span class="comment">/* Actual loading</span>
<a name="l00773"></a>00773 <span class="comment">/* ~~~ Implemented in RigSpawner_ProcessControl.cpp!</span>
<a name="l00774"></a>00774 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l00775"></a>00775 
<a name="l00776"></a>00776 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l00777"></a>00777 <span class="comment">/* Processing functions and utilities.</span>
<a name="l00778"></a>00778 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l00779"></a>00779 
<a name="l00780"></a><a class="code" href="class_rig_spawner.html#a779ff1be7563774af52dd7f4c9ee9b81">00780</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a779ff1be7563774af52dd7f4c9ee9b81">RigSpawner::WashCalculator</a>(Ogre::Quaternion <span class="keyword">const</span> &amp; rot)
<a name="l00781"></a>00781 {
<a name="l00782"></a>00782     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00783"></a>00783 
<a name="l00784"></a>00784     Ogre::Quaternion invrot=rot.Inverse();
<a name="l00785"></a>00785     <span class="comment">//we will compute wash</span>
<a name="l00786"></a>00786     <span class="keywordtype">int</span> w,p;
<a name="l00787"></a>00787     <span class="keywordflow">for</span> (p=0; p&lt;m_rig-&gt;free_aeroengine; p++)
<a name="l00788"></a>00788     {
<a name="l00789"></a>00789         Ogre::Vector3 prop=invrot*m_rig-&gt;nodes[m_rig-&gt;aeroengines[p]-&gt;getNoderef()].RelPosition;
<a name="l00790"></a>00790         <span class="keywordtype">float</span> radius=m_rig-&gt;aeroengines[p]-&gt;getRadius();
<a name="l00791"></a>00791         <span class="keywordflow">for</span> (w=0; w&lt;m_rig-&gt;free_wing; w++)
<a name="l00792"></a>00792         {
<a name="l00793"></a>00793             <span class="comment">//left wash</span>
<a name="l00794"></a>00794             Ogre::Vector3 wcent=invrot*((m_rig-&gt;nodes[m_rig-&gt;wings[w].fa-&gt;nfld].RelPosition+m_rig-&gt;nodes[m_rig-&gt;wings[w].fa-&gt;nfrd].RelPosition)/2.0);
<a name="l00795"></a>00795             <span class="comment">//check if wing is near enough along X (less than 15m back)</span>
<a name="l00796"></a>00796             <span class="keywordflow">if</span> (wcent.x&gt;prop.x &amp;&amp; wcent.x&lt;prop.x+15.0)
<a name="l00797"></a>00797             {
<a name="l00798"></a>00798                 <span class="comment">//check if it&#39;s okay vertically</span>
<a name="l00799"></a>00799                 <span class="keywordflow">if</span> (wcent.y&gt;prop.y-radius &amp;&amp; wcent.y&lt;prop.y+radius)
<a name="l00800"></a>00800                 {
<a name="l00801"></a>00801                     <span class="comment">//okay, compute wash coverage ratio along Z</span>
<a name="l00802"></a>00802                     <span class="keywordtype">float</span> wleft=(invrot*m_rig-&gt;nodes[m_rig-&gt;wings[w].fa-&gt;nfld].RelPosition).z;
<a name="l00803"></a>00803                     <span class="keywordtype">float</span> wright=(invrot*m_rig-&gt;nodes[m_rig-&gt;wings[w].fa-&gt;nfrd].RelPosition).z;
<a name="l00804"></a>00804                     <span class="keywordtype">float</span> pleft=prop.z+radius;
<a name="l00805"></a>00805                     <span class="keywordtype">float</span> pright=prop.z-radius;
<a name="l00806"></a>00806                     <span class="keywordtype">float</span> aleft=wleft;
<a name="l00807"></a>00807                     <span class="keywordflow">if</span> (pleft&lt;aleft) aleft=pleft;
<a name="l00808"></a>00808                     <span class="keywordtype">float</span> aright=wright;
<a name="l00809"></a>00809                     <span class="keywordflow">if</span> (pright&gt;aright) aright=pright;
<a name="l00810"></a>00810                     <span class="keywordflow">if</span> (aright&lt;aleft)
<a name="l00811"></a>00811                     {
<a name="l00812"></a>00812                         <span class="comment">//we have a wash</span>
<a name="l00813"></a>00813                         <span class="keywordtype">float</span> wratio=(aleft-aright)/(wleft-wright);
<a name="l00814"></a>00814                         m_rig-&gt;wings[w].fa-&gt;addwash(p, wratio);
<a name="l00815"></a>00815                         Ogre::String msg = <span class="stringliteral">&quot;Wing &quot;</span>+<a class="code" href="_ro_r_prerequisites_8h.html#a9063e80f8777300c93afde6e6f4c9cea">TOSTRING</a>(w)+<span class="stringliteral">&quot; is washed by prop &quot;</span>+<a class="code" href="_ro_r_prerequisites_8h.html#a9063e80f8777300c93afde6e6f4c9cea">TOSTRING</a>(p)+<span class="stringliteral">&quot; at &quot;</span>+<a class="code" href="_ro_r_prerequisites_8h.html#a9063e80f8777300c93afde6e6f4c9cea">TOSTRING</a>((<span class="keywordtype">float</span>)(wratio*100.0))+<span class="stringliteral">&quot;%&quot;</span>;
<a name="l00816"></a>00816                         AddMessage(Message::TYPE_INFO, msg);
<a name="l00817"></a>00817                     }
<a name="l00818"></a>00818                 }
<a name="l00819"></a>00819             }
<a name="l00820"></a>00820         }
<a name="l00821"></a>00821     }
<a name="l00822"></a>00822 }
<a name="l00823"></a>00823 
<a name="l00824"></a><a class="code" href="class_rig_spawner.html#acacd7c6417f8125aea2cc9b32a757c3a">00824</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#acacd7c6417f8125aea2cc9b32a757c3a">RigSpawner::ProcessTurbojet</a>(<a class="code" href="struct_rig_def_1_1_turbojet.html">RigDef::Turbojet</a> &amp; def)
<a name="l00825"></a>00825 {
<a name="l00826"></a>00826     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00827"></a>00827 
<a name="l00828"></a>00828     <span class="keywordtype">int</span> front,back,ref;
<a name="l00829"></a>00829     front = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turbojet.html#a25dd2357851ba5db406b47bc4f71fb00">front_node</a>);<span class="comment">//parse_node_number(c, args[0]);</span>
<a name="l00830"></a>00830     back  = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turbojet.html#a35b2cf4c86857bfef1eca33322b5de6f">back_node</a>);<span class="comment">//parse_node_number(c, args[1]);</span>
<a name="l00831"></a>00831     ref   = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turbojet.html#aca50c1f2e3e4be0ed61fe44bf4e7ea0a">side_node</a>);<span class="comment">//parse_node_number(c, args[2]);</span>
<a name="l00832"></a>00832     
<a name="l00833"></a>00833     <span class="keywordtype">char</span> propname[256];
<a name="l00834"></a>00834     sprintf(propname, <span class="stringliteral">&quot;turbojet-%s-%i&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_aeroengine);
<a name="l00835"></a>00835     <a class="code" href="class_turbojet.html">Turbojet</a> *tj=<span class="keyword">new</span> <a class="code" href="class_turbojet.html">Turbojet</a>(
<a name="l00836"></a>00836         propname, 
<a name="l00837"></a>00837         m_rig-&gt;free_aeroengine, 
<a name="l00838"></a>00838         m_rig-&gt;trucknum, 
<a name="l00839"></a>00839         m_rig-&gt;nodes, 
<a name="l00840"></a>00840         front, 
<a name="l00841"></a>00841         back, 
<a name="l00842"></a>00842         ref, 
<a name="l00843"></a>00843         def.<a class="code" href="struct_rig_def_1_1_turbojet.html#a07570f67a2da3d92bac9a48f47b97f62">dry_thrust</a>, <span class="comment">//drthrust, </span>
<a name="l00844"></a>00844         def.<a class="code" href="struct_rig_def_1_1_turbojet.html#aff28db5a0011b8637a5b05515ff8df53">is_reversable</a> != 0, <span class="comment">//rev!=0, </span>
<a name="l00845"></a>00845         def.<a class="code" href="struct_rig_def_1_1_turbojet.html#aac05877c1e00622e605e6f9f5098ba15">wet_thrust</a> &gt; 0, <span class="comment">//abthrust&gt;0, </span>
<a name="l00846"></a>00846         def.<a class="code" href="struct_rig_def_1_1_turbojet.html#aac05877c1e00622e605e6f9f5098ba15">wet_thrust</a>, <span class="comment">//abthrust, </span>
<a name="l00847"></a>00847         def.<a class="code" href="struct_rig_def_1_1_turbojet.html#ae701fe33e60b606b9d8f5fc3b4a3a346">front_diameter</a>,
<a name="l00848"></a>00848         def.<a class="code" href="struct_rig_def_1_1_turbojet.html#a3cb86aefce20d815d7acd0f549344e15">back_diameter</a>, <span class="comment">//bdiam, </span>
<a name="l00849"></a>00849         def.<a class="code" href="struct_rig_def_1_1_turbojet.html#a7730aef3cc72b2075b255e9b84741f09">nozzle_length</a>, <span class="comment">//len, </span>
<a name="l00850"></a>00850         m_rig-&gt;disable_smoke, 
<a name="l00851"></a>00851         m_rig-&gt;heathaze, 
<a name="l00852"></a>00852         m_rig-&gt;materialFunctionMapper, 
<a name="l00853"></a>00853         m_rig-&gt;usedSkin, 
<a name="l00854"></a>00854         m_rig-&gt;materialReplacer);
<a name="l00855"></a>00855 
<a name="l00856"></a>00856     m_rig-&gt;aeroengines[m_rig-&gt;free_aeroengine]=tj;
<a name="l00857"></a>00857     m_rig-&gt;driveable=<a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18a9e543158d0fa5b033941649d12acdfc1" title="its an airplane">AIRPLANE</a>;
<a name="l00858"></a>00858     <span class="keywordflow">if</span> (m_rig-&gt;autopilot == <span class="keyword">nullptr</span> &amp;&amp; m_rig-&gt;state != <a class="code" href="_beam_data_8h.html#aaf8fd5f0e57d456151c951e0f3715fc4aec51286c7abc228c47367bbae4a7a1f9" title="not calculated, gets remote data">NETWORKED</a>)
<a name="l00859"></a>00859         m_rig-&gt;autopilot=<span class="keyword">new</span> <a class="code" href="class_autopilot.html">Autopilot</a>(m_rig-&gt;trucknum);
<a name="l00860"></a>00860     <span class="comment">//if (audio) audio-&gt;setupAeroengines(TURBOJETS);</span>
<a name="l00861"></a>00861     
<a name="l00862"></a>00862     m_rig-&gt;free_aeroengine++;
<a name="l00863"></a>00863 }
<a name="l00864"></a>00864 
<a name="l00865"></a><a class="code" href="class_rig_spawner.html#a8fa3fecc8fcbc8e020753b7127528034">00865</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a8fa3fecc8fcbc8e020753b7127528034">RigSpawner::ProcessSkeletonSettings</a>(<a class="code" href="struct_rig_def_1_1_skeleton_settings.html">RigDef::SkeletonSettings</a> &amp; def)
<a name="l00866"></a>00866 {
<a name="l00867"></a>00867     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00868"></a>00868 
<a name="l00869"></a>00869     m_rig-&gt;fadeDist = def.<a class="code" href="struct_rig_def_1_1_skeleton_settings.html#a52ad3ac019c6d70ac8ddf23f2f45c7e6">visibility_range_meters</a>;
<a name="l00870"></a>00870     m_rig-&gt;skeleton_beam_diameter = def.<a class="code" href="struct_rig_def_1_1_skeleton_settings.html#ab8d6978401f7e6528a3c58fc4192e07a">beam_thickness_meters</a>;
<a name="l00871"></a>00871 }
<a name="l00872"></a>00872 
<a name="l00873"></a><a class="code" href="class_rig_spawner.html#a9e6dcd099a17b39397c8cc63ede72ab2">00873</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a9e6dcd099a17b39397c8cc63ede72ab2">RigSpawner::ProcessScrewprop</a>(<a class="code" href="struct_rig_def_1_1_screwprop.html">RigDef::Screwprop</a> &amp; def)
<a name="l00874"></a>00874 {
<a name="l00875"></a>00875     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00876"></a>00876 
<a name="l00877"></a>00877     <span class="keywordflow">if</span> (! CheckScrewpropLimit(1))
<a name="l00878"></a>00878     {
<a name="l00879"></a>00879         <span class="keywordflow">return</span>;
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881 
<a name="l00882"></a>00882     <span class="keywordtype">int</span> ref_node_idx = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_screwprop.html#a619725c292f7aa018eebe6bbcbf2bd21">prop_node</a>);
<a name="l00883"></a>00883     <span class="keywordtype">int</span> back_node_idx = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_screwprop.html#afd9b093759696217ad259b8e9787702f">back_node</a>);
<a name="l00884"></a>00884     <span class="keywordtype">int</span> top_node_idx = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_screwprop.html#ae2456dd4ebe41609db3adfe3fb55e883">top_node</a>);
<a name="l00885"></a>00885 
<a name="l00886"></a>00886     m_rig-&gt;screwprops[m_rig-&gt;free_screwprop] = <span class="keyword">new</span> <a class="code" href="class_screwprop.html">Screwprop</a>(
<a name="l00887"></a>00887         m_rig-&gt;nodes,
<a name="l00888"></a>00888         ref_node_idx,
<a name="l00889"></a>00889         back_node_idx,
<a name="l00890"></a>00890         top_node_idx,
<a name="l00891"></a>00891         def.<a class="code" href="struct_rig_def_1_1_screwprop.html#a7cb2109d28eabed05953c5cd982ad0c3">power</a>,
<a name="l00892"></a>00892         m_rig-&gt;trucknum
<a name="l00893"></a>00893     );
<a name="l00894"></a>00894     m_rig-&gt;driveable=<a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18a5fcfdc36f4798fb6ace9348a10f1e1b3" title="its a boat">BOAT</a>;
<a name="l00895"></a>00895     m_rig-&gt;free_screwprop++;
<a name="l00896"></a>00896 }
<a name="l00897"></a>00897 
<a name="l00898"></a><a class="code" href="class_rig_spawner.html#af624d28fa414e43d4c1c11013cc3cb2c">00898</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af624d28fa414e43d4c1c11013cc3cb2c">RigSpawner::ProcessFusedrag</a>(<a class="code" href="struct_rig_def_1_1_fusedrag.html">RigDef::Fusedrag</a> &amp; def)
<a name="l00899"></a>00899 {
<a name="l00900"></a>00900     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00901"></a>00901 
<a name="l00902"></a>00902     <span class="comment">//parse fusedrag</span>
<a name="l00903"></a>00903     <span class="keywordtype">int</span> front_node_idx = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_fusedrag.html#ab835953a261cb4749a86abfe4b2f7a57">front_node</a>);
<a name="l00904"></a>00904     <span class="keywordtype">int</span> back_node_idx = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_fusedrag.html#a2efe22f9f139c92c680c45d8a3779d57">rear_node</a>);
<a name="l00905"></a>00905     <span class="keywordtype">float</span> width = 1.f;
<a name="l00906"></a>00906     <span class="keywordtype">float</span> factor = 1.f;
<a name="l00907"></a>00907     <span class="keywordtype">char</span> fusefoil[256];
<a name="l00908"></a>00908     strncpy(fusefoil, def.<a class="code" href="struct_rig_def_1_1_fusedrag.html#a386e5c4c276721a79d00ef61e656cfd2">airfoil_name</a>.c_str(), 255);
<a name="l00909"></a>00909 
<a name="l00910"></a>00910     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_fusedrag.html#ab11e1d8b1d40bc97ea990500057e6d0e">autocalc</a>)
<a name="l00911"></a>00911     {
<a name="l00912"></a>00912         <span class="comment">// fusedrag autocalculation</span>
<a name="l00913"></a>00913 
<a name="l00914"></a>00914         <span class="comment">// calculate fusedrag by truck size</span>
<a name="l00915"></a>00915         factor = def.<a class="code" href="struct_rig_def_1_1_fusedrag.html#aedb2d863626ae5bcfda5fb1740620265">area_coefficient</a>;
<a name="l00916"></a>00916         width  =  (m_fuse_z_max - m_fuse_z_min) * (m_fuse_y_max - m_fuse_y_min) * factor;           
<a name="l00917"></a>00917         
<a name="l00918"></a>00918         m_rig-&gt;fuseAirfoil = <span class="keyword">new</span> <a class="code" href="class_airfoil.html">Airfoil</a>(fusefoil);
<a name="l00919"></a>00919         
<a name="l00920"></a>00920         m_rig-&gt;fuseFront   = &amp; GetNode(front_node_idx);
<a name="l00921"></a>00921         m_rig-&gt;fuseBack    = &amp; GetNode(front_node_idx); <span class="comment">// This equals v0.38 / v0.4.0.7, but it&#39;s probably a bug</span>
<a name="l00922"></a>00922         m_rig-&gt;fuseWidth   = width;
<a name="l00923"></a>00923         AddMessage(Message::TYPE_INFO, <span class="stringliteral">&quot;Fusedrag autocalculation size: &quot;</span>+<a class="code" href="_ro_r_prerequisites_8h.html#a9063e80f8777300c93afde6e6f4c9cea">TOSTRING</a>(width)+<span class="stringliteral">&quot; m^2&quot;</span>);
<a name="l00924"></a>00924     } <span class="keywordflow">else</span>
<a name="l00925"></a>00925     {
<a name="l00926"></a>00926         <span class="comment">// original fusedrag calculation</span>
<a name="l00927"></a>00927 
<a name="l00928"></a>00928         width  = def.<a class="code" href="struct_rig_def_1_1_fusedrag.html#ade27250a1d499d0c5782e10368dba628">approximate_width</a>;
<a name="l00929"></a>00929                     
<a name="l00930"></a>00930         m_rig-&gt;fuseAirfoil = <span class="keyword">new</span> <a class="code" href="class_airfoil.html">Airfoil</a>(fusefoil);
<a name="l00931"></a>00931         
<a name="l00932"></a>00932         m_rig-&gt;fuseFront   = &amp; GetNode(front_node_idx);
<a name="l00933"></a>00933         m_rig-&gt;fuseBack    = &amp; GetNode(front_node_idx); <span class="comment">// This equals v0.38 / v0.4.0.7, but it&#39;s probably a bug</span>
<a name="l00934"></a>00934         m_rig-&gt;fuseWidth   = width;
<a name="l00935"></a>00935     }
<a name="l00936"></a>00936 }
<a name="l00937"></a>00937 
<a name="l00938"></a><a class="code" href="class_rig_spawner.html#ac879bb3727f3c2f11e758339dfa5a452">00938</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ac879bb3727f3c2f11e758339dfa5a452">RigSpawner::BuildAerialEngine</a>(
<a name="l00939"></a>00939     <span class="keywordtype">int</span> ref_node_index,
<a name="l00940"></a>00940     <span class="keywordtype">int</span> back_node_index,
<a name="l00941"></a>00941     <span class="keywordtype">int</span> blade_1_node_index,
<a name="l00942"></a>00942     <span class="keywordtype">int</span> blade_2_node_index,
<a name="l00943"></a>00943     <span class="keywordtype">int</span> blade_3_node_index,
<a name="l00944"></a>00944     <span class="keywordtype">int</span> blade_4_node_index,
<a name="l00945"></a>00945     <span class="keywordtype">int</span> couplenode_index,
<a name="l00946"></a>00946     <span class="keywordtype">bool</span> is_turboprops,
<a name="l00947"></a>00947     Ogre::String <span class="keyword">const</span> &amp; airfoil,
<a name="l00948"></a>00948     <span class="keywordtype">float</span> power,
<a name="l00949"></a>00949     <span class="keywordtype">float</span> pitch
<a name="l00950"></a>00950     )
<a name="l00951"></a>00951 {
<a name="l00952"></a>00952     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l00953"></a>00953 
<a name="l00954"></a>00954     <span class="keywordtype">char</span> propname[256];
<a name="l00955"></a>00955     sprintf(propname, <span class="stringliteral">&quot;turboprop-%s-%i&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_aeroengine);
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     <a class="code" href="class_turboprop.html">Turboprop</a> *turbo_prop = <span class="keyword">new</span> <a class="code" href="class_turboprop.html">Turboprop</a>(
<a name="l00958"></a>00958         propname,
<a name="l00959"></a>00959         m_rig-&gt;nodes, 
<a name="l00960"></a>00960         ref_node_index,
<a name="l00961"></a>00961         back_node_index,
<a name="l00962"></a>00962         blade_1_node_index,
<a name="l00963"></a>00963         blade_2_node_index,
<a name="l00964"></a>00964         blade_3_node_index,
<a name="l00965"></a>00965         blade_4_node_index,
<a name="l00966"></a>00966         couplenode_index,
<a name="l00967"></a>00967         power,
<a name="l00968"></a>00968         airfoil,
<a name="l00969"></a>00969         m_rig-&gt;free_aeroengine,
<a name="l00970"></a>00970         m_rig-&gt;trucknum,
<a name="l00971"></a>00971         m_rig-&gt;disable_smoke,
<a name="l00972"></a>00972         ! is_turboprops,
<a name="l00973"></a>00973         pitch,
<a name="l00974"></a>00974         m_rig-&gt;heathaze
<a name="l00975"></a>00975     );
<a name="l00976"></a>00976     m_rig-&gt;aeroengines[m_rig-&gt;free_aeroengine] = turbo_prop;
<a name="l00977"></a>00977     m_rig-&gt;free_aeroengine++;
<a name="l00978"></a>00978     m_rig-&gt;driveable = <a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18a9e543158d0fa5b033941649d12acdfc1" title="its an airplane">AIRPLANE</a>;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980     <span class="comment">/* Autopilot */</span>
<a name="l00981"></a>00981     <span class="keywordflow">if</span> (m_rig-&gt;autopilot == <span class="keyword">nullptr</span> &amp;&amp; m_rig-&gt;state != <a class="code" href="_beam_data_8h.html#aaf8fd5f0e57d456151c951e0f3715fc4aec51286c7abc228c47367bbae4a7a1f9" title="not calculated, gets remote data">NETWORKED</a>)
<a name="l00982"></a>00982     {
<a name="l00983"></a>00983         m_rig-&gt;autopilot = <span class="keyword">new</span> <a class="code" href="class_autopilot.html">Autopilot</a>(m_rig-&gt;trucknum);
<a name="l00984"></a>00984     }
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     <span class="comment">/* Visuals */</span>
<a name="l00987"></a>00987     <span class="keywordtype">float</span> scale = GetNode(ref_node_index).RelPosition.distance(GetNode(blade_1_node_index).RelPosition) / 2.25f;
<a name="l00988"></a>00988     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;unsigned int&gt;(m_rig-&gt;free_prop); i++)
<a name="l00989"></a>00989     {
<a name="l00990"></a>00990         <a class="code" href="structprop__t.html">prop_t</a> &amp; prop = m_rig-&gt;props[i];
<a name="l00991"></a>00991         <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a23fe12866c6bea2ed971e456bccfe501">noderef</a> == ref_node_index)
<a name="l00992"></a>00992         {
<a name="l00993"></a>00993             <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a3b3e8e97174239ac445b08b12aa264b8" title="Is this a pale? (Boolean {0/1})">pale</a> == 1)
<a name="l00994"></a>00994             {
<a name="l00995"></a>00995                 prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>-&gt;scale(scale, scale, scale);
<a name="l00996"></a>00996                 turbo_prop-&gt;<a class="code" href="class_turboprop.html#a8186810a8e366d1c510f4bd5ae2824e8">addPale</a>(prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>);
<a name="l00997"></a>00997             }
<a name="l00998"></a>00998             <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a2df2ebb1b18ff6dda8eacfd1330b1524" title="Is this a spinprop? (Boolean {0/1})">spinner</a> == 1)
<a name="l00999"></a>00999             {
<a name="l01000"></a>01000                 prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>-&gt;scale(scale, scale, scale);
<a name="l01001"></a>01001                 turbo_prop-&gt;<a class="code" href="class_turboprop.html#ad285d5ec5891ddad9fd7e9773a70b398">addSpinner</a>(prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>);
<a name="l01002"></a>01002             }
<a name="l01003"></a>01003         }
<a name="l01004"></a>01004     }
<a name="l01005"></a>01005 }
<a name="l01006"></a>01006 
<a name="l01007"></a><a class="code" href="class_rig_spawner.html#ac9e3aae25c447cd74119da20c8dffeb4">01007</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ac9e3aae25c447cd74119da20c8dffeb4">RigSpawner::ProcessTurboprop2</a>(<a class="code" href="struct_rig_def_1_1_turboprop2.html">RigDef::Turboprop2</a> &amp; def)
<a name="l01008"></a>01008 {
<a name="l01009"></a>01009     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01010"></a>01010 
<a name="l01011"></a>01011     <span class="keywordtype">int</span> couple_node_index = (def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a60e4377080154a2b2bc204dafa1c1d7e">couple_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>()) ? GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a60e4377080154a2b2bc204dafa1c1d7e">couple_node</a>) : -1;
<a name="l01012"></a>01012 
<a name="l01013"></a>01013     BuildAerialEngine(
<a name="l01014"></a>01014         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a9976396cc84a01b6b424b286875b59a8">reference_node</a>),
<a name="l01015"></a>01015         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a73d28a64bae9eb54e559f2ef7500c822">axis_node</a>),
<a name="l01016"></a>01016         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a5015bb8f4886eb8178e45a91504f1146">blade_tip_nodes</a>[0]),
<a name="l01017"></a>01017         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a5015bb8f4886eb8178e45a91504f1146">blade_tip_nodes</a>[1]),
<a name="l01018"></a>01018         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a5015bb8f4886eb8178e45a91504f1146">blade_tip_nodes</a>[2]),
<a name="l01019"></a>01019         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a5015bb8f4886eb8178e45a91504f1146">blade_tip_nodes</a>[3]),
<a name="l01020"></a>01020         couple_node_index,
<a name="l01021"></a>01021         <span class="keyword">true</span>,
<a name="l01022"></a>01022         def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#acef97c6fe1afc1cc6722070e616e1f63">airfoil</a>,
<a name="l01023"></a>01023         def.<a class="code" href="struct_rig_def_1_1_turboprop2.html#a6b4240cbd6419b6c229556e12f046c4d">turbine_power_kW</a>,
<a name="l01024"></a>01024         -10
<a name="l01025"></a>01025     );
<a name="l01026"></a>01026 }
<a name="l01027"></a>01027 
<a name="l01028"></a><a class="code" href="class_rig_spawner.html#a643088a29570e0b12f957bdade550158">01028</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a643088a29570e0b12f957bdade550158">RigSpawner::ProcessPistonprop</a>(<a class="code" href="struct_rig_def_1_1_pistonprop.html">RigDef::Pistonprop</a> &amp; def)
<a name="l01029"></a>01029 {
<a name="l01030"></a>01030     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01031"></a>01031 
<a name="l01032"></a>01032     <span class="keywordtype">int</span> couple_node_index = (def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#a58110aea79e235bd5403c779e0f3af56">_couple_node_set</a>) ? GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#ad38783a613008c910358d61b75a53514">couple_node</a>) : -1;
<a name="l01033"></a>01033 
<a name="l01034"></a>01034     BuildAerialEngine(
<a name="l01035"></a>01035         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#a1c08289b70db9067bc0e2c84606671fe">reference_node</a>),
<a name="l01036"></a>01036         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#a1369fcb3df80349a65bb880c2d93e5e3">axis_node</a>),
<a name="l01037"></a>01037         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#adfd32e849240dbff62d7d08d8941ae2c">blade_tip_nodes</a>[0]),
<a name="l01038"></a>01038         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#adfd32e849240dbff62d7d08d8941ae2c">blade_tip_nodes</a>[1]),
<a name="l01039"></a>01039         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#adfd32e849240dbff62d7d08d8941ae2c">blade_tip_nodes</a>[2]),
<a name="l01040"></a>01040         GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#adfd32e849240dbff62d7d08d8941ae2c">blade_tip_nodes</a>[3]),
<a name="l01041"></a>01041         couple_node_index,
<a name="l01042"></a>01042         <span class="keyword">false</span>,
<a name="l01043"></a>01043         def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#a4a20e2b4dc9536e37ec2c8d864d513a6">airfoil</a>,
<a name="l01044"></a>01044         def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#a58cc04108e8cc80fc9649984ba797c9c">turbine_power_kW</a>,
<a name="l01045"></a>01045         def.<a class="code" href="struct_rig_def_1_1_pistonprop.html#a7e2688d04a4a069e7db2811c7c01b391">pitch</a>
<a name="l01046"></a>01046     );
<a name="l01047"></a>01047 }
<a name="l01048"></a>01048 
<a name="l01049"></a><a class="code" href="class_rig_spawner.html#ae6d53587a8a4657eaa515bcc014a5a0d">01049</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ae6d53587a8a4657eaa515bcc014a5a0d">RigSpawner::ProcessAirbrake</a>(<a class="code" href="struct_rig_def_1_1_airbrake.html">RigDef::Airbrake</a> &amp; def)
<a name="l01050"></a>01050 {
<a name="l01051"></a>01051     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01052"></a>01052 
<a name="l01053"></a>01053     <span class="keywordflow">if</span> (! CheckAirBrakeLimit(1))
<a name="l01054"></a>01054     {
<a name="l01055"></a>01055         <span class="keywordflow">return</span>;
<a name="l01056"></a>01056     }
<a name="l01057"></a>01057 
<a name="l01058"></a>01058     m_rig-&gt;airbrakes[m_rig-&gt;free_airbrake] = <span class="keyword">new</span> <a class="code" href="class_airbrake.html">Airbrake</a>(
<a name="l01059"></a>01059         m_rig-&gt;truckname,
<a name="l01060"></a>01060         m_rig-&gt;free_airbrake, 
<a name="l01061"></a>01061         GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a2fbb3b8138c067f25c60fcb5668f619d">reference_node</a>), 
<a name="l01062"></a>01062         GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a9aa515799ce8033acaf8b52bd9e58318">x_axis_node</a>),<span class="comment">//&amp;nodes[nx], </span>
<a name="l01063"></a>01063         GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a140ec1a21186fc2d7790782a456df728">y_axis_node</a>),<span class="comment">//&amp;nodes[ny], </span>
<a name="l01064"></a>01064         GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a046a3009067abd7935423790edc217db">aditional_node</a>),<span class="comment">//&amp;nodes[na], </span>
<a name="l01065"></a>01065         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#abe978da4efd1cfb73d462f90add4b3fa">offset</a>,<span class="comment">//Vector3(ox,oy,oz), </span>
<a name="l01066"></a>01066         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a0fcaf18096d9fc6c091762ce956c9aea">width</a>,<span class="comment">//wd, </span>
<a name="l01067"></a>01067         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a9ae147d3e358d1893126c0c9c09913b5">height</a>,<span class="comment">//len, </span>
<a name="l01068"></a>01068         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a68bbe32d012b67b674a932fe62431740">max_inclination_angle</a>,<span class="comment">//maxang, </span>
<a name="l01069"></a>01069         m_rig-&gt;texname, 
<a name="l01070"></a>01070         <span class="comment">//tx1,tx2,tx3,tx4,liftcoef);</span>
<a name="l01071"></a>01071         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#ae3e1d803970f21adf1c9f1cfce33b5e3">texcoord_x1</a>,
<a name="l01072"></a>01072         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a75401ba6c8765cdc0012aac9ad8ac43c">texcoord_y1</a>,
<a name="l01073"></a>01073         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a84ff9520595ba4e6108bfcddcd6c81bc">texcoord_x2</a>,
<a name="l01074"></a>01074         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#aa6a21fc1a7268e54fa8880ef5dc78d1d">texcoord_y2</a>,
<a name="l01075"></a>01075         def.<a class="code" href="struct_rig_def_1_1_airbrake.html#a38f072b623ed21739fe8e80a06c72817">lift_coefficient</a>
<a name="l01076"></a>01076     );
<a name="l01077"></a>01077     m_rig-&gt;free_airbrake++;
<a name="l01078"></a>01078 }
<a name="l01079"></a>01079 
<a name="l01080"></a><a class="code" href="class_rig_spawner.html#a7f344c61c37b326481901ce0035e5e2d">01080</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a7f344c61c37b326481901ce0035e5e2d">RigSpawner::ProcessWing</a>(<a class="code" href="struct_rig_def_1_1_wing.html">RigDef::Wing</a> &amp; def)
<a name="l01081"></a>01081 {
<a name="l01082"></a>01082     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01083"></a>01083 
<a name="l01084"></a>01084     <span class="keywordflow">if</span> (! CheckWingLimit(1))
<a name="l01085"></a>01085     {
<a name="l01086"></a>01086         <span class="keywordflow">return</span>;
<a name="l01087"></a>01087     }
<a name="l01088"></a>01088 
<a name="l01089"></a>01089     std::stringstream wing_name;
<a name="l01090"></a>01090     wing_name &lt;&lt; <span class="stringliteral">&quot;wing-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; m_rig-&gt;free_wing;
<a name="l01091"></a>01091     std::stringstream wing_obj_name;
<a name="l01092"></a>01092     wing_obj_name &lt;&lt; <span class="stringliteral">&quot;wingobj-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; m_rig-&gt;free_wing;
<a name="l01093"></a>01093 
<a name="l01094"></a>01094     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wing_index = m_rig-&gt;free_wing;
<a name="l01095"></a>01095     m_rig-&gt;free_wing++;
<a name="l01096"></a>01096     <a class="code" href="structwing__t.html">wing_t</a> &amp; wing = m_rig-&gt;wings[wing_index];
<a name="l01097"></a>01097 
<a name="l01098"></a>01098     <span class="keywordtype">int</span> node_indices[8];
<a name="l01099"></a>01099     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++)
<a name="l01100"></a>01100     {
<a name="l01101"></a>01101         node_indices[i] = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_wing.html#af9fd01597d96acddff7ea98a70d37dbd">nodes</a>[i]);
<a name="l01102"></a>01102     }
<a name="l01103"></a>01103 
<a name="l01104"></a>01104     wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a> = <span class="keyword">new</span> <a class="code" href="class_flex_airfoil.html">FlexAirfoil</a>(
<a name="l01105"></a>01105         wing_name.str(),
<a name="l01106"></a>01106         m_rig-&gt;nodes,
<a name="l01107"></a>01107         node_indices[0],
<a name="l01108"></a>01108         node_indices[1],
<a name="l01109"></a>01109         node_indices[2],
<a name="l01110"></a>01110         node_indices[3],
<a name="l01111"></a>01111         node_indices[4],
<a name="l01112"></a>01112         node_indices[5],
<a name="l01113"></a>01113         node_indices[6],
<a name="l01114"></a>01114         node_indices[7],
<a name="l01115"></a>01115         m_rig-&gt;texname,
<a name="l01116"></a>01116         Ogre::Vector2(def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[0], def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[1]),
<a name="l01117"></a>01117         Ogre::Vector2(def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[2], def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[3]),
<a name="l01118"></a>01118         Ogre::Vector2(def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[4], def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[5]),
<a name="l01119"></a>01119         Ogre::Vector2(def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[6], def.<a class="code" href="struct_rig_def_1_1_wing.html#a166182b49b3061e80ba9f79beef69eb3">tex_coords</a>[7]),
<a name="l01120"></a>01120         def.<a class="code" href="struct_rig_def_1_1_wing.html#a6acc0c0b70dddeff6573c05b2390f43d">control_surface</a>,
<a name="l01121"></a>01121         def.<a class="code" href="struct_rig_def_1_1_wing.html#a2da399224c067ba5af014e6c265c1438">chord_point</a>,
<a name="l01122"></a>01122         def.<a class="code" href="struct_rig_def_1_1_wing.html#a16d628e5fd4e734527487ba682af69c0">min_deflection</a>,
<a name="l01123"></a>01123         def.<a class="code" href="struct_rig_def_1_1_wing.html#aa761ba06bf76f4be332ff3a9b5094312">max_deflection</a>,
<a name="l01124"></a>01124         def.<a class="code" href="struct_rig_def_1_1_wing.html#a866db6e2fa1a3161b71f242cd756da5d">airfoil</a>,
<a name="l01125"></a>01125         def.<a class="code" href="struct_rig_def_1_1_wing.html#a199f9f522298b8454fd45f687e4ce841">efficacy_coef</a>,
<a name="l01126"></a>01126         m_rig-&gt;aeroengines,
<a name="l01127"></a>01127         m_rig-&gt;state != <a class="code" href="_beam_data_8h.html#aaf8fd5f0e57d456151c951e0f3715fc4aec51286c7abc228c47367bbae4a7a1f9" title="not calculated, gets remote data">NETWORKED</a>
<a name="l01128"></a>01128     );
<a name="l01129"></a>01129                     
<a name="l01130"></a>01130     Ogre::Entity *entity = <span class="keyword">nullptr</span>;
<a name="l01131"></a>01131     <span class="keywordflow">try</span>
<a name="l01132"></a>01132     {
<a name="l01133"></a>01133         entity = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createEntity(wing_obj_name.str(), wing_name.str());
<a name="l01134"></a>01134     }
<a name="l01135"></a>01135     <span class="keywordflow">catch</span> (...)
<a name="l01136"></a>01136     {
<a name="l01137"></a>01137         AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to load mesh (flexbody wing): &quot;</span> + wing_name.str());
<a name="l01138"></a>01138         <span class="comment">// Revert wing processing</span>
<a name="l01139"></a>01139         <span class="keyword">delete</span> wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>;
<a name="l01140"></a>01140         std::memset(&amp;wing, 0, <span class="keyword">sizeof</span>(wing));
<a name="l01141"></a>01141         --m_rig-&gt;free_wing;
<a name="l01142"></a>01142         <span class="keywordflow">return</span>;
<a name="l01143"></a>01143     }
<a name="l01144"></a>01144     m_rig-&gt;deletion_Entities.emplace_back(entity);
<a name="l01145"></a>01145     <a class="code" href="class_material_function_mapper.html#abee8fd1cc0b52699d3babb4b5e84b477">MaterialFunctionMapper::replaceSimpleMeshMaterials</a>(entity, Ogre::ColourValue(0.5, 1, 0));
<a name="l01146"></a>01146     <span class="keywordflow">if</span> (m_rig-&gt;materialFunctionMapper) 
<a name="l01147"></a>01147     {
<a name="l01148"></a>01148         m_rig-&gt;materialFunctionMapper-&gt;replaceMeshMaterials(entity);
<a name="l01149"></a>01149     }
<a name="l01150"></a>01150     <span class="keywordflow">if</span> (m_rig-&gt;materialReplacer) 
<a name="l01151"></a>01151     {
<a name="l01152"></a>01152         m_rig-&gt;materialReplacer-&gt;replaceMeshMaterials(entity);
<a name="l01153"></a>01153     }
<a name="l01154"></a>01154     <span class="keywordflow">if</span> (m_rig-&gt;usedSkin) 
<a name="l01155"></a>01155     {
<a name="l01156"></a>01156         m_rig-&gt;usedSkin-&gt;replaceMeshMaterials(entity);
<a name="l01157"></a>01157     }
<a name="l01158"></a>01158     wing.<a class="code" href="structwing__t.html#a405d1b5549690b5bab27615fcb417c7c">cnode</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l01159"></a>01159     wing.<a class="code" href="structwing__t.html#a405d1b5549690b5bab27615fcb417c7c">cnode</a>-&gt;attachObject(entity);
<a name="l01160"></a>01160                     
<a name="l01161"></a>01161     <span class="comment">//induced drag</span>
<a name="l01162"></a>01162     <span class="keywordflow">if</span> (m_rig-&gt;wingstart==-1) 
<a name="l01163"></a>01163     {
<a name="l01164"></a>01164         m_rig-&gt;wingstart=wing_index;
<a name="l01165"></a>01165         m_wing_area=ComputeWingArea(
<a name="l01166"></a>01166             GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>).AbsPosition, 
<a name="l01167"></a>01167             GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1be774e0a718ba8cdb61d4e8147d5a36">nfrd</a>).AbsPosition, 
<a name="l01168"></a>01168             GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1cafef68414f3f691cf1570adf0e985f">nbld</a>).AbsPosition, 
<a name="l01169"></a>01169             GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a83b336e32822ada0d0e7f006d56a795d">nbrd</a>).AbsPosition
<a name="l01170"></a>01170         );
<a name="l01171"></a>01171     }
<a name="l01172"></a>01172     <span class="keywordflow">else</span>
<a name="l01173"></a>01173     {
<a name="l01174"></a>01174         <a class="code" href="structwing__t.html">wing_t</a> &amp; previous_wing = m_rig-&gt;wings[wing_index - 1];
<a name="l01175"></a>01175         <span class="keywordflow">if</span> (previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a> == <span class="keyword">nullptr</span>)
<a name="l01176"></a>01176         {
<a name="l01177"></a>01177             AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Unable to process wing, previous wing has no Airfoil&quot;</span>);
<a name="l01178"></a>01178             <span class="comment">// Revert wing processing</span>
<a name="l01179"></a>01179             <span class="keyword">delete</span> wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>;
<a name="l01180"></a>01180             std::memset(&amp;wing, 0, <span class="keyword">sizeof</span>(wing));
<a name="l01181"></a>01181             --m_rig-&gt;free_wing;
<a name="l01182"></a>01182             <span class="keywordflow">return</span>;
<a name="l01183"></a>01183         }
<a name="l01184"></a>01184 
<a name="l01185"></a>01185         <span class="keywordflow">if</span> (node_indices[1] != previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>)
<a name="l01186"></a>01186         {
<a name="l01187"></a>01187             <a class="code" href="structwing__t.html">wing_t</a> &amp; start_wing    = m_rig-&gt;wings[m_rig-&gt;wingstart];
<a name="l01188"></a>01188 
<a name="l01189"></a>01189             <span class="comment">//discontinuity</span>
<a name="l01190"></a>01190             <span class="comment">//inform wing segments</span>
<a name="l01191"></a>01191             <span class="keywordtype">float</span> span = GetNode( start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1be774e0a718ba8cdb61d4e8147d5a36">nfrd</a>).RelPosition.distance( GetNode(previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>).RelPosition );
<a name="l01192"></a>01192             
<a name="l01193"></a>01193             start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a5de78c556113cc59c793837dba1c8afd">enableInducedDrag</a>(span, m_wing_area, <span class="keyword">false</span>);
<a name="l01194"></a>01194             previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a5de78c556113cc59c793837dba1c8afd">enableInducedDrag</a>(span, m_wing_area, <span class="keyword">true</span>);
<a name="l01195"></a>01195 
<a name="l01196"></a>01196             <span class="comment">//we want also to add positional lights for first wing</span>
<a name="l01197"></a>01197             <span class="keywordflow">if</span> (m_generate_wing_position_lights &amp;&amp; m_rig-&gt;flaresMode&gt;0)
<a name="l01198"></a>01198             {
<a name="l01199"></a>01199                 <span class="keywordflow">if</span> (! CheckPropLimit(4))
<a name="l01200"></a>01200                 {
<a name="l01201"></a>01201                     <span class="keywordflow">return</span>;
<a name="l01202"></a>01202                 }
<a name="l01203"></a>01203 
<a name="l01204"></a>01204                 <span class="comment">//Left green</span>
<a name="l01205"></a>01205                 m_airplane_left_light=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>;
<a name="l01206"></a>01206                 <a class="code" href="structprop__t.html">prop_t</a> &amp; left_green_prop = m_rig-&gt;props[m_rig-&gt;free_prop];
<a name="l01207"></a>01207                 m_rig-&gt;free_prop++;
<a name="l01208"></a>01208 
<a name="l01209"></a>01209                 left_green_prop.<a class="code" href="structprop__t.html#a23fe12866c6bea2ed971e456bccfe501">noderef</a>=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>;
<a name="l01210"></a>01210                 left_green_prop.<a class="code" href="structprop__t.html#a2db413fa8ce7a71f0cac011c035f4c33">nodex</a>=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a567fb772ad9f4e477fcfc34d59fd5bb7">nflu</a>;
<a name="l01211"></a>01211                 left_green_prop.<a class="code" href="structprop__t.html#ad5fd60d7f37628fb8f2cd61e77bc213c">nodey</a>=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>; <span class="comment">//ignored</span>
<a name="l01212"></a>01212                 left_green_prop.<a class="code" href="structprop__t.html#a1bf7f6db554e501648fe1fe0544f67fb">offsetx</a>=0.5;
<a name="l01213"></a>01213                 left_green_prop.<a class="code" href="structprop__t.html#aecceca2d076d8807015c554ccae1ef48">offsety</a>=0.0;
<a name="l01214"></a>01214                 left_green_prop.<a class="code" href="structprop__t.html#a5cac941815e1c455ad9cf439e76bf24b">offsetz</a>=0.0;
<a name="l01215"></a>01215                 left_green_prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a>=Ogre::Quaternion::IDENTITY;
<a name="l01216"></a>01216                 left_green_prop.<a class="code" href="structprop__t.html#a8d4342b22134513dd7197b7456e8e46b" title="Special prop: custom steering wheel for dashboard.">wheel</a>=<span class="keyword">nullptr</span>;
<a name="l01217"></a>01217                 left_green_prop.<a class="code" href="structprop__t.html#a1bef2bb0b1e842eb0bf36de9cc9b6ff9">wheelrotdegree</a>=0.0;
<a name="l01218"></a>01218                 left_green_prop.<a class="code" href="structprop__t.html#a4ff55543f060c57d7e32a162afb99853">mirror</a>=0;
<a name="l01219"></a>01219                 left_green_prop.<a class="code" href="structprop__t.html#a3b3e8e97174239ac445b08b12aa264b8" title="Is this a pale? (Boolean {0/1})">pale</a>=0;
<a name="l01220"></a>01220                 left_green_prop.<a class="code" href="structprop__t.html#a2df2ebb1b18ff6dda8eacfd1330b1524" title="Is this a spinprop? (Boolean {0/1})">spinner</a>=0;
<a name="l01221"></a>01221                 left_green_prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>=<span class="keyword">nullptr</span>; <span class="comment">//no visible prop</span>
<a name="l01222"></a>01222                 left_green_prop.<a class="code" href="structprop__t.html#a3dccf8b3a2fdb5d21ffc344a5b7c60ef">bpos</a>[0]=0.0;
<a name="l01223"></a>01223                 left_green_prop.<a class="code" href="structprop__t.html#a7c0346ae551a6b1ea8556bd61ad5d86c">brate</a>[0]=1.0;
<a name="l01224"></a>01224                 left_green_prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a>=<span class="charliteral">&#39;L&#39;</span>;
<a name="l01225"></a>01225                 left_green_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]=<span class="keyword">nullptr</span>; <span class="comment">//no light</span>
<a name="l01226"></a>01226                 <span class="comment">//the flare billboard</span>
<a name="l01227"></a>01227                 <span class="keywordtype">char</span> propname[256];
<a name="l01228"></a>01228                 sprintf(propname, <span class="stringliteral">&quot;prop-%s-%i&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_prop);
<a name="l01229"></a>01229                 left_green_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l01230"></a>01230                 left_green_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(propname,1);
<a name="l01231"></a>01231                 left_green_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;createBillboard(0,0,0);
<a name="l01232"></a>01232                 <span class="keywordflow">if</span> (left_green_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0])
<a name="l01233"></a>01233                 {
<a name="l01234"></a>01234                     left_green_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l01235"></a>01235                     left_green_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/greenflare&quot;</span>);
<a name="l01236"></a>01236                     left_green_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;attachObject(left_green_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]);
<a name="l01237"></a>01237                 }
<a name="l01238"></a>01238                 left_green_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01239"></a>01239                 left_green_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setDefaultDimensions(0.5, 0.5);
<a name="l01240"></a>01240                 left_green_prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[0]=0;
<a name="l01241"></a>01241                 left_green_prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[0]=0;
<a name="l01242"></a>01242                 
<a name="l01243"></a>01243                 <span class="comment">//Left flash</span>
<a name="l01244"></a>01244                 <a class="code" href="structprop__t.html">prop_t</a> &amp; left_flash_prop = m_rig-&gt;props[m_rig-&gt;free_prop];
<a name="l01245"></a>01245                 m_rig-&gt;free_prop++;
<a name="l01246"></a>01246 
<a name="l01247"></a>01247                 left_flash_prop.<a class="code" href="structprop__t.html#a23fe12866c6bea2ed971e456bccfe501">noderef</a>=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1cafef68414f3f691cf1570adf0e985f">nbld</a>;
<a name="l01248"></a>01248                 left_flash_prop.<a class="code" href="structprop__t.html#a2db413fa8ce7a71f0cac011c035f4c33">nodex</a>=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a820633ef945ee92685f152674b0fd2b0">nblu</a>;
<a name="l01249"></a>01249                 left_flash_prop.<a class="code" href="structprop__t.html#ad5fd60d7f37628fb8f2cd61e77bc213c">nodey</a>=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1cafef68414f3f691cf1570adf0e985f">nbld</a>; <span class="comment">//ignored</span>
<a name="l01250"></a>01250                 left_flash_prop.<a class="code" href="structprop__t.html#a1bf7f6db554e501648fe1fe0544f67fb">offsetx</a>=0.5;
<a name="l01251"></a>01251                 left_flash_prop.<a class="code" href="structprop__t.html#aecceca2d076d8807015c554ccae1ef48">offsety</a>=0.0;
<a name="l01252"></a>01252                 left_flash_prop.<a class="code" href="structprop__t.html#a5cac941815e1c455ad9cf439e76bf24b">offsetz</a>=0.0;
<a name="l01253"></a>01253                 left_flash_prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a>=Ogre::Quaternion::IDENTITY;
<a name="l01254"></a>01254                 left_flash_prop.<a class="code" href="structprop__t.html#a8d4342b22134513dd7197b7456e8e46b" title="Special prop: custom steering wheel for dashboard.">wheel</a>=<span class="keyword">nullptr</span>;
<a name="l01255"></a>01255                 left_flash_prop.<a class="code" href="structprop__t.html#a1bef2bb0b1e842eb0bf36de9cc9b6ff9">wheelrotdegree</a>=0.0;
<a name="l01256"></a>01256                 left_flash_prop.<a class="code" href="structprop__t.html#a4ff55543f060c57d7e32a162afb99853">mirror</a>=0;
<a name="l01257"></a>01257                 left_flash_prop.<a class="code" href="structprop__t.html#a3b3e8e97174239ac445b08b12aa264b8" title="Is this a pale? (Boolean {0/1})">pale</a>=0;
<a name="l01258"></a>01258                 left_flash_prop.<a class="code" href="structprop__t.html#a2df2ebb1b18ff6dda8eacfd1330b1524" title="Is this a spinprop? (Boolean {0/1})">spinner</a>=0;
<a name="l01259"></a>01259                 left_flash_prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>=<span class="keyword">nullptr</span>; <span class="comment">//no visible prop</span>
<a name="l01260"></a>01260                 left_flash_prop.<a class="code" href="structprop__t.html#a3dccf8b3a2fdb5d21ffc344a5b7c60ef">bpos</a>[0]=0.5; <span class="comment">//alt</span>
<a name="l01261"></a>01261                 left_flash_prop.<a class="code" href="structprop__t.html#a7c0346ae551a6b1ea8556bd61ad5d86c">brate</a>[0]=1.0;
<a name="l01262"></a>01262                 left_flash_prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a>=<span class="charliteral">&#39;w&#39;</span>;
<a name="l01263"></a>01263                 <span class="comment">//light</span>
<a name="l01264"></a>01264                 sprintf(propname, <span class="stringliteral">&quot;prop-%s-%i&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_prop);
<a name="l01265"></a>01265                 left_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(propname);
<a name="l01266"></a>01266                 left_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setType(Ogre::Light::LT_POINT);
<a name="l01267"></a>01267                 left_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setDiffuseColour( Ogre::ColourValue(1.0, 1.0, 1.0));
<a name="l01268"></a>01268                 left_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setSpecularColour( Ogre::ColourValue(1.0, 1.0, 1.0));
<a name="l01269"></a>01269                 left_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setAttenuation(50.0, 1.0, 0.3, 0.0);
<a name="l01270"></a>01270                 left_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l01271"></a>01271                 left_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01272"></a>01272                 <span class="comment">//the flare billboard</span>
<a name="l01273"></a>01273                 left_flash_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l01274"></a>01274                 left_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(propname,1);
<a name="l01275"></a>01275                 left_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;createBillboard(0,0,0);
<a name="l01276"></a>01276                 <span class="keywordflow">if</span> (left_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0])
<a name="l01277"></a>01277                 {
<a name="l01278"></a>01278                     left_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l01279"></a>01279                     left_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/flare&quot;</span>);
<a name="l01280"></a>01280                     left_flash_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;attachObject(left_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]);
<a name="l01281"></a>01281                 }
<a name="l01282"></a>01282                 left_flash_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01283"></a>01283                 left_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setDefaultDimensions(1.0, 1.0);
<a name="l01284"></a>01284                 
<a name="l01285"></a>01285                 <span class="comment">//Right red</span>
<a name="l01286"></a>01286                 m_airplane_right_light=previous_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1be774e0a718ba8cdb61d4e8147d5a36">nfrd</a>;
<a name="l01287"></a>01287                 <a class="code" href="structprop__t.html">prop_t</a> &amp; right_red_prop = m_rig-&gt;props[m_rig-&gt;free_prop];
<a name="l01288"></a>01288                 m_rig-&gt;free_prop++;
<a name="l01289"></a>01289 
<a name="l01290"></a>01290                 
<a name="l01291"></a>01291                 right_red_prop.<a class="code" href="structprop__t.html#a23fe12866c6bea2ed971e456bccfe501">noderef</a>=start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1be774e0a718ba8cdb61d4e8147d5a36">nfrd</a>;
<a name="l01292"></a>01292                 right_red_prop.<a class="code" href="structprop__t.html#a2db413fa8ce7a71f0cac011c035f4c33">nodex</a>=start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#ac5d81d4608fed1206a022b917072ae5d">nfru</a>;
<a name="l01293"></a>01293                 right_red_prop.<a class="code" href="structprop__t.html#ad5fd60d7f37628fb8f2cd61e77bc213c">nodey</a>=start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1be774e0a718ba8cdb61d4e8147d5a36">nfrd</a>; <span class="comment">//ignored</span>
<a name="l01294"></a>01294                 right_red_prop.<a class="code" href="structprop__t.html#a1bf7f6db554e501648fe1fe0544f67fb">offsetx</a>=0.5;
<a name="l01295"></a>01295                 right_red_prop.<a class="code" href="structprop__t.html#aecceca2d076d8807015c554ccae1ef48">offsety</a>=0.0;
<a name="l01296"></a>01296                 right_red_prop.<a class="code" href="structprop__t.html#a5cac941815e1c455ad9cf439e76bf24b">offsetz</a>=0.0;
<a name="l01297"></a>01297                 right_red_prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a>=Ogre::Quaternion::IDENTITY;
<a name="l01298"></a>01298                 right_red_prop.<a class="code" href="structprop__t.html#a8d4342b22134513dd7197b7456e8e46b" title="Special prop: custom steering wheel for dashboard.">wheel</a>=<span class="keyword">nullptr</span>;
<a name="l01299"></a>01299                 right_red_prop.<a class="code" href="structprop__t.html#a1bef2bb0b1e842eb0bf36de9cc9b6ff9">wheelrotdegree</a>=0.0;
<a name="l01300"></a>01300                 right_red_prop.<a class="code" href="structprop__t.html#a4ff55543f060c57d7e32a162afb99853">mirror</a>=0;
<a name="l01301"></a>01301                 right_red_prop.<a class="code" href="structprop__t.html#a3b3e8e97174239ac445b08b12aa264b8" title="Is this a pale? (Boolean {0/1})">pale</a>=0;
<a name="l01302"></a>01302                 right_red_prop.<a class="code" href="structprop__t.html#a2df2ebb1b18ff6dda8eacfd1330b1524" title="Is this a spinprop? (Boolean {0/1})">spinner</a>=0;
<a name="l01303"></a>01303                 right_red_prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>=<span class="keyword">nullptr</span>; <span class="comment">//no visible prop</span>
<a name="l01304"></a>01304                 right_red_prop.<a class="code" href="structprop__t.html#a3dccf8b3a2fdb5d21ffc344a5b7c60ef">bpos</a>[0]=0.0;
<a name="l01305"></a>01305                 right_red_prop.<a class="code" href="structprop__t.html#a7c0346ae551a6b1ea8556bd61ad5d86c">brate</a>[0]=1.0;
<a name="l01306"></a>01306                 right_red_prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a>=<span class="charliteral">&#39;R&#39;</span>;
<a name="l01307"></a>01307                 right_red_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]=<span class="keyword">nullptr</span>; <span class="comment">/* No light */</span>
<a name="l01308"></a>01308                 <span class="comment">//the flare billboard</span>
<a name="l01309"></a>01309                 sprintf(propname, <span class="stringliteral">&quot;prop-%s-%i&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_prop);
<a name="l01310"></a>01310                 right_red_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l01311"></a>01311                 right_red_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(propname,1);
<a name="l01312"></a>01312                 right_red_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;createBillboard(0,0,0);
<a name="l01313"></a>01313                 <span class="keywordflow">if</span> (right_red_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0])
<a name="l01314"></a>01314                 {
<a name="l01315"></a>01315                     right_red_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l01316"></a>01316                     right_red_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/redflare&quot;</span>);
<a name="l01317"></a>01317                     right_red_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;attachObject(right_red_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]);
<a name="l01318"></a>01318                 }
<a name="l01319"></a>01319                 right_red_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01320"></a>01320                 right_red_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setDefaultDimensions(0.5, 0.5);
<a name="l01321"></a>01321                 right_red_prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[0]=0;
<a name="l01322"></a>01322                 right_red_prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[0]=0;
<a name="l01323"></a>01323                 
<a name="l01324"></a>01324                 <span class="comment">//Right flash</span>
<a name="l01325"></a>01325                 <a class="code" href="structprop__t.html">prop_t</a> &amp; right_flash_prop = m_rig-&gt;props[m_rig-&gt;free_prop];
<a name="l01326"></a>01326                 m_rig-&gt;free_prop++;
<a name="l01327"></a>01327 
<a name="l01328"></a>01328                 right_flash_prop.<a class="code" href="structprop__t.html#a23fe12866c6bea2ed971e456bccfe501">noderef</a>=start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a83b336e32822ada0d0e7f006d56a795d">nbrd</a>;
<a name="l01329"></a>01329                 right_flash_prop.<a class="code" href="structprop__t.html#a2db413fa8ce7a71f0cac011c035f4c33">nodex</a>=start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a77ff7d144a3ebe6bd4b1926209a05dea">nbru</a>;
<a name="l01330"></a>01330                 right_flash_prop.<a class="code" href="structprop__t.html#ad5fd60d7f37628fb8f2cd61e77bc213c">nodey</a>=start_wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a83b336e32822ada0d0e7f006d56a795d">nbrd</a>; <span class="comment">//ignored</span>
<a name="l01331"></a>01331                 right_flash_prop.<a class="code" href="structprop__t.html#a1bf7f6db554e501648fe1fe0544f67fb">offsetx</a>=0.5;
<a name="l01332"></a>01332                 right_flash_prop.<a class="code" href="structprop__t.html#aecceca2d076d8807015c554ccae1ef48">offsety</a>=0.0;
<a name="l01333"></a>01333                 right_flash_prop.<a class="code" href="structprop__t.html#a5cac941815e1c455ad9cf439e76bf24b">offsetz</a>=0.0;
<a name="l01334"></a>01334                 right_flash_prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a>=Ogre::Quaternion::IDENTITY;
<a name="l01335"></a>01335                 right_flash_prop.<a class="code" href="structprop__t.html#a8d4342b22134513dd7197b7456e8e46b" title="Special prop: custom steering wheel for dashboard.">wheel</a>=<span class="keyword">nullptr</span>;
<a name="l01336"></a>01336                 right_flash_prop.<a class="code" href="structprop__t.html#a1bef2bb0b1e842eb0bf36de9cc9b6ff9">wheelrotdegree</a>=0.0;
<a name="l01337"></a>01337                 right_flash_prop.<a class="code" href="structprop__t.html#a4ff55543f060c57d7e32a162afb99853">mirror</a>=0;
<a name="l01338"></a>01338                 right_flash_prop.<a class="code" href="structprop__t.html#a3b3e8e97174239ac445b08b12aa264b8" title="Is this a pale? (Boolean {0/1})">pale</a>=0;
<a name="l01339"></a>01339                 right_flash_prop.<a class="code" href="structprop__t.html#a2df2ebb1b18ff6dda8eacfd1330b1524" title="Is this a spinprop? (Boolean {0/1})">spinner</a>=0;
<a name="l01340"></a>01340                 right_flash_prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>=<span class="keyword">nullptr</span>; <span class="comment">//no visible prop</span>
<a name="l01341"></a>01341                 right_flash_prop.<a class="code" href="structprop__t.html#a3dccf8b3a2fdb5d21ffc344a5b7c60ef">bpos</a>[0]=0.5; <span class="comment">//alt</span>
<a name="l01342"></a>01342                 right_flash_prop.<a class="code" href="structprop__t.html#a7c0346ae551a6b1ea8556bd61ad5d86c">brate</a>[0]=1.0;
<a name="l01343"></a>01343                 right_flash_prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a>=<span class="charliteral">&#39;w&#39;</span>;
<a name="l01344"></a>01344                 <span class="comment">//light</span>
<a name="l01345"></a>01345                 sprintf(propname, <span class="stringliteral">&quot;prop-%s-%i&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_prop);
<a name="l01346"></a>01346                 right_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(propname);
<a name="l01347"></a>01347                 right_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setType(Ogre::Light::LT_POINT);
<a name="l01348"></a>01348                 right_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setDiffuseColour( Ogre::ColourValue(1.0, 1.0, 1.0));
<a name="l01349"></a>01349                 right_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setSpecularColour( Ogre::ColourValue(1.0, 1.0, 1.0));
<a name="l01350"></a>01350                 right_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setAttenuation(50.0, 1.0, 0.3, 0.0);
<a name="l01351"></a>01351                 right_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l01352"></a>01352                 right_flash_prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01353"></a>01353                 <span class="comment">//the flare billboard</span>
<a name="l01354"></a>01354                 right_flash_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l01355"></a>01355                 right_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(propname,1);
<a name="l01356"></a>01356                 right_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;createBillboard(0,0,0);
<a name="l01357"></a>01357                 <span class="keywordflow">if</span> (right_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0] != <span class="keyword">nullptr</span>)
<a name="l01358"></a>01358                 {
<a name="l01359"></a>01359                     right_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l01360"></a>01360                     right_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/flare&quot;</span>);
<a name="l01361"></a>01361                     right_flash_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;attachObject(right_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]);
<a name="l01362"></a>01362                 }
<a name="l01363"></a>01363                 right_flash_prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l01364"></a>01364                 right_flash_prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setDefaultDimensions(1.0, 1.0);
<a name="l01365"></a>01365                 right_flash_prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[0]=0;
<a name="l01366"></a>01366                 right_flash_prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[0]=0;
<a name="l01367"></a>01367                 
<a name="l01368"></a>01368                 m_generate_wing_position_lights = <span class="keyword">false</span>; <span class="comment">// Already done</span>
<a name="l01369"></a>01369             }
<a name="l01370"></a>01370 
<a name="l01371"></a>01371             m_rig-&gt;wingstart=wing_index;
<a name="l01372"></a>01372             m_wing_area=ComputeWingArea(
<a name="l01373"></a>01373                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>).AbsPosition, 
<a name="l01374"></a>01374                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1be774e0a718ba8cdb61d4e8147d5a36">nfrd</a>).AbsPosition, 
<a name="l01375"></a>01375                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1cafef68414f3f691cf1570adf0e985f">nbld</a>).AbsPosition, 
<a name="l01376"></a>01376                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a83b336e32822ada0d0e7f006d56a795d">nbrd</a>).AbsPosition
<a name="l01377"></a>01377             );
<a name="l01378"></a>01378         }
<a name="l01379"></a>01379         <span class="keywordflow">else</span> 
<a name="l01380"></a>01380         {
<a name="l01381"></a>01381             m_wing_area+=ComputeWingArea(
<a name="l01382"></a>01382                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a4ac9c20c7274fae92d4e48b8050e2dec">nfld</a>).AbsPosition, 
<a name="l01383"></a>01383                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1be774e0a718ba8cdb61d4e8147d5a36">nfrd</a>).AbsPosition, 
<a name="l01384"></a>01384                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a1cafef68414f3f691cf1570adf0e985f">nbld</a>).AbsPosition, 
<a name="l01385"></a>01385                 GetNode(wing.<a class="code" href="structwing__t.html#aa618df27452b384e438ac7a2dbf6c93d">fa</a>-&gt;<a class="code" href="class_flex_airfoil.html#a83b336e32822ada0d0e7f006d56a795d">nbrd</a>).AbsPosition
<a name="l01386"></a>01386             );
<a name="l01387"></a>01387         }
<a name="l01388"></a>01388     }               
<a name="l01389"></a>01389 }
<a name="l01390"></a>01390 
<a name="l01391"></a><a class="code" href="class_rig_spawner.html#a31c0b1273553f1792f1970e877eedebc">01391</a> <span class="keywordtype">float</span> <a class="code" href="class_rig_spawner.html#a31c0b1273553f1792f1970e877eedebc">RigSpawner::ComputeWingArea</a>(Ogre::Vector3 <span class="keyword">const</span> &amp; ref, Ogre::Vector3 <span class="keyword">const</span> &amp; x, Ogre::Vector3 <span class="keyword">const</span> &amp; y, Ogre::Vector3 <span class="keyword">const</span> &amp; aref)
<a name="l01392"></a>01392 {
<a name="l01393"></a>01393     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01394"></a>01394 
<a name="l01395"></a>01395     <span class="keywordflow">return</span> (((x-ref).crossProduct(y-ref)).length()+((x-aref).crossProduct(y-aref)).length())*0.5f;
<a name="l01396"></a>01396 }
<a name="l01397"></a>01397 
<a name="l01398"></a><a class="code" href="class_rig_spawner.html#aa1d24676d205cc7c313258b914187a64">01398</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aa1d24676d205cc7c313258b914187a64">RigSpawner::ProcessSoundSource2</a>(<a class="code" href="struct_rig_def_1_1_sound_source2.html">RigDef::SoundSource2</a> &amp; def)
<a name="l01399"></a>01399 {
<a name="l01400"></a>01400     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01401"></a>01401 
<a name="l01402"></a>01402     <span class="keywordtype">int</span> mode = (def.<a class="code" href="struct_rig_def_1_1_sound_source2.html#a64eb25ae2d258b2a97e6f59441411c39">mode</a> == <a class="code" href="struct_rig_def_1_1_sound_source2.html#aa408cd90ab02d8b10087891936570c80abb6f1c0073fb7ab60f30c26f0320af1a">RigDef::SoundSource2::MODE_CINECAM</a>) ? def.<a class="code" href="struct_rig_def_1_1_sound_source2.html#a0f708397ab919b35ce7a88a32d3a8ce2">cinecam_index</a> : def.<a class="code" href="struct_rig_def_1_1_sound_source2.html#a64eb25ae2d258b2a97e6f59441411c39">mode</a>;
<a name="l01403"></a>01403     <span class="keywordtype">int</span> node_index = FindNodeIndex(def.<a class="code" href="struct_rig_def_1_1_sound_source.html#a2bd1ee6a10e18432a2ea28886e8b0c53">node</a>);
<a name="l01404"></a>01404     <span class="keywordflow">if</span> (node_index == -1)
<a name="l01405"></a>01405     {
<a name="l01406"></a>01406         <span class="keywordflow">return</span>;
<a name="l01407"></a>01407     }
<a name="l01408"></a>01408     AddSoundSource(
<a name="l01409"></a>01409             m_rig,
<a name="l01410"></a>01410             SoundScriptManager::getSingleton().createInstance(def.<a class="code" href="struct_rig_def_1_1_sound_source.html#adc2a5959e0bdd022076270167b4f4224">sound_script_name</a>, m_rig-&gt;trucknum), 
<a name="l01411"></a>01411             node_index,
<a name="l01412"></a>01412             mode
<a name="l01413"></a>01413         );
<a name="l01414"></a>01414 }
<a name="l01415"></a>01415 
<a name="l01416"></a><a class="code" href="class_rig_spawner.html#a94ed26619f502433153bf3d6bd8f07d9">01416</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a94ed26619f502433153bf3d6bd8f07d9">RigSpawner::AddSoundSourceInstance</a>(<a class="code" href="class_beam.html">Beam</a> *vehicle, Ogre::String <span class="keyword">const</span> &amp; sound_script_name, <span class="keywordtype">int</span> node_index, <span class="keywordtype">int</span> type)
<a name="l01417"></a>01417 {
<a name="l01418"></a>01418     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01419"></a>01419 
<a name="l01420"></a>01420     AddSoundSource(vehicle, SoundScriptManager::getSingleton().createInstance(sound_script_name, vehicle-&gt;<a class="code" href="structrig__t.html#a7c1e3928db39d4489eb3dbaa4fb0db5b">trucknum</a>, <span class="keyword">nullptr</span>), node_index);
<a name="l01421"></a>01421 }
<a name="l01422"></a>01422 
<a name="l01423"></a><a class="code" href="class_rig_spawner.html#af5a9cc99001c694755362c78ce9ae27f">01423</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af5a9cc99001c694755362c78ce9ae27f">RigSpawner::AddSoundSource</a>(<a class="code" href="class_beam.html">Beam</a> *vehicle, SoundScriptInstance *sound_script, <span class="keywordtype">int</span> node_index, <span class="keywordtype">int</span> type)
<a name="l01424"></a>01424 {
<a name="l01425"></a>01425     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01426"></a>01426 
<a name="l01427"></a>01427     <span class="keywordflow">if</span> (! CheckSoundScriptLimit(vehicle, 1))
<a name="l01428"></a>01428     {
<a name="l01429"></a>01429         <span class="keywordflow">return</span>;
<a name="l01430"></a>01430     }
<a name="l01431"></a>01431 
<a name="l01432"></a>01432     <span class="keywordflow">if</span> (sound_script == <span class="keyword">nullptr</span>)
<a name="l01433"></a>01433     {
<a name="l01434"></a>01434         <span class="keywordflow">return</span>;
<a name="l01435"></a>01435     }
<a name="l01436"></a>01436 
<a name="l01437"></a>01437     vehicle-&gt;<a class="code" href="structrig__t.html#af9dd5ea357e0d12bb6313a99773b90a5">soundsources</a>[vehicle-&gt;<a class="code" href="structrig__t.html#a84827602fd06d83ceb927e7274decb26">free_soundsource</a>].<a class="code" href="structsoundsource__t.html#a82374b5bd2c94e290951fe6ac82de3b5">ssi</a>=sound_script;
<a name="l01438"></a>01438     vehicle-&gt;<a class="code" href="structrig__t.html#af9dd5ea357e0d12bb6313a99773b90a5">soundsources</a>[vehicle-&gt;<a class="code" href="structrig__t.html#a84827602fd06d83ceb927e7274decb26">free_soundsource</a>].<a class="code" href="structsoundsource__t.html#ac05ba4154642b1d441dc07412c57b2bd">nodenum</a>=node_index;
<a name="l01439"></a>01439     vehicle-&gt;<a class="code" href="structrig__t.html#af9dd5ea357e0d12bb6313a99773b90a5">soundsources</a>[vehicle-&gt;<a class="code" href="structrig__t.html#a84827602fd06d83ceb927e7274decb26">free_soundsource</a>].<a class="code" href="structsoundsource__t.html#a9b1152b0c928c4b334ef7ba421e06c88">type</a>=type;
<a name="l01440"></a>01440     vehicle-&gt;<a class="code" href="structrig__t.html#a84827602fd06d83ceb927e7274decb26">free_soundsource</a>++;
<a name="l01441"></a>01441 }
<a name="l01442"></a>01442 
<a name="l01443"></a><a class="code" href="class_rig_spawner.html#a2123d95b64fb832999c7e6a0e01e4fa5">01443</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a2123d95b64fb832999c7e6a0e01e4fa5">RigSpawner::ProcessSoundSource</a>(<a class="code" href="struct_rig_def_1_1_sound_source.html">RigDef::SoundSource</a> &amp; def)
<a name="l01444"></a>01444 {
<a name="l01445"></a>01445     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01446"></a>01446 
<a name="l01447"></a>01447     AddSoundSource(
<a name="l01448"></a>01448             m_rig,
<a name="l01449"></a>01449             SoundScriptManager::getSingleton().createInstance(def.<a class="code" href="struct_rig_def_1_1_sound_source.html#adc2a5959e0bdd022076270167b4f4224">sound_script_name</a>, m_rig-&gt;trucknum), 
<a name="l01450"></a>01450             GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_sound_source.html#a2bd1ee6a10e18432a2ea28886e8b0c53">node</a>),
<a name="l01451"></a>01451             -2
<a name="l01452"></a>01452         );
<a name="l01453"></a>01453 }
<a name="l01454"></a>01454 
<a name="l01455"></a><a class="code" href="class_rig_spawner.html#a017de832430caece45a8879de76cad11">01455</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a017de832430caece45a8879de76cad11">RigSpawner::ProcessCameraRail</a>(<a class="code" href="struct_rig_def_1_1_camera_rail.html">RigDef::CameraRail</a> &amp; def)
<a name="l01456"></a>01456 {
<a name="l01457"></a>01457     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     <span class="keyword">auto</span> itor = def.<a class="code" href="struct_rig_def_1_1_camera_rail.html#a5169035d5342fcb7efa9cc60048bb427">nodes</a>.begin();
<a name="l01460"></a>01460     <span class="keyword">auto</span> end  = def.<a class="code" href="struct_rig_def_1_1_camera_rail.html#a5169035d5342fcb7efa9cc60048bb427">nodes</a>.end();
<a name="l01461"></a>01461     <span class="keywordflow">for</span>(; itor != end; ++itor)
<a name="l01462"></a>01462     {
<a name="l01463"></a>01463         <span class="keywordflow">if</span> (! CheckCameraRailLimit(1))
<a name="l01464"></a>01464         {
<a name="l01465"></a>01465             <span class="keywordflow">return</span>;
<a name="l01466"></a>01466         }
<a name="l01467"></a>01467         m_rig-&gt;cameraRail[m_rig-&gt;free_camerarail] = GetNodeIndexOrThrow(*itor);
<a name="l01468"></a>01468     }
<a name="l01469"></a>01469 }
<a name="l01470"></a>01470 
<a name="l01471"></a><a class="code" href="class_rig_spawner.html#abddfa26ec5b9f17139da7b7bf20f56c1">01471</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#abddfa26ec5b9f17139da7b7bf20f56c1">RigSpawner::ProcessExtCamera</a>(<a class="code" href="struct_rig_def_1_1_ext_camera.html">RigDef::ExtCamera</a> &amp; def)
<a name="l01472"></a>01472 {
<a name="l01473"></a>01473     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01474"></a>01474 
<a name="l01475"></a>01475     m_rig-&gt;externalcameramode = def.<a class="code" href="struct_rig_def_1_1_ext_camera.html#a59945cc99a78817ec8d99f2617e47ca3">mode</a>;
<a name="l01476"></a>01476     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_ext_camera.html#a6fd883282c79029116cb1b791fbf1097">node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l01477"></a>01477     {
<a name="l01478"></a>01478         m_rig-&gt;externalcameranode = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_ext_camera.html#a6fd883282c79029116cb1b791fbf1097">node</a>);
<a name="l01479"></a>01479     }
<a name="l01480"></a>01480 }
<a name="l01481"></a>01481 
<a name="l01482"></a><a class="code" href="class_rig_spawner.html#ac40a82ded5f7e9199428c228d4c5cd89">01482</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ac40a82ded5f7e9199428c228d4c5cd89">RigSpawner::ProcessVideoCamera</a>(<a class="code" href="struct_rig_def_1_1_video_camera.html">RigDef::VideoCamera</a> &amp; def)
<a name="l01483"></a>01483 {
<a name="l01484"></a>01484     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01485"></a>01485 
<a name="l01486"></a>01486     <a class="code" href="class_video_camera.html">VideoCamera</a> *v = <a class="code" href="class_video_camera.html#a8268fb8cb1546ba2f78a2179c6a763c2">VideoCamera::Setup</a>(<span class="keyword">this</span>, def);
<a name="l01487"></a>01487     <span class="keywordflow">if</span> (v != <span class="keyword">nullptr</span>)
<a name="l01488"></a>01488     {
<a name="l01489"></a>01489         m_rig-&gt;vidcams.push_back(v);
<a name="l01490"></a>01490     }
<a name="l01491"></a>01491     <span class="keywordflow">else</span>
<a name="l01492"></a>01492     {
<a name="l01493"></a>01493         AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to create video camera&quot;</span>);
<a name="l01494"></a>01494     }
<a name="l01495"></a>01495 }
<a name="l01496"></a>01496 
<a name="l01497"></a><a class="code" href="class_rig_spawner.html#a34e4dc9a27bce1c49b72ce5feb4ebaae">01497</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a34e4dc9a27bce1c49b72ce5feb4ebaae">RigSpawner::ProcessGuiSettings</a>(<a class="code" href="struct_rig_def_1_1_gui_settings.html">RigDef::GuiSettings</a> &amp; def)
<a name="l01498"></a>01498 {
<a name="l01499"></a>01499     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01500"></a>01500 
<a name="l01501"></a>01501     m_rig-&gt;tachomat = def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#af750537cd6eff49c15d07884632ce907">tacho_material</a>;
<a name="l01502"></a>01502     m_rig-&gt;speedomat = def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#aa5ec9dd0781f91001802bc974681e359">speedo_material</a>;
<a name="l01503"></a>01503     <span class="keywordflow">if</span> (! def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a67a6f8681381fba6e850a3a24476b2e6">help_material</a>.empty())
<a name="l01504"></a>01504     {
<a name="l01505"></a>01505         strncpy(m_rig-&gt;helpmat, def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a67a6f8681381fba6e850a3a24476b2e6">help_material</a>.c_str(), <span class="keyword">sizeof</span>(m_rig-&gt;helpmat) - 1);
<a name="l01506"></a>01506     }
<a name="l01507"></a>01507     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a8e3aecd4b95624548fd2389c4822189b">speedo_highest_kph</a> &gt; 10 &amp;&amp; def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a8e3aecd4b95624548fd2389c4822189b">speedo_highest_kph</a> &lt; 32000)
<a name="l01508"></a>01508     {
<a name="l01509"></a>01509         m_rig-&gt;speedoMax = def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a8e3aecd4b95624548fd2389c4822189b">speedo_highest_kph</a>; <span class="comment">/* Handles default */</span>
<a name="l01510"></a>01510     }
<a name="l01511"></a>01511     <span class="keywordflow">else</span>
<a name="l01512"></a>01512     {
<a name="l01513"></a>01513         std::stringstream msg;
<a name="l01514"></a>01514         msg &lt;&lt; <span class="stringliteral">&quot;Invalid &#39;speedo_highest_kph&#39; value (&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a8e3aecd4b95624548fd2389c4822189b">speedo_highest_kph</a> &lt;&lt; <span class="stringliteral">&quot;), allowed range is &lt;10 -32000&gt;. Falling back to default...&quot;</span>;
<a name="l01515"></a>01515         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l01516"></a>01516         m_rig-&gt;speedoMax = <a class="code" href="struct_rig_def_1_1_gui_settings.html#a03146641ce5c149be80fa8cf343860d3">RigDef::GuiSettings::DEFAULT_SPEEDO_MAX</a>;
<a name="l01517"></a>01517     }
<a name="l01518"></a>01518     m_rig-&gt;useMaxRPMforGUI = def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a7572832a5d66683fa260a403d9d6f7c4">use_max_rpm</a>;  <span class="comment">/* Handles default */</span>
<a name="l01519"></a>01519 
<a name="l01520"></a>01520     std::list&lt;Ogre::String&gt;::iterator dash_itor = def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a8724f4256b74cfa85ab58cd197666e84">dashboard_layouts</a>.begin();
<a name="l01521"></a>01521     <span class="keywordflow">for</span> ( ; dash_itor != def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a8724f4256b74cfa85ab58cd197666e84">dashboard_layouts</a>.end(); dash_itor++)
<a name="l01522"></a>01522     {
<a name="l01523"></a>01523         m_rig-&gt;dashBoardLayouts.push_back(std::pair&lt;Ogre::String, bool&gt;(*dash_itor, <span class="keyword">false</span>));
<a name="l01524"></a>01524     }
<a name="l01525"></a>01525 
<a name="l01526"></a>01526     std::list&lt;Ogre::String&gt;::iterator rtt_itor = def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a44beac907eab61484ac33a297d4e2723">rtt_dashboard_layouts</a>.begin();
<a name="l01527"></a>01527     <span class="keywordflow">for</span> ( ; rtt_itor != def.<a class="code" href="struct_rig_def_1_1_gui_settings.html#a44beac907eab61484ac33a297d4e2723">rtt_dashboard_layouts</a>.end(); rtt_itor++)
<a name="l01528"></a>01528     {
<a name="l01529"></a>01529         m_rig-&gt;dashBoardLayouts.push_back(std::pair&lt;Ogre::String, bool&gt;(*rtt_itor, <span class="keyword">true</span>));
<a name="l01530"></a>01530     }
<a name="l01531"></a>01531 
<a name="l01532"></a>01532 }
<a name="l01533"></a>01533 
<a name="l01534"></a><a class="code" href="class_rig_spawner.html#a9cf2655ecc490b4c5bd63a5ac69062e5">01534</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a9cf2655ecc490b4c5bd63a5ac69062e5">RigSpawner::ProcessFixedNode</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> node_ref)
<a name="l01535"></a>01535 {
<a name="l01536"></a>01536     <a class="code" href="structnode__t.html">node_t</a> &amp; node = GetNodeOrThrow(node_ref);
<a name="l01537"></a>01537     node.<a class="code" href="structnode__t.html#a37ac963c2be7abcd147d1952193bf550">locked</a> = 1;
<a name="l01538"></a>01538 }
<a name="l01539"></a>01539 
<a name="l01540"></a><a class="code" href="class_rig_spawner.html#a31feba4779a64c68fb6de0be028187dc">01540</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a31feba4779a64c68fb6de0be028187dc">RigSpawner::ProcessExhaust</a>(<a class="code" href="struct_rig_def_1_1_exhaust.html">RigDef::Exhaust</a> &amp; def)
<a name="l01541"></a>01541 {
<a name="l01542"></a>01542     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01543"></a>01543 
<a name="l01544"></a>01544     <span class="comment">// parse exhausts</span>
<a name="l01545"></a>01545     <span class="keywordflow">if</span> (m_rig-&gt;disable_smoke)
<a name="l01546"></a>01546     {
<a name="l01547"></a>01547         <span class="keywordflow">return</span>;
<a name="l01548"></a>01548     }
<a name="l01549"></a>01549     
<a name="l01550"></a>01550     <a class="code" href="structnode__t.html">node_t</a> &amp; ref_node = GetNodeOrThrow(def.<a class="code" href="struct_rig_def_1_1_exhaust.html#a4377c68c1a0660bd0b80b22678d91adb">reference_node</a>);<span class="comment">//id1;</span>
<a name="l01551"></a>01551     <a class="code" href="structnode__t.html">node_t</a> &amp; dir_node = GetNodeOrThrow(def.<a class="code" href="struct_rig_def_1_1_exhaust.html#a0b979d6372b169ce43a3982da773054c">direction_node</a>);<span class="comment">//id2;</span>
<a name="l01552"></a>01552 
<a name="l01553"></a>01553     <a class="code" href="structexhaust__t.html">exhaust_t</a> exhaust;
<a name="l01554"></a>01554     exhaust.<a class="code" href="structexhaust__t.html#a2b7657f951482ce38a72c347809f539b">emitterNode</a> = ref_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>;
<a name="l01555"></a>01555     exhaust.<a class="code" href="structexhaust__t.html#a125e03e4b6add2a031f73a19881e3035">directionNode</a> = dir_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>;
<a name="l01556"></a>01556     exhaust.<a class="code" href="structexhaust__t.html#ab718fc960742f3b3955a0bbb86b7a5ab" title="False if defined in &#39;exhausts&#39; section, true if defined in &#39;nodes&#39; by &#39;x&#39;/&#39;y&#39; flag.">isOldFormat</a> = <span class="keyword">false</span>;
<a name="l01557"></a>01557     exhaust.<a class="code" href="structexhaust__t.html#a2003daf0d86d88e00091f8912ba43eea">factor</a> = 1.f; <span class="comment">// Unused, according to wiki documentation.</span>
<a name="l01558"></a>01558     std::memset(exhaust.<a class="code" href="structexhaust__t.html#a59d141770d6a8fd44a4165991ccba1e9">material</a>, 0, <span class="keyword">sizeof</span>(exhaust.<a class="code" href="structexhaust__t.html#a59d141770d6a8fd44a4165991ccba1e9">material</a>));
<a name="l01559"></a>01559     
<a name="l01560"></a>01560     exhaust.<a class="code" href="structexhaust__t.html#aa92b4afbbad118ec282621b7b6a3ac6e">smokeNode</a> = m_parent_scene_node-&gt;createChildSceneNode();
<a name="l01561"></a>01561     std::stringstream instance_name;
<a name="l01562"></a>01562     instance_name &lt;&lt; <span class="stringliteral">&quot;exhaust-&quot;</span> &lt;&lt; m_rig-&gt;exhausts.size() &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; m_rig-&gt;truckname;
<a name="l01563"></a>01563     Ogre::String material_name;
<a name="l01564"></a>01564     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_exhaust.html#a67fc90a534b3463e5dea3a93250ad191">material_name</a>.empty() || def.<a class="code" href="struct_rig_def_1_1_exhaust.html#a67fc90a534b3463e5dea3a93250ad191">material_name</a> == <span class="stringliteral">&quot;default&quot;</span>)
<a name="l01565"></a>01565     {
<a name="l01566"></a>01566         material_name = <span class="stringliteral">&quot;tracks/Smoke&quot;</span>;
<a name="l01567"></a>01567     }
<a name="l01568"></a>01568     <span class="keywordflow">else</span>
<a name="l01569"></a>01569     {
<a name="l01570"></a>01570         material_name = def.<a class="code" href="struct_rig_def_1_1_exhaust.html#a67fc90a534b3463e5dea3a93250ad191">material_name</a>;
<a name="l01571"></a>01571     }
<a name="l01572"></a>01572 
<a name="l01573"></a>01573     <span class="keywordflow">if</span> (m_rig-&gt;usedSkin)
<a name="l01574"></a>01574     {
<a name="l01575"></a>01575         Ogre::String newMat = m_rig-&gt;usedSkin-&gt;getReplacementForMaterial(material_name);
<a name="l01576"></a>01576         <span class="keywordflow">if</span> (!newMat.empty())
<a name="l01577"></a>01577         {
<a name="l01578"></a>01578             <span class="comment">//strncpy(material, newMat.c_str(), 50);</span>
<a name="l01579"></a>01579             material_name = newMat;
<a name="l01580"></a>01580         }
<a name="l01581"></a>01581     }
<a name="l01582"></a>01582 
<a name="l01583"></a>01583     exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createParticleSystem(instance_name.str(), material_name);
<a name="l01584"></a>01584     <span class="keywordflow">if</span> (!exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a>)
<a name="l01585"></a>01585     {
<a name="l01586"></a>01586         AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to create exhaust particle system&quot;</span>);
<a name="l01587"></a>01587         <span class="keywordflow">return</span>;
<a name="l01588"></a>01588     }
<a name="l01589"></a>01589     exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a>-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>); <span class="comment">// disable particles in depthmap</span>
<a name="l01590"></a>01590     exhaust.<a class="code" href="structexhaust__t.html#aa92b4afbbad118ec282621b7b6a3ac6e">smokeNode</a>-&gt;attachObject(exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a>);
<a name="l01591"></a>01591     exhaust.<a class="code" href="structexhaust__t.html#aa92b4afbbad118ec282621b7b6a3ac6e">smokeNode</a>-&gt;setPosition(m_rig-&gt;nodes[exhaust.<a class="code" href="structexhaust__t.html#a2b7657f951482ce38a72c347809f539b">emitterNode</a>].AbsPosition);
<a name="l01592"></a>01592     
<a name="l01593"></a>01593     ref_node.<a class="code" href="structnode__t.html#a9e196aca44cd914d7ccdda5e4d206fb8" title="Makes this node emit vapour particles when in contact with water.">isHot</a>=<span class="keyword">true</span>;
<a name="l01594"></a>01594     dir_node.<a class="code" href="structnode__t.html#a9e196aca44cd914d7ccdda5e4d206fb8" title="Makes this node emit vapour particles when in contact with water.">isHot</a>=<span class="keyword">true</span>;
<a name="l01595"></a>01595     ref_node.<a class="code" href="structnode__t.html#aef05ecf1894a1c0ef547c5da5a50cef1">iIsSkin</a>=<span class="keyword">true</span>;
<a name="l01596"></a>01596     dir_node.<a class="code" href="structnode__t.html#aef05ecf1894a1c0ef547c5da5a50cef1">iIsSkin</a>=<span class="keyword">true</span>;
<a name="l01597"></a>01597     m_rig-&gt;exhausts.push_back(exhaust);
<a name="l01598"></a>01598 }
<a name="l01599"></a>01599 
<a name="l01600"></a><a class="code" href="class_rig_spawner.html#a4d89ec70342e6ad29e69169e2e15e9d9">01600</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a4d89ec70342e6ad29e69169e2e15e9d9">RigSpawner::ProcessSubmeshGroundmodel</a>()
<a name="l01601"></a>01601 {
<a name="l01602"></a>01602     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01603"></a>01603 
<a name="l01604"></a>01604     SetCurrentKeyword(<a class="code" href="struct_rig_def_1_1_file.html#add5bea6329504fe29cc675aa7f8a75c3a5a08b19a89c168922d73a630be2c1f96">RigDef::File::KEYWORD_SUBMESH_GROUNDMODEL</a>);
<a name="l01605"></a>01605 
<a name="l01606"></a>01606     <span class="keyword">auto</span> module_itor = m_selected_modules.begin();
<a name="l01607"></a>01607     <span class="keyword">auto</span> module_end  = m_selected_modules.end();
<a name="l01608"></a>01608     <span class="keywordflow">for</span> (; module_itor != module_end; ++module_itor)
<a name="l01609"></a>01609     {
<a name="l01610"></a>01610         <span class="keywordflow">if</span> (! module_itor-&gt;get()-&gt;submeshes_ground_model_name.empty())
<a name="l01611"></a>01611         {
<a name="l01612"></a>01612             m_rig-&gt;subMeshGroundModelName = module_itor-&gt;get()-&gt;submeshes_ground_model_name;
<a name="l01613"></a>01613             <span class="keywordflow">break</span>;
<a name="l01614"></a>01614         }
<a name="l01615"></a>01615     }
<a name="l01616"></a>01616 
<a name="l01617"></a>01617     SetCurrentKeyword(<a class="code" href="struct_rig_def_1_1_file.html#add5bea6329504fe29cc675aa7f8a75c3a1c5772b1ec3afd9b63e87fb3d53293bc">RigDef::File::KEYWORD_INVALID</a>);
<a name="l01618"></a>01618 };
<a name="l01619"></a>01619 
<a name="l01620"></a><a class="code" href="class_rig_spawner.html#a8fd7b6233073533d73e8f0f35d9869b6">01620</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a8fd7b6233073533d73e8f0f35d9869b6">RigSpawner::ProcessSubmesh</a>(<a class="code" href="struct_rig_def_1_1_submesh.html">RigDef::Submesh</a> &amp; def)
<a name="l01621"></a>01621 {
<a name="l01622"></a>01622     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01623"></a>01623 
<a name="l01624"></a>01624     <span class="keywordflow">if</span> (! CheckSubmeshLimit(1))
<a name="l01625"></a>01625     {
<a name="l01626"></a>01626         <span class="keywordflow">return</span>;
<a name="l01627"></a>01627     }
<a name="l01628"></a>01628 
<a name="l01629"></a>01629     m_rig-&gt;subtexcoords[m_rig-&gt;free_sub]=m_rig-&gt;free_texcoord;
<a name="l01630"></a>01630     m_rig-&gt;subcabs[m_rig-&gt;free_sub]=m_rig-&gt;free_cab;
<a name="l01631"></a>01631     m_rig-&gt;free_sub++;
<a name="l01632"></a>01632     <span class="comment">//initialize the next</span>
<a name="l01633"></a>01633     m_rig-&gt;subisback[m_rig-&gt;free_sub]=0;
<a name="l01634"></a>01634 
<a name="l01635"></a>01635     <span class="comment">/* TEXCOORDS */</span>
<a name="l01636"></a>01636 
<a name="l01637"></a>01637     std::vector&lt;RigDef::Texcoord&gt;::iterator texcoord_itor = def.<a class="code" href="struct_rig_def_1_1_submesh.html#a8f1943a80d219d3ce24a2def8f46d5fc">texcoords</a>.begin();
<a name="l01638"></a>01638     <span class="keywordflow">for</span> ( ; texcoord_itor != def.<a class="code" href="struct_rig_def_1_1_submesh.html#a8f1943a80d219d3ce24a2def8f46d5fc">texcoords</a>.end(); texcoord_itor++)
<a name="l01639"></a>01639     {
<a name="l01640"></a>01640         <span class="keywordflow">if</span> (! CheckTexcoordLimit(1))
<a name="l01641"></a>01641         {
<a name="l01642"></a>01642             <span class="keywordflow">break</span>;
<a name="l01643"></a>01643         }
<a name="l01644"></a>01644 
<a name="l01645"></a>01645         m_rig-&gt;texcoords[m_rig-&gt;free_texcoord] = Ogre::Vector3(GetNodeIndexOrThrow(texcoord_itor-&gt;node), texcoord_itor-&gt;u, texcoord_itor-&gt;v);<span class="comment">//(id, x, y);</span>
<a name="l01646"></a>01646         m_rig-&gt;free_texcoord++;
<a name="l01647"></a>01647     }
<a name="l01648"></a>01648 
<a name="l01649"></a>01649     <span class="comment">/* CAB */</span>
<a name="l01650"></a>01650 
<a name="l01651"></a>01651     <span class="keyword">auto</span> cab_itor = def.<a class="code" href="struct_rig_def_1_1_submesh.html#a706856fe350209888c4deaa9e41c6338">cab_triangles</a>.begin();
<a name="l01652"></a>01652     <span class="keyword">auto</span> cab_itor_end = def.<a class="code" href="struct_rig_def_1_1_submesh.html#a706856fe350209888c4deaa9e41c6338">cab_triangles</a>.end();
<a name="l01653"></a>01653     <span class="keywordflow">for</span> ( ; cab_itor != cab_itor_end; ++cab_itor)
<a name="l01654"></a>01654     {
<a name="l01655"></a>01655         <span class="keywordflow">if</span> (! CheckCabLimit(1))
<a name="l01656"></a>01656         {
<a name="l01657"></a>01657             <span class="keywordflow">return</span>;
<a name="l01658"></a>01658         }
<a name="l01659"></a>01659         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_rig-&gt;free_collcab &gt;= <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a>)
<a name="l01660"></a>01660         {
<a name="l01661"></a>01661             std::stringstream msg;
<a name="l01662"></a>01662             msg &lt;&lt; <span class="stringliteral">&quot;Collcab limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l01663"></a>01663             AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l01664"></a>01664             <span class="keywordflow">return</span>;
<a name="l01665"></a>01665         }
<a name="l01666"></a>01666 
<a name="l01667"></a>01667         m_rig-&gt;cabs[m_rig-&gt;free_cab*3]=GetNodeIndexOrThrow(cab_itor-&gt;nodes[0]); <span class="comment">//id1;</span>
<a name="l01668"></a>01668         m_rig-&gt;cabs[m_rig-&gt;free_cab*3+1]=GetNodeIndexOrThrow(cab_itor-&gt;nodes[1]);<span class="comment">//id2;</span>
<a name="l01669"></a>01669         m_rig-&gt;cabs[m_rig-&gt;free_cab*3+2]=GetNodeIndexOrThrow(cab_itor-&gt;nodes[2]);<span class="comment">//id3;</span>
<a name="l01670"></a>01670 
<a name="l01671"></a>01671         <span class="comment">//if (type==&#39;c&#39;) </span>
<a name="l01672"></a>01672         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(cab_itor-&gt;options, <a class="code" href="struct_rig_def_1_1_cab.html#ab9ca6727614d82936118bd72fda9ed8c">RigDef::Cab::OPTION_c_CONTACT</a>))
<a name="l01673"></a>01673         {
<a name="l01674"></a>01674             m_rig-&gt;collcabs[m_rig-&gt;free_collcab]=m_rig-&gt;free_cab; 
<a name="l01675"></a>01675             m_rig-&gt;collcabstype[m_rig-&gt;free_collcab]=0; 
<a name="l01676"></a>01676             m_rig-&gt;free_collcab++;
<a name="l01677"></a>01677         }
<a name="l01678"></a>01678         <span class="comment">//if (type==&#39;p&#39;) </span>
<a name="l01679"></a>01679         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(cab_itor-&gt;options, <a class="code" href="struct_rig_def_1_1_cab.html#ab2db444140540ee627487748513b8f8b">RigDef::Cab::OPTION_p_10xTOUGHER</a>))
<a name="l01680"></a>01680         {
<a name="l01681"></a>01681             m_rig-&gt;collcabs[m_rig-&gt;free_collcab]=m_rig-&gt;free_cab; 
<a name="l01682"></a>01682             m_rig-&gt;collcabstype[m_rig-&gt;free_collcab]=1; 
<a name="l01683"></a>01683             m_rig-&gt;free_collcab++;
<a name="l01684"></a>01684         }
<a name="l01685"></a>01685         <span class="comment">//if (type==&#39;u&#39;) </span>
<a name="l01686"></a>01686         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(cab_itor-&gt;options, <a class="code" href="struct_rig_def_1_1_cab.html#a527ef97a08f09bd243f0e7bf223ed801">RigDef::Cab::OPTION_u_INVULNERABLE</a>))
<a name="l01687"></a>01687         {
<a name="l01688"></a>01688             m_rig-&gt;collcabs[m_rig-&gt;free_collcab]=m_rig-&gt;free_cab; 
<a name="l01689"></a>01689             m_rig-&gt;collcabstype[m_rig-&gt;free_collcab]=2; 
<a name="l01690"></a>01690             m_rig-&gt;free_collcab++;
<a name="l01691"></a>01691         }
<a name="l01692"></a>01692         <span class="comment">//if (type==&#39;b&#39;)</span>
<a name="l01693"></a>01693         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(cab_itor-&gt;options, <a class="code" href="struct_rig_def_1_1_cab.html#a9e807c56e3fcf501644a590ead107f0c">RigDef::Cab::OPTION_b_BUOYANT</a>))
<a name="l01694"></a>01694         {
<a name="l01695"></a>01695             m_rig-&gt;buoycabs[m_rig-&gt;free_buoycab]=m_rig-&gt;free_cab; 
<a name="l01696"></a>01696             m_rig-&gt;collcabstype[m_rig-&gt;free_collcab]=0; 
<a name="l01697"></a>01697             m_rig-&gt;buoycabtypes[m_rig-&gt;free_buoycab]=<a class="code" href="class_buoyance.html#a344c522c179a49a948a924752d2b6a26a0ef7ed4984478301e8a26efe66bd69ea">Buoyance::BUOY_NORMAL</a>; 
<a name="l01698"></a>01698             m_rig-&gt;free_buoycab++;   
<a name="l01699"></a>01699             <span class="keywordflow">if</span> (m_rig-&gt;buoyance == <span class="keyword">nullptr</span>)
<a name="l01700"></a>01700             {
<a name="l01701"></a>01701                 m_rig-&gt;buoyance=<span class="keyword">new</span> <a class="code" href="class_buoyance.html">Buoyance</a>();
<a name="l01702"></a>01702             }
<a name="l01703"></a>01703         }
<a name="l01704"></a>01704         <span class="comment">//if (type==&#39;r&#39;)</span>
<a name="l01705"></a>01705         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(cab_itor-&gt;options, <a class="code" href="struct_rig_def_1_1_cab.html#af03e129813747b08f2f3a60fa33d044e">RigDef::Cab::OPTION_r_BUOYANT_ONLY_DRAG</a>))
<a name="l01706"></a>01706         {
<a name="l01707"></a>01707             m_rig-&gt;buoycabs[m_rig-&gt;free_buoycab]=m_rig-&gt;free_cab; 
<a name="l01708"></a>01708             m_rig-&gt;collcabstype[m_rig-&gt;free_collcab]=0; 
<a name="l01709"></a>01709             m_rig-&gt;buoycabtypes[m_rig-&gt;free_buoycab]=<a class="code" href="class_buoyance.html#a344c522c179a49a948a924752d2b6a26a6ef8dc6ac0f201dbcf814ba0f131df66">Buoyance::BUOY_DRAGONLY</a>; 
<a name="l01710"></a>01710             m_rig-&gt;free_buoycab++; 
<a name="l01711"></a>01711             <span class="keywordflow">if</span> (m_rig-&gt;buoyance == <span class="keyword">nullptr</span>)
<a name="l01712"></a>01712             {
<a name="l01713"></a>01713                 m_rig-&gt;buoyance=<span class="keyword">new</span> <a class="code" href="class_buoyance.html">Buoyance</a>();
<a name="l01714"></a>01714             }
<a name="l01715"></a>01715         }
<a name="l01716"></a>01716         <span class="comment">//if (type==&#39;s&#39;) </span>
<a name="l01717"></a>01717         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(cab_itor-&gt;options, <a class="code" href="struct_rig_def_1_1_cab.html#a04615f8621ca55b46f9ab9ffe9d7b9cc">RigDef::Cab::OPTION_s_BUOYANT_NO_DRAG</a>))
<a name="l01718"></a>01718         {
<a name="l01719"></a>01719             m_rig-&gt;buoycabs[m_rig-&gt;free_buoycab]=m_rig-&gt;free_cab; 
<a name="l01720"></a>01720             m_rig-&gt;collcabstype[m_rig-&gt;free_collcab]=0; 
<a name="l01721"></a>01721             m_rig-&gt;buoycabtypes[m_rig-&gt;free_buoycab]=<a class="code" href="class_buoyance.html#a344c522c179a49a948a924752d2b6a26a81d4d0f9e91dfa3c8502606d718a74ff">Buoyance::BUOY_DRAGLESS</a>; 
<a name="l01722"></a>01722             m_rig-&gt;free_buoycab++; 
<a name="l01723"></a>01723             <span class="keywordflow">if</span> (m_rig-&gt;buoyance == <span class="keyword">nullptr</span>)
<a name="l01724"></a>01724             {
<a name="l01725"></a>01725                 m_rig-&gt;buoyance=<span class="keyword">new</span> <a class="code" href="class_buoyance.html">Buoyance</a>();
<a name="l01726"></a>01726             }
<a name="l01727"></a>01727         }
<a name="l01728"></a>01728 
<a name="l01729"></a>01729         <span class="keywordtype">int</span> collcabs_type = -1;
<a name="l01730"></a>01730         <span class="keywordflow">if</span> (cab_itor-&gt;GetOption_D_ContactBuoyant())
<a name="l01731"></a>01731         {
<a name="l01732"></a>01732             collcabs_type = 0;
<a name="l01733"></a>01733         }
<a name="l01734"></a>01734         <span class="keywordflow">if</span> (cab_itor-&gt;GetOption_F_10xTougherBuoyant())
<a name="l01735"></a>01735         {
<a name="l01736"></a>01736             collcabs_type = 1;
<a name="l01737"></a>01737         }
<a name="l01738"></a>01738         <span class="keywordflow">if</span> (cab_itor-&gt;GetOption_S_UnpenetrableBuoyant())
<a name="l01739"></a>01739         {
<a name="l01740"></a>01740             collcabs_type = 2;
<a name="l01741"></a>01741         }
<a name="l01742"></a>01742 
<a name="l01743"></a>01743         <span class="comment">//if (type==&#39;D&#39; || type == &#39;F&#39; || type == &#39;S&#39;)</span>
<a name="l01744"></a>01744         <span class="keywordflow">if</span> (collcabs_type != -1)
<a name="l01745"></a>01745         {
<a name="l01746"></a>01746 
<a name="l01747"></a>01747             <span class="keywordflow">if</span> (m_rig-&gt;free_collcab &gt;= <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a>)
<a name="l01748"></a>01748             {
<a name="l01749"></a>01749                 std::stringstream msg;
<a name="l01750"></a>01750                 msg &lt;&lt; <span class="stringliteral">&quot;Collcab limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l01751"></a>01751                 AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l01752"></a>01752                 <span class="keywordflow">return</span>;
<a name="l01753"></a>01753             }
<a name="l01754"></a>01754             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_rig-&gt;free_buoycab &gt;= <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a>)
<a name="l01755"></a>01755             {
<a name="l01756"></a>01756                 std::stringstream msg;
<a name="l01757"></a>01757                 msg &lt;&lt; <span class="stringliteral">&quot;Buoycab limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l01758"></a>01758                 AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l01759"></a>01759                 <span class="keywordflow">return</span>;
<a name="l01760"></a>01760             }
<a name="l01761"></a>01761 
<a name="l01762"></a>01762             m_rig-&gt;collcabs[m_rig-&gt;free_collcab]=m_rig-&gt;free_cab;
<a name="l01763"></a>01763             m_rig-&gt;collcabstype[m_rig-&gt;free_collcab]=collcabs_type;
<a name="l01764"></a>01764             m_rig-&gt;free_collcab++;
<a name="l01765"></a>01765             m_rig-&gt;buoycabs[m_rig-&gt;free_buoycab]=m_rig-&gt;free_cab; 
<a name="l01766"></a>01766             m_rig-&gt;buoycabtypes[m_rig-&gt;free_buoycab]=<a class="code" href="class_buoyance.html#a344c522c179a49a948a924752d2b6a26a0ef7ed4984478301e8a26efe66bd69ea">Buoyance::BUOY_NORMAL</a>; 
<a name="l01767"></a>01767             m_rig-&gt;free_buoycab++; 
<a name="l01768"></a>01768             <span class="keywordflow">if</span> (m_rig-&gt;buoyance == <span class="keyword">nullptr</span>)
<a name="l01769"></a>01769             {
<a name="l01770"></a>01770                 m_rig-&gt;buoyance=<span class="keyword">new</span> <a class="code" href="class_buoyance.html">Buoyance</a>();
<a name="l01771"></a>01771             }
<a name="l01772"></a>01772         }
<a name="l01773"></a>01773         m_rig-&gt;free_cab++;
<a name="l01774"></a>01774     }
<a name="l01775"></a>01775 
<a name="l01776"></a>01776     <span class="comment">/* BACKMESH */</span>
<a name="l01777"></a>01777 
<a name="l01778"></a>01778     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_submesh.html#a83efd6d48d7d0a7e03a647e1b15da694">backmesh</a>)
<a name="l01779"></a>01779     {
<a name="l01780"></a>01780 
<a name="l01781"></a>01781         <span class="comment">//close the current mesh</span>
<a name="l01782"></a>01782         m_rig-&gt;subtexcoords[m_rig-&gt;free_sub]=m_rig-&gt;free_texcoord;
<a name="l01783"></a>01783         m_rig-&gt;subcabs[m_rig-&gt;free_sub]=m_rig-&gt;free_cab;
<a name="l01784"></a>01784 
<a name="l01785"></a>01785         <span class="comment">// Check limit</span>
<a name="l01786"></a>01786         <span class="keywordflow">if</span> (! CheckCabLimit(1))
<a name="l01787"></a>01787         {
<a name="l01788"></a>01788             <span class="keywordflow">return</span>;
<a name="l01789"></a>01789         }
<a name="l01790"></a>01790 
<a name="l01791"></a>01791         <span class="comment">//make it normal</span>
<a name="l01792"></a>01792         m_rig-&gt;subisback[m_rig-&gt;free_sub]=0;
<a name="l01793"></a>01793         m_rig-&gt;free_sub++;
<a name="l01794"></a>01794 
<a name="l01795"></a>01795         <span class="comment">//add an extra front mesh</span>
<a name="l01796"></a>01796         <span class="keywordtype">int</span> i;
<a name="l01797"></a>01797         <span class="keywordtype">int</span> start = (m_rig-&gt;free_sub==1) ? 0 : m_rig-&gt;subtexcoords[m_rig-&gt;free_sub-2];
<a name="l01798"></a>01798         <span class="comment">//texcoords</span>
<a name="l01799"></a>01799         for (i=start; i&lt;m_rig-&gt;subtexcoords[m_rig-&gt;free_sub-1]; i++)
<a name="l01800"></a>01800         {
<a name="l01801"></a>01801             m_rig-&gt;texcoords[m_rig-&gt;free_texcoord] = m_rig-&gt;texcoords[i];;
<a name="l01802"></a>01802             m_rig-&gt;free_texcoord++;
<a name="l01803"></a>01803         }
<a name="l01804"></a>01804         <span class="comment">//cab</span>
<a name="l01805"></a>01805         start =  (m_rig-&gt;free_sub==1) ? 0 : m_rig-&gt;subcabs[m_rig-&gt;free_sub-2];
<a name="l01806"></a>01806 
<a name="l01807"></a>01807         for (i=start; i&lt;m_rig-&gt;subcabs[m_rig-&gt;free_sub-1]; i++)
<a name="l01808"></a>01808         {
<a name="l01809"></a>01809             m_rig-&gt;cabs[m_rig-&gt;free_cab*3]=m_rig-&gt;cabs[i*3];
<a name="l01810"></a>01810             m_rig-&gt;cabs[m_rig-&gt;free_cab*3+1]=m_rig-&gt;cabs[i*3+1];
<a name="l01811"></a>01811             m_rig-&gt;cabs[m_rig-&gt;free_cab*3+2]=m_rig-&gt;cabs[i*3+2];
<a name="l01812"></a>01812             m_rig-&gt;free_cab++;
<a name="l01813"></a>01813         }
<a name="l01814"></a>01814         <span class="comment">//finish it, this is a window</span>
<a name="l01815"></a>01815         m_rig-&gt;subisback[m_rig-&gt;free_sub]=2;
<a name="l01816"></a>01816         <span class="comment">//close the current mesh</span>
<a name="l01817"></a>01817         m_rig-&gt;subtexcoords[m_rig-&gt;free_sub]=m_rig-&gt;free_texcoord;
<a name="l01818"></a>01818         m_rig-&gt;subcabs[m_rig-&gt;free_sub]=m_rig-&gt;free_cab;
<a name="l01819"></a>01819         <span class="comment">//make is transparent</span>
<a name="l01820"></a>01820         m_rig-&gt;free_sub++;
<a name="l01821"></a>01821 
<a name="l01822"></a>01822 
<a name="l01823"></a>01823         <span class="comment">//add an extra back mesh</span>
<a name="l01824"></a>01824         <span class="comment">//texcoords</span>
<a name="l01825"></a>01825         start = (m_rig-&gt;free_sub==1) ? 0 : m_rig-&gt;subtexcoords[m_rig-&gt;free_sub-2];
<a name="l01826"></a>01826         for (i=start; i&lt;m_rig-&gt;subtexcoords[m_rig-&gt;free_sub-1]; i++)
<a name="l01827"></a>01827         {
<a name="l01828"></a>01828             m_rig-&gt;texcoords[m_rig-&gt;free_texcoord]=m_rig-&gt;texcoords[i];;
<a name="l01829"></a>01829             m_rig-&gt;free_texcoord++;
<a name="l01830"></a>01830         }
<a name="l01831"></a>01831 
<a name="l01832"></a>01832         <span class="comment">//cab</span>
<a name="l01833"></a>01833         start = (m_rig-&gt;free_sub==1) ? 0 : m_rig-&gt;subcabs[m_rig-&gt;free_sub-2];
<a name="l01834"></a>01834         for (i=start; i&lt;m_rig-&gt;subcabs[m_rig-&gt;free_sub-1]; i++)
<a name="l01835"></a>01835         {
<a name="l01836"></a>01836             m_rig-&gt;cabs[m_rig-&gt;free_cab*3]=m_rig-&gt;cabs[i*3+1];
<a name="l01837"></a>01837             m_rig-&gt;cabs[m_rig-&gt;free_cab*3+1]=m_rig-&gt;cabs[i*3];
<a name="l01838"></a>01838             m_rig-&gt;cabs[m_rig-&gt;free_cab*3+2]=m_rig-&gt;cabs[i*3+2];
<a name="l01839"></a>01839             m_rig-&gt;free_cab++;
<a name="l01840"></a>01840         }
<a name="l01841"></a>01841     
<a name="l01842"></a>01842         m_rig-&gt;subisback[m_rig-&gt;free_sub]=1;
<a name="l01843"></a>01843     }
<a name="l01844"></a>01844 }
<a name="l01845"></a>01845 
<a name="l01846"></a><a class="code" href="class_rig_spawner.html#a09a6eeeebc7acba0947490ad9b0cd635">01846</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a09a6eeeebc7acba0947490ad9b0cd635">RigSpawner::ProcessFlexbody</a>(boost::shared_ptr&lt;RigDef::Flexbody&gt; def)
<a name="l01847"></a>01847 {
<a name="l01848"></a>01848     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01849"></a>01849 
<a name="l01850"></a>01850     <span class="keywordflow">if</span> (! CheckFlexbodyLimit(1))
<a name="l01851"></a>01851     {
<a name="l01852"></a>01852         <span class="keywordflow">return</span>;
<a name="l01853"></a>01853     }
<a name="l01854"></a>01854 
<a name="l01855"></a>01855     <span class="keywordtype">char</span> unique_name[200];
<a name="l01856"></a>01856     sprintf(unique_name, <span class="stringliteral">&quot;Flexbody-%s-%d&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_flexbody);
<a name="l01857"></a>01857 
<a name="l01858"></a>01858     Ogre::Quaternion rot=Ogre::Quaternion(Ogre::Degree(def-&gt;rotation.z), Ogre::Vector3::UNIT_Z);
<a name="l01859"></a>01859     rot=rot*Ogre::Quaternion(Ogre::Degree(def-&gt;rotation.y), Ogre::Vector3::UNIT_Y);
<a name="l01860"></a>01860     rot=rot*Ogre::Quaternion(Ogre::Degree(def-&gt;rotation.x), Ogre::Vector3::UNIT_X);
<a name="l01861"></a>01861 
<a name="l01862"></a>01862     <span class="comment">/* Collect nodes */</span>
<a name="l01863"></a>01863     std::vector&lt;unsigned int&gt; node_indices;
<a name="l01864"></a>01864     node_indices.reserve(def-&gt;node_list.size());
<a name="l01865"></a>01865     <span class="keywordtype">bool</span> nodes_found = <span class="keyword">true</span>;
<a name="l01866"></a>01866     <span class="keyword">auto</span> node_itor = def-&gt;node_list.begin();
<a name="l01867"></a>01867     <span class="keyword">auto</span> node_end  = def-&gt;node_list.end();
<a name="l01868"></a>01868     <span class="keywordflow">for</span> (; node_itor != node_end; ++node_itor)
<a name="l01869"></a>01869     {
<a name="l01870"></a>01870         <span class="keyword">auto</span> result = this-&gt;GetNodeIndex(*node_itor);
<a name="l01871"></a>01871         <span class="keywordflow">if</span> (!result.second)
<a name="l01872"></a>01872         {
<a name="l01873"></a>01873             nodes_found = <span class="keyword">false</span>;
<a name="l01874"></a>01874             <span class="keywordflow">break</span>;
<a name="l01875"></a>01875         }
<a name="l01876"></a>01876         node_indices.push_back(result.first);
<a name="l01877"></a>01877     }
<a name="l01878"></a>01878 
<a name="l01879"></a>01879     <span class="keywordflow">if</span> (! nodes_found)
<a name="l01880"></a>01880     {
<a name="l01881"></a>01881         std::stringstream msg;
<a name="l01882"></a>01882         msg &lt;&lt; <span class="stringliteral">&quot;Failed to collect nodes from node-ranges, skipping flexbody &#39;&quot;</span> &lt;&lt; def-&gt;mesh_name &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l01883"></a>01883         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l01884"></a>01884         <span class="keywordflow">return</span>;
<a name="l01885"></a>01885     }
<a name="l01886"></a>01886 
<a name="l01887"></a>01887     <span class="keywordtype">int</span> reference_node = FindNodeIndex(def-&gt;reference_node);
<a name="l01888"></a>01888     <span class="keywordtype">int</span> x_axis_node = FindNodeIndex(def-&gt;x_axis_node);
<a name="l01889"></a>01889     <span class="keywordtype">int</span> y_axis_node = FindNodeIndex(def-&gt;y_axis_node);
<a name="l01890"></a>01890     <span class="keywordflow">if</span> (reference_node == -1 || x_axis_node == -1 || y_axis_node == -1)
<a name="l01891"></a>01891     {
<a name="l01892"></a>01892         AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to find required nodes, skipping flexbody &#39;&quot;</span> + def-&gt;mesh_name + <span class="stringliteral">&quot;&#39;&quot;</span>);
<a name="l01893"></a>01893     }
<a name="l01894"></a>01894 
<a name="l01895"></a>01895     <span class="keyword">auto</span> * flexbody = m_flex_factory.CreateFlexBody(
<a name="l01896"></a>01896         m_rig-&gt;free_node, 
<a name="l01897"></a>01897         def-&gt;mesh_name.c_str(),
<a name="l01898"></a>01898         unique_name,
<a name="l01899"></a>01899         reference_node,
<a name="l01900"></a>01900         x_axis_node,
<a name="l01901"></a>01901         y_axis_node,
<a name="l01902"></a>01902         def-&gt;offset, 
<a name="l01903"></a>01903         rot,
<a name="l01904"></a>01904         node_indices
<a name="l01905"></a>01905         );
<a name="l01906"></a>01906     <span class="keywordtype">int</span> camera_mode = (def-&gt;camera_settings.mode == <a class="code" href="struct_rig_def_1_1_camera_settings.html#ae863ff86c38d3a617fcb5fd119e9ddd1ae078e87947501801495854dfe1a88d7f">RigDef::CameraSettings::MODE_CINECAM</a>) 
<a name="l01907"></a>01907         ? (<span class="keywordtype">int</span>)def-&gt;camera_settings.cinecam_index 
<a name="l01908"></a>01908         : (int)def-&gt;camera_settings.mode;
<a name="l01909"></a>01909     flexbody-&gt;setCameraMode(camera_mode);
<a name="l01910"></a>01910 
<a name="l01911"></a>01911     m_rig-&gt;flexbodies[m_rig-&gt;free_flexbody] = flexbody;
<a name="l01912"></a>01912     m_rig-&gt;free_flexbody++;
<a name="l01913"></a>01913 }
<a name="l01914"></a>01914 
<a name="l01915"></a><a class="code" href="class_rig_spawner.html#a3111af9b13e45b26f7942a7707e6a57e">01915</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a3111af9b13e45b26f7942a7707e6a57e">RigSpawner::ProcessProp</a>(<a class="code" href="struct_rig_def_1_1_prop.html">RigDef::Prop</a> &amp; def)
<a name="l01916"></a>01916 {
<a name="l01917"></a>01917     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l01918"></a>01918 
<a name="l01919"></a>01919     <span class="keywordflow">if</span> (! CheckPropLimit(1))
<a name="l01920"></a>01920     {
<a name="l01921"></a>01921         <span class="keywordflow">return</span>;
<a name="l01922"></a>01922     }
<a name="l01923"></a>01923 
<a name="l01924"></a>01924     <a class="code" href="structprop__t.html">prop_t</a> &amp; prop = m_rig-&gt;props[m_rig-&gt;free_prop];
<a name="l01925"></a>01925     m_rig-&gt;free_prop++;
<a name="l01926"></a>01926     memset(&amp;prop, 0, <span class="keyword">sizeof</span>(<a class="code" href="structprop__t.html">prop_t</a>)); <span class="comment">/* Initialize prop memory to avoid invalid pointers. */</span>
<a name="l01927"></a>01927 
<a name="l01928"></a>01928     prop.<a class="code" href="structprop__t.html#a23fe12866c6bea2ed971e456bccfe501">noderef</a>         = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_prop.html#a061b2a0c2196509a6232bcb112573ffa">reference_node</a>);
<a name="l01929"></a>01929     prop.<a class="code" href="structprop__t.html#a2db413fa8ce7a71f0cac011c035f4c33">nodex</a>           = FindNodeIndex(def.<a class="code" href="struct_rig_def_1_1_prop.html#a1027c5b9c7a54bd98a776f2c0a310540">x_axis_node</a>);
<a name="l01930"></a>01930     prop.<a class="code" href="structprop__t.html#ad5fd60d7f37628fb8f2cd61e77bc213c">nodey</a>           = FindNodeIndex(def.<a class="code" href="struct_rig_def_1_1_prop.html#aa8d678a71a4e0c2e05c2c30bbc1d2cfb">y_axis_node</a>);
<a name="l01931"></a>01931     <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a2db413fa8ce7a71f0cac011c035f4c33">nodex</a> == -1 || prop.<a class="code" href="structprop__t.html#ad5fd60d7f37628fb8f2cd61e77bc213c">nodey</a> == -1)
<a name="l01932"></a>01932     {
<a name="l01933"></a>01933         <span class="keywordflow">return</span>;
<a name="l01934"></a>01934     }
<a name="l01935"></a>01935     prop.<a class="code" href="structprop__t.html#a1bf7f6db554e501648fe1fe0544f67fb">offsetx</a>         = def.<a class="code" href="struct_rig_def_1_1_prop.html#a36e797f7df54b7a2657a978eb7da45a9">offset</a>.x;
<a name="l01936"></a>01936     prop.<a class="code" href="structprop__t.html#aecceca2d076d8807015c554ccae1ef48">offsety</a>         = def.<a class="code" href="struct_rig_def_1_1_prop.html#a36e797f7df54b7a2657a978eb7da45a9">offset</a>.y;
<a name="l01937"></a>01937     prop.<a class="code" href="structprop__t.html#a5cac941815e1c455ad9cf439e76bf24b">offsetz</a>         = def.<a class="code" href="struct_rig_def_1_1_prop.html#a36e797f7df54b7a2657a978eb7da45a9">offset</a>.z;
<a name="l01938"></a>01938     prop.<a class="code" href="structprop__t.html#a5aa5480123cdadf458dd9be598e8fe0f">orgoffsetX</a>      = def.<a class="code" href="struct_rig_def_1_1_prop.html#a36e797f7df54b7a2657a978eb7da45a9">offset</a>.x;
<a name="l01939"></a>01939     prop.<a class="code" href="structprop__t.html#a605263a2e6862e8f06fbe44f4a2ba8a4">orgoffsetY</a>      = def.<a class="code" href="struct_rig_def_1_1_prop.html#a36e797f7df54b7a2657a978eb7da45a9">offset</a>.y;
<a name="l01940"></a>01940     prop.<a class="code" href="structprop__t.html#a23bcbc597887a0350fd46a7347238632">orgoffsetZ</a>      = def.<a class="code" href="struct_rig_def_1_1_prop.html#a36e797f7df54b7a2657a978eb7da45a9">offset</a>.z;
<a name="l01941"></a>01941     prop.<a class="code" href="structprop__t.html#a04439f4fa670b1a1c962333cf4d9ce04">rotaX</a>           = def.<a class="code" href="struct_rig_def_1_1_prop.html#af2a8c18b7068f61691e926c6496ec546">rotation</a>.x;
<a name="l01942"></a>01942     prop.<a class="code" href="structprop__t.html#a783472d5555ac0f21befa203602ee7f7">rotaY</a>           = def.<a class="code" href="struct_rig_def_1_1_prop.html#af2a8c18b7068f61691e926c6496ec546">rotation</a>.y;
<a name="l01943"></a>01943     prop.<a class="code" href="structprop__t.html#a13f24353c85e0b9ef59a187199071bea">rotaZ</a>           = def.<a class="code" href="struct_rig_def_1_1_prop.html#af2a8c18b7068f61691e926c6496ec546">rotation</a>.z;
<a name="l01944"></a>01944     prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a>             = Ogre::Quaternion(Ogre::Degree(def.<a class="code" href="struct_rig_def_1_1_prop.html#af2a8c18b7068f61691e926c6496ec546">rotation</a>.z), Ogre::Vector3::UNIT_Z);
<a name="l01945"></a>01945     prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a>             = prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a> * Ogre::Quaternion(Ogre::Degree(def.<a class="code" href="struct_rig_def_1_1_prop.html#af2a8c18b7068f61691e926c6496ec546">rotation</a>.y), Ogre::Vector3::UNIT_Y);
<a name="l01946"></a>01946     prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a>             = prop.<a class="code" href="structprop__t.html#a186e9a3b022dcb017257843862959127">rot</a> * Ogre::Quaternion(Ogre::Degree(def.<a class="code" href="struct_rig_def_1_1_prop.html#af2a8c18b7068f61691e926c6496ec546">rotation</a>.x), Ogre::Vector3::UNIT_X);
<a name="l01947"></a>01947     prop.<a class="code" href="structprop__t.html#a4e4073fcd5ed3edbcb8d4e74c922e0d3" title="Visibility control {-2 = always, -1 = 3rdPerson only, 0+ = cinecam index}.">cameramode</a>      = def.<a class="code" href="struct_rig_def_1_1_prop.html#a24212fb76f6dcd09560cacc9a44ea0a6">camera_settings</a>.<a class="code" href="struct_rig_def_1_1_camera_settings.html#a1edd2dcb5809cd604eb3d2bfbbaf5743">mode</a>; <span class="comment">/* Handles default value */</span>
<a name="l01948"></a>01948     prop.<a class="code" href="structprop__t.html#a1bef2bb0b1e842eb0bf36de9cc9b6ff9">wheelrotdegree</a>  = 160.f;
<a name="l01949"></a>01949     <span class="comment">/* Set no animation by default */</span>
<a name="l01950"></a>01950     prop.<a class="code" href="structprop__t.html#a1a0b6337bb4fa0f661af6b5b03a450d6">animKey</a>[0]      = -1;
<a name="l01951"></a>01951     prop.<a class="code" href="structprop__t.html#a3131f0e2fb0e10a6b88223e61233bacf">animKeyState</a>[0] = -1.f;
<a name="l01952"></a>01952 
<a name="l01953"></a>01953     <span class="comment">/* SPECIAL PROPS */</span>
<a name="l01954"></a>01954 
<a name="l01955"></a>01955     <span class="comment">/* Rear view mirror (left) */</span>
<a name="l01956"></a>01956     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53a95a0ff5476b4c4e1a694d0e38d2f3f93">RigDef::Prop::SPECIAL_LEFT_REAR_VIEW_MIRROR</a>)
<a name="l01957"></a>01957     {
<a name="l01958"></a>01958         prop.<a class="code" href="structprop__t.html#a4ff55543f060c57d7e32a162afb99853">mirror</a> = 1;
<a name="l01959"></a>01959     }
<a name="l01960"></a>01960 
<a name="l01961"></a>01961     <span class="comment">/* Rear view mirror (right) */</span>
<a name="l01962"></a>01962     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53ae21e93c165e760fe842ef68627636222">RigDef::Prop::SPECIAL_RIGHT_REAR_VIEW_MIRROR</a>)
<a name="l01963"></a>01963     {
<a name="l01964"></a>01964         prop.<a class="code" href="structprop__t.html#a4ff55543f060c57d7e32a162afb99853">mirror</a> = -1;
<a name="l01965"></a>01965     }
<a name="l01966"></a>01966 
<a name="l01967"></a>01967     <span class="comment">/* Custom steering wheel */</span>
<a name="l01968"></a>01968     Ogre::Vector3 steering_wheel_offset = Ogre::Vector3::ZERO;
<a name="l01969"></a>01969     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53aa04994333c39f785c08ee3ddfd2ab24e">RigDef::Prop::SPECIAL_STEERING_WHEEL_LEFT_HANDED</a>)
<a name="l01970"></a>01970     {
<a name="l01971"></a>01971         steering_wheel_offset = Ogre::Vector3(-0.67, -0.61,0.24);
<a name="l01972"></a>01972     }
<a name="l01973"></a>01973     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53a3a181df4c6d7a8596d3e045608734ee6">RigDef::Prop::SPECIAL_STEERING_WHEEL_RIGHT_HANDED</a>)
<a name="l01974"></a>01974     {
<a name="l01975"></a>01975         steering_wheel_offset = Ogre::Vector3(0.67, -0.61,0.24);
<a name="l01976"></a>01976     }
<a name="l01977"></a>01977     <span class="keywordflow">if</span> (steering_wheel_offset != Ogre::Vector3::ZERO)
<a name="l01978"></a>01978     {
<a name="l01979"></a>01979         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_prop.html#ab78677043d84eb34e7bb69ca60126fcd">special_prop_steering_wheel</a>.<a class="code" href="struct_rig_def_1_1_prop_1_1_steering_wheel_special.html#af3a382cad32f86f5fa146faa47f81b73">_offset_is_set</a>)
<a name="l01980"></a>01980         {
<a name="l01981"></a>01981             steering_wheel_offset = def.<a class="code" href="struct_rig_def_1_1_prop.html#ab78677043d84eb34e7bb69ca60126fcd">special_prop_steering_wheel</a>.<a class="code" href="struct_rig_def_1_1_prop_1_1_steering_wheel_special.html#a08d4ff12869ba075e81417b2cd5ac97e">offset</a>;
<a name="l01982"></a>01982         }
<a name="l01983"></a>01983         prop.<a class="code" href="structprop__t.html#a1bef2bb0b1e842eb0bf36de9cc9b6ff9">wheelrotdegree</a> = def.<a class="code" href="struct_rig_def_1_1_prop.html#ab78677043d84eb34e7bb69ca60126fcd">special_prop_steering_wheel</a>.<a class="code" href="struct_rig_def_1_1_prop_1_1_steering_wheel_special.html#a10c3362a328083c73eb118b936dd5cb4">rotation_angle</a>;
<a name="l01984"></a>01984         prop.<a class="code" href="structprop__t.html#a8d4342b22134513dd7197b7456e8e46b" title="Special prop: custom steering wheel for dashboard.">wheel</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l01985"></a>01985         prop.<a class="code" href="structprop__t.html#a15b2a6fb89ddd70e695bab6a240f545f" title="Special prop: custom steering wheel for dashboard.">wheelpos</a> = steering_wheel_offset;
<a name="l01986"></a>01986         <a class="code" href="class_mesh_object.html">MeshObject</a> *mesh_object = <span class="keyword">new</span> <a class="code" href="class_mesh_object.html">MeshObject</a>(
<a name="l01987"></a>01987             def.<a class="code" href="struct_rig_def_1_1_prop.html#ab78677043d84eb34e7bb69ca60126fcd">special_prop_steering_wheel</a>.<a class="code" href="struct_rig_def_1_1_prop_1_1_steering_wheel_special.html#a54fa9dadca48121b36ad3959fe4f2183">mesh_name</a>,
<a name="l01988"></a>01988             <span class="stringliteral">&quot;&quot;</span>,
<a name="l01989"></a>01989             prop.<a class="code" href="structprop__t.html#a8d4342b22134513dd7197b7456e8e46b" title="Special prop: custom steering wheel for dashboard.">wheel</a>,
<a name="l01990"></a>01990             m_rig-&gt;usedSkin,
<a name="l01991"></a>01991             m_enable_background_loading
<a name="l01992"></a>01992             );
<a name="l01993"></a>01993         mesh_object-&gt;<a class="code" href="class_mesh_object.html#a0130316d08afecdfeccb99b7e166b9ae">setSimpleMaterialColour</a>(Ogre::ColourValue(0, 0.5, 0.5));
<a name="l01994"></a>01994         mesh_object-&gt;<a class="code" href="class_mesh_object.html#a38277070647888cc39b4d03911e44995">setMaterialFunctionMapper</a>(m_rig-&gt;materialFunctionMapper, m_rig-&gt;materialReplacer);
<a name="l01995"></a>01995     }
<a name="l01996"></a>01996 
<a name="l01997"></a>01997     <span class="comment">/* CREATE THE PROP */</span>
<a name="l01998"></a>01998 
<a name="l01999"></a>01999     prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l02000"></a>02000     prop.<a class="code" href="structprop__t.html#af0918f0903c3f528c0548f2936457822">mo</a> = <span class="keyword">new</span> <a class="code" href="class_mesh_object.html">MeshObject</a>(def.<a class="code" href="struct_rig_def_1_1_prop.html#a5705650fcc106405afbb2d5b25839fa0">mesh_name</a>, <span class="stringliteral">&quot;&quot;</span>, prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>, m_rig-&gt;usedSkin, m_enable_background_loading);
<a name="l02001"></a>02001     prop.<a class="code" href="structprop__t.html#af0918f0903c3f528c0548f2936457822">mo</a>-&gt;<a class="code" href="class_mesh_object.html#a0130316d08afecdfeccb99b7e166b9ae">setSimpleMaterialColour</a>(Ogre::ColourValue(1, 1, 0));
<a name="l02002"></a>02002     prop.<a class="code" href="structprop__t.html#af0918f0903c3f528c0548f2936457822">mo</a>-&gt;<a class="code" href="class_mesh_object.html#a38277070647888cc39b4d03911e44995">setMaterialFunctionMapper</a>(m_rig-&gt;materialFunctionMapper, m_rig-&gt;materialReplacer);
<a name="l02003"></a>02003     prop.<a class="code" href="structprop__t.html#af0918f0903c3f528c0548f2936457822">mo</a>-&gt;<a class="code" href="class_mesh_object.html#a263f9814d946dc49c8f5d4003e945f24">setCastShadows</a>(<span class="keyword">true</span>); <span class="comment">// Orig code {{ prop.mo-&gt;setCastShadows(shadowmode != 0); }}, shadowmode has default value 1 and changes with undocumented directive &#39;set_shadows&#39;</span>
<a name="l02004"></a>02004     prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a> = <span class="charliteral">&#39;n&#39;</span>; <span class="comment">// Orig: hardcoded in BTS_PROPS</span>
<a name="l02005"></a>02005 
<a name="l02006"></a>02006     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53a27473d37b4dcf9d8453aeff458ec64a8">RigDef::Prop::SPECIAL_SPINPROP</a>)
<a name="l02007"></a>02007     {
<a name="l02008"></a>02008         prop.<a class="code" href="structprop__t.html#a2df2ebb1b18ff6dda8eacfd1330b1524" title="Is this a spinprop? (Boolean {0/1})">spinner</a> = 1;
<a name="l02009"></a>02009         prop.<a class="code" href="structprop__t.html#af0918f0903c3f528c0548f2936457822">mo</a>-&gt;<a class="code" href="class_mesh_object.html#a263f9814d946dc49c8f5d4003e945f24">setCastShadows</a>(<span class="keyword">false</span>);
<a name="l02010"></a>02010         prop.<a class="code" href="structprop__t.html#a032a735548652a5b56abe134704911bf" title="The pivot scene node (parented to root-node).">snode</a>-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02011"></a>02011     }
<a name="l02012"></a>02012     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53ad19121a47ff5439a69dd7ab21006be85">RigDef::Prop::SPECIAL_PALE</a>)
<a name="l02013"></a>02013     {
<a name="l02014"></a>02014         prop.<a class="code" href="structprop__t.html#a3b3e8e97174239ac445b08b12aa264b8" title="Is this a pale? (Boolean {0/1})">pale</a> = 1;
<a name="l02015"></a>02015     }
<a name="l02016"></a>02016     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53af0192a760e85972211eb0c88b7cf604f">RigDef::Prop::SPECIAL_DRIVER_SEAT</a>)
<a name="l02017"></a>02017     {
<a name="l02018"></a>02018         m_rig-&gt;driversseatfound = <span class="keyword">true</span>;
<a name="l02019"></a>02019         m_rig-&gt;driverSeat = &amp; prop;
<a name="l02020"></a>02020         prop.<a class="code" href="structprop__t.html#af0918f0903c3f528c0548f2936457822">mo</a>-&gt;<a class="code" href="class_mesh_object.html#aa1f80776138c7c5e2d2570c3e8646c16">setMaterialName</a>(<span class="stringliteral">&quot;driversseat&quot;</span>);
<a name="l02021"></a>02021     }
<a name="l02022"></a>02022     <span class="keywordflow">else</span> <span class="keywordflow">if</span>(def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53a27473d37b4dcf9d8453aeff458ec64a8">RigDef::Prop::SPECIAL_SPINPROP</a>)
<a name="l02023"></a>02023     {
<a name="l02024"></a>02024         m_rig-&gt;driversseatfound = <span class="keyword">true</span>;
<a name="l02025"></a>02025         m_rig-&gt;driverSeat = &amp; prop;
<a name="l02026"></a>02026     }
<a name="l02027"></a>02027     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (m_rig-&gt;flaresMode &gt; 0)
<a name="l02028"></a>02028     {
<a name="l02029"></a>02029         <span class="keywordflow">if</span>(def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53a15f256191e43f4fba34c68c991cba000">RigDef::Prop::SPECIAL_BEACON</a>)
<a name="l02030"></a>02030         {
<a name="l02031"></a>02031             prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a> = <span class="charliteral">&#39;b&#39;</span>;
<a name="l02032"></a>02032             prop.<a class="code" href="structprop__t.html#a3dccf8b3a2fdb5d21ffc344a5b7c60ef">bpos</a>[0] = 2.0 * 3.14 * (std::rand() / RAND_MAX);
<a name="l02033"></a>02033             prop.<a class="code" href="structprop__t.html#a7c0346ae551a6b1ea8556bd61ad5d86c">brate</a>[0] = 4.0 * 3.14 + (std::rand() / RAND_MAX) - 0.5;
<a name="l02034"></a>02034             <span class="comment">/* the light */</span>
<a name="l02035"></a>02035             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight();
<a name="l02036"></a>02036             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setType(Ogre::Light::LT_SPOTLIGHT);
<a name="l02037"></a>02037             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setDiffuseColour(def.<a class="code" href="struct_rig_def_1_1_prop.html#a97356eecd5c27e41f5b92e524a84adc4">special_prop_beacon</a>.<a class="code" href="struct_rig_def_1_1_prop_1_1_beacon_special.html#aa31bca04e9640d69b1eb0c0afe9fc9d2">color</a>);
<a name="l02038"></a>02038             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setSpecularColour(def.<a class="code" href="struct_rig_def_1_1_prop.html#a97356eecd5c27e41f5b92e524a84adc4">special_prop_beacon</a>.<a class="code" href="struct_rig_def_1_1_prop_1_1_beacon_special.html#aa31bca04e9640d69b1eb0c0afe9fc9d2">color</a>);
<a name="l02039"></a>02039             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setAttenuation(50.0, 1.0, 0.3, 0.0);
<a name="l02040"></a>02040             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setSpotlightRange( Ogre::Degree(35), Ogre::Degree(45) );
<a name="l02041"></a>02041             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l02042"></a>02042             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02043"></a>02043             <span class="comment">/* the flare billboard */</span>
<a name="l02044"></a>02044             prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l02045"></a>02045             prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(1); <span class="comment">//(propname,1);</span>
<a name="l02046"></a>02046             prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;createBillboard(0,0,0);
<a name="l02047"></a>02047             <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0])
<a name="l02048"></a>02048             {
<a name="l02049"></a>02049                 prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setMaterialName(def.<a class="code" href="struct_rig_def_1_1_prop.html#a97356eecd5c27e41f5b92e524a84adc4">special_prop_beacon</a>.<a class="code" href="struct_rig_def_1_1_prop_1_1_beacon_special.html#a990d4c1ac0a5100bac56c814b59dfaa7">flare_material_name</a>);
<a name="l02050"></a>02050                 prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l02051"></a>02051             }
<a name="l02052"></a>02052             prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02053"></a>02053             prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02054"></a>02054         }
<a name="l02055"></a>02055         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53abb4f8806e1293ff39adc71885d61f937">RigDef::Prop::SPECIAL_REDBEACON</a>)
<a name="l02056"></a>02056         {
<a name="l02057"></a>02057             prop.<a class="code" href="structprop__t.html#a7c0346ae551a6b1ea8556bd61ad5d86c">brate</a>[0] = 1.0;
<a name="l02058"></a>02058             prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a> = <span class="charliteral">&#39;r&#39;</span>;
<a name="l02059"></a>02059             <span class="comment">//the light</span>
<a name="l02060"></a>02060             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight();<span class="comment">//propname);</span>
<a name="l02061"></a>02061             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setType(Ogre::Light::LT_POINT);
<a name="l02062"></a>02062             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setDiffuseColour( Ogre::ColourValue(1.0, 0.0, 0.0));
<a name="l02063"></a>02063             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setSpecularColour( Ogre::ColourValue(1.0, 0.0, 0.0));
<a name="l02064"></a>02064             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setAttenuation(50.0, 1.0, 0.3, 0.0);
<a name="l02065"></a>02065             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l02066"></a>02066             prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02067"></a>02067             <span class="comment">//the flare billboard</span>
<a name="l02068"></a>02068             prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l02069"></a>02069             prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(1); <span class="comment">//propname,1);</span>
<a name="l02070"></a>02070             prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;createBillboard(0,0,0);
<a name="l02071"></a>02071             <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0])
<a name="l02072"></a>02072             {
<a name="l02073"></a>02073                 prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/redbeaconflare&quot;</span>);
<a name="l02074"></a>02074                 prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l02075"></a>02075             }
<a name="l02076"></a>02076             <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0])
<a name="l02077"></a>02077             {
<a name="l02078"></a>02078                 prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;attachObject(prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]);
<a name="l02079"></a>02079             }
<a name="l02080"></a>02080             prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[0]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02081"></a>02081             prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[0]-&gt;setDefaultDimensions(1.0, 1.0);
<a name="l02082"></a>02082         }
<a name="l02083"></a>02083         <span class="keywordflow">else</span> <span class="keywordflow">if</span>(def.<a class="code" href="struct_rig_def_1_1_prop.html#aec230d8aa9e9dbdd22c6b667ea6f88cd">special</a> == <a class="code" href="struct_rig_def_1_1_prop.html#a527c190718a4a96b07b7935fea5eff53ab9f7e257ee3ec4de6a864ff4928517d5">RigDef::Prop::SPECIAL_LIGHTBAR</a>)
<a name="l02084"></a>02084         {
<a name="l02085"></a>02085             <span class="keywordtype">int</span> k;
<a name="l02086"></a>02086             m_rig-&gt;ispolice = <span class="keyword">true</span>;
<a name="l02087"></a>02087             prop.<a class="code" href="structprop__t.html#ab423c7fa184f8bb4fda894b715e80aab">beacontype</a>=<span class="charliteral">&#39;p&#39;</span>;
<a name="l02088"></a>02088             <span class="keywordflow">for</span> (k=0; k&lt;4; k++)
<a name="l02089"></a>02089             {
<a name="l02090"></a>02090                 prop.<a class="code" href="structprop__t.html#a3dccf8b3a2fdb5d21ffc344a5b7c60ef">bpos</a>[k]=2.0*3.14*(std::rand()/RAND_MAX);
<a name="l02091"></a>02091                 prop.<a class="code" href="structprop__t.html#a7c0346ae551a6b1ea8556bd61ad5d86c">brate</a>[k]=4.0*3.14+(std::rand()/RAND_MAX)-0.5;
<a name="l02092"></a>02092                 prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k]=0;
<a name="l02093"></a>02093                 <span class="comment">//the light</span>
<a name="l02094"></a>02094                 <span class="comment">//char rpname[256];</span>
<a name="l02095"></a>02095                 <span class="comment">//sprintf(rpname,&quot;%s-%i&quot;, propname, k);</span>
<a name="l02096"></a>02096                 prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(); <span class="comment">//rpname);</span>
<a name="l02097"></a>02097                 prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setType(Ogre::Light::LT_SPOTLIGHT);
<a name="l02098"></a>02098                 <span class="keywordflow">if</span> (k&gt;1)
<a name="l02099"></a>02099                 {
<a name="l02100"></a>02100                     prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setDiffuseColour( Ogre::ColourValue(1.0, 0.0, 0.0));
<a name="l02101"></a>02101                     prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setSpecularColour( Ogre::ColourValue(1.0, 0.0, 0.0));
<a name="l02102"></a>02102                 }
<a name="l02103"></a>02103                 <span class="keywordflow">else</span>
<a name="l02104"></a>02104                 {
<a name="l02105"></a>02105                     prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setDiffuseColour( Ogre::ColourValue(0.0, 0.5, 1.0));
<a name="l02106"></a>02106                     prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setSpecularColour( Ogre::ColourValue(0.0, 0.5, 1.0));
<a name="l02107"></a>02107                 }
<a name="l02108"></a>02108                 prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setAttenuation(50.0, 1.0, 0.3, 0.0);
<a name="l02109"></a>02109                 prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setSpotlightRange( Ogre::Degree(35), Ogre::Degree(45) );
<a name="l02110"></a>02110                 prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l02111"></a>02111                 prop.<a class="code" href="structprop__t.html#afa0bf355fb28a72cef0cea9dc3faaa6a">light</a>[k]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02112"></a>02112                 <span class="comment">//the flare billboard</span>
<a name="l02113"></a>02113                 prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[k] = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l02114"></a>02114                 prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k]=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(1); <span class="comment">//rpname,1);</span>
<a name="l02115"></a>02115                 prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k]-&gt;createBillboard(0,0,0);
<a name="l02116"></a>02116                 <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k])
<a name="l02117"></a>02117                 {
<a name="l02118"></a>02118                     <span class="keywordflow">if</span> (k&gt;1)
<a name="l02119"></a>02119                     {
<a name="l02120"></a>02120                         prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k]-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/brightredflare&quot;</span>);
<a name="l02121"></a>02121                     }
<a name="l02122"></a>02122                     <span class="keywordflow">else</span>
<a name="l02123"></a>02123                     {
<a name="l02124"></a>02124                         prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k]-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/brightblueflare&quot;</span>);
<a name="l02125"></a>02125                     }
<a name="l02126"></a>02126 
<a name="l02127"></a>02127                     <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k])
<a name="l02128"></a>02128                     {
<a name="l02129"></a>02129                         prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k]-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l02130"></a>02130                         prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[k]-&gt;attachObject(prop.<a class="code" href="structprop__t.html#a97df1f93f3ec4ff25de502fb0a4804bf">bbs</a>[k]);
<a name="l02131"></a>02131                     }
<a name="l02132"></a>02132                 }
<a name="l02133"></a>02133                 prop.<a class="code" href="structprop__t.html#a1252c88374711893966a9809812590bc">bbsnode</a>[k]-&gt;setVisible(<span class="keyword">false</span>);
<a name="l02134"></a>02134             }
<a name="l02135"></a>02135         }
<a name="l02136"></a>02136     }   
<a name="l02137"></a>02137 
<a name="l02138"></a>02138     <span class="comment">/* PROCESS ANIMATIONS */</span>
<a name="l02139"></a>02139 
<a name="l02140"></a>02140     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_prop.html#ae36a89311276557f32c956c0a04ad780">animations</a>.size() &gt; 10)
<a name="l02141"></a>02141     {
<a name="l02142"></a>02142         std::stringstream msg;
<a name="l02143"></a>02143         msg &lt;&lt; <span class="stringliteral">&quot;Prop (mesh: &quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_prop.html#a5705650fcc106405afbb2d5b25839fa0">mesh_name</a> &lt;&lt; <span class="stringliteral">&quot;) has too many animations: &quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_prop.html#ae36a89311276557f32c956c0a04ad780">animations</a>.size() &lt;&lt; <span class="stringliteral">&quot; (max. is 10). Using first 10 ...&quot;</span>;
<a name="l02144"></a>02144         AddMessage(Message::TYPE_WARNING, msg.str());
<a name="l02145"></a>02145     }
<a name="l02146"></a>02146 
<a name="l02147"></a>02147     std::list&lt;RigDef::Animation&gt;::iterator anim_itor = def.<a class="code" href="struct_rig_def_1_1_prop.html#ae36a89311276557f32c956c0a04ad780">animations</a>.begin();
<a name="l02148"></a>02148     <span class="keywordtype">int</span> anim_index = 0;
<a name="l02149"></a>02149     <span class="keywordflow">while</span> (anim_itor != def.<a class="code" href="struct_rig_def_1_1_prop.html#ae36a89311276557f32c956c0a04ad780">animations</a>.end() &amp;&amp; anim_index &lt; 10)
<a name="l02150"></a>02150     {
<a name="l02151"></a>02151         prop.<a class="code" href="structprop__t.html#a3131f0e2fb0e10a6b88223e61233bacf">animKeyState</a>[anim_index] = -1.0f; <span class="comment">// Orig: hardcoded in {add_animation}</span>
<a name="l02152"></a>02152 
<a name="l02153"></a>02153         <span class="comment">/* Arg #1: ratio */</span>
<a name="l02154"></a>02154         prop.<a class="code" href="structprop__t.html#a2b2296c6b76c33425318a75cf1eed0bc" title="A coefficient for the animation, prop degree if used with mode: rotation and propoffset if used with ...">animratio</a>[anim_index] = anim_itor-&gt;ratio;
<a name="l02155"></a>02155         <span class="keywordflow">if</span> (anim_itor-&gt;ratio == 0) 
<a name="l02156"></a>02156         {
<a name="l02157"></a>02157             std::stringstream msg;
<a name="l02158"></a>02158             msg &lt;&lt; <span class="stringliteral">&quot;Prop (mesh: &quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_prop.html#a5705650fcc106405afbb2d5b25839fa0">mesh_name</a> &lt;&lt; <span class="stringliteral">&quot;) has invalid animation ratio (0), using it anyway (compatibility)...&quot;</span>;
<a name="l02159"></a>02159             AddMessage(Message::TYPE_WARNING, msg.str());
<a name="l02160"></a>02160         }
<a name="l02161"></a>02161 
<a name="l02162"></a>02162         <span class="comment">/* Arg #2: option1 (lower limit) */</span>
<a name="l02163"></a>02163         prop.<a class="code" href="structprop__t.html#af4920cafb82b2a20a7b76d05106d7e6d" title="The lower limit for the animation.">animOpt1</a>[anim_index] = anim_itor-&gt;lower_limit; <span class="comment">/* Handles default */</span>
<a name="l02164"></a>02164 
<a name="l02165"></a>02165         <span class="comment">/* Arg #3: option2 (upper limit) */</span>
<a name="l02166"></a>02166         prop.<a class="code" href="structprop__t.html#acc3c90220d7fe6cff091e692c7cd97e3" title="The upper limit for the animation.">animOpt2</a>[anim_index] = anim_itor-&gt;upper_limit; <span class="comment">/* Handles default */</span>
<a name="l02167"></a>02167 
<a name="l02168"></a>02168         <span class="comment">/* Arg #4: source */</span>
<a name="l02169"></a>02169         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_AIRSPEED)) { <span class="comment">/* (NOTE: code formatting relaxed) */</span>
<a name="l02170"></a>02170             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a09f3cc3a9e5a06073eb5305bf5ee22b7">ANIM_FLAG_AIRSPEED</a>);
<a name="l02171"></a>02171         }
<a name="l02172"></a>02172         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_VERTICAL_VELOCITY)) {
<a name="l02173"></a>02173             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a5720e55cfcc50e503f11f91e4b364760">ANIM_FLAG_VVI</a>);
<a name="l02174"></a>02174         }
<a name="l02175"></a>02175         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_ALTIMETER_100K)) {
<a name="l02176"></a>02176             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a12457c45931e4754166f40f356b7d4bf">ANIM_FLAG_ALTIMETER</a>);
<a name="l02177"></a>02177             prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = 1.f;
<a name="l02178"></a>02178         }
<a name="l02179"></a>02179         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_ALTIMETER_10K)) {
<a name="l02180"></a>02180             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a12457c45931e4754166f40f356b7d4bf">ANIM_FLAG_ALTIMETER</a>);
<a name="l02181"></a>02181             prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = 2.f;
<a name="l02182"></a>02182         }
<a name="l02183"></a>02183         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_ALTIMETER_1K)) {
<a name="l02184"></a>02184             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a12457c45931e4754166f40f356b7d4bf">ANIM_FLAG_ALTIMETER</a>);
<a name="l02185"></a>02185             prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = 3.f;
<a name="l02186"></a>02186         }
<a name="l02187"></a>02187         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_ANGLE_OF_ATTACK)) {
<a name="l02188"></a>02188             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a18751276139a896667dfe69b9e28ad14">ANIM_FLAG_AOA</a>);
<a name="l02189"></a>02189         }
<a name="l02190"></a>02190         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_FLAP)) {
<a name="l02191"></a>02191             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a9b28ff675b27cafe2c5d43f4c683f3ec">ANIM_FLAG_FLAP</a>);
<a name="l02192"></a>02192         }
<a name="l02193"></a>02193         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_AIR_BRAKE)) {
<a name="l02194"></a>02194             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a7a1409d70a1aff5d5726057447f5fed6">ANIM_FLAG_AIRBRAKE</a>);
<a name="l02195"></a>02195         }
<a name="l02196"></a>02196         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_ROLL)) {
<a name="l02197"></a>02197             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ac7049c44ea826423cd65f0f97ee7db09">ANIM_FLAG_ROLL</a>);
<a name="l02198"></a>02198         }
<a name="l02199"></a>02199         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_PITCH)) {
<a name="l02200"></a>02200             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aa32dcb1565f706311a59932363327ff8">ANIM_FLAG_PITCH</a>);
<a name="l02201"></a>02201         }
<a name="l02202"></a>02202         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_BRAKES)) {
<a name="l02203"></a>02203             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a7fca60b90dfd77fab816143552331889">ANIM_FLAG_BRAKE</a>);
<a name="l02204"></a>02204         }
<a name="l02205"></a>02205         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_ACCEL)) {
<a name="l02206"></a>02206             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034afd98e9a63a7b7ed744b2270f955a4532">ANIM_FLAG_ACCEL</a>);
<a name="l02207"></a>02207         }
<a name="l02208"></a>02208         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_CLUTCH)) {
<a name="l02209"></a>02209             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a621316d9e84e1d5c105439134d54a153">ANIM_FLAG_CLUTCH</a>);
<a name="l02210"></a>02210         }
<a name="l02211"></a>02211         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_SPEEDO)) {
<a name="l02212"></a>02212             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a5b8f9fe7bbc358fcb6b65d50e394fb3c">ANIM_FLAG_SPEEDO</a>);
<a name="l02213"></a>02213         }
<a name="l02214"></a>02214         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_TACHO)) {
<a name="l02215"></a>02215             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ac885ea69cc6648d0197c5a60cf78a3f6">ANIM_FLAG_TACHO</a>);
<a name="l02216"></a>02216         }
<a name="l02217"></a>02217         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_TURBO)) {
<a name="l02218"></a>02218             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aa62dfdc082b90d00272e218ea117fbc2">ANIM_FLAG_TURBO</a>);
<a name="l02219"></a>02219         }
<a name="l02220"></a>02220         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_PARKING)) {
<a name="l02221"></a>02221             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ad0fafb8888f2f597f16d30af1bf18840">ANIM_FLAG_PBRAKE</a>);
<a name="l02222"></a>02222         }
<a name="l02223"></a>02223         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_SHIFT_LEFT_RIGHT)) {
<a name="l02224"></a>02224             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l02225"></a>02225             prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = 1.0f;
<a name="l02226"></a>02226         }
<a name="l02227"></a>02227         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_SHIFT_BACK_FORTH)) {
<a name="l02228"></a>02228             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l02229"></a>02229             prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = 2.0f;
<a name="l02230"></a>02230         }
<a name="l02231"></a>02231         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_SHIFTERLIN)) {
<a name="l02232"></a>02232             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l02233"></a>02233             prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = 3.0f;
<a name="l02234"></a>02234         }
<a name="l02235"></a>02235         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_SEQUENTIAL_SHIFT)) {
<a name="l02236"></a>02236             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l02237"></a>02237             prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = 4.0f;
<a name="l02238"></a>02238         }
<a name="l02239"></a>02239         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_TORQUE)) {
<a name="l02240"></a>02240             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aee8a151f04bb8a51644053aeb961fc10">ANIM_FLAG_TORQUE</a>);
<a name="l02241"></a>02241         }
<a name="l02242"></a>02242         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_HEADING)) {
<a name="l02243"></a>02243             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a0fa499f96e5afe37cfa77bdfa51db211">ANIM_FLAG_HEADING</a>);
<a name="l02244"></a>02244         }
<a name="l02245"></a>02245         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_DIFFLOCK)) {
<a name="l02246"></a>02246             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a40e2a8142ddd9c567dc866219d177f7d">ANIM_FLAG_DIFFLOCK</a>);
<a name="l02247"></a>02247         }
<a name="l02248"></a>02248         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_STEERING_WHEEL)) {
<a name="l02249"></a>02249             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ae10c35bb9f6df9f04aefd349f448e23a">ANIM_FLAG_STEERING</a>);
<a name="l02250"></a>02250         }
<a name="l02251"></a>02251         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_AILERON)) {
<a name="l02252"></a>02252             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034abefc5c30695c75219b96843a07ee6e9e">ANIM_FLAG_AILERONS</a>);
<a name="l02253"></a>02253         }
<a name="l02254"></a>02254         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_ELEVATOR)) {
<a name="l02255"></a>02255             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034af939efdaf0ca38bfe6c6d3f9b52b3ee1">ANIM_FLAG_ELEVATORS</a>);
<a name="l02256"></a>02256         }
<a name="l02257"></a>02257         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_AIR_RUDDER)) {
<a name="l02258"></a>02258             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ae8c76242bcc8ab8c495f42f9e105269b">ANIM_FLAG_ARUDDER</a>);
<a name="l02259"></a>02259         }
<a name="l02260"></a>02260         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_BOAT_RUDDER)) {
<a name="l02261"></a>02261             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aa99404a8d349a348dfe64886f78fafa4">ANIM_FLAG_BRUDDER</a>);
<a name="l02262"></a>02262         }
<a name="l02263"></a>02263         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_BOAT_THROTTLE)) {
<a name="l02264"></a>02264             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ad28aca782bd8e4ad42ec47f8cbac5a1f">ANIM_FLAG_BTHROTTLE</a>);
<a name="l02265"></a>02265         }
<a name="l02266"></a>02266         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_PERMANENT)) {
<a name="l02267"></a>02267             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ac2569b3f959e23fc1d891e58551f1047">ANIM_FLAG_PERMANENT</a>);
<a name="l02268"></a>02268         }
<a name="l02269"></a>02269         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;source, RigDef::Animation::SOURCE_EVENT)) {
<a name="l02270"></a>02270             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a4b71bd492d316cd619203ac8f43a6925">ANIM_FLAG_EVENT</a>);
<a name="l02271"></a>02271         }
<a name="l02272"></a>02272         <span class="comment">/* Motor-indexed sources */</span>
<a name="l02273"></a>02273         std::list&lt;RigDef::Animation::MotorSource&gt;::iterator source_itor = anim_itor-&gt;motor_sources.begin();
<a name="l02274"></a>02274         <span class="keywordflow">for</span> ( ; source_itor != anim_itor-&gt;motor_sources.end(); source_itor++)
<a name="l02275"></a>02275         {
<a name="l02276"></a>02276             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(source_itor-&gt;source, <a class="code" href="struct_rig_def_1_1_animation_1_1_motor_source.html#a288c9257b2409dc7caa7e5b8bef27d51">RigDef::Animation::MotorSource::SOURCE_AERO_THROTTLE</a>)) {
<a name="l02277"></a>02277                 <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a41c65943f7670904b0614c81218f95af">ANIM_FLAG_THROTTLE</a>);
<a name="l02278"></a>02278                 prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(source_itor-&gt;motor);
<a name="l02279"></a>02279             }
<a name="l02280"></a>02280             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(source_itor-&gt;source, <a class="code" href="struct_rig_def_1_1_animation_1_1_motor_source.html#ac3d41c6b8ac94c0e03e7b17d96b88fc8">RigDef::Animation::MotorSource::SOURCE_AERO_RPM</a>)) {
<a name="l02281"></a>02281                 <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a72f876cc96347534e2d8af28f8955ada">ANIM_FLAG_RPM</a>);
<a name="l02282"></a>02282                 prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(source_itor-&gt;motor);
<a name="l02283"></a>02283             }
<a name="l02284"></a>02284             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(source_itor-&gt;source, <a class="code" href="struct_rig_def_1_1_animation_1_1_motor_source.html#ab346495b1f556950e569075a62a04289">RigDef::Animation::MotorSource::SOURCE_AERO_TORQUE</a>)) {
<a name="l02285"></a>02285                 <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a440ec65a53d462324e31f84109c18851">ANIM_FLAG_AETORQUE</a>);
<a name="l02286"></a>02286                 prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(source_itor-&gt;motor);
<a name="l02287"></a>02287             }
<a name="l02288"></a>02288             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(source_itor-&gt;source, <a class="code" href="struct_rig_def_1_1_animation_1_1_motor_source.html#a609836db67ad2a0f138b0ef5f8254b62">RigDef::Animation::MotorSource::SOURCE_AERO_PITCH</a>)) {
<a name="l02289"></a>02289                 <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a019e3e9c3b97a6e7fe0c18549b8abe92">ANIM_FLAG_AEPITCH</a>);
<a name="l02290"></a>02290                 prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(source_itor-&gt;motor);
<a name="l02291"></a>02291             }
<a name="l02292"></a>02292             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(source_itor-&gt;source, <a class="code" href="struct_rig_def_1_1_animation_1_1_motor_source.html#a7d49b927a2c2f455905e40414bfbd8aa">RigDef::Animation::MotorSource::SOURCE_AERO_STATUS</a>)) {
<a name="l02293"></a>02293                 <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index], <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a9d024a577f80d1729027b79642988200">ANIM_FLAG_AESTATUS</a>);
<a name="l02294"></a>02294                 prop.<a class="code" href="structprop__t.html#a8e1a1b8c7c6b0d1edb9acf0c198fcd32" title="Various purposes.">animOpt3</a>[anim_index] = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(source_itor-&gt;motor);
<a name="l02295"></a>02295             }
<a name="l02296"></a>02296         }
<a name="l02297"></a>02297         <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index] == 0)
<a name="l02298"></a>02298         {
<a name="l02299"></a>02299             AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to identify animation source&quot;</span>);
<a name="l02300"></a>02300         }
<a name="l02301"></a>02301 
<a name="l02302"></a>02302         <span class="comment">/* Anim modes */</span>
<a name="l02303"></a>02303         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, RigDef::Animation::MODE_ROTATION_X)) {
<a name="l02304"></a>02304             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebba8bf721601f7bb07158c7816238144fac">ANIM_MODE_ROTA_X</a>);
<a name="l02305"></a>02305         }
<a name="l02306"></a>02306         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a014f961a2cb9f010117611b056ecfa66">RigDef::Animation::MODE_ROTATION_Y</a>)) {
<a name="l02307"></a>02307             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebbac30a915cce9cd446e24b96b6e84d1c5c">ANIM_MODE_ROTA_Y</a>);
<a name="l02308"></a>02308         }
<a name="l02309"></a>02309         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a7b2b081b8875e17be7503503fb4bfa76">RigDef::Animation::MODE_ROTATION_Z</a>)) {
<a name="l02310"></a>02310             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebba09c61b9b6cf0f549a6d2e8c4aa470319">ANIM_MODE_ROTA_Z</a>);
<a name="l02311"></a>02311         }
<a name="l02312"></a>02312         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#ab145143e02f645cb3f4c350ae6645cf4">RigDef::Animation::MODE_OFFSET_X</a>)) {
<a name="l02313"></a>02313             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebba341b082cc545a965a50cc9752748bae3">ANIM_MODE_OFFSET_X</a>);
<a name="l02314"></a>02314         }
<a name="l02315"></a>02315         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#ad76d68a66dade2f17247515a6ff0eeb5">RigDef::Animation::MODE_OFFSET_Y</a>)) {
<a name="l02316"></a>02316             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebba0ecb80b05e58f63cdc0b75e5609537be">ANIM_MODE_OFFSET_Y</a>);
<a name="l02317"></a>02317         }
<a name="l02318"></a>02318         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a51706cb287087515e3205fd4abeae845">RigDef::Animation::MODE_OFFSET_Z</a>)) {
<a name="l02319"></a>02319             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebba3fd9d2faf67ad41ee5bccf4ae081df7a">ANIM_MODE_OFFSET_Z</a>);
<a name="l02320"></a>02320         }
<a name="l02321"></a>02321         <span class="keywordflow">if</span> (prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index] == 0)
<a name="l02322"></a>02322         {
<a name="l02323"></a>02323             AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to identify animation mode&quot;</span>);
<a name="l02324"></a>02324         }
<a name="l02325"></a>02325 
<a name="l02326"></a>02326         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a219cdc0aaf0d8f91d8485b262610bef3">RigDef::Animation::MODE_AUTO_ANIMATE</a>)) 
<a name="l02327"></a>02327         {
<a name="l02328"></a>02328             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebbadd2289aa1cf5d5f60c9cac9e9ea6c3cb">ANIM_MODE_AUTOANIMATE</a>);
<a name="l02329"></a>02329 
<a name="l02330"></a>02330             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, RigDef::Animation::MODE_ROTATION_X)) {
<a name="l02331"></a>02331                 prop.<a class="code" href="structprop__t.html#af4920cafb82b2a20a7b76d05106d7e6d" title="The lower limit for the animation.">animOpt1</a>[anim_index] = anim_itor-&gt;lower_limit + prop.<a class="code" href="structprop__t.html#a04439f4fa670b1a1c962333cf4d9ce04">rotaX</a>;
<a name="l02332"></a>02332                 prop.<a class="code" href="structprop__t.html#acc3c90220d7fe6cff091e692c7cd97e3" title="The upper limit for the animation.">animOpt2</a>[anim_index] = anim_itor-&gt;upper_limit + prop.<a class="code" href="structprop__t.html#a04439f4fa670b1a1c962333cf4d9ce04">rotaX</a>;
<a name="l02333"></a>02333                 prop.<a class="code" href="structprop__t.html#a058d28bbea32ea392e290d7f730fd13a">animOpt4</a>[anim_index] = prop.<a class="code" href="structprop__t.html#a04439f4fa670b1a1c962333cf4d9ce04">rotaX</a>;
<a name="l02334"></a>02334             }
<a name="l02335"></a>02335             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a014f961a2cb9f010117611b056ecfa66">RigDef::Animation::MODE_ROTATION_Y</a>)) {
<a name="l02336"></a>02336                 prop.<a class="code" href="structprop__t.html#af4920cafb82b2a20a7b76d05106d7e6d" title="The lower limit for the animation.">animOpt1</a>[anim_index] = anim_itor-&gt;lower_limit + prop.<a class="code" href="structprop__t.html#a783472d5555ac0f21befa203602ee7f7">rotaY</a>;
<a name="l02337"></a>02337                 prop.<a class="code" href="structprop__t.html#acc3c90220d7fe6cff091e692c7cd97e3" title="The upper limit for the animation.">animOpt2</a>[anim_index] = anim_itor-&gt;upper_limit + prop.<a class="code" href="structprop__t.html#a783472d5555ac0f21befa203602ee7f7">rotaY</a>;
<a name="l02338"></a>02338                 prop.<a class="code" href="structprop__t.html#a058d28bbea32ea392e290d7f730fd13a">animOpt4</a>[anim_index] = prop.<a class="code" href="structprop__t.html#a783472d5555ac0f21befa203602ee7f7">rotaY</a>;
<a name="l02339"></a>02339             }
<a name="l02340"></a>02340             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a7b2b081b8875e17be7503503fb4bfa76">RigDef::Animation::MODE_ROTATION_Z</a>)) {
<a name="l02341"></a>02341                 prop.<a class="code" href="structprop__t.html#af4920cafb82b2a20a7b76d05106d7e6d" title="The lower limit for the animation.">animOpt1</a>[anim_index] = anim_itor-&gt;lower_limit + prop.<a class="code" href="structprop__t.html#a13f24353c85e0b9ef59a187199071bea">rotaZ</a>;
<a name="l02342"></a>02342                 prop.<a class="code" href="structprop__t.html#acc3c90220d7fe6cff091e692c7cd97e3" title="The upper limit for the animation.">animOpt2</a>[anim_index] = anim_itor-&gt;upper_limit + prop.<a class="code" href="structprop__t.html#a13f24353c85e0b9ef59a187199071bea">rotaZ</a>;
<a name="l02343"></a>02343                 prop.<a class="code" href="structprop__t.html#a058d28bbea32ea392e290d7f730fd13a">animOpt4</a>[anim_index] = prop.<a class="code" href="structprop__t.html#a13f24353c85e0b9ef59a187199071bea">rotaZ</a>;
<a name="l02344"></a>02344             }
<a name="l02345"></a>02345             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#ab145143e02f645cb3f4c350ae6645cf4">RigDef::Animation::MODE_OFFSET_X</a>)) {
<a name="l02346"></a>02346                 prop.<a class="code" href="structprop__t.html#af4920cafb82b2a20a7b76d05106d7e6d" title="The lower limit for the animation.">animOpt1</a>[anim_index] = anim_itor-&gt;lower_limit + prop.<a class="code" href="structprop__t.html#a5aa5480123cdadf458dd9be598e8fe0f">orgoffsetX</a>;
<a name="l02347"></a>02347                 prop.<a class="code" href="structprop__t.html#acc3c90220d7fe6cff091e692c7cd97e3" title="The upper limit for the animation.">animOpt2</a>[anim_index] = anim_itor-&gt;upper_limit + prop.<a class="code" href="structprop__t.html#a5aa5480123cdadf458dd9be598e8fe0f">orgoffsetX</a>;
<a name="l02348"></a>02348                 prop.<a class="code" href="structprop__t.html#a058d28bbea32ea392e290d7f730fd13a">animOpt4</a>[anim_index] = prop.<a class="code" href="structprop__t.html#a5aa5480123cdadf458dd9be598e8fe0f">orgoffsetX</a>;
<a name="l02349"></a>02349             }
<a name="l02350"></a>02350             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#ad76d68a66dade2f17247515a6ff0eeb5">RigDef::Animation::MODE_OFFSET_Y</a>)) {
<a name="l02351"></a>02351                 prop.<a class="code" href="structprop__t.html#af4920cafb82b2a20a7b76d05106d7e6d" title="The lower limit for the animation.">animOpt1</a>[anim_index] = anim_itor-&gt;lower_limit + prop.<a class="code" href="structprop__t.html#a605263a2e6862e8f06fbe44f4a2ba8a4">orgoffsetY</a>;
<a name="l02352"></a>02352                 prop.<a class="code" href="structprop__t.html#acc3c90220d7fe6cff091e692c7cd97e3" title="The upper limit for the animation.">animOpt2</a>[anim_index] = anim_itor-&gt;upper_limit + prop.<a class="code" href="structprop__t.html#a605263a2e6862e8f06fbe44f4a2ba8a4">orgoffsetY</a>;
<a name="l02353"></a>02353                 prop.<a class="code" href="structprop__t.html#a058d28bbea32ea392e290d7f730fd13a">animOpt4</a>[anim_index] = prop.<a class="code" href="structprop__t.html#a605263a2e6862e8f06fbe44f4a2ba8a4">orgoffsetY</a>;
<a name="l02354"></a>02354             }
<a name="l02355"></a>02355             <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a51706cb287087515e3205fd4abeae845">RigDef::Animation::MODE_OFFSET_Z</a>)) {
<a name="l02356"></a>02356                 prop.<a class="code" href="structprop__t.html#af4920cafb82b2a20a7b76d05106d7e6d" title="The lower limit for the animation.">animOpt1</a>[anim_index] = anim_itor-&gt;lower_limit + prop.<a class="code" href="structprop__t.html#a23bcbc597887a0350fd46a7347238632">orgoffsetZ</a>;
<a name="l02357"></a>02357                 prop.<a class="code" href="structprop__t.html#acc3c90220d7fe6cff091e692c7cd97e3" title="The upper limit for the animation.">animOpt2</a>[anim_index] = anim_itor-&gt;upper_limit + prop.<a class="code" href="structprop__t.html#a23bcbc597887a0350fd46a7347238632">orgoffsetZ</a>;
<a name="l02358"></a>02358                 prop.<a class="code" href="structprop__t.html#a058d28bbea32ea392e290d7f730fd13a">animOpt4</a>[anim_index] = prop.<a class="code" href="structprop__t.html#a23bcbc597887a0350fd46a7347238632">orgoffsetZ</a>;
<a name="l02359"></a>02359             }
<a name="l02360"></a>02360         }
<a name="l02361"></a>02361         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a3cedf2743d4678a7bcb0fa9e099c0b4b">RigDef::Animation::MODE_NO_FLIP</a>)) 
<a name="l02362"></a>02362         {
<a name="l02363"></a>02363             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebba623f30f46fef2099003bc9093956c628">ANIM_MODE_NOFLIP</a>);
<a name="l02364"></a>02364         }
<a name="l02365"></a>02365         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a2cff7cde8c83afc0087075a48c612835">RigDef::Animation::MODE_BOUNCE</a>)) 
<a name="l02366"></a>02366         {
<a name="l02367"></a>02367             <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(prop.<a class="code" href="structprop__t.html#abf47d4b402186a5db2ce6b73adbdb3a9">animMode</a>[anim_index], <a class="code" href="_beam_data_8h.html#a0ed680fdb405e7195d9f14032851eebbac1bb7fde44d738ac81849fe8a1aeb9c8">ANIM_MODE_BOUNCE</a>);
<a name="l02368"></a>02368             prop.<a class="code" href="structprop__t.html#a36d1884da173de394ee1229f3fb643f8">animOpt5</a>[anim_index] = 1.f;
<a name="l02369"></a>02369         }
<a name="l02370"></a>02370         <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(anim_itor-&gt;mode, <a class="code" href="struct_rig_def_1_1_animation.html#a59bf0f8be1a8ca70ef9ae9acbc8ffffa">RigDef::Animation::MODE_EVENT_LOCK</a>)) 
<a name="l02371"></a>02371         {
<a name="l02372"></a>02372             prop.<a class="code" href="structprop__t.html#a3131f0e2fb0e10a6b88223e61233bacf">animKeyState</a>[anim_index] = 0.0f;
<a name="l02373"></a>02373             prop.<a class="code" href="structprop__t.html#a54e0a2a3dec0a8a3f2cdff9b0d1bbff2">lastanimKS</a>[anim_index] = 0.0f;
<a name="l02374"></a>02374         }
<a name="l02375"></a>02375         
<a name="l02376"></a>02376         <span class="comment">/* Parameter &#39;event:&#39; */</span>
<a name="l02377"></a>02377 
<a name="l02378"></a>02378         <span class="keywordflow">if</span> (! anim_itor-&gt;event.empty())
<a name="l02379"></a>02379         {
<a name="l02380"></a>02380             <span class="comment">// we are using keys as source</span>
<a name="l02381"></a>02381             prop.<a class="code" href="structprop__t.html#af939cd861eb3c61eb345712695676502">animFlags</a>[anim_index] |= <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a4b71bd492d316cd619203ac8f43a6925">ANIM_FLAG_EVENT</a>;
<a name="l02382"></a>02382 
<a name="l02383"></a>02383             <span class="keywordtype">int</span> event_id = <a class="code" href="class_ro_r_1_1_application.html#a608003a20ef939a79437a9da8fa76307">RoR::Application::GetInputEngine</a>()-&gt;<a class="code" href="class_input_engine.html#a31686978ff9fe35d93d467ef33149b10">resolveEventName</a>(anim_itor-&gt;event);
<a name="l02384"></a>02384             <span class="keywordflow">if</span> (event_id == -1)
<a name="l02385"></a>02385             {
<a name="l02386"></a>02386                 AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Unknown animation event: &quot;</span> + anim_itor-&gt;event);
<a name="l02387"></a>02387             }
<a name="l02388"></a>02388             <span class="keywordflow">else</span>
<a name="l02389"></a>02389             {
<a name="l02390"></a>02390                 prop.<a class="code" href="structprop__t.html#a1a0b6337bb4fa0f661af6b5b03a450d6">animKey</a>[anim_index] = event_id;
<a name="l02391"></a>02391             }
<a name="l02392"></a>02392         }
<a name="l02393"></a>02393 
<a name="l02394"></a>02394         <span class="comment">/* Advance */</span>
<a name="l02395"></a>02395         anim_itor++;
<a name="l02396"></a>02396         anim_index++;
<a name="l02397"></a>02397     }
<a name="l02398"></a>02398 }
<a name="l02399"></a>02399 
<a name="l02400"></a><a class="code" href="class_rig_spawner.html#aacbcfc16063370c668081c4849aa1650">02400</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aacbcfc16063370c668081c4849aa1650">RigSpawner::ProcessMaterialFlareBinding</a>(<a class="code" href="struct_rig_def_1_1_material_flare_binding.html">RigDef::MaterialFlareBinding</a> &amp; def)
<a name="l02401"></a>02401 {
<a name="l02402"></a>02402     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02403"></a>02403 
<a name="l02404"></a>02404     std::stringstream mat_clone_name;
<a name="l02405"></a>02405     mat_clone_name &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_material_flare_binding.html#a57fb5c2e114b4c56583b57caf4cfc6e4">material_name</a> &lt;&lt; <span class="stringliteral">&quot;_mfb_&quot;</span> &lt;&lt; m_rig-&gt;truckname;
<a name="l02406"></a>02406     Ogre::MaterialPtr material = CloneMaterial(def.<a class="code" href="struct_rig_def_1_1_material_flare_binding.html#a57fb5c2e114b4c56583b57caf4cfc6e4">material_name</a>, mat_clone_name.str());
<a name="l02407"></a>02407     <span class="keywordflow">if</span> (material.isNull())
<a name="l02408"></a>02408     {
<a name="l02409"></a>02409         <span class="keywordflow">return</span>;
<a name="l02410"></a>02410     }
<a name="l02411"></a>02411     
<a name="l02412"></a>02412     <span class="keywordflow">if</span> (m_rig-&gt;materialFunctionMapper != <span class="keyword">nullptr</span>)
<a name="l02413"></a>02413     {
<a name="l02414"></a>02414         <a class="code" href="struct_material_function_mapper_1_1materialmapping__t.html">MaterialFunctionMapper::materialmapping_t</a> mapping;
<a name="l02415"></a>02415         mapping.<a class="code" href="struct_material_function_mapper_1_1materialmapping__t.html#abe5fc049b70457cdd62c49a3e68496e4">originalmaterial</a> = def.<a class="code" href="struct_rig_def_1_1_material_flare_binding.html#a57fb5c2e114b4c56583b57caf4cfc6e4">material_name</a>;
<a name="l02416"></a>02416         mapping.<a class="code" href="struct_material_function_mapper_1_1materialmapping__t.html#a011b02ab3220d736b5591ef031d912cb">material</a> = mat_clone_name.str();
<a name="l02417"></a>02417         mapping.<a class="code" href="struct_material_function_mapper_1_1materialmapping__t.html#a1792ee032638e1dd69ec0b0d8c54a6b3">type</a> = 0; <span class="comment">// Orig: hardcoded in BTS_MATERIALFLAREBINDINGS</span>
<a name="l02418"></a>02418 
<a name="l02419"></a>02419         m_rig-&gt;materialFunctionMapper-&gt;addMaterial(def.<a class="code" href="struct_rig_def_1_1_material_flare_binding.html#a700151fced508c570132cde62ae3fc91">flare_number</a>, mapping);
<a name="l02420"></a>02420     }
<a name="l02421"></a>02421 }
<a name="l02422"></a>02422 
<a name="l02423"></a><a class="code" href="class_rig_spawner.html#a54a1ce38af4b4965580dd13afcd85166">02423</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a54a1ce38af4b4965580dd13afcd85166">RigSpawner::ProcessFlare2</a>(<a class="code" href="struct_rig_def_1_1_flare2.html">RigDef::Flare2</a> &amp; def)
<a name="l02424"></a>02424 {
<a name="l02425"></a>02425     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02426"></a>02426 
<a name="l02427"></a>02427     <span class="keywordflow">if</span> (m_rig-&gt;flaresMode == 0)
<a name="l02428"></a>02428     {
<a name="l02429"></a>02429         <span class="keywordflow">return</span>;
<a name="l02430"></a>02430     }
<a name="l02431"></a>02431 
<a name="l02432"></a>02432     <span class="keywordtype">int</span> blink_delay = def.<a class="code" href="struct_rig_def_1_1_flare2.html#a245a2d3145e5da397c67ad3df715ed6d">blink_delay_milis</a>;
<a name="l02433"></a>02433     <span class="keywordtype">float</span> size = def.<a class="code" href="struct_rig_def_1_1_flare2.html#a432ac1a603a3fea65526d60fa0f04dfc">size</a>;
<a name="l02434"></a>02434 
<a name="l02435"></a>02435     <span class="comment">/* Backwards compatibility */</span>
<a name="l02436"></a>02436     <span class="keywordflow">if</span> (blink_delay == -2) 
<a name="l02437"></a>02437     {
<a name="l02438"></a>02438         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59ae7ad7fbb7df460e7a064ed9a8cb85681">RigDef::Flare2::TYPE_l_LEFT_BLINKER</a> || def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59ae7ad7fbb7df460e7a064ed9a8cb85681">RigDef::Flare2::TYPE_l_LEFT_BLINKER</a>)
<a name="l02439"></a>02439         {
<a name="l02440"></a>02440             blink_delay = -1; <span class="comment">/* Default blink */</span>
<a name="l02441"></a>02441         }
<a name="l02442"></a>02442         <span class="keywordflow">else</span>
<a name="l02443"></a>02443         {
<a name="l02444"></a>02444             blink_delay = 0; <span class="comment">/* Default no blink */</span>
<a name="l02445"></a>02445         }
<a name="l02446"></a>02446     }
<a name="l02447"></a>02447     
<a name="l02448"></a>02448     <span class="keywordflow">if</span> (size == -2.f &amp;&amp; def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59af689203e62629c7546ea661d76fb2c68">RigDef::Flare2::TYPE_f_HEADLIGHT</a>)
<a name="l02449"></a>02449     {
<a name="l02450"></a>02450         size = 1.f;
<a name="l02451"></a>02451     }
<a name="l02452"></a>02452     <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((size == -2.f &amp;&amp; def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> != <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59af689203e62629c7546ea661d76fb2c68">RigDef::Flare2::TYPE_f_HEADLIGHT</a>) || size == -1.f)
<a name="l02453"></a>02453     {
<a name="l02454"></a>02454         size = 0.5f;
<a name="l02455"></a>02455     }
<a name="l02456"></a>02456 
<a name="l02457"></a>02457     <a class="code" href="structflare__t.html">flare_t</a> flare;
<a name="l02458"></a>02458     flare.<a class="code" href="structflare__t.html#a164638416c2365fd9c0e3f20920253b2">type</a>                 = def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a>;
<a name="l02459"></a>02459     flare.<a class="code" href="structflare__t.html#a51faa5a77c5ae681209f817472522185">controlnumber</a>        = def.<a class="code" href="struct_rig_def_1_1_flare2.html#a8508c9aa3e177b4b1db257ed4b03e970">control_number</a>;
<a name="l02460"></a>02460     flare.<a class="code" href="structflare__t.html#a6b6afb793a6eab142e9b864352159683">controltoggle_status</a> = <span class="keyword">false</span>;
<a name="l02461"></a>02461     flare.<a class="code" href="structflare__t.html#a11bd0c8b93f0ffb17712d41a01e19784">blinkdelay</a>           = (blink_delay == -1) ? 0.5f : blink_delay / 1000.f;
<a name="l02462"></a>02462     flare.<a class="code" href="structflare__t.html#a5a6f4ecd5c2064bb0299f7971cb1ed63">blinkdelay_curr</a>      = 0.f;
<a name="l02463"></a>02463     flare.<a class="code" href="structflare__t.html#a7b13432422742f1ea36fd569459811de">blinkdelay_state</a>     = <span class="keyword">false</span>;
<a name="l02464"></a>02464     flare.<a class="code" href="structflare__t.html#ae6d2ad4621fb6a56c89ac36515dad574">noderef</a>              = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_flare2.html#ab1ecd6650e9e4594c25c64554174744a">reference_node</a>);
<a name="l02465"></a>02465     flare.<a class="code" href="structflare__t.html#ac37cd6b59a1c96b114332a2bd901fc18">nodex</a>                = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_flare2.html#a1b3cd9f30d8364dca13356cfe8916ae2">node_axis_x</a>);
<a name="l02466"></a>02466     flare.<a class="code" href="structflare__t.html#a5f14fb47b0bc3745e4e1ce141978ed0d">nodey</a>                = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_flare2.html#a8aba4620d5a8a712bb90f78f39463ba9">node_axis_y</a>);
<a name="l02467"></a>02467     flare.<a class="code" href="structflare__t.html#a429d00f08056632034a8e5cd2d378cea">offsetx</a>              = def.<a class="code" href="struct_rig_def_1_1_flare2.html#a1336f448b07125339747191de0e5a0c1">offset</a>.x;
<a name="l02468"></a>02468     flare.<a class="code" href="structflare__t.html#a80cfd03942e9dd33951ab37dc4a78a66">offsety</a>              = def.<a class="code" href="struct_rig_def_1_1_flare2.html#a1336f448b07125339747191de0e5a0c1">offset</a>.y;
<a name="l02469"></a>02469     flare.<a class="code" href="structflare__t.html#a322fffb0846a9df5c155b25e51adbc78">offsetz</a>              = def.<a class="code" href="struct_rig_def_1_1_flare2.html#a1336f448b07125339747191de0e5a0c1">offset</a>.z;
<a name="l02470"></a>02470     flare.<a class="code" href="structflare__t.html#a5cde72f02bd0308883036df815e79542">size</a>                 = size;
<a name="l02471"></a>02471 
<a name="l02472"></a>02472     <span class="comment">/* Visuals */</span>
<a name="l02473"></a>02473     flare.<a class="code" href="structflare__t.html#aafd8ad9bfba0affacb7c125bc766a8f9">snode</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l02474"></a>02474     std::stringstream flare_name;
<a name="l02475"></a>02475     flare_name &lt;&lt; <span class="stringliteral">&quot;flare-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; m_rig-&gt;free_flare;
<a name="l02476"></a>02476     flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createBillboardSet(flare_name.str(), 1);
<a name="l02477"></a>02477     <span class="keywordtype">bool</span> using_default_material = <span class="keyword">true</span>;
<a name="l02478"></a>02478     <span class="keywordflow">if</span> (flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a> == <span class="keyword">nullptr</span>)
<a name="l02479"></a>02479     {
<a name="l02480"></a>02480         AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;Failed to create flare: &#39;&quot;</span> + flare_name.str() + <span class="stringliteral">&quot;&#39;, continuing without it (compatibility)...&quot;</span>);
<a name="l02481"></a>02481     }
<a name="l02482"></a>02482     <span class="keywordflow">else</span>
<a name="l02483"></a>02483     {
<a name="l02484"></a>02484         flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a>-&gt;createBillboard(0,0,0);
<a name="l02485"></a>02485         flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a>-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l02486"></a>02486         
<a name="l02487"></a>02487         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a5a611fa08db567dc3a26184fdc33b19b">material_name</a>.length() == 0 || def.<a class="code" href="struct_rig_def_1_1_flare2.html#a5a611fa08db567dc3a26184fdc33b19b">material_name</a> == <span class="stringliteral">&quot;default&quot;</span>)
<a name="l02488"></a>02488         {
<a name="l02489"></a>02489             <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59a3a1a80923d79d229f9912f31b771c2f0">RigDef::Flare2::TYPE_b_BRAKELIGHT</a>)
<a name="l02490"></a>02490             {
<a name="l02491"></a>02491                 flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a>-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/brakeflare&quot;</span>);
<a name="l02492"></a>02492             }
<a name="l02493"></a>02493             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59ae7ad7fbb7df460e7a064ed9a8cb85681">RigDef::Flare2::TYPE_l_LEFT_BLINKER</a> || (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59a0c24533b14331d8cc42f7539ce32cb90">RigDef::Flare2::TYPE_r_RIGHT_BLINKER</a>))
<a name="l02494"></a>02494             {
<a name="l02495"></a>02495                 flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a>-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/blinkflare&quot;</span>);
<a name="l02496"></a>02496             }
<a name="l02497"></a>02497             <span class="keywordflow">else</span>
<a name="l02498"></a>02498             {
<a name="l02499"></a>02499                 flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a>-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/flare&quot;</span>);
<a name="l02500"></a>02500             }
<a name="l02501"></a>02501         }
<a name="l02502"></a>02502         <span class="keywordflow">else</span>
<a name="l02503"></a>02503         {
<a name="l02504"></a>02504             using_default_material = <span class="keyword">false</span>;
<a name="l02505"></a>02505             flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a>-&gt;setMaterialName(def.<a class="code" href="struct_rig_def_1_1_flare2.html#a5a611fa08db567dc3a26184fdc33b19b">material_name</a>);
<a name="l02506"></a>02506         }
<a name="l02507"></a>02507         flare.<a class="code" href="structflare__t.html#aafd8ad9bfba0affacb7c125bc766a8f9">snode</a>-&gt;attachObject(flare.<a class="code" href="structflare__t.html#a1c5198022092fabc2c82ad5cb187407b">bbs</a>);
<a name="l02508"></a>02508     }
<a name="l02509"></a>02509     flare.<a class="code" href="structflare__t.html#a22dea33cb886c8790153f77b48d7fb58">isVisible</a> = <span class="keyword">true</span>;
<a name="l02510"></a>02510     flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a> = <span class="keyword">nullptr</span>;
<a name="l02511"></a>02511 
<a name="l02512"></a>02512     <span class="keywordflow">if</span> (m_rig-&gt;flaresMode &gt;= 2 &amp;&amp; size &gt; 0.001)
<a name="l02513"></a>02513     {
<a name="l02514"></a>02514         <span class="comment">//if (type == &#39;f&#39; &amp;&amp; usingDefaultMaterial &amp;&amp; flaresMode &gt;=2 &amp;&amp; size &gt; 0.001)</span>
<a name="l02515"></a>02515         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59af689203e62629c7546ea661d76fb2c68">RigDef::Flare2::TYPE_f_HEADLIGHT</a> &amp;&amp; using_default_material )
<a name="l02516"></a>02516         {
<a name="l02517"></a>02517             <span class="comment">/* front light */</span>
<a name="l02518"></a>02518             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(flare_name.str());
<a name="l02519"></a>02519             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setType(Ogre::Light::LT_SPOTLIGHT);
<a name="l02520"></a>02520             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setDiffuseColour( Ogre::ColourValue(1, 1, 1));
<a name="l02521"></a>02521             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpecularColour( Ogre::ColourValue(1, 1, 1));
<a name="l02522"></a>02522             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setAttenuation(400, 0.9, 0, 0);
<a name="l02523"></a>02523             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpotlightRange( Ogre::Degree(35), Ogre::Degree(45) );
<a name="l02524"></a>02524             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l02525"></a>02525         }
<a name="l02526"></a>02526     }
<a name="l02527"></a>02527     <span class="keywordflow">if</span> (m_rig-&gt;flaresMode &gt;= 4 &amp;&amp; size &gt; 0.001)
<a name="l02528"></a>02528     {
<a name="l02529"></a>02529         <span class="comment">//else if (type == &#39;f&#39; &amp;&amp; !usingDefaultMaterial &amp;&amp; flaresMode &gt;=4 &amp;&amp; size &gt; 0.001)</span>
<a name="l02530"></a>02530         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59af689203e62629c7546ea661d76fb2c68">RigDef::Flare2::TYPE_f_HEADLIGHT</a> &amp;&amp; ! using_default_material)
<a name="l02531"></a>02531         {
<a name="l02532"></a>02532             <span class="comment">/* this is a quick fix for the red backlight when frontlight is switched on */</span>
<a name="l02533"></a>02533             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(flare_name.str());
<a name="l02534"></a>02534             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setDiffuseColour( Ogre::ColourValue(1.0, 0, 0));
<a name="l02535"></a>02535             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpecularColour( Ogre::ColourValue(1.0, 0, 0));
<a name="l02536"></a>02536             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setAttenuation(10.0, 1.0, 0, 0);
<a name="l02537"></a>02537         }
<a name="l02538"></a>02538         <span class="comment">//else if (type == &#39;R&#39; &amp;&amp; flaresMode &gt;= 4 &amp;&amp; size &gt; 0.001)</span>
<a name="l02539"></a>02539         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59a935ded8c74ada5768e8fae07bfa61b90">RigDef::Flare2::TYPE_R_REVERSE_LIGHT</a>)
<a name="l02540"></a>02540         {
<a name="l02541"></a>02541             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(flare_name.str());
<a name="l02542"></a>02542             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setDiffuseColour(Ogre::ColourValue(1, 1, 1));
<a name="l02543"></a>02543             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpecularColour(Ogre::ColourValue(1, 1, 1));
<a name="l02544"></a>02544             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setAttenuation(20.0, 1, 0, 0);
<a name="l02545"></a>02545         }
<a name="l02546"></a>02546         <span class="comment">//else if (type == &#39;b&#39; &amp;&amp; flaresMode &gt;= 4 &amp;&amp; size &gt; 0.001)</span>
<a name="l02547"></a>02547         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59a3a1a80923d79d229f9912f31b771c2f0">RigDef::Flare2::TYPE_b_BRAKELIGHT</a>)
<a name="l02548"></a>02548         {
<a name="l02549"></a>02549             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(flare_name.str());
<a name="l02550"></a>02550             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setDiffuseColour( Ogre::ColourValue(1.0, 0, 0));
<a name="l02551"></a>02551             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpecularColour( Ogre::ColourValue(1.0, 0, 0));
<a name="l02552"></a>02552             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setAttenuation(10.0, 1.0, 0, 0);
<a name="l02553"></a>02553         }
<a name="l02554"></a>02554         <span class="comment">//else if ((type == &#39;l&#39; || type == &#39;r&#39;) &amp;&amp; flaresMode &gt;= 4 &amp;&amp; size &gt; 0.001)</span>
<a name="l02555"></a>02555         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59ae7ad7fbb7df460e7a064ed9a8cb85681">RigDef::Flare2::TYPE_l_LEFT_BLINKER</a> || (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59a0c24533b14331d8cc42f7539ce32cb90">RigDef::Flare2::TYPE_r_RIGHT_BLINKER</a>))
<a name="l02556"></a>02556         {
<a name="l02557"></a>02557             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(flare_name.str());
<a name="l02558"></a>02558             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setDiffuseColour( Ogre::ColourValue(1, 1, 0));
<a name="l02559"></a>02559             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpecularColour( Ogre::ColourValue(1, 1, 0));
<a name="l02560"></a>02560             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setAttenuation(10.0, 1, 1, 0);
<a name="l02561"></a>02561         }
<a name="l02562"></a>02562         <span class="comment">//else if ((type == &#39;u&#39;) &amp;&amp; flaresMode &gt;= 4 &amp;&amp; size &gt; 0.001)</span>
<a name="l02563"></a>02563         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_flare2.html#a85f03d77917f51332efdc1f91586838a">type</a> == <a class="code" href="struct_rig_def_1_1_flare2.html#ab2549ae31580f64bbd36c459afb14e59a55c88b800fe2003b594467a592b99d29">RigDef::Flare2::TYPE_u_USER</a>)
<a name="l02564"></a>02564         {
<a name="l02565"></a>02565             <span class="comment">/* user light always white (TODO: improve this) */</span>
<a name="l02566"></a>02566             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>=<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(flare_name.str());
<a name="l02567"></a>02567             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setDiffuseColour( Ogre::ColourValue(1, 1, 1));
<a name="l02568"></a>02568             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpecularColour( Ogre::ColourValue(1, 1, 1));
<a name="l02569"></a>02569             flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setAttenuation(50.0, 1.0, 1, 0.2);
<a name="l02570"></a>02570 
<a name="l02571"></a>02571             <span class="keywordflow">if</span> (m_rig-&gt;netCustomLightArray_counter &lt; 4)
<a name="l02572"></a>02572             {
<a name="l02573"></a>02573                 m_rig-&gt;netCustomLightArray[m_rig-&gt;netCustomLightArray_counter] = m_rig-&gt;free_flare;
<a name="l02574"></a>02574                 m_rig-&gt;netCustomLightArray_counter++;
<a name="l02575"></a>02575             }
<a name="l02576"></a>02576         }
<a name="l02577"></a>02577     }
<a name="l02578"></a>02578 
<a name="l02579"></a>02579     <span class="comment">/* Finalize light */</span>
<a name="l02580"></a>02580     <span class="keywordflow">if</span> (flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a> != <span class="keyword">nullptr</span>)
<a name="l02581"></a>02581     {
<a name="l02582"></a>02582         flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setType(Ogre::Light::LT_SPOTLIGHT);
<a name="l02583"></a>02583         flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setSpotlightRange( Ogre::Degree(35), Ogre::Degree(45) );
<a name="l02584"></a>02584         flare.<a class="code" href="structflare__t.html#a5b1b8c3f083ff03c5efc96cf997774ee">light</a>-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l02585"></a>02585     }
<a name="l02586"></a>02586     m_rig-&gt;flares.push_back(flare);
<a name="l02587"></a>02587     m_rig-&gt;free_flare++;
<a name="l02588"></a>02588 }
<a name="l02589"></a>02589 
<a name="l02590"></a><a class="code" href="class_rig_spawner.html#a80e47a0d12c49486ef6b9056383fa38d">02590</a> Ogre::MaterialPtr <a class="code" href="class_rig_spawner.html#a80e47a0d12c49486ef6b9056383fa38d">RigSpawner::CloneMaterial</a>(Ogre::String <span class="keyword">const</span> &amp; source_name, Ogre::String <span class="keyword">const</span> &amp; clone_name)
<a name="l02591"></a>02591 {
<a name="l02592"></a>02592     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02593"></a>02593 
<a name="l02594"></a>02594     Ogre::MaterialPtr src_mat = <span class="keyword">static_cast&lt;</span>Ogre::MaterialPtr<span class="keyword">&gt;</span>(Ogre::MaterialManager::getSingleton().getByName(source_name));
<a name="l02595"></a>02595     <span class="keywordflow">if</span> (src_mat.isNull())
<a name="l02596"></a>02596     {
<a name="l02597"></a>02597         std::stringstream msg;
<a name="l02598"></a>02598         msg &lt;&lt; <span class="stringliteral">&quot;Built-in material &#39;&quot;</span> &lt;&lt; source_name &lt;&lt; <span class="stringliteral">&quot;&#39; missing! Skipping...&quot;</span>;
<a name="l02599"></a>02599         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l02600"></a>02600         <span class="keywordflow">return</span> Ogre::MaterialPtr();
<a name="l02601"></a>02601     }
<a name="l02602"></a>02602     <span class="keywordflow">return</span> src_mat-&gt;clone(clone_name);
<a name="l02603"></a>02603 }
<a name="l02604"></a>02604 
<a name="l02605"></a><a class="code" href="class_rig_spawner.html#a696ca2325d4e8c656f5aca09088ec057">02605</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a696ca2325d4e8c656f5aca09088ec057">RigSpawner::ProcessManagedMaterial</a>(<a class="code" href="struct_rig_def_1_1_managed_material.html">RigDef::ManagedMaterial</a> &amp; def)
<a name="l02606"></a>02606 {
<a name="l02607"></a>02607     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02608"></a>02608 
<a name="l02609"></a>02609     Ogre::MaterialPtr test = <span class="keyword">static_cast&lt;</span>Ogre::MaterialPtr<span class="keyword">&gt;</span>(Ogre::MaterialManager::getSingleton().getByName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a>));
<a name="l02610"></a>02610     <span class="keywordflow">if</span> (!test.isNull())
<a name="l02611"></a>02611     {
<a name="l02612"></a>02612         std::stringstream msg;
<a name="l02613"></a>02613         msg &lt;&lt; <span class="stringliteral">&quot;Managed material &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a> &lt;&lt; <span class="stringliteral">&quot;&#39; already exists (probably because the vehicle was already spawned before)&quot;</span>;
<a name="l02614"></a>02614         AddMessage(Message::TYPE_WARNING, msg.str());
<a name="l02615"></a>02615     }
<a name="l02616"></a>02616 
<a name="l02617"></a>02617     Ogre::MaterialPtr material;
<a name="l02618"></a>02618     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#adb33b1c26a945929d447f64be31e972a">type</a> == <a class="code" href="struct_rig_def_1_1_managed_material.html#a69a407568a5bc70553488f2ff2a3a329a3d9e2e7f1931a98343ab7ad741c5f263">RigDef::ManagedMaterial::TYPE_FLEXMESH_STANDARD</a> || def.<a class="code" href="struct_rig_def_1_1_managed_material.html#adb33b1c26a945929d447f64be31e972a">type</a> == <a class="code" href="struct_rig_def_1_1_managed_material.html#a69a407568a5bc70553488f2ff2a3a329a364fbb22df927b6d9f14fb504914fdac">RigDef::ManagedMaterial::TYPE_FLEXMESH_TRANSPARENT</a>)
<a name="l02619"></a>02619     {
<a name="l02620"></a>02620         Ogre::String mat_name_base
<a name="l02621"></a>02621             = (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#adb33b1c26a945929d447f64be31e972a">type</a> == <a class="code" href="struct_rig_def_1_1_managed_material.html#a69a407568a5bc70553488f2ff2a3a329a3d9e2e7f1931a98343ab7ad741c5f263">RigDef::ManagedMaterial::TYPE_FLEXMESH_STANDARD</a>)
<a name="l02622"></a>02622             ? <span class="stringliteral">&quot;managed/flexmesh_standard&quot;</span>
<a name="l02623"></a>02623             : <span class="stringliteral">&quot;managed/flexmesh_transparent&quot;</span>;
<a name="l02624"></a>02624 
<a name="l02625"></a>02625         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#ac103fdc5fb34c014b05e4edbaa31e3e6">HasDamagedDiffuseMap</a>())
<a name="l02626"></a>02626         {
<a name="l02627"></a>02627             <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a0a78525bf6a3ed403ad367f851d26a34">HasSpecularMap</a>())
<a name="l02628"></a>02628             {
<a name="l02629"></a>02629                 <span class="comment">/* FLEXMESH, damage, specular */</span>
<a name="l02630"></a>02630                 material = CloneMaterial(mat_name_base + <span class="stringliteral">&quot;/speculardamage&quot;</span>, def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a>);
<a name="l02631"></a>02631                 <span class="keywordflow">if</span> (material.isNull())
<a name="l02632"></a>02632                 {
<a name="l02633"></a>02633                     <span class="keywordflow">return</span>;
<a name="l02634"></a>02634                 }
<a name="l02635"></a>02635                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#abc379420c9b5b3d69d9e78e8b78b36cc">diffuse_map</a>);
<a name="l02636"></a>02636                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Dmg_Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#ad72439b398c66b63fbc46028ccbfc160">damaged_diffuse_map</a>);
<a name="l02637"></a>02637                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;SpecularMapping1&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;SpecularMapping1_Tex&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a913aa588a71ff3ce3fd26bb4a5638dcd">specular_map</a>);
<a name="l02638"></a>02638             }
<a name="l02639"></a>02639             <span class="keywordflow">else</span>
<a name="l02640"></a>02640             {
<a name="l02641"></a>02641                 <span class="comment">/* FLEXMESH, damage, no_specular */</span>
<a name="l02642"></a>02642                 material = CloneMaterial(mat_name_base + <span class="stringliteral">&quot;/damageonly&quot;</span>, def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a>);
<a name="l02643"></a>02643                 <span class="keywordflow">if</span> (material.isNull())
<a name="l02644"></a>02644                 {
<a name="l02645"></a>02645                     <span class="keywordflow">return</span>;
<a name="l02646"></a>02646                 }
<a name="l02647"></a>02647                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#abc379420c9b5b3d69d9e78e8b78b36cc">diffuse_map</a>);
<a name="l02648"></a>02648                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Dmg_Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#ad72439b398c66b63fbc46028ccbfc160">damaged_diffuse_map</a>);
<a name="l02649"></a>02649             }
<a name="l02650"></a>02650             <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a879a1abaa523c1659b5029b8bfc2dcf0">options</a>.<a class="code" href="struct_rig_def_1_1_managed_materials_options.html#aec4abc6b63dcea79172f0080bda1d9f3">double_sided</a>)
<a name="l02651"></a>02651             {
<a name="l02652"></a>02652                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;setCullingMode(Ogre::CULL_NONE);
<a name="l02653"></a>02653                 <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a0a78525bf6a3ed403ad367f851d26a34">HasSpecularMap</a>())
<a name="l02654"></a>02654                 {
<a name="l02655"></a>02655                     material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;SpecularMapping1&quot;</span>)-&gt;setCullingMode(Ogre::CULL_NONE);
<a name="l02656"></a>02656                 }
<a name="l02657"></a>02657             }
<a name="l02658"></a>02658         }
<a name="l02659"></a>02659         <span class="keywordflow">else</span>
<a name="l02660"></a>02660         {
<a name="l02661"></a>02661             <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a0a78525bf6a3ed403ad367f851d26a34">HasSpecularMap</a>())
<a name="l02662"></a>02662             {
<a name="l02663"></a>02663                 <span class="comment">/* FLEXMESH, no_damage, specular */</span>
<a name="l02664"></a>02664                 material = CloneMaterial(mat_name_base + <span class="stringliteral">&quot;/specularonly&quot;</span>, def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a>);
<a name="l02665"></a>02665                 <span class="keywordflow">if</span> (material.isNull())
<a name="l02666"></a>02666                 {
<a name="l02667"></a>02667                     <span class="keywordflow">return</span>;
<a name="l02668"></a>02668                 }
<a name="l02669"></a>02669                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#abc379420c9b5b3d69d9e78e8b78b36cc">diffuse_map</a>);
<a name="l02670"></a>02670                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;SpecularMapping1&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;SpecularMapping1_Tex&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a913aa588a71ff3ce3fd26bb4a5638dcd">specular_map</a>);
<a name="l02671"></a>02671             }
<a name="l02672"></a>02672             <span class="keywordflow">else</span>
<a name="l02673"></a>02673             {
<a name="l02674"></a>02674                 <span class="comment">/* FLEXMESH, no_damage, no_specular */</span>
<a name="l02675"></a>02675                 material = CloneMaterial(mat_name_base + <span class="stringliteral">&quot;/simple&quot;</span>, def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a>);
<a name="l02676"></a>02676                 <span class="keywordflow">if</span> (material.isNull())
<a name="l02677"></a>02677                 {
<a name="l02678"></a>02678                     <span class="keywordflow">return</span>;
<a name="l02679"></a>02679                 }
<a name="l02680"></a>02680                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#abc379420c9b5b3d69d9e78e8b78b36cc">diffuse_map</a>);
<a name="l02681"></a>02681             }
<a name="l02682"></a>02682             <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a879a1abaa523c1659b5029b8bfc2dcf0">options</a>.<a class="code" href="struct_rig_def_1_1_managed_materials_options.html#aec4abc6b63dcea79172f0080bda1d9f3">double_sided</a>)
<a name="l02683"></a>02683             {
<a name="l02684"></a>02684                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;setCullingMode(Ogre::CULL_NONE);
<a name="l02685"></a>02685                 <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a0a78525bf6a3ed403ad367f851d26a34">HasSpecularMap</a>())
<a name="l02686"></a>02686                 {
<a name="l02687"></a>02687                     material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;SpecularMapping1&quot;</span>)-&gt;setCullingMode(Ogre::CULL_NONE);
<a name="l02688"></a>02688                 }
<a name="l02689"></a>02689             }
<a name="l02690"></a>02690         }
<a name="l02691"></a>02691     }
<a name="l02692"></a>02692     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#adb33b1c26a945929d447f64be31e972a">type</a> == <a class="code" href="struct_rig_def_1_1_managed_material.html#a69a407568a5bc70553488f2ff2a3a329aa5556c7362b5bbf5d7dc7cb24600d9fb">RigDef::ManagedMaterial::TYPE_MESH_STANDARD</a> || def.<a class="code" href="struct_rig_def_1_1_managed_material.html#adb33b1c26a945929d447f64be31e972a">type</a> == <a class="code" href="struct_rig_def_1_1_managed_material.html#a69a407568a5bc70553488f2ff2a3a329a327d3a960b3f7f3c56f15aa8570cb5eb">RigDef::ManagedMaterial::TYPE_MESH_TRANSPARENT</a>)
<a name="l02693"></a>02693     {
<a name="l02694"></a>02694         Ogre::String mat_name_base
<a name="l02695"></a>02695             = (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#adb33b1c26a945929d447f64be31e972a">type</a> == <a class="code" href="struct_rig_def_1_1_managed_material.html#a69a407568a5bc70553488f2ff2a3a329aa5556c7362b5bbf5d7dc7cb24600d9fb">RigDef::ManagedMaterial::TYPE_MESH_STANDARD</a>)
<a name="l02696"></a>02696             ? <span class="stringliteral">&quot;managed/mesh_standard&quot;</span>
<a name="l02697"></a>02697             : <span class="stringliteral">&quot;managed/mesh_transparent&quot;</span>;
<a name="l02698"></a>02698 
<a name="l02699"></a>02699         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a0a78525bf6a3ed403ad367f851d26a34">HasSpecularMap</a>())
<a name="l02700"></a>02700         {
<a name="l02701"></a>02701             <span class="comment">/* MESH, specular */</span>
<a name="l02702"></a>02702             material = CloneMaterial(mat_name_base + <span class="stringliteral">&quot;/specular&quot;</span>, def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a>);
<a name="l02703"></a>02703             <span class="keywordflow">if</span> (material.isNull())
<a name="l02704"></a>02704             {
<a name="l02705"></a>02705                 <span class="keywordflow">return</span>;
<a name="l02706"></a>02706             }
<a name="l02707"></a>02707             material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#abc379420c9b5b3d69d9e78e8b78b36cc">diffuse_map</a>);
<a name="l02708"></a>02708             material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;SpecularMapping1&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;SpecularMapping1_Tex&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a913aa588a71ff3ce3fd26bb4a5638dcd">specular_map</a>);
<a name="l02709"></a>02709         }
<a name="l02710"></a>02710         <span class="keywordflow">else</span>
<a name="l02711"></a>02711         {
<a name="l02712"></a>02712             <span class="comment">/* MESH, no_specular */</span>
<a name="l02713"></a>02713             material = CloneMaterial(mat_name_base + <span class="stringliteral">&quot;/simple&quot;</span>, def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a5dc09cd722ca4525361dbdaed3f40bc5">name</a>);
<a name="l02714"></a>02714             <span class="keywordflow">if</span> (material.isNull())
<a name="l02715"></a>02715             {
<a name="l02716"></a>02716                 <span class="keywordflow">return</span>;
<a name="l02717"></a>02717             }
<a name="l02718"></a>02718             material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;getTextureUnitState(<span class="stringliteral">&quot;Diffuse_Map&quot;</span>)-&gt;setTextureName(def.<a class="code" href="struct_rig_def_1_1_managed_material.html#abc379420c9b5b3d69d9e78e8b78b36cc">diffuse_map</a>);
<a name="l02719"></a>02719 
<a name="l02720"></a>02720             <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a879a1abaa523c1659b5029b8bfc2dcf0">options</a>.<a class="code" href="struct_rig_def_1_1_managed_materials_options.html#aec4abc6b63dcea79172f0080bda1d9f3">double_sided</a>)
<a name="l02721"></a>02721             {
<a name="l02722"></a>02722                 material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;BaseRender&quot;</span>)-&gt;setCullingMode(Ogre::CULL_NONE);
<a name="l02723"></a>02723                 <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_managed_material.html#a0a78525bf6a3ed403ad367f851d26a34">HasSpecularMap</a>())
<a name="l02724"></a>02724                 {
<a name="l02725"></a>02725                     material-&gt;getTechnique(<span class="stringliteral">&quot;BaseTechnique&quot;</span>)-&gt;getPass(<span class="stringliteral">&quot;SpecularMapping1&quot;</span>)-&gt;setCullingMode(Ogre::CULL_NONE);
<a name="l02726"></a>02726                 }
<a name="l02727"></a>02727             }
<a name="l02728"></a>02728         }
<a name="l02729"></a>02729     }
<a name="l02730"></a>02730 
<a name="l02731"></a>02731     <span class="comment">/* Finalize */</span>
<a name="l02732"></a>02732 
<a name="l02733"></a>02733     material-&gt;compile();
<a name="l02734"></a>02734 }
<a name="l02735"></a>02735 
<a name="l02736"></a><a class="code" href="class_rig_spawner.html#abc4647a96c0e44974ff864b08fe0a91d">02736</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#abc4647a96c0e44974ff864b08fe0a91d">RigSpawner::ProcessCollisionBox</a>(<a class="code" href="struct_rig_def_1_1_collision_box.html">RigDef::CollisionBox</a> &amp; def)
<a name="l02737"></a>02737 {
<a name="l02738"></a>02738     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02739"></a>02739 
<a name="l02740"></a>02740     <span class="keyword">auto</span> itor = def.<a class="code" href="struct_rig_def_1_1_collision_box.html#ad9cdb18abd6ad4db1e0102851299aaf2">nodes</a>.begin();
<a name="l02741"></a>02741     <span class="keyword">auto</span> end  = def.<a class="code" href="struct_rig_def_1_1_collision_box.html#ad9cdb18abd6ad4db1e0102851299aaf2">nodes</a>.end();
<a name="l02742"></a>02742     <span class="keywordflow">for</span> ( ; itor != end; ++itor)
<a name="l02743"></a>02743     {
<a name="l02744"></a>02744         std::pair&lt;unsigned int, bool&gt; node_result = GetNodeIndex(*itor);
<a name="l02745"></a>02745         <span class="keywordflow">if</span> (! node_result.second)
<a name="l02746"></a>02746         {
<a name="l02747"></a>02747             std::stringstream msg;
<a name="l02748"></a>02748             msg &lt;&lt; <span class="stringliteral">&quot;Invalid node &#39;&quot;</span> &lt;&lt; itor-&gt;ToString() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l02749"></a>02749             <span class="keywordflow">continue</span>;
<a name="l02750"></a>02750         }
<a name="l02751"></a>02751         m_rig-&gt;nodes[node_result.first].collisionBoundingBoxID = m_rig-&gt;collisionBoundingBoxes.size();
<a name="l02752"></a>02752     }
<a name="l02753"></a>02753 
<a name="l02754"></a>02754     m_rig-&gt;collisionBoundingBoxes.resize(m_rig-&gt;collisionBoundingBoxes.size() + 1);
<a name="l02755"></a>02755 }
<a name="l02756"></a>02756 
<a name="l02757"></a><a class="code" href="class_rig_spawner.html#a5cafd3f3437883387720fc887a031b34">02757</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a5cafd3f3437883387720fc887a031b34">RigSpawner::AssignWheelToAxle</a>(<span class="keywordtype">int</span> &amp; _out_axle_wheel, <a class="code" href="structnode__t.html">node_t</a> *axis_node_1, <a class="code" href="structnode__t.html">node_t</a> *axis_node_2)
<a name="l02758"></a>02758 {
<a name="l02759"></a>02759     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02760"></a>02760 
<a name="l02761"></a>02761     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_rig-&gt;free_wheel; i++)
<a name="l02762"></a>02762     {
<a name="l02763"></a>02763         <a class="code" href="structwheel__t.html">wheel_t</a> &amp; wheel = m_rig-&gt;wheels[i];
<a name="l02764"></a>02764         <span class="keywordflow">if</span>  (   (wheel.<a class="code" href="structwheel__t.html#a6cf8fe4b687a7e4abe51819eac224bc1">refnode0</a> == axis_node_1 &amp;&amp; wheel.<a class="code" href="structwheel__t.html#a507a081a13d6c5a10e75c31a341e2fad">refnode1</a> == axis_node_2)
<a name="l02765"></a>02765             ||  (wheel.<a class="code" href="structwheel__t.html#a6cf8fe4b687a7e4abe51819eac224bc1">refnode0</a> == axis_node_2 &amp;&amp; wheel.<a class="code" href="structwheel__t.html#a507a081a13d6c5a10e75c31a341e2fad">refnode1</a> == axis_node_1)
<a name="l02766"></a>02766             )
<a name="l02767"></a>02767         {
<a name="l02768"></a>02768             _out_axle_wheel = i;
<a name="l02769"></a>02769             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l02770"></a>02770         }
<a name="l02771"></a>02771     }
<a name="l02772"></a>02772     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l02773"></a>02773 }
<a name="l02774"></a>02774 
<a name="l02775"></a><a class="code" href="class_rig_spawner.html#a629bef5e7c13c56fde46472b3adaa8fa">02775</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a629bef5e7c13c56fde46472b3adaa8fa">RigSpawner::ProcessAxle</a>(<a class="code" href="struct_rig_def_1_1_axle.html">RigDef::Axle</a> &amp; def)
<a name="l02776"></a>02776 {
<a name="l02777"></a>02777     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02778"></a>02778 
<a name="l02779"></a>02779     <span class="keywordflow">if</span> (! CheckAxleLimit(1))
<a name="l02780"></a>02780     {
<a name="l02781"></a>02781         <span class="keywordflow">return</span>;
<a name="l02782"></a>02782     }
<a name="l02783"></a>02783 
<a name="l02784"></a>02784     <a class="code" href="structnode__t.html">node_t</a> *wheel_1_node_1 = GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[0][0]);
<a name="l02785"></a>02785     <a class="code" href="structnode__t.html">node_t</a> *wheel_1_node_2 = GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[0][1]);
<a name="l02786"></a>02786     <a class="code" href="structnode__t.html">node_t</a> *wheel_2_node_1 = GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[1][0]);
<a name="l02787"></a>02787     <a class="code" href="structnode__t.html">node_t</a> *wheel_2_node_2 = GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[1][1]);
<a name="l02788"></a>02788     <a class="code" href="class_axle.html" title="class created from a struct will be ugly for a while.">Axle</a> *axle = <span class="keyword">new</span> <a class="code" href="class_axle.html" title="class created from a struct will be ugly for a while.">Axle</a>();
<a name="l02789"></a>02789 
<a name="l02790"></a>02790     <span class="keywordflow">if</span> (! AssignWheelToAxle(axle-&gt;<a class="code" href="class_axle.html#af8cdb2fdb1f4aabba10f5e27fc1773a6">wheel_1</a>, wheel_1_node_1, wheel_1_node_2))
<a name="l02791"></a>02791     {
<a name="l02792"></a>02792         std::stringstream msg;
<a name="l02793"></a>02793         msg &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t find wheel with axis nodes &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[0][0].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>()
<a name="l02794"></a>02794             &lt;&lt; <span class="stringliteral">&quot;&#39; and &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[0][1].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l02795"></a>02795         AddMessage(Message::TYPE_WARNING, msg.str());
<a name="l02796"></a>02796     }
<a name="l02797"></a>02797 
<a name="l02798"></a>02798     <span class="keywordflow">if</span> (! AssignWheelToAxle(axle-&gt;<a class="code" href="class_axle.html#ab45f25aecf8a658e887a0e1d29b74fc4" title="array location of wheel 1">wheel_2</a>, wheel_2_node_1, wheel_2_node_2))
<a name="l02799"></a>02799     {
<a name="l02800"></a>02800         std::stringstream msg;
<a name="l02801"></a>02801         msg &lt;&lt; <span class="stringliteral">&quot;Couldn&#39;t find wheel with axis nodes &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[1][0].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>()
<a name="l02802"></a>02802             &lt;&lt; <span class="stringliteral">&quot;&#39; and &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_axle.html#ac4957b6163bcd501003490d20e3abf34">wheels</a>[1][1].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l02803"></a>02803         AddMessage(Message::TYPE_WARNING, msg.str());
<a name="l02804"></a>02804     }
<a name="l02805"></a>02805 
<a name="l02806"></a>02806     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_axle.html#ab9853ed20b3b34ea3a2baa140cc7a2ef" title="Order matters!">options</a>.size() == 0)
<a name="l02807"></a>02807     {
<a name="l02808"></a>02808         AddMessage(Message::TYPE_INFO, <span class="stringliteral">&quot;No differential defined, defaulting to Open &amp; Locked&quot;</span>);
<a name="l02809"></a>02809         axle-&gt;<a class="code" href="class_axle.html#a586be91663e139cca504c12a4f98f104">addDiffType</a>(<a class="code" href="_differentials_8h.html#a4f72c76ecf6a186ee470acf55db0b194a64c2cc807d46a02de085d8d0f3579aad">OPEN_DIFF</a>);
<a name="l02810"></a>02810         axle-&gt;<a class="code" href="class_axle.html#a586be91663e139cca504c12a4f98f104">addDiffType</a>(<a class="code" href="_differentials_8h.html#a4f72c76ecf6a186ee470acf55db0b194a1dcac20ac43a2b92dd3db608d93fc7c8">LOCKED_DIFF</a>);
<a name="l02811"></a>02811     }
<a name="l02812"></a>02812     <span class="keywordflow">else</span>
<a name="l02813"></a>02813     {
<a name="l02814"></a>02814         <span class="keyword">auto</span> end = def.<a class="code" href="struct_rig_def_1_1_axle.html#ab9853ed20b3b34ea3a2baa140cc7a2ef" title="Order matters!">options</a>.end();
<a name="l02815"></a>02815         <span class="keywordflow">for</span> (<span class="keyword">auto</span> itor = def.<a class="code" href="struct_rig_def_1_1_axle.html#ab9853ed20b3b34ea3a2baa140cc7a2ef" title="Order matters!">options</a>.begin(); itor != end; ++itor)
<a name="l02816"></a>02816         {
<a name="l02817"></a>02817             <span class="keywordflow">switch</span> (*itor)
<a name="l02818"></a>02818             {
<a name="l02819"></a>02819             <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_axle.html#ad6ec4ee3dd676f1050c74d9404b1ec99">RigDef::Axle::OPTION_l_LOCKED</a>:
<a name="l02820"></a>02820                 axle-&gt;<a class="code" href="class_axle.html#a586be91663e139cca504c12a4f98f104">addDiffType</a>(<a class="code" href="_differentials_8h.html#a4f72c76ecf6a186ee470acf55db0b194a1dcac20ac43a2b92dd3db608d93fc7c8">LOCKED_DIFF</a>);
<a name="l02821"></a>02821                 <span class="keywordflow">break</span>;
<a name="l02822"></a>02822             <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_axle.html#a5844831f0428a2455f12f1b9278a0690">RigDef::Axle::OPTION_o_OPEN</a>:
<a name="l02823"></a>02823                 axle-&gt;<a class="code" href="class_axle.html#a586be91663e139cca504c12a4f98f104">addDiffType</a>(<a class="code" href="_differentials_8h.html#a4f72c76ecf6a186ee470acf55db0b194a64c2cc807d46a02de085d8d0f3579aad">OPEN_DIFF</a>);
<a name="l02824"></a>02824                 <span class="keywordflow">break</span>;
<a name="l02825"></a>02825             <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_axle.html#a801e43b2d99a230b53533e47973a323a">RigDef::Axle::OPTION_s_SPLIT</a>:
<a name="l02826"></a>02826                 axle-&gt;<a class="code" href="class_axle.html#a586be91663e139cca504c12a4f98f104">addDiffType</a>(<a class="code" href="_differentials_8h.html#a4f72c76ecf6a186ee470acf55db0b194af9bc25be280f0e5659bddea5161c0a49">SPLIT_DIFF</a>);
<a name="l02827"></a>02827                 <span class="keywordflow">break</span>;
<a name="l02828"></a>02828             <span class="keywordflow">default</span>:
<a name="l02829"></a>02829                 AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;Unknown differential type: &quot;</span> + *itor);
<a name="l02830"></a>02830                 <span class="keywordflow">break</span>;
<a name="l02831"></a>02831             }
<a name="l02832"></a>02832         }
<a name="l02833"></a>02833     }
<a name="l02834"></a>02834 
<a name="l02835"></a>02835     m_rig-&gt;axles[m_rig-&gt;free_axle] = axle;
<a name="l02836"></a>02836     m_rig-&gt;free_axle++;
<a name="l02837"></a>02837 }
<a name="l02838"></a>02838 
<a name="l02839"></a><a class="code" href="class_rig_spawner.html#a04b41c52378956d8019f61074113c19f">02839</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a04b41c52378956d8019f61074113c19f">RigSpawner::ProcessSpeedLimiter</a>(<a class="code" href="struct_rig_def_1_1_speed_limiter.html">RigDef::SpeedLimiter</a> &amp; def)
<a name="l02840"></a>02840 {
<a name="l02841"></a>02841     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02842"></a>02842 
<a name="l02843"></a>02843     m_rig-&gt;sl_enabled = <span class="keyword">true</span>;
<a name="l02844"></a>02844     m_rig-&gt;sl_speed_limit = def.<a class="code" href="struct_rig_def_1_1_speed_limiter.html#a82b9d7697cbafb40dd20ae8c7b8f3ca7">max_speed</a>;
<a name="l02845"></a>02845     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_speed_limiter.html#a82b9d7697cbafb40dd20ae8c7b8f3ca7">max_speed</a> &lt;= 0.f)
<a name="l02846"></a>02846     {
<a name="l02847"></a>02847         std::stringstream msg;
<a name="l02848"></a>02848         msg &lt;&lt; <span class="stringliteral">&quot;Invalid parameter &#39;max_speed&#39; (&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_speed_limiter.html#a82b9d7697cbafb40dd20ae8c7b8f3ca7">max_speed</a> 
<a name="l02849"></a>02849             &lt;&lt; <span class="stringliteral">&quot;) must be positive nonzero number. Using it anyway (compatibility)&quot;</span>;
<a name="l02850"></a>02850     }
<a name="l02851"></a>02851 }
<a name="l02852"></a>02852 
<a name="l02853"></a><a class="code" href="class_rig_spawner.html#af240339d0174a8f4681f165958a2d9b7">02853</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af240339d0174a8f4681f165958a2d9b7">RigSpawner::ProcessCruiseControl</a>(<a class="code" href="struct_rig_def_1_1_cruise_control.html">RigDef::CruiseControl</a> &amp; def)
<a name="l02854"></a>02854 {
<a name="l02855"></a>02855     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02856"></a>02856 
<a name="l02857"></a>02857     m_rig-&gt;cc_target_speed_lower_limit = def.<a class="code" href="struct_rig_def_1_1_cruise_control.html#ab552ac1e269796538f721e92ee7f9c7a">min_speed</a>;
<a name="l02858"></a>02858     <span class="keywordflow">if</span> (m_rig-&gt;cc_target_speed_lower_limit &lt;= 0.f)
<a name="l02859"></a>02859     {
<a name="l02860"></a>02860         std::stringstream msg;
<a name="l02861"></a>02861         msg &lt;&lt; <span class="stringliteral">&quot;Invalid parameter &#39;lower_limit&#39; (&quot;</span> &lt;&lt; m_rig-&gt;cc_target_speed_lower_limit 
<a name="l02862"></a>02862             &lt;&lt; <span class="stringliteral">&quot;) must be positive nonzero number. Using it anyway (compatibility)&quot;</span>;
<a name="l02863"></a>02863     }
<a name="l02864"></a>02864     m_rig-&gt;cc_can_brake = def.<a class="code" href="struct_rig_def_1_1_cruise_control.html#a2ce00864da1fbb3c4506163bb3b57f66">autobrake</a> != 0;
<a name="l02865"></a>02865 }
<a name="l02866"></a>02866 
<a name="l02867"></a><a class="code" href="class_rig_spawner.html#a8b8a48940590458417c9ceb088590f92">02867</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a8b8a48940590458417c9ceb088590f92">RigSpawner::ProcessTorqueCurve</a>(<a class="code" href="struct_rig_def_1_1_torque_curve.html">RigDef::TorqueCurve</a> &amp; def)
<a name="l02868"></a>02868 {
<a name="l02869"></a>02869     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02870"></a>02870 
<a name="l02871"></a>02871     <span class="keywordflow">if</span> (m_rig-&gt;engine == <span class="keyword">nullptr</span>)
<a name="l02872"></a>02872     {
<a name="l02873"></a>02873         AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;Section &#39;torquecurve&#39; found but no &#39;engine&#39; defined, skipping...&quot;</span>);
<a name="l02874"></a>02874         <span class="keywordflow">return</span>;
<a name="l02875"></a>02875     }
<a name="l02876"></a>02876 
<a name="l02877"></a>02877     <a class="code" href="class_torque_curve.html" title="This class loads and processes a torque curve for a truck.">TorqueCurve</a> *target_torque_curve = m_rig-&gt;engine-&gt;getTorqueCurve();
<a name="l02878"></a>02878 
<a name="l02879"></a>02879     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_torque_curve.html#ae802dcd3b567637f1c049cfddfacbde4">predefined_func_name</a>.length() != 0)
<a name="l02880"></a>02880     {
<a name="l02881"></a>02881         target_torque_curve-&gt;<a class="code" href="class_torque_curve.html#a9e4decb6a9bd46ea604995d15b20007f">setTorqueModel</a>(def.<a class="code" href="struct_rig_def_1_1_torque_curve.html#ae802dcd3b567637f1c049cfddfacbde4">predefined_func_name</a>);
<a name="l02882"></a>02882     }
<a name="l02883"></a>02883     <span class="keywordflow">else</span>
<a name="l02884"></a>02884     {
<a name="l02885"></a>02885         target_torque_curve-&gt;<a class="code" href="class_torque_curve.html#aee98faa6b93b58a0ba7b4a76a32e2700">CreateNewCurve</a>(); <span class="comment">/* Use default name for custom curve */</span>
<a name="l02886"></a>02886         std::vector&lt;RigDef::TorqueCurve::Sample&gt;::iterator itor = def.<a class="code" href="struct_rig_def_1_1_torque_curve.html#a0ae72aa572e1dac7f4092b6156421fd2">samples</a>.begin();
<a name="l02887"></a>02887         <span class="keywordflow">for</span> ( ; itor != def.<a class="code" href="struct_rig_def_1_1_torque_curve.html#a0ae72aa572e1dac7f4092b6156421fd2">samples</a>.end(); itor++)
<a name="l02888"></a>02888         {
<a name="l02889"></a>02889             target_torque_curve-&gt;<a class="code" href="class_torque_curve.html#a16cb0f36ed41f96e4f2d67f9e57643d7">AddCurveSample</a>(itor-&gt;power, itor-&gt;torque_percent);
<a name="l02890"></a>02890         }
<a name="l02891"></a>02891     }
<a name="l02892"></a>02892 }
<a name="l02893"></a>02893 
<a name="l02894"></a><a class="code" href="class_rig_spawner.html#a938a03dda6953c2f8fd9dfe12294ee41">02894</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a938a03dda6953c2f8fd9dfe12294ee41">RigSpawner::ProcessParticle</a>(<a class="code" href="struct_rig_def_1_1_particle.html">RigDef::Particle</a> &amp; def)
<a name="l02895"></a>02895 {
<a name="l02896"></a>02896     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02897"></a>02897 
<a name="l02898"></a>02898     <span class="keywordflow">if</span> (! m_rig-&gt;cparticle_enabled)
<a name="l02899"></a>02899     {
<a name="l02900"></a>02900         <span class="keywordflow">return</span>;
<a name="l02901"></a>02901     }
<a name="l02902"></a>02902 
<a name="l02903"></a>02903     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> particle_index = m_rig-&gt;free_cparticle;
<a name="l02904"></a>02904     m_rig-&gt;free_cparticle++;
<a name="l02905"></a>02905     <a class="code" href="structcparticle__t.html">cparticle_t</a> &amp; particle = m_rig-&gt;cparticles[particle_index];
<a name="l02906"></a>02906 
<a name="l02907"></a>02907     particle.<a class="code" href="structcparticle__t.html#a1035e755152d91dc28a8ded027d2a6a0">emitterNode</a> = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_particle.html#a124a9d68981f024ec468e1bafc31bdc0">emitter_node</a>);
<a name="l02908"></a>02908     particle.<a class="code" href="structcparticle__t.html#af1c35c4c738904c85089941ef8807899">directionNode</a> = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_particle.html#a6dd0aa51141e1c4368837b37ae8135a3">reference_node</a>);
<a name="l02909"></a>02909 
<a name="l02910"></a>02910     <span class="comment">/* Setup visuals */</span>
<a name="l02911"></a>02911     std::stringstream name;
<a name="l02912"></a>02912     name &lt;&lt; <span class="stringliteral">&quot;cparticle-&quot;</span> &lt;&lt; particle_index &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; m_rig-&gt;truckname;
<a name="l02913"></a>02913     particle.<a class="code" href="structcparticle__t.html#a3d608b66f390a23e2ba2c1a423d58874">snode</a> = m_parent_scene_node-&gt;createChildSceneNode();
<a name="l02914"></a>02914     particle.<a class="code" href="structcparticle__t.html#aa5b2d07e032d2913609ce1430b09bc60">psys</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createParticleSystem(name.str(), def.<a class="code" href="struct_rig_def_1_1_particle.html#add2234f956e03de6e48774758e51cad5">particle_system_name</a>);
<a name="l02915"></a>02915     <span class="keywordflow">if</span> (particle.<a class="code" href="structcparticle__t.html#aa5b2d07e032d2913609ce1430b09bc60">psys</a> == <span class="keyword">nullptr</span>)
<a name="l02916"></a>02916     {
<a name="l02917"></a>02917         std::stringstream msg;
<a name="l02918"></a>02918         msg &lt;&lt; <span class="stringliteral">&quot;Failed to create particle system &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_particle.html#add2234f956e03de6e48774758e51cad5">particle_system_name</a> &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l02919"></a>02919         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l02920"></a>02920         <span class="keywordflow">return</span>;
<a name="l02921"></a>02921     }
<a name="l02922"></a>02922     particle.<a class="code" href="structcparticle__t.html#aa5b2d07e032d2913609ce1430b09bc60">psys</a>-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>);
<a name="l02923"></a>02923     particle.<a class="code" href="structcparticle__t.html#a3d608b66f390a23e2ba2c1a423d58874">snode</a>-&gt;attachObject(particle.<a class="code" href="structcparticle__t.html#aa5b2d07e032d2913609ce1430b09bc60">psys</a>);
<a name="l02924"></a>02924     particle.<a class="code" href="structcparticle__t.html#a3d608b66f390a23e2ba2c1a423d58874">snode</a>-&gt;setPosition(GetNode(particle.<a class="code" href="structcparticle__t.html#a1035e755152d91dc28a8ded027d2a6a0">emitterNode</a>).AbsPosition);
<a name="l02925"></a>02925     
<a name="l02926"></a>02926     <span class="comment">/* Shut down the emitters */</span>
<a name="l02927"></a>02927     particle.<a class="code" href="structcparticle__t.html#a3822aeb36ddcf7688aab208cc948b9f6">active</a> = <span class="keyword">false</span>; 
<a name="l02928"></a>02928     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; particle.<a class="code" href="structcparticle__t.html#aa5b2d07e032d2913609ce1430b09bc60">psys</a>-&gt;getNumEmitters(); i++)
<a name="l02929"></a>02929     {
<a name="l02930"></a>02930         particle.<a class="code" href="structcparticle__t.html#aa5b2d07e032d2913609ce1430b09bc60">psys</a>-&gt;getEmitter(i)-&gt;setEnabled(<span class="keyword">false</span>);
<a name="l02931"></a>02931     }
<a name="l02932"></a>02932 }
<a name="l02933"></a>02933 
<a name="l02934"></a><a class="code" href="class_rig_spawner.html#acd9a714252d4a928392f19a17e7dc63d">02934</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#acd9a714252d4a928392f19a17e7dc63d">RigSpawner::ProcessRopable</a>(<a class="code" href="struct_rig_def_1_1_ropable.html">RigDef::Ropable</a> &amp; def)
<a name="l02935"></a>02935 {
<a name="l02936"></a>02936     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02937"></a>02937 
<a name="l02938"></a>02938     <a class="code" href="structropable__t.html">ropable_t</a> ropable;
<a name="l02939"></a>02939     ropable.<a class="code" href="structropable__t.html#ad43bdbbd00ed11ac8dfc31d976e02ad6">node</a> = GetNodePointerOrThrow(def.<a class="code" href="struct_rig_def_1_1_ropable.html#ad7c7f6defb128879b79c33b8e883cad4">node</a>);
<a name="l02940"></a>02940     ropable.<a class="code" href="structropable__t.html#a5c74787d9bac34d6b2843f137bd50b37">group</a> = def.<a class="code" href="struct_rig_def_1_1_ropable.html#aee8681f82ec839e672e483711a045452">group</a>;
<a name="l02941"></a>02941     ropable.<a class="code" href="structropable__t.html#a90de0c9a19b6c492e9411f7667d2a4e8">used</a> = 0; <span class="comment">// Hardcoded in BTS_ROPABLES</span>
<a name="l02942"></a>02942     ropable.<a class="code" href="structropable__t.html#aecd6a3792a3bb3d288ba58949e338d73">multilock</a> = def.<a class="code" href="struct_rig_def_1_1_ropable.html#aef6accf08290580c74f19adfb631abe7">multilock</a>;
<a name="l02943"></a>02943     m_rig-&gt;ropables.push_back(ropable);
<a name="l02944"></a>02944 
<a name="l02945"></a>02945     ropable.<a class="code" href="structropable__t.html#ad43bdbbd00ed11ac8dfc31d976e02ad6">node</a>-&gt;<a class="code" href="structnode__t.html#aef05ecf1894a1c0ef547c5da5a50cef1">iIsSkin</a> = <span class="keyword">true</span>;
<a name="l02946"></a>02946 }
<a name="l02947"></a>02947 
<a name="l02948"></a><a class="code" href="class_rig_spawner.html#aa370ffcbca4b2189d90b70f470cea251">02948</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aa370ffcbca4b2189d90b70f470cea251">RigSpawner::ProcessTie</a>(<a class="code" href="struct_rig_def_1_1_tie.html">RigDef::Tie</a> &amp; def)
<a name="l02949"></a>02949 {
<a name="l02950"></a>02950     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02951"></a>02951 
<a name="l02952"></a>02952     <span class="keywordflow">if</span> (! CheckBeamLimit(1))
<a name="l02953"></a>02953     {
<a name="l02954"></a>02954         <span class="keywordflow">return</span>;
<a name="l02955"></a>02955     }
<a name="l02956"></a>02956 
<a name="l02957"></a>02957     <a class="code" href="structnode__t.html">node_t</a> &amp; node_1 = GetNodeOrThrow(def.<a class="code" href="struct_rig_def_1_1_tie.html#a0117bb7f086f5ae7ddaee03ea527a227">root_node</a>);
<a name="l02958"></a>02958     <a class="code" href="structnode__t.html">node_t</a> &amp; node_2 = GetNode( (node_1.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> == 0) ? 1 : 0 );
<a name="l02959"></a>02959 
<a name="l02960"></a>02960     <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l02961"></a>02961     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(node_1, node_2, def.<a class="code" href="struct_rig_def_1_1_tie.html#a71d99e3fe734fb79671b6d1404e353ba">beam_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_tie.html#a10e540a088583865d56a93b170e64945">detacher_group</a>);
<a name="l02962"></a>02962     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_tie.html#a71d99e3fe734fb79671b6d1404e353ba">beam_defaults</a>-&gt;GetScaledBreakingThreshold());
<a name="l02963"></a>02963     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#a71d99e3fe734fb79671b6d1404e353ba">beam_defaults</a>-&gt;GetScaledSpringiness();
<a name="l02964"></a>02964     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#a71d99e3fe734fb79671b6d1404e353ba">beam_defaults</a>-&gt;GetScaledDamping();
<a name="l02965"></a>02965     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = (def.<a class="code" href="struct_rig_def_1_1_tie.html#a36e8a071e7a9ab91bb8cbd5b3885fc84">options</a> == <a class="code" href="struct_rig_def_1_1_tie.html#a71af09d152fa909aca046d40a6c479fda7c14978fd9956ecca99531fb03c450e5">RigDef::Tie::OPTIONS_INVISIBLE</a>) ? <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a> : <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l02966"></a>02966     beam.<a class="code" href="structbeam__t.html#a97e6ce14fdcf35d1c7b8c40b40998ede" title="length">L</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#ade8c827f6cc690147b04d676139d332b">max_reach_length</a>;
<a name="l02967"></a>02967     beam.<a class="code" href="structbeam__t.html#ace384f1fca382d1df48d29c895a29bc3" title="reference length">refL</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#ade8c827f6cc690147b04d676139d332b">max_reach_length</a>;
<a name="l02968"></a>02968     beam.<a class="code" href="structbeam__t.html#a65d3452c6840de148c962b20defb45b6" title="hydro reference len">Lhydro</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#ade8c827f6cc690147b04d676139d332b">max_reach_length</a>;
<a name="l02969"></a>02969     beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a24d6f5addc374131ab07a16c222d6992">ROPE</a>;
<a name="l02970"></a>02970     beam.<a class="code" href="structbeam__t.html#a7056fd64d16dff1edba5c533c9a4f86d">disabled</a> = <span class="keyword">true</span>;
<a name="l02971"></a>02971     beam.<a class="code" href="structbeam__t.html#ab0ab6a1847baf4011bf0b58a742189dd">commandRatioLong</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#a5925b6d13ff4b9fb0e3adecb2c4340fe">auto_shorten_rate</a>;
<a name="l02972"></a>02972     beam.<a class="code" href="structbeam__t.html#a56392ecaa08c8b8bec4abdc1ec204d25">commandRatioShort</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#a5925b6d13ff4b9fb0e3adecb2c4340fe">auto_shorten_rate</a>;
<a name="l02973"></a>02973     beam.<a class="code" href="structbeam__t.html#a49deacaa83d59050c7613aa9d3c486b7">commandShort</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#a0b40a56021499da732a7c4ddbc4223a0">min_length</a>;
<a name="l02974"></a>02974     beam.<a class="code" href="structbeam__t.html#a22e9fa02eb5a1a4760b77f0197ab87ee">commandLong</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#acd3d9a03f642abb6fb56b71e74592d8e">max_length</a>;
<a name="l02975"></a>02975     beam.<a class="code" href="structbeam__t.html#af07708c1109a50ffc8d54da3d189e732">maxtiestress</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#a0da377554573a477e06532d4d03999dd">max_stress</a>;
<a name="l02976"></a>02976     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a> = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l02977"></a>02977     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_tie.html#a71d99e3fe734fb79671b6d1404e353ba">beam_defaults</a>, <span class="keyword">false</span>);
<a name="l02978"></a>02978 
<a name="l02979"></a>02979     <span class="comment">/* Register tie */</span>
<a name="l02980"></a>02980     <a class="code" href="structtie__t.html">tie_t</a> tie;
<a name="l02981"></a>02981     tie.<a class="code" href="structtie__t.html#a49bae07ef1bbe779f3dfe15578ea4120">group</a> = def.<a class="code" href="struct_rig_def_1_1_tie.html#ae0eb5e62ce1822f1338cc60c14a9f61e">group</a>;
<a name="l02982"></a>02982     tie.<a class="code" href="structtie__t.html#a9cea5fda893b459e96a161ec5ae2c118">tying</a> = <span class="keyword">false</span>;
<a name="l02983"></a>02983     tie.<a class="code" href="structtie__t.html#aeb4c3c8127157ceac20293259bb4111a">tied</a> = <span class="keyword">false</span>;
<a name="l02984"></a>02984     tie.<a class="code" href="structtie__t.html#adb5af1a225d7bd02473e11f9374de17c">beam</a> = &amp; beam;
<a name="l02985"></a>02985     tie.<a class="code" href="structtie__t.html#aaa7478a887f8cb85f5e78284a446041d">commandValue</a> = -1.f;
<a name="l02986"></a>02986     m_rig-&gt;ties.push_back(tie);
<a name="l02987"></a>02987 
<a name="l02988"></a>02988     m_rig-&gt;hascommands = 1;
<a name="l02989"></a>02989 }
<a name="l02990"></a>02990 
<a name="l02991"></a><a class="code" href="class_rig_spawner.html#af7cb339584c08658261d9c83374575e8">02991</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af7cb339584c08658261d9c83374575e8">RigSpawner::ProcessRope</a>(<a class="code" href="struct_rig_def_1_1_rope.html">RigDef::Rope</a> &amp; def)
<a name="l02992"></a>02992 {
<a name="l02993"></a>02993     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l02994"></a>02994 
<a name="l02995"></a>02995     <span class="keywordflow">if</span> (! CheckBeamLimit(1))
<a name="l02996"></a>02996     {
<a name="l02997"></a>02997         <span class="keywordflow">return</span>;
<a name="l02998"></a>02998     }
<a name="l02999"></a>02999 
<a name="l03000"></a>03000     <a class="code" href="structnode__t.html">node_t</a> &amp; root_node = GetNodeOrThrow(def.<a class="code" href="struct_rig_def_1_1_rope.html#aca715ade3aa0c0029f0f613e3713830c">root_node</a>);
<a name="l03001"></a>03001     <a class="code" href="structnode__t.html">node_t</a> &amp; end_node = GetNodeOrThrow(def.<a class="code" href="struct_rig_def_1_1_rope.html#ac0918cf76f8fd8694c09aedee559abc5">end_node</a>);
<a name="l03002"></a>03002 
<a name="l03003"></a>03003     <span class="comment">/* Add beam */</span>
<a name="l03004"></a>03004     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(root_node, end_node, def.<a class="code" href="struct_rig_def_1_1_rope.html#a683bb747ac66dc46f32b9202582c33da">beam_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_rope.html#a8bc57fcbde4261780ba36860dba82e54">detacher_group</a>);
<a name="l03005"></a>03005     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_rope.html#a683bb747ac66dc46f32b9202582c33da">beam_defaults</a>-&gt;GetScaledBreakingThreshold());
<a name="l03006"></a>03006     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = def.<a class="code" href="struct_rig_def_1_1_rope.html#a683bb747ac66dc46f32b9202582c33da">beam_defaults</a>-&gt;GetScaledSpringiness();
<a name="l03007"></a>03007     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = def.<a class="code" href="struct_rig_def_1_1_rope.html#a683bb747ac66dc46f32b9202582c33da">beam_defaults</a>-&gt;GetScaledDamping();
<a name="l03008"></a>03008     beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a24d6f5addc374131ab07a16c222d6992">ROPE</a>;
<a name="l03009"></a>03009     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = (def.<a class="code" href="struct_rig_def_1_1_rope.html#a723d1873f1b3ae5175a1746b1b3cde73">invisible</a>) ? <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a> : <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03010"></a>03010 
<a name="l03011"></a>03011     <span class="comment">/* Register rope */</span>
<a name="l03012"></a>03012     <a class="code" href="structrope__t.html">rope_t</a> rope;
<a name="l03013"></a>03013     rope.<a class="code" href="structrope__t.html#a55dcf0924d711fc75d707531be0dc184">beam</a> = &amp; beam;
<a name="l03014"></a>03014     rope.<a class="code" href="structrope__t.html#a919b599071b0f8f206f0bff8a6a071fb">lockedto</a> = &amp; m_rig-&gt;nodes[0]; <span class="comment">// Orig: hardcoded in BTS_ROPES</span>
<a name="l03015"></a>03015     rope.<a class="code" href="structrope__t.html#ae4627688cdf725adb04402be1a00ddbd">group</a> = 0; <span class="comment">// Orig: hardcoded in BTS_ROPES. TODO: To be used.</span>
<a name="l03016"></a>03016     m_rig-&gt;ropes.push_back(rope);
<a name="l03017"></a>03017 
<a name="l03018"></a>03018     root_node.<a class="code" href="structnode__t.html#aef05ecf1894a1c0ef547c5da5a50cef1">iIsSkin</a> = <span class="keyword">true</span>;
<a name="l03019"></a>03019     end_node.<a class="code" href="structnode__t.html#aef05ecf1894a1c0ef547c5da5a50cef1">iIsSkin</a> = <span class="keyword">true</span>;
<a name="l03020"></a>03020 }
<a name="l03021"></a>03021 
<a name="l03022"></a><a class="code" href="class_rig_spawner.html#a2a63b83576a68f2a2b924a6c86c2831d">03022</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a2a63b83576a68f2a2b924a6c86c2831d">RigSpawner::ProcessRailGroup</a>(<a class="code" href="struct_rig_def_1_1_rail_group.html">RigDef::RailGroup</a> &amp; def)
<a name="l03023"></a>03023 {
<a name="l03024"></a>03024     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03025"></a>03025 
<a name="l03026"></a>03026     <a class="code" href="class_rail.html">Rail</a> *rail = CreateRail(def.<a class="code" href="struct_rig_def_1_1_rail_group.html#a3681d82bc0eeea15944595c83ab6551b">node_list</a>);
<a name="l03027"></a>03027     <span class="keywordflow">if</span> (rail == <span class="keyword">nullptr</span>)
<a name="l03028"></a>03028     {
<a name="l03029"></a>03029         <span class="keywordflow">return</span>;
<a name="l03030"></a>03030     }
<a name="l03031"></a>03031     <a class="code" href="class_rail_group.html">RailGroup</a> *rail_group = <span class="keyword">new</span> <a class="code" href="class_rail_group.html">RailGroup</a>(rail, def.<a class="code" href="struct_rig_def_1_1_rail_group.html#a81c2cc3edae5a3a9bf50eff2119fa996">id</a>);
<a name="l03032"></a>03032     m_rig-&gt;mRailGroups.push_back(rail_group);
<a name="l03033"></a>03033 }
<a name="l03034"></a>03034 
<a name="l03035"></a><a class="code" href="class_rig_spawner.html#aeb9cc73a5856b289f91e6a46115a01ad">03035</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aeb9cc73a5856b289f91e6a46115a01ad">RigSpawner::ProcessSlidenode</a>(<a class="code" href="struct_rig_def_1_1_slide_node.html">RigDef::SlideNode</a> &amp; def)
<a name="l03036"></a>03036 {
<a name="l03037"></a>03037     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03038"></a>03038 
<a name="l03039"></a>03039     <a class="code" href="structnode__t.html">node_t</a> &amp; node = GetNodeOrThrow(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a57d4430eeb3a1bed4f1482b3813f9cd3">slide_node</a>);
<a name="l03040"></a>03040     <a class="code" href="class_slide_node.html">SlideNode</a> slide_node(&amp; node, <span class="keyword">nullptr</span>);
<a name="l03041"></a>03041     slide_node.<a class="code" href="class_slide_node.html#adcee5a4e21607e9f5a6ff1fb00603141" title="distance from a beam before corrective forces take effect">setThreshold</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#afce23142d6e72bb68145d464ed57f52e">tolerance</a>);
<a name="l03042"></a>03042     slide_node.<a class="code" href="class_slide_node.html#a858bcffba2de9eb8f79a424f852093b6" title="spring force used to calculate corrective forces">setSpringRate</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a23a8705deff5cbbfa2915f56b88d3b35">spring_rate</a>);
<a name="l03043"></a>03043     slide_node.<a class="code" href="class_slide_node.html#adafe888657c615c57d9a2639a1450136" title="how long it will take for springs to fully attach to the Rail">setAttachmentRate</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a23a8705deff5cbbfa2915f56b88d3b35">spring_rate</a>);
<a name="l03044"></a>03044     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a5f3aa42a8723a89cb4302c48faf435ea">_break_force_set</a>)
<a name="l03045"></a>03045     {
<a name="l03046"></a>03046         slide_node.<a class="code" href="class_slide_node.html#aa24c32635f4321d6b2c705e9f68390b3" title="Force required to break the Node from the Rail.">setBreakForce</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a62aabeacd5968d1896ca3fbffee8c985">break_force</a>);
<a name="l03047"></a>03047     }
<a name="l03048"></a>03048     slide_node.<a class="code" href="class_slide_node.html#a7a772c740bf9fe5cb348cf9d7e3bb946" title="maximum distance this spring node is allowed to reach out for a Rail">setAttachmentDistance</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a43a6fe5e7bbed69a4eb578b62e68e4bc">max_attachment_distance</a>);
<a name="l03049"></a>03049 
<a name="l03050"></a>03050     <span class="comment">/* Constraints */</span>
<a name="l03051"></a>03051     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a555deae76d227f639fa29827dc0c01d9">constraint_flags</a>, RigDef::SlideNode::CONSTRAINT_ATTACH_ALL))
<a name="l03052"></a>03052     {
<a name="l03053"></a>03053         slide_node.<a class="code" href="class_slide_node.html#a5db88b8bdb7a128da91a18514ceac2d3">setAttachRule</a>( <a class="code" href="_slide_node_8h.html#ac9ece25e8276b025084d546f297446bf" title="attach/detach to any rail, on the current vehicle or others">ATTACH_ALL</a> );
<a name="l03054"></a>03054     }
<a name="l03055"></a>03055     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a555deae76d227f639fa29827dc0c01d9">constraint_flags</a>, RigDef::SlideNode::CONSTRAINT_ATTACH_SELF))
<a name="l03056"></a>03056     {
<a name="l03057"></a>03057         slide_node.<a class="code" href="class_slide_node.html#a5db88b8bdb7a128da91a18514ceac2d3">setAttachRule</a>( <a class="code" href="_slide_node_8h.html#a920abd283050f0336339afd957a08229" title="attach/detach to rails on the current vehicle only">ATTACH_SELF</a> );
<a name="l03058"></a>03058     }
<a name="l03059"></a>03059     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a555deae76d227f639fa29827dc0c01d9">constraint_flags</a>, RigDef::SlideNode::CONSTRAINT_ATTACH_FOREIGN))
<a name="l03060"></a>03060     {
<a name="l03061"></a>03061         slide_node.<a class="code" href="class_slide_node.html#a5db88b8bdb7a128da91a18514ceac2d3">setAttachRule</a>( <a class="code" href="_slide_node_8h.html#a0d5081d994483c49bc9c7e25edc3ece6" title="attach/detach to rails only on other vehicles">ATTACH_FOREIGN</a> );
<a name="l03062"></a>03062     }
<a name="l03063"></a>03063     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a555deae76d227f639fa29827dc0c01d9">constraint_flags</a>, RigDef::SlideNode::CONSTRAINT_ATTACH_NONE))
<a name="l03064"></a>03064     {
<a name="l03065"></a>03065         slide_node.<a class="code" href="class_slide_node.html#a5db88b8bdb7a128da91a18514ceac2d3">setAttachRule</a>( <a class="code" href="_slide_node_8h.html#aa28e5cadc266846cc2f49ee2985f3fb7" title="can only be attached to rail specified at start">ATTACH_NONE</a> );
<a name="l03066"></a>03066     }
<a name="l03067"></a>03067 
<a name="l03068"></a>03068     <span class="comment">/* RailGroup */</span>
<a name="l03069"></a>03069     <a class="code" href="class_rail_group.html">RailGroup</a> *rail_group = <span class="keyword">nullptr</span>;
<a name="l03070"></a>03070     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_slide_node.html#a2429f664acf0ed69c546262274e2b134">_railgroup_id_set</a>)
<a name="l03071"></a>03071     {
<a name="l03072"></a>03072         std::vector&lt;RailGroup*&gt;::iterator itor = m_rig-&gt;mRailGroups.begin();
<a name="l03073"></a>03073         <span class="keywordflow">for</span> ( ; itor != m_rig-&gt;mRailGroups.end(); itor++)
<a name="l03074"></a>03074         {
<a name="l03075"></a>03075             <span class="keywordflow">if</span> ((*itor)-&gt;getID() == def.<a class="code" href="struct_rig_def_1_1_slide_node.html#ad0286cca02f9e759734177f5a6ff79ef">railgroup_id</a>)
<a name="l03076"></a>03076             {
<a name="l03077"></a>03077                 rail_group = *itor;
<a name="l03078"></a>03078                 <span class="keywordflow">break</span>;
<a name="l03079"></a>03079             }
<a name="l03080"></a>03080         }
<a name="l03081"></a>03081 
<a name="l03082"></a>03082         <span class="keywordflow">if</span> (rail_group == <span class="keyword">nullptr</span>)
<a name="l03083"></a>03083         {
<a name="l03084"></a>03084             std::stringstream msg;
<a name="l03085"></a>03085             msg &lt;&lt; <span class="stringliteral">&quot;Specified rail group id &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_slide_node.html#ad0286cca02f9e759734177f5a6ff79ef">railgroup_id</a> &lt;&lt; <span class="stringliteral">&quot;&#39; not found. Ignoring slidenode...&quot;</span>;
<a name="l03086"></a>03086             AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l03087"></a>03087             <span class="keywordflow">return</span>;
<a name="l03088"></a>03088         }
<a name="l03089"></a>03089     }
<a name="l03090"></a>03090     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_slide_node.html#ae0e327c404999401b78796111441ee6d">rail_node_ranges</a>.size() &gt; 0)
<a name="l03091"></a>03091     {
<a name="l03092"></a>03092         <a class="code" href="class_rail.html">Rail</a> *rail = CreateRail(def.<a class="code" href="struct_rig_def_1_1_slide_node.html#ae0e327c404999401b78796111441ee6d">rail_node_ranges</a>);
<a name="l03093"></a>03093         <span class="keywordflow">if</span> (rail == <span class="keyword">nullptr</span>)
<a name="l03094"></a>03094         {
<a name="l03095"></a>03095             <span class="keywordflow">return</span>;
<a name="l03096"></a>03096         }
<a name="l03097"></a>03097         rail_group = <span class="keyword">new</span> <a class="code" href="class_rail_group.html">RailGroup</a>(rail);
<a name="l03098"></a>03098         m_rig-&gt;mRailGroups.push_back(rail_group);
<a name="l03099"></a>03099     }
<a name="l03100"></a>03100     <span class="keywordflow">else</span>
<a name="l03101"></a>03101     {
<a name="l03102"></a>03102         AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;No RailGroup available for SlideNode, skipping...&quot;</span>);
<a name="l03103"></a>03103     }
<a name="l03104"></a>03104 
<a name="l03105"></a>03105     slide_node.<a class="code" href="class_slide_node.html#a1e7f3cdbbe2d0ae1085caa1207882355">setDefaultRail</a>(rail_group);
<a name="l03106"></a>03106     m_rig-&gt;mSlideNodes.push_back(slide_node);
<a name="l03107"></a>03107 }
<a name="l03108"></a>03108 
<a name="l03109"></a><a class="code" href="class_rig_spawner.html#aee93dd5365fb7c0e9db48198ecaa65d8">03109</a> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#aee93dd5365fb7c0e9db48198ecaa65d8">RigSpawner::FindNodeIndex</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> &amp; node_ref, <span class="keywordtype">bool</span> silent <span class="comment">/* Default: false */</span>)
<a name="l03110"></a>03110 {
<a name="l03111"></a>03111     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03112"></a>03112 
<a name="l03113"></a>03113     std::pair&lt;unsigned int, bool&gt; result = GetNodeIndex(node_ref, <span class="comment">/* quiet */</span> <span class="keyword">true</span>);
<a name="l03114"></a>03114     <span class="keywordflow">if</span> (result.second)
<a name="l03115"></a>03115     {
<a name="l03116"></a>03116         <span class="keywordflow">return</span> <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(result.first);
<a name="l03117"></a>03117     }
<a name="l03118"></a>03118     <span class="keywordflow">else</span>
<a name="l03119"></a>03119     {
<a name="l03120"></a>03120         <span class="keywordflow">if</span> (! silent)
<a name="l03121"></a>03121         {
<a name="l03122"></a>03122             std::stringstream msg;
<a name="l03123"></a>03123             msg &lt;&lt; <span class="stringliteral">&quot;Failed to find node by reference: &quot;</span> &lt;&lt; node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>();
<a name="l03124"></a>03124             AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l03125"></a>03125         }
<a name="l03126"></a>03126         <span class="keywordflow">return</span> -1; <span class="comment">/* Node not found */</span>
<a name="l03127"></a>03127     }
<a name="l03128"></a>03128 }
<a name="l03129"></a>03129 
<a name="l03130"></a><a class="code" href="class_rig_spawner.html#a6c13c01e641d8c82b599ed03f4281446">03130</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a6c13c01e641d8c82b599ed03f4281446">RigSpawner::CollectNodesFromRanges</a>(
<a name="l03131"></a>03131     std::vector&lt;RigDef::Node::Range&gt; &amp; node_ranges,
<a name="l03132"></a>03132     std::vector&lt;unsigned int&gt; &amp; out_node_indices
<a name="l03133"></a>03133     )
<a name="l03134"></a>03134 {
<a name="l03135"></a>03135     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03136"></a>03136 
<a name="l03137"></a>03137     std::vector&lt;RigDef::Node::Range&gt;::iterator itor = node_ranges.begin();
<a name="l03138"></a>03138     <span class="keywordflow">for</span> ( ; itor != node_ranges.end(); itor++)
<a name="l03139"></a>03139     {
<a name="l03140"></a>03140         <span class="keywordflow">if</span> (itor-&gt;IsRange())
<a name="l03141"></a>03141         {
<a name="l03142"></a>03142 
<a name="l03143"></a>03143             <span class="keywordtype">int</span> result_a = FindNodeIndex(itor-&gt;start, <span class="comment">/* silent */</span> <span class="keyword">false</span>);
<a name="l03144"></a>03144             <span class="keywordtype">int</span> result_b = FindNodeIndex(itor-&gt;end,   <span class="comment">/* silent */</span> <span class="keyword">true</span>);
<a name="l03145"></a>03145 
<a name="l03146"></a>03146             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> start = 0;
<a name="l03147"></a>03147             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> end = 0;
<a name="l03148"></a>03148 
<a name="l03149"></a>03149             <span class="keywordflow">if</span> (result_a == -1)
<a name="l03150"></a>03150             {
<a name="l03151"></a>03151                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03152"></a>03152             }
<a name="l03153"></a>03153             <span class="keywordflow">else</span>
<a name="l03154"></a>03154             {
<a name="l03155"></a>03155                 start = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(result_a);
<a name="l03156"></a>03156             }
<a name="l03157"></a>03157 
<a name="l03158"></a>03158             <span class="keywordflow">if</span> (result_b == -1)
<a name="l03159"></a>03159             {
<a name="l03160"></a>03160                 std::stringstream msg;
<a name="l03161"></a>03161                 msg &lt;&lt; <span class="stringliteral">&quot;Encountered non-existent node &#39;&quot;</span> &lt;&lt; itor-&gt;end.ToString() &lt;&lt; <span class="stringliteral">&quot;&#39; in range [&quot;</span> &lt;&lt; itor-&gt;start.ToString() &lt;&lt; <span class="stringliteral">&quot; - &quot;</span> &lt;&lt; itor-&gt;end.ToString() &lt;&lt; <span class="stringliteral">&quot;], &quot;</span>
<a name="l03162"></a>03162                     &lt;&lt; <span class="stringliteral">&quot;highest node index is &#39;&quot;</span> &lt;&lt; m_rig-&gt;free_node - 1 &lt;&lt; <span class="stringliteral">&quot;&#39;.&quot;</span>;
<a name="l03163"></a>03163 
<a name="l03164"></a>03164                 <span class="keywordflow">if</span> (itor-&gt;end.Str().empty()) <span class="comment">/* If the node is numeric... */</span>
<a name="l03165"></a>03165                 {
<a name="l03166"></a>03166                     msg &lt;&lt; <span class="stringliteral">&quot; However, this node must be accepted anyway for backwards compatibility.&quot;</span>
<a name="l03167"></a>03167                         &lt;&lt; <span class="stringliteral">&quot; Please fix this as soon as possible.&quot;</span>;
<a name="l03168"></a>03168                     end = itor-&gt;end.Num();
<a name="l03169"></a>03169                     AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l03170"></a>03170                 }
<a name="l03171"></a>03171                 <span class="keywordflow">else</span>
<a name="l03172"></a>03172                 {
<a name="l03173"></a>03173                     AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l03174"></a>03174                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l03175"></a>03175                 }
<a name="l03176"></a>03176             }
<a name="l03177"></a>03177             <span class="keywordflow">else</span>
<a name="l03178"></a>03178             {
<a name="l03179"></a>03179                 end = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(result_b);
<a name="l03180"></a>03180             }
<a name="l03181"></a>03181 
<a name="l03182"></a>03182             <span class="keywordflow">if</span> (end &lt; start)
<a name="l03183"></a>03183             {
<a name="l03184"></a>03184                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> swap = start;
<a name="l03185"></a>03185                 start = end;
<a name="l03186"></a>03186                 end = swap;
<a name="l03187"></a>03187             }
<a name="l03188"></a>03188 
<a name="l03189"></a>03189             <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = start; i &lt;= end; i++)
<a name="l03190"></a>03190             {
<a name="l03191"></a>03191                 out_node_indices.push_back(i);
<a name="l03192"></a>03192             }
<a name="l03193"></a>03193         }
<a name="l03194"></a>03194         <span class="keywordflow">else</span>
<a name="l03195"></a>03195         {
<a name="l03196"></a>03196             out_node_indices.push_back(GetNodeIndexOrThrow(itor-&gt;start));
<a name="l03197"></a>03197         }
<a name="l03198"></a>03198     }
<a name="l03199"></a>03199     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l03200"></a>03200 }
<a name="l03201"></a>03201 
<a name="l03202"></a><a class="code" href="class_rig_spawner.html#afd2ecae23210ddf4f25a16677963589e">03202</a> <a class="code" href="class_rail.html">Rail</a> *<a class="code" href="class_rig_spawner.html#afd2ecae23210ddf4f25a16677963589e">RigSpawner::CreateRail</a>(std::vector&lt;RigDef::Node::Range&gt; &amp; node_ranges)
<a name="l03203"></a>03203 {
<a name="l03204"></a>03204     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03205"></a>03205 
<a name="l03206"></a>03206     <span class="comment">/* Collect nodes */</span>
<a name="l03207"></a>03207     std::vector&lt;unsigned int&gt; node_indices;
<a name="l03208"></a>03208     node_indices.reserve(100);
<a name="l03209"></a>03209 
<a name="l03210"></a>03210     CollectNodesFromRanges(node_ranges, node_indices);
<a name="l03211"></a>03211 
<a name="l03212"></a>03212     <span class="comment">/* Find beams &amp;build rail */</span>
<a name="l03213"></a>03213     <a class="code" href="class_rail_builder.html">RailBuilder</a> rail_builder; <span class="comment">/* rail builder allocates the memory for each rail, it will not free it */</span>
<a name="l03214"></a>03214     <span class="keywordflow">if</span> (node_indices.front() == node_indices.back())
<a name="l03215"></a>03215     {
<a name="l03216"></a>03216         rail_builder.<a class="code" href="class_rail_builder.html#a01ed51af84de0c6bf4e610497185f2c0" title="wrapper method">loopRail</a>();
<a name="l03217"></a>03217     }
<a name="l03218"></a>03218 
<a name="l03219"></a>03219     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; node_indices.size() - 1; i++)
<a name="l03220"></a>03220     {
<a name="l03221"></a>03221         <a class="code" href="structbeam__t.html">beam_t</a> *beam = FindBeamInRig(node_indices[i], node_indices[i + 1]);
<a name="l03222"></a>03222         <span class="keywordflow">if</span> (beam == <span class="keyword">nullptr</span>)
<a name="l03223"></a>03223         {
<a name="l03224"></a>03224             std::stringstream msg;
<a name="l03225"></a>03225             msg &lt;&lt; <span class="stringliteral">&quot;No beam between nodes indexed &#39;&quot;</span> &lt;&lt; node_indices[i] &lt;&lt; <span class="stringliteral">&quot;&#39; and &#39;&quot;</span> &lt;&lt; node_indices[i + 1] &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l03226"></a>03226             AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l03227"></a>03227             <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l03228"></a>03228         }
<a name="l03229"></a>03229         rail_builder.<a class="code" href="class_rail_builder.html#a7a2bce672a41701e6908a9cea2139df6">pushBack</a>(beam);
<a name="l03230"></a>03230     }
<a name="l03231"></a>03231 
<a name="l03232"></a>03232     <span class="keywordflow">return</span> rail_builder.<a class="code" href="class_rail_builder.html#a4b49db641ae4ab3edf5d5567aeb57386">getCompletedRail</a>(); <span class="comment">/* Transfers memory ownership */</span>
<a name="l03233"></a>03233 }
<a name="l03234"></a>03234 
<a name="l03235"></a><a class="code" href="class_rig_spawner.html#a65076064eab3053ee05efbb068a17ca5">03235</a> <a class="code" href="structbeam__t.html">beam_t</a> *<a class="code" href="class_rig_spawner.html#a65076064eab3053ee05efbb068a17ca5">RigSpawner::FindBeamInRig</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_a_index, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_b_index)
<a name="l03236"></a>03236 {
<a name="l03237"></a>03237     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03238"></a>03238 
<a name="l03239"></a>03239     <a class="code" href="structnode__t.html">node_t</a> *node_a = &amp; m_rig-&gt;nodes[node_a_index];
<a name="l03240"></a>03240     <a class="code" href="structnode__t.html">node_t</a> *node_b = &amp; m_rig-&gt;nodes[node_b_index];
<a name="l03241"></a>03241 
<a name="l03242"></a>03242     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; static_cast&lt;unsigned int&gt;(m_rig-&gt;free_beam); i++)
<a name="l03243"></a>03243     {
<a name="l03244"></a>03244         <span class="keywordflow">if</span>  (
<a name="l03245"></a>03245                 (GetBeam(i).p1 == node_a &amp;&amp; GetBeam(i).p2 == node_b)
<a name="l03246"></a>03246             ||  (GetBeam(i).p2 == node_a &amp;&amp; GetBeam(i).p1 == node_b)
<a name="l03247"></a>03247             )
<a name="l03248"></a>03248         {
<a name="l03249"></a>03249             <span class="keywordflow">return</span> &amp; GetBeam(i);
<a name="l03250"></a>03250         }
<a name="l03251"></a>03251     }
<a name="l03252"></a>03252     <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l03253"></a>03253 }
<a name="l03254"></a>03254 
<a name="l03255"></a><a class="code" href="class_rig_spawner.html#a8e4ea854f11dd22badc2ff123ea60209">03255</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a8e4ea854f11dd22badc2ff123ea60209">RigSpawner::ProcessHook</a>(<a class="code" href="struct_rig_def_1_1_hook.html">RigDef::Hook</a> &amp; def)
<a name="l03256"></a>03256 {
<a name="l03257"></a>03257     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03258"></a>03258 
<a name="l03259"></a>03259     <span class="comment">/* Find the node */</span>
<a name="l03260"></a>03260     <a class="code" href="structnode__t.html">node_t</a> *node = GetNodePointer(def.<a class="code" href="struct_rig_def_1_1_hook.html#a01f2d5f1ab67a86f5a6845eb5515a94d">node</a>);
<a name="l03261"></a>03261     <span class="keywordflow">if</span> (node ==  <span class="keyword">nullptr</span>)
<a name="l03262"></a>03262     {
<a name="l03263"></a>03263         <span class="keywordflow">return</span>;
<a name="l03264"></a>03264     }
<a name="l03265"></a>03265     
<a name="l03266"></a>03266     <span class="comment">/* Find the hook */</span>
<a name="l03267"></a>03267     <a class="code" href="structhook__t.html">hook_t</a> *hook = <span class="keyword">nullptr</span>;
<a name="l03268"></a>03268     std::vector &lt;hook_t&gt;::iterator itor = m_rig-&gt;hooks.begin();
<a name="l03269"></a>03269     <span class="keywordflow">for</span> (; itor != m_rig-&gt;hooks.end(); itor++)
<a name="l03270"></a>03270     {
<a name="l03271"></a>03271         <span class="keywordflow">if</span> (itor-&gt;hookNode == node)
<a name="l03272"></a>03272         {
<a name="l03273"></a>03273             hook = &amp;*itor;
<a name="l03274"></a>03274             <span class="keywordflow">break</span>;
<a name="l03275"></a>03275         }
<a name="l03276"></a>03276     }
<a name="l03277"></a>03277 
<a name="l03278"></a>03278     <span class="keywordflow">if</span> (hook == <span class="keyword">nullptr</span>)
<a name="l03279"></a>03279     {
<a name="l03280"></a>03280         std::stringstream msg;
<a name="l03281"></a>03281         msg &lt;&lt; <span class="stringliteral">&quot;Node &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_hook.html#a01f2d5f1ab67a86f5a6845eb5515a94d">node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>() &lt;&lt; <span class="stringliteral">&quot;&#39; is not a hook-node (not marked with flag &#39;h&#39;), ignoring...&quot;</span>;
<a name="l03282"></a>03282         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l03283"></a>03283         <span class="keywordflow">return</span>;
<a name="l03284"></a>03284     }
<a name="l03285"></a>03285 
<a name="l03286"></a>03286     <span class="comment">/* Process options */</span>
<a name="l03287"></a>03287     hook-&gt;<a class="code" href="structhook__t.html#aa973528b0525d1a6d31dcf84552b214b">lockrange</a> = def.<a class="code" href="struct_rig_def_1_1_hook.html#ac3636e93d80f1661fc35d0f11e9962a7">option_hook_range</a>;
<a name="l03288"></a>03288     hook-&gt;<a class="code" href="structhook__t.html#a95bb8b2ced0b0557fe3a5ba37b6673e7">lockspeed</a> = def.<a class="code" href="struct_rig_def_1_1_hook.html#aaeee104bc6070537c7a94dc4087a4f23">option_speed_coef</a> * <a class="code" href="_beam_data_8h.html#a9a66d793c818665dbc71fa6dd2cdd7fa">HOOK_SPEED_DEFAULT</a>;
<a name="l03289"></a>03289     hook-&gt;<a class="code" href="structhook__t.html#a4dbd0e551163d656c302c709da09c0d0">maxforce</a>  = def.<a class="code" href="struct_rig_def_1_1_hook.html#a097d4679b1e15280132d779875b1f738">option_max_force</a>;
<a name="l03290"></a>03290     hook-&gt;<a class="code" href="structhook__t.html#a43430cce00fdb5ed7418458f1c572c84">group</a>     = def.<a class="code" href="struct_rig_def_1_1_hook.html#a811b7a7360afc101c1eab7112a9fb3bc">option_hookgroup</a>;
<a name="l03291"></a>03291     hook-&gt;<a class="code" href="structhook__t.html#ad70c41204141991e5686bad7dc566279">lockgroup</a> = def.<a class="code" href="struct_rig_def_1_1_hook.html#a40a5ee3b921373bb4cbd5047225bfc9b">option_lockgroup</a>;
<a name="l03292"></a>03292     hook-&gt;<a class="code" href="structhook__t.html#a3bebb9e9433d7cd3ccdf7dc04d3420ea">timer</a>     = 0.f; <span class="comment">// Hardcoded in BTS_HOOKS</span>
<a name="l03293"></a>03293     hook-&gt;<a class="code" href="structhook__t.html#aa63e9bc8212cf7f280651ed33ecd4174">timer_preset</a> = def.<a class="code" href="struct_rig_def_1_1_hook.html#aad124f3192fff9addc2ecbecb8c8eec6">option_timer</a>;
<a name="l03294"></a>03294     hook-&gt;<a class="code" href="structhook__t.html#ab206cc031a404ae1ab75e2533f1cc618">beam</a>-&gt;<a class="code" href="structbeam__t.html#a49deacaa83d59050c7613aa9d3c486b7">commandShort</a> = def.<a class="code" href="struct_rig_def_1_1_hook.html#a3b467ae3c087117ded123c54f1cc790f">option_minimum_range_meters</a>;
<a name="l03295"></a>03295     hook-&gt;<a class="code" href="structhook__t.html#aff82f72e9d013b3af885ee2d852b7280">selflock</a> = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_hook.html#aeae478518568ac4c0c8a2be16745c744">flags</a>, RigDef::Hook::FLAG_SELF_LOCK);
<a name="l03296"></a>03296     hook-&gt;<a class="code" href="structhook__t.html#a190579b61f34bc5e3a0c9d5e3295ac54">nodisable</a> = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_hook.html#aeae478518568ac4c0c8a2be16745c744">flags</a>, RigDef::Hook::FLAG_NO_DISABLE);
<a name="l03297"></a>03297     hook-&gt;<a class="code" href="structhook__t.html#ae6610b5315de112dd406e5daff464a9b">is_hook_visible</a> = <span class="keyword">false</span>;
<a name="l03298"></a>03298     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_hook.html#aeae478518568ac4c0c8a2be16745c744">flags</a>, RigDef::Hook::FLAG_AUTO_LOCK))
<a name="l03299"></a>03299     {
<a name="l03300"></a>03300         hook-&gt;<a class="code" href="structhook__t.html#a4f30c362e2e4c9f63f0d38aa16de000b">autolock</a> = <span class="keyword">true</span>;
<a name="l03301"></a>03301         <span class="keywordflow">if</span> (hook-&gt;<a class="code" href="structhook__t.html#a43430cce00fdb5ed7418458f1c572c84">group</a> == -1)
<a name="l03302"></a>03302         {
<a name="l03303"></a>03303             hook-&gt;<a class="code" href="structhook__t.html#a43430cce00fdb5ed7418458f1c572c84">group</a> = -2; <span class="comment">/* only overwrite hgroup when its still default (-1) */</span>
<a name="l03304"></a>03304         }
<a name="l03305"></a>03305     }
<a name="l03306"></a>03306     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_hook.html#aeae478518568ac4c0c8a2be16745c744">flags</a>, RigDef::Hook::FLAG_NO_ROPE))
<a name="l03307"></a>03307     {
<a name="l03308"></a>03308         hook-&gt;<a class="code" href="structhook__t.html#ab206cc031a404ae1ab75e2533f1cc618">beam</a>-&gt;<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a69c3572873654b06119fef77969e4711" title="not a shock">NOSHOCK</a>;
<a name="l03309"></a>03309     }
<a name="l03310"></a>03310     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_hook.html#aeae478518568ac4c0c8a2be16745c744">flags</a>, RigDef::Hook::FLAG_VISIBLE))
<a name="l03311"></a>03311     {
<a name="l03312"></a>03312         hook-&gt;<a class="code" href="structhook__t.html#ae6610b5315de112dd406e5daff464a9b">is_hook_visible</a> = <span class="keyword">true</span>;
<a name="l03313"></a>03313         <span class="keywordflow">if</span> (hook-&gt;<a class="code" href="structhook__t.html#ab206cc031a404ae1ab75e2533f1cc618">beam</a>-&gt;<a class="code" href="structbeam__t.html#a75eba7838bbbca59b4fdedd6c1c8df20" title="visual">mSceneNode</a>-&gt;numAttachedObjects() == 0)
<a name="l03314"></a>03314         {
<a name="l03315"></a>03315             hook-&gt;<a class="code" href="structhook__t.html#ab206cc031a404ae1ab75e2533f1cc618">beam</a>-&gt;<a class="code" href="structbeam__t.html#a75eba7838bbbca59b4fdedd6c1c8df20" title="visual">mSceneNode</a>-&gt;attachObject(hook-&gt;<a class="code" href="structhook__t.html#ab206cc031a404ae1ab75e2533f1cc618">beam</a>-&gt;<a class="code" href="structbeam__t.html#aff519520e0a0495a4d6d895fca408c83" title="visual">mEntity</a>);
<a name="l03316"></a>03316         }
<a name="l03317"></a>03317     }
<a name="l03318"></a>03318 }
<a name="l03319"></a>03319 
<a name="l03320"></a><a class="code" href="class_rig_spawner.html#aef77411c75ecb73eeeb5272b086d0d0a">03320</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aef77411c75ecb73eeeb5272b086d0d0a">RigSpawner::ProcessLockgroup</a>(<a class="code" href="struct_rig_def_1_1_lockgroup.html">RigDef::Lockgroup</a> &amp; lockgroup)
<a name="l03321"></a>03321 {
<a name="l03322"></a>03322     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03323"></a>03323 
<a name="l03324"></a>03324     <span class="keyword">auto</span> itor = lockgroup.<a class="code" href="struct_rig_def_1_1_lockgroup.html#aade1cceb5aab1c7f5ddda0e414ef7e68">nodes</a>.begin();
<a name="l03325"></a>03325     <span class="keyword">auto</span> end  = lockgroup.<a class="code" href="struct_rig_def_1_1_lockgroup.html#aade1cceb5aab1c7f5ddda0e414ef7e68">nodes</a>.end();
<a name="l03326"></a>03326     <span class="keywordflow">for</span> (; itor != end; ++itor)
<a name="l03327"></a>03327     {
<a name="l03328"></a>03328         GetNodeOrThrow(*itor).lockgroup = lockgroup.<a class="code" href="struct_rig_def_1_1_lockgroup.html#a444542fc9687a13e294f5465738bc71d">number</a>;
<a name="l03329"></a>03329     }
<a name="l03330"></a>03330 }
<a name="l03331"></a>03331 
<a name="l03332"></a><a class="code" href="class_rig_spawner.html#a647a78efc082c2d22d7fd6de5fbfad2d">03332</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a647a78efc082c2d22d7fd6de5fbfad2d">RigSpawner::ProcessTrigger</a>(<a class="code" href="struct_rig_def_1_1_trigger.html">RigDef::Trigger</a> &amp; def)
<a name="l03333"></a>03333 {
<a name="l03334"></a>03334     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03335"></a>03335 
<a name="l03336"></a>03336     <span class="keywordflow">if</span> (! CheckBeamLimit(1) || ! CheckShockLimit(1))
<a name="l03337"></a>03337     {
<a name="l03338"></a>03338         <span class="keywordflow">return</span>;
<a name="l03339"></a>03339     }
<a name="l03340"></a>03340 
<a name="l03341"></a>03341     <a class="code" href="structshock__t.html">shock_t</a> &amp; shock = this-&gt;GetFreeShock();
<a name="l03342"></a>03342 
<a name="l03343"></a>03343     <span class="comment">// Disable trigger on startup? (default enabled)</span>
<a name="l03344"></a>03344     shock.<a class="code" href="structshock__t.html#afa81f342fd8cba8fc4c929026fb7e87c" title="general trigger,switch and blocker state">trigger_enabled</a> = !def.HasFlag_x_StartDisabled();
<a name="l03345"></a>03345 
<a name="l03346"></a>03346     m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a>].trigger_cmdkeyblock_state = <span class="keyword">false</span>;
<a name="l03347"></a>03347     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a> != -1)
<a name="l03348"></a>03348     {
<a name="l03349"></a>03349         m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a>].trigger_cmdkeyblock_state = <span class="keyword">false</span>;
<a name="l03350"></a>03350     }
<a name="l03351"></a>03351 
<a name="l03352"></a>03352     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03353"></a>03353     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shock_flags = <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da018fcd7fd5a8c7ba2dcbbaa35910cfeb">SHOCK_FLAG_NORMAL</a> | <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291dace2072759bef3459eb690b6d87e220f6">SHOCK_FLAG_ISTRIGGER</a>;
<a name="l03354"></a>03354     <span class="keywordtype">float</span> short_limit = def.<a class="code" href="struct_rig_def_1_1_trigger.html#a91c37e7be551f412ee1a86b64279c6a6">contraction_trigger_limit</a>;
<a name="l03355"></a>03355     <span class="keywordtype">float</span> long_limit = def.<a class="code" href="struct_rig_def_1_1_trigger.html#ab05ed575c633037c2d93b662e1b85076">expansion_trigger_limit</a>;
<a name="l03356"></a>03356 
<a name="l03357"></a>03357     <span class="keywordflow">if</span> (def.HasFlag_i_Invisible())
<a name="l03358"></a>03358     {
<a name="l03359"></a>03359         hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>;
<a name="l03360"></a>03360         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da86aa4d52e258bb9715a49015a1d7fe53">SHOCK_FLAG_INVISIBLE</a>);
<a name="l03361"></a>03361     }
<a name="l03362"></a>03362     <span class="keywordflow">if</span> (def.HasFlag_B_TriggerBlocker())
<a name="l03363"></a>03363     {
<a name="l03364"></a>03364         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da750aac5184949d10d1b22bb48b8a5738">SHOCK_FLAG_TRG_BLOCKER</a>);
<a name="l03365"></a>03365     }
<a name="l03366"></a>03366     <span class="keywordflow">if</span> (def.HasFlag_s_CmdNumSwitch()) <span class="comment">// switch that exchanges cmdshort/cmdshort for all triggers with the same commandnumbers, default false</span>
<a name="l03367"></a>03367     {
<a name="l03368"></a>03368         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da006f4edd64708a17c9194f66e3d0b9b2">SHOCK_FLAG_TRG_CMD_SWITCH</a>);
<a name="l03369"></a>03369     }
<a name="l03370"></a>03370     <span class="keywordflow">if</span> (def.HasFlag_c_CommandStyle()) <span class="comment">// // trigger is set with commandstyle boundaries instead of shocksytle</span>
<a name="l03371"></a>03371     {
<a name="l03372"></a>03372         short_limit = abs(short_limit - 1);
<a name="l03373"></a>03373         long_limit = long_limit - 1;
<a name="l03374"></a>03374     }
<a name="l03375"></a>03375     <span class="keywordflow">if</span> (def.HasFlag_A_InvTriggerBlocker()) <span class="comment">// Blocker that enable/disable other triggers, reversed activation method (inverted Blocker style, auto-ON)</span>
<a name="l03376"></a>03376     {
<a name="l03377"></a>03377         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da46a1b17c09f4f2011125ef447c739bfb">SHOCK_FLAG_TRG_BLOCKER_A</a>);
<a name="l03378"></a>03378     }
<a name="l03379"></a>03379     <span class="keywordflow">if</span> (def.HasFlag_h_UnlocksHookGroup())
<a name="l03380"></a>03380     {
<a name="l03381"></a>03381         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da19e4a5e8e794de544fd7b5ec6e0c7fef">SHOCK_FLAG_TRG_HOOK_UNLOCK</a>);
<a name="l03382"></a>03382     }
<a name="l03383"></a>03383     <span class="keywordflow">if</span> (def.HasFlag_H_LocksHookGroup())
<a name="l03384"></a>03384     {
<a name="l03385"></a>03385         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291dab6761a51bbbee7260167a7525000ff4c">SHOCK_FLAG_TRG_HOOK_LOCK</a>);
<a name="l03386"></a>03386     }
<a name="l03387"></a>03387     <span class="keywordflow">if</span> (def.HasFlag_t_Continuous())
<a name="l03388"></a>03388     {
<a name="l03389"></a>03389         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da5336999ccba60f66bcd4e85105c0e664">SHOCK_FLAG_TRG_CONTINUOUS</a>); <span class="comment">// this trigger sends values between 0 and 1</span>
<a name="l03390"></a>03390     }
<a name="l03391"></a>03391     <span class="keywordflow">if</span> (def.HasFlag_E_EngineTrigger())
<a name="l03392"></a>03392     {
<a name="l03393"></a>03393         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da996efb4592191352e6026e34b70b293f">SHOCK_FLAG_TRG_ENGINE</a>);
<a name="l03394"></a>03394     }
<a name="l03395"></a>03395 
<a name="l03396"></a>03396     <span class="comment">// Checks</span>
<a name="l03397"></a>03397     <span class="keywordflow">if</span> (!def.<a class="code" href="struct_rig_def_1_1_trigger.html#a9289882a3ad6be2221eb10a9a5f7e638">IsTriggerBlockerAnyType</a>() &amp;&amp; !def.<a class="code" href="struct_rig_def_1_1_trigger.html#a781493c1eee518042e4503faa8f8697b">IsHookToggleTrigger</a>() &amp;&amp; !def.HasFlag_E_EngineTrigger())
<a name="l03398"></a>03398     {
<a name="l03399"></a>03399         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a> &lt; 1 || def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a> &gt; <a class="code" href="_beam_data_8h.html#ab666a57e1a89c01fb894ac44469612ba" title="maximum number of commands per truck">MAX_COMMANDS</a>)
<a name="l03400"></a>03400         {
<a name="l03401"></a>03401             std::stringstream msg;
<a name="l03402"></a>03402             msg &lt;&lt; <span class="stringliteral">&quot;Invalid value of &#39;shortbound_trigger_action&#39;: &#39;&quot;</span> &lt;&lt; def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a> &lt;&lt; <span class="stringliteral">&quot;&#39;. Must be between 1 and &quot;</span>&lt;&lt;<a class="code" href="_beam_data_8h.html#ab666a57e1a89c01fb894ac44469612ba" title="maximum number of commands per truck">MAX_COMMANDS</a>&lt;&lt;<span class="stringliteral">&quot;. Ignoring trigger.&quot;</span>;
<a name="l03403"></a>03403             AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l03404"></a>03404             <span class="keywordflow">return</span>;
<a name="l03405"></a>03405         }
<a name="l03406"></a>03406     }
<a name="l03407"></a>03407     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!def.<a class="code" href="struct_rig_def_1_1_trigger.html#a781493c1eee518042e4503faa8f8697b">IsHookToggleTrigger</a>() &amp;&amp; !def.HasFlag_E_EngineTrigger())
<a name="l03408"></a>03408     {
<a name="l03409"></a>03409         <span class="comment">// this is a Trigger-Blocker, make special check</span>
<a name="l03410"></a>03410         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a> &lt; 0 || def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a> &lt; 0)
<a name="l03411"></a>03411         {
<a name="l03412"></a>03412             AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Wrong command-eventnumber (Triggers). Trigger-Blocker deactivated.&quot;</span>);
<a name="l03413"></a>03413             <span class="keywordflow">return</span>;
<a name="l03414"></a>03414         }
<a name="l03415"></a>03415     }
<a name="l03416"></a>03416     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.HasFlag_E_EngineTrigger())
<a name="l03417"></a>03417     {
<a name="l03418"></a>03418         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_trigger.html#a9289882a3ad6be2221eb10a9a5f7e638">IsTriggerBlockerAnyType</a>() || def.<a class="code" href="struct_rig_def_1_1_trigger.html#a781493c1eee518042e4503faa8f8697b">IsHookToggleTrigger</a>() || def.HasFlag_s_CmdNumSwitch())
<a name="l03419"></a>03419         {
<a name="l03420"></a>03420             AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Wrong command-eventnumber (Triggers). Engine trigger deactivated.&quot;</span>);
<a name="l03421"></a>03421             <span class="keywordflow">return</span>;
<a name="l03422"></a>03422         }
<a name="l03423"></a>03423     }
<a name="l03424"></a>03424 
<a name="l03425"></a>03425     <span class="keywordtype">int</span> node_1_index = FindNodeIndex(def.<a class="code" href="struct_rig_def_1_1_trigger.html#ac9e97e57ca35830dfc5f0638b93f5c29">nodes</a>[0]);
<a name="l03426"></a>03426     <span class="keywordtype">int</span> node_2_index = FindNodeIndex(def.<a class="code" href="struct_rig_def_1_1_trigger.html#ac9e97e57ca35830dfc5f0638b93f5c29">nodes</a>[1]);
<a name="l03427"></a>03427     <span class="keywordflow">if</span> (node_1_index == -1 || node_2_index == -1 )
<a name="l03428"></a>03428     {
<a name="l03429"></a>03429         <span class="keywordflow">return</span>;
<a name="l03430"></a>03430     }
<a name="l03431"></a>03431     <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l03432"></a>03432     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(GetNode(node_1_index), GetNode(node_2_index), def.<a class="code" href="struct_rig_def_1_1_trigger.html#a0d687343e9148e57e15b47603222cb9a">beam_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_trigger.html#aae9e84cd4486b3dab1de194a7039359c">detacher_group</a>);
<a name="l03433"></a>03433     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = hydro_type;
<a name="l03434"></a>03434     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_trigger.html#a0d687343e9148e57e15b47603222cb9a">beam_defaults</a>-&gt;breaking_threshold_constant);
<a name="l03435"></a>03435     SetBeamSpring(beam, 0.f);
<a name="l03436"></a>03436     SetBeamDamping(beam, 0.f);
<a name="l03437"></a>03437     CalculateBeamLength(beam);
<a name="l03438"></a>03438     beam.<a class="code" href="structbeam__t.html#af85ad7bcb782f7fcab155bc93ddcc27d">shortbound</a> = short_limit;
<a name="l03439"></a>03439     beam.<a class="code" href="structbeam__t.html#a4acafe687c44c7f729c2fafd9a8f3e3d">longbound</a> = long_limit;
<a name="l03440"></a>03440     beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a696845de03029f4206a9af01e8c13c69" title="shock2">SHOCK2</a>;
<a name="l03441"></a>03441     beam.<a class="code" href="structbeam__t.html#a398694fbd7b6f46eab876121d69ee02f">shock</a> = &amp;shock;
<a name="l03442"></a>03442     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a> = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l03443"></a>03443 
<a name="l03444"></a>03444     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_trigger.html#a0d687343e9148e57e15b47603222cb9a">beam_defaults</a>, hydro_type != <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>);
<a name="l03445"></a>03445 
<a name="l03446"></a>03446     <span class="keywordflow">if</span> (m_rig-&gt;triggerdebug)
<a name="l03447"></a>03447     {
<a name="l03448"></a>03448         <a class="code" href="_ro_r_prerequisites_8h.html#af855c94dc540e943632089ce7496faac">LOG</a>(<span class="stringliteral">&quot;Trigger added. BeamID &quot;</span> + <a class="code" href="_ro_r_prerequisites_8h.html#a9063e80f8777300c93afde6e6f4c9cea">TOSTRING</a>(beam_index));
<a name="l03449"></a>03449     }
<a name="l03450"></a>03450 
<a name="l03451"></a>03451     shock.<a class="code" href="structshock__t.html#aed2e4a946f40231f4fa8cff04717409b">beamid</a> = beam_index;
<a name="l03452"></a>03452     shock.<a class="code" href="structshock__t.html#af78a298380572b49c4db90d54476059b" title="needed to avoid doubleswitch, bool and timer in one">trigger_switch_state</a> = 0.0f;   <span class="comment">// used as bool and countdowntimer, dont touch!</span>
<a name="l03453"></a>03453 
<a name="l03454"></a>03454     <span class="keywordflow">if</span> (!def.<a class="code" href="struct_rig_def_1_1_trigger.html#a9289882a3ad6be2221eb10a9a5f7e638">IsTriggerBlockerAnyType</a>())
<a name="l03455"></a>03455     {
<a name="l03456"></a>03456         shock.<a class="code" href="structshock__t.html#ae869bbe5210ce7a640aaf9551a367ca3" title="F-key for trigger injection shortbound-check.">trigger_cmdshort</a> = def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a>;
<a name="l03457"></a>03457         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a> != -1 || (def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a> == -1 &amp;&amp; def.<a class="code" href="struct_rig_def_1_1_trigger.html#a781493c1eee518042e4503faa8f8697b">IsHookToggleTrigger</a>()))
<a name="l03458"></a>03458         {
<a name="l03459"></a>03459             <span class="comment">// this is a trigger or a hook_toggle</span>
<a name="l03460"></a>03460             shock.<a class="code" href="structshock__t.html#aa025f0766bbdda7b2848396d03c5ed73" title="F-key for trigger injection longbound-check.">trigger_cmdlong</a> = def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a>;
<a name="l03461"></a>03461         }
<a name="l03462"></a>03462         <span class="keywordflow">else</span>
<a name="l03463"></a>03463         {
<a name="l03464"></a>03464             <span class="comment">// this is a commandkeyblocker</span>
<a name="l03465"></a>03465             shock_flags |= <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291dac91264c3ea9ec3109d7404e46b248089">SHOCK_FLAG_TRG_CMD_BLOCKER</a>;
<a name="l03466"></a>03466         }
<a name="l03467"></a>03467     } 
<a name="l03468"></a>03468     <span class="keywordflow">else</span> 
<a name="l03469"></a>03469     {
<a name="l03470"></a>03470         <span class="comment">// this is a trigger_blocker</span>
<a name="l03471"></a>03471         <span class="keywordflow">if</span> (!def.HasFlag_A_InvTriggerBlocker())
<a name="l03472"></a>03472         {
<a name="l03473"></a>03473             <span class="comment">//normal BLOCKER</span>
<a name="l03474"></a>03474             shock_flags |= <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da750aac5184949d10d1b22bb48b8a5738">SHOCK_FLAG_TRG_BLOCKER</a>;
<a name="l03475"></a>03475             shock.<a class="code" href="structshock__t.html#ae869bbe5210ce7a640aaf9551a367ca3" title="F-key for trigger injection shortbound-check.">trigger_cmdshort</a> = def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a>;
<a name="l03476"></a>03476             shock.<a class="code" href="structshock__t.html#aa025f0766bbdda7b2848396d03c5ed73" title="F-key for trigger injection longbound-check.">trigger_cmdlong</a>  = def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a>;
<a name="l03477"></a>03477         } 
<a name="l03478"></a>03478         <span class="keywordflow">else</span>
<a name="l03479"></a>03479         {
<a name="l03480"></a>03480             <span class="comment">//inverted BLOCKER</span>
<a name="l03481"></a>03481             shock_flags |= <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da46a1b17c09f4f2011125ef447c739bfb">SHOCK_FLAG_TRG_BLOCKER_A</a>;
<a name="l03482"></a>03482             shock.<a class="code" href="structshock__t.html#ae869bbe5210ce7a640aaf9551a367ca3" title="F-key for trigger injection shortbound-check.">trigger_cmdshort</a> = def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a>;
<a name="l03483"></a>03483             shock.<a class="code" href="structshock__t.html#aa025f0766bbdda7b2848396d03c5ed73" title="F-key for trigger injection longbound-check.">trigger_cmdlong</a>  = def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a>;
<a name="l03484"></a>03484         }
<a name="l03485"></a>03485     }
<a name="l03486"></a>03486 
<a name="l03487"></a>03487     <span class="keywordflow">if</span> (def.HasFlag_b_KeyBlocker() &amp;&amp; !def.HasFlag_B_TriggerBlocker())
<a name="l03488"></a>03488     {
<a name="l03489"></a>03489         m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_trigger.html#aff88b0ac6416d870d0ad23e96ef7f0a5">shortbound_trigger_action</a>].trigger_cmdkeyblock_state = <span class="keyword">true</span>;
<a name="l03490"></a>03490         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a> != -1)
<a name="l03491"></a>03491         {
<a name="l03492"></a>03492             m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_trigger.html#aaa81d883e0a442ad5d39320f58e54d3c">longbound_trigger_action</a>].trigger_cmdkeyblock_state = <span class="keyword">true</span>;
<a name="l03493"></a>03493         }
<a name="l03494"></a>03494     }
<a name="l03495"></a>03495 
<a name="l03496"></a>03496     shock.<a class="code" href="structshock__t.html#ab66f157de2a0c9b2c840d7c46eb36726" title="optional value to tune trigger_switch_state autorelease">trigger_boundary_t</a> = def.<a class="code" href="struct_rig_def_1_1_trigger.html#aa161cd914d0920b4a6b80af298a99d62">boundary_timer</a>;
<a name="l03497"></a>03497     shock.<a class="code" href="structshock__t.html#ac15672f0e15504873d07b4d8124593f2">flags</a>              = shock_flags;
<a name="l03498"></a>03498     shock.<a class="code" href="structshock__t.html#acecec1828893e798ff56a8b7be346cb1" title="set beam default for spring">sbd_spring</a>         = def.<a class="code" href="struct_rig_def_1_1_trigger.html#a0d687343e9148e57e15b47603222cb9a">beam_defaults</a>-&gt;springiness;
<a name="l03499"></a>03499     shock.<a class="code" href="structshock__t.html#aa54a428648c23e2661e932758d3db794" title="set beam default for damping">sbd_damp</a>           = def.<a class="code" href="struct_rig_def_1_1_trigger.html#a0d687343e9148e57e15b47603222cb9a">beam_defaults</a>-&gt;damping_constant;
<a name="l03500"></a>03500     shock.<a class="code" href="structshock__t.html#acb8913bdbd5d1b5efd89ef1ce58d6b39" title="smart debug output">last_debug_state</a>   = 0;
<a name="l03501"></a>03501     
<a name="l03502"></a>03502 }
<a name="l03503"></a>03503 
<a name="l03504"></a><a class="code" href="class_rig_spawner.html#af10179cd62d0fe5e448991f08bb834a8">03504</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af10179cd62d0fe5e448991f08bb834a8">RigSpawner::ProcessContacter</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> &amp; node_ref)
<a name="l03505"></a>03505 {
<a name="l03506"></a>03506     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03507"></a>03507 
<a name="l03508"></a>03508     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_index = GetNodeIndexOrThrow(node_ref);
<a name="l03509"></a>03509     m_rig-&gt;contacters[m_rig-&gt;free_contacter].nodeid = node_index;
<a name="l03510"></a>03510     GetNode(node_index).iIsSkin = <span class="keyword">true</span>;
<a name="l03511"></a>03511     m_rig-&gt;free_contacter++;
<a name="l03512"></a>03512 };
<a name="l03513"></a>03513 
<a name="l03514"></a><a class="code" href="class_rig_spawner.html#a2dfd3b213f6dec9acb16f98c2bc22e8f">03514</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a2dfd3b213f6dec9acb16f98c2bc22e8f">RigSpawner::ProcessRotator</a>(<a class="code" href="struct_rig_def_1_1_rotator.html">RigDef::Rotator</a> &amp; def)
<a name="l03515"></a>03515 {
<a name="l03516"></a>03516     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03517"></a>03517 
<a name="l03518"></a>03518     <span class="keywordflow">if</span> (! CheckRotatorLimit(1))
<a name="l03519"></a>03519     {
<a name="l03520"></a>03520         <span class="keywordflow">return</span>;
<a name="l03521"></a>03521     }
<a name="l03522"></a>03522 
<a name="l03523"></a>03523     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rotator_index = m_rig-&gt;free_rotator;
<a name="l03524"></a>03524     m_rig-&gt;free_rotator++;
<a name="l03525"></a>03525     <a class="code" href="structrotator__t.html">rotator_t</a> &amp; rotator = m_rig-&gt;rotators[rotator_index];
<a name="l03526"></a>03526 
<a name="l03527"></a>03527     rotator.<a class="code" href="structrotator__t.html#ad1a30622b23efe2f923573e1a949395b">angle</a> = 0;
<a name="l03528"></a>03528     rotator.<a class="code" href="structrotator__t.html#a88e40fe9ad004c03107652d074fb1854">rate</a> = def.<a class="code" href="struct_rig_def_1_1_rotator.html#a5afb8c7d3d6b1699d83c9e173e471b39">rate</a>;
<a name="l03529"></a>03529     rotator.<a class="code" href="structrotator__t.html#aba4b036806cb48258bcb9072afcb2e93" title="rot axis">axis1</a> = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a52f0e36103480f64d723bd76f7c56077">axis_nodes</a>[0]);
<a name="l03530"></a>03530     rotator.<a class="code" href="structrotator__t.html#ad8ada5b57fae5549b490a3a2e3f1b966">axis2</a>     = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a52f0e36103480f64d723bd76f7c56077">axis_nodes</a>[1]);
<a name="l03531"></a>03531     rotator.<a class="code" href="structrotator__t.html#a4fa28f54aa477040dd25014c602cc68c">force</a>     = <a class="code" href="_beam_data_8h.html#a55a3b84b1cd33e3c581804204f87241d">ROTATOR_FORCE_DEFAULT</a>;
<a name="l03532"></a>03532     rotator.<a class="code" href="structrotator__t.html#a86bd6e69f0fdeacc748c055ef0a61ef8">tolerance</a> = <a class="code" href="_beam_data_8h.html#a761873837461b2319f260e0b76586c37">ROTATOR_TOLERANCE_DEFAULT</a>;
<a name="l03533"></a>03533     rotator.<a class="code" href="structrotator__t.html#a162c1387c4faf50320a7425fabe16601">rotatorEngineCoupling</a> = def.<a class="code" href="struct_rig_def_1_1_rotator.html#aacf94cde941fba9879ac65d0e9375d5e">engine_coupling</a>;
<a name="l03534"></a>03534     rotator.<a class="code" href="structrotator__t.html#aefd57726f10937f247127115492f181f">rotatorNeedsEngine</a> = def.<a class="code" href="struct_rig_def_1_1_rotator.html#ae38424df0bdad806156eda5aa0015b5a">needs_engine</a>;
<a name="l03535"></a>03535     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; i++)
<a name="l03536"></a>03536     {
<a name="l03537"></a>03537         rotator.<a class="code" href="structrotator__t.html#a1ac30696efb9057f937174a9a8908715">nodes1</a>[i] = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a1d31f8aa4803b50313cba04d332904a1">base_plate_nodes</a>[i]);
<a name="l03538"></a>03538         rotator.<a class="code" href="structrotator__t.html#a85b2e59309b64956044c9af4065b7456">nodes2</a>[i] = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a85c6f87df65ac0c9412d9cc4acf9e929">rotating_plate_nodes</a>[i]);
<a name="l03539"></a>03539     }
<a name="l03540"></a>03540 
<a name="l03541"></a>03541     <span class="comment">/* Rotate left key */</span>
<a name="l03542"></a>03542     m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_rotator.html#a0daafc8c467011e98d76c92e5b15a910">spin_left_key</a>].rotators.push_back(- (static_cast&lt;int&gt;(rotator_index) + 1));
<a name="l03543"></a>03543     m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_rotator.html#a0daafc8c467011e98d76c92e5b15a910">spin_left_key</a>].description = <span class="stringliteral">&quot;Rotate_Left/Right&quot;</span>;
<a name="l03544"></a>03544 
<a name="l03545"></a>03545     <span class="comment">/* Rotate right key */</span>
<a name="l03546"></a>03546     m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_rotator.html#aac4085eef518bc103315f9c7a9a6f76f">spin_right_key</a>].rotators.push_back(rotator_index + 1);
<a name="l03547"></a>03547 
<a name="l03548"></a>03548     _ProcessCommandKeyInertia(def.<a class="code" href="struct_rig_def_1_1_rotator.html#afdc433fe06fcf1fba9080d224144736b">inertia</a>, *def.<a class="code" href="struct_rig_def_1_1_rotator.html#af59a750b5211e759afde10c3cbc57bc8">inertia_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_rotator.html#a0daafc8c467011e98d76c92e5b15a910">spin_left_key</a>, def.<a class="code" href="struct_rig_def_1_1_rotator.html#aac4085eef518bc103315f9c7a9a6f76f">spin_right_key</a>);
<a name="l03549"></a>03549 
<a name="l03550"></a>03550     m_rig-&gt;hascommands = 1;
<a name="l03551"></a>03551 }
<a name="l03552"></a>03552 
<a name="l03553"></a><a class="code" href="class_rig_spawner.html#ae8abbbcd92ac624d224f4cb026df76c5">03553</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ae8abbbcd92ac624d224f4cb026df76c5">RigSpawner::ProcessRotator2</a>(<a class="code" href="struct_rig_def_1_1_rotator2.html">RigDef::Rotator2</a> &amp; def)
<a name="l03554"></a>03554 {
<a name="l03555"></a>03555     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03556"></a>03556 
<a name="l03557"></a>03557     <span class="keywordflow">if</span> (! CheckRotatorLimit(1))
<a name="l03558"></a>03558     {
<a name="l03559"></a>03559         <span class="keywordflow">return</span>;
<a name="l03560"></a>03560     }
<a name="l03561"></a>03561 
<a name="l03562"></a>03562     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rotator_index = m_rig-&gt;free_rotator;
<a name="l03563"></a>03563     m_rig-&gt;free_rotator++;
<a name="l03564"></a>03564     <a class="code" href="structrotator__t.html">rotator_t</a> &amp; rotator = m_rig-&gt;rotators[rotator_index];
<a name="l03565"></a>03565 
<a name="l03566"></a>03566     rotator.<a class="code" href="structrotator__t.html#ad1a30622b23efe2f923573e1a949395b">angle</a> = 0;
<a name="l03567"></a>03567     rotator.<a class="code" href="structrotator__t.html#a88e40fe9ad004c03107652d074fb1854">rate</a> = def.<a class="code" href="struct_rig_def_1_1_rotator.html#a5afb8c7d3d6b1699d83c9e173e471b39">rate</a>;
<a name="l03568"></a>03568     rotator.<a class="code" href="structrotator__t.html#aba4b036806cb48258bcb9072afcb2e93" title="rot axis">axis1</a> = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a52f0e36103480f64d723bd76f7c56077">axis_nodes</a>[0]);
<a name="l03569"></a>03569     rotator.<a class="code" href="structrotator__t.html#ad8ada5b57fae5549b490a3a2e3f1b966">axis2</a>     = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a52f0e36103480f64d723bd76f7c56077">axis_nodes</a>[1]);
<a name="l03570"></a>03570     rotator.<a class="code" href="structrotator__t.html#a4fa28f54aa477040dd25014c602cc68c">force</a>     = def.<a class="code" href="struct_rig_def_1_1_rotator2.html#ae62524db69939d86ed54857ccfff30bb">rotating_force</a>; <span class="comment">/* Default value is set in constructor */</span>
<a name="l03571"></a>03571     rotator.<a class="code" href="structrotator__t.html#a86bd6e69f0fdeacc748c055ef0a61ef8">tolerance</a> = def.<a class="code" href="struct_rig_def_1_1_rotator2.html#ae8d5400f5aecf0d6e62ea17666027d7b">tolerance</a>; <span class="comment">/* Default value is set in constructor */</span>
<a name="l03572"></a>03572     rotator.<a class="code" href="structrotator__t.html#a162c1387c4faf50320a7425fabe16601">rotatorEngineCoupling</a> = def.<a class="code" href="struct_rig_def_1_1_rotator.html#aacf94cde941fba9879ac65d0e9375d5e">engine_coupling</a>;
<a name="l03573"></a>03573     rotator.<a class="code" href="structrotator__t.html#aefd57726f10937f247127115492f181f">rotatorNeedsEngine</a> = def.<a class="code" href="struct_rig_def_1_1_rotator.html#ae38424df0bdad806156eda5aa0015b5a">needs_engine</a>;
<a name="l03574"></a>03574     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 4; i++)
<a name="l03575"></a>03575     {
<a name="l03576"></a>03576         rotator.<a class="code" href="structrotator__t.html#a1ac30696efb9057f937174a9a8908715">nodes1</a>[i] = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a1d31f8aa4803b50313cba04d332904a1">base_plate_nodes</a>[i]);
<a name="l03577"></a>03577         rotator.<a class="code" href="structrotator__t.html#a85b2e59309b64956044c9af4065b7456">nodes2</a>[i] = GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_rotator.html#a85c6f87df65ac0c9412d9cc4acf9e929">rotating_plate_nodes</a>[i]);
<a name="l03578"></a>03578     }
<a name="l03579"></a>03579 
<a name="l03580"></a>03580     <span class="comment">/* Rotate left key */</span>
<a name="l03581"></a>03581     m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_rotator.html#a0daafc8c467011e98d76c92e5b15a910">spin_left_key</a>].rotators.push_back(- (static_cast&lt;int&gt;(rotator_index) + 1));
<a name="l03582"></a>03582     <span class="keywordflow">if</span> (! def.<a class="code" href="struct_rig_def_1_1_rotator2.html#ab7696eb43681bf0b32c54f3b17c58328">description</a>.empty())
<a name="l03583"></a>03583     {
<a name="l03584"></a>03584         m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_rotator.html#a0daafc8c467011e98d76c92e5b15a910">spin_left_key</a>].description = def.<a class="code" href="struct_rig_def_1_1_rotator2.html#ab7696eb43681bf0b32c54f3b17c58328">description</a>;
<a name="l03585"></a>03585     }
<a name="l03586"></a>03586     <span class="keywordflow">else</span>
<a name="l03587"></a>03587     {
<a name="l03588"></a>03588         m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_rotator.html#a0daafc8c467011e98d76c92e5b15a910">spin_left_key</a>].description = <span class="stringliteral">&quot;Rotate_Left/Right&quot;</span>;
<a name="l03589"></a>03589     }
<a name="l03590"></a>03590 
<a name="l03591"></a>03591     <span class="comment">/* Rotate right key */</span>
<a name="l03592"></a>03592     m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_rotator.html#aac4085eef518bc103315f9c7a9a6f76f">spin_right_key</a>].rotators.push_back(rotator_index + 1);
<a name="l03593"></a>03593 
<a name="l03594"></a>03594     _ProcessCommandKeyInertia(def.<a class="code" href="struct_rig_def_1_1_rotator.html#afdc433fe06fcf1fba9080d224144736b">inertia</a>, *def.<a class="code" href="struct_rig_def_1_1_rotator.html#af59a750b5211e759afde10c3cbc57bc8">inertia_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_rotator.html#a0daafc8c467011e98d76c92e5b15a910">spin_left_key</a>, def.<a class="code" href="struct_rig_def_1_1_rotator.html#aac4085eef518bc103315f9c7a9a6f76f">spin_right_key</a>);
<a name="l03595"></a>03595 
<a name="l03596"></a>03596     m_rig-&gt;hascommands = 1;
<a name="l03597"></a>03597 }
<a name="l03598"></a>03598 
<a name="l03599"></a><a class="code" href="class_rig_spawner.html#a34e6e8f7fe5a473c6f4847c2feecaa48">03599</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a34e6e8f7fe5a473c6f4847c2feecaa48">RigSpawner::_ProcessCommandKeyInertia</a>(
<a name="l03600"></a>03600     <a class="code" href="struct_rig_def_1_1_optional_inertia.html">RigDef::OptionalInertia</a> &amp; inertia, 
<a name="l03601"></a>03601     <a class="code" href="struct_rig_def_1_1_default_inertia.html">RigDef::DefaultInertia</a> &amp; inertia_defaults, 
<a name="l03602"></a>03602     <span class="keywordtype">int</span> contract_key, 
<a name="l03603"></a>03603     <span class="keywordtype">int</span> extend_key
<a name="l03604"></a>03604 )
<a name="l03605"></a>03605 {
<a name="l03606"></a>03606     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03607"></a>03607 
<a name="l03608"></a>03608     <span class="keywordflow">if</span> (m_rig-&gt;cmdInertia != <span class="keyword">nullptr</span>)
<a name="l03609"></a>03609     {
<a name="l03610"></a>03610         <span class="comment">/* Handle placeholders */</span>
<a name="l03611"></a>03611         Ogre::String start_function;
<a name="l03612"></a>03612         Ogre::String stop_function;
<a name="l03613"></a>03613         <span class="keywordflow">if</span> (! inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#a940044fc40a8b1d6614fe83d4cbf0c19">start_function</a>.empty() &amp;&amp; inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#a940044fc40a8b1d6614fe83d4cbf0c19">start_function</a> != <span class="stringliteral">&quot;/&quot;</span> &amp;&amp; inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#a940044fc40a8b1d6614fe83d4cbf0c19">start_function</a> != <span class="stringliteral">&quot;-&quot;</span>)
<a name="l03614"></a>03614         {
<a name="l03615"></a>03615             start_function = inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#a940044fc40a8b1d6614fe83d4cbf0c19">start_function</a>;
<a name="l03616"></a>03616         }
<a name="l03617"></a>03617         <span class="keywordflow">if</span> (! inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4899a8aac32426e9dd74f73fe7d7892">stop_function</a>.empty() &amp;&amp; inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4899a8aac32426e9dd74f73fe7d7892">stop_function</a> != <span class="stringliteral">&quot;/&quot;</span> &amp;&amp; inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4899a8aac32426e9dd74f73fe7d7892">stop_function</a> != <span class="stringliteral">&quot;-&quot;</span>)
<a name="l03618"></a>03618         {
<a name="l03619"></a>03619             stop_function = inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4899a8aac32426e9dd74f73fe7d7892">stop_function</a>;
<a name="l03620"></a>03620         }
<a name="l03621"></a>03621         <span class="keywordflow">if</span> (inertia.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a0de247f14ef22453dd249a58a74d1a29">_start_delay_factor_set</a> &amp;&amp; inertia.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a33017bbfc4914e4fc59563542e628809">_stop_delay_factor_set</a>)
<a name="l03622"></a>03622         {
<a name="l03623"></a>03623             m_rig-&gt;cmdInertia-&gt;setCmdKeyDelay(
<a name="l03624"></a>03624                 contract_key,
<a name="l03625"></a>03625                 inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#a974e50429cd8a4fca7e9f326caf46ab1">start_delay_factor</a>,
<a name="l03626"></a>03626                 inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4299c949c4459d1f6a0fb281d9d64e2">stop_delay_factor</a>,
<a name="l03627"></a>03627                 start_function,
<a name="l03628"></a>03628                 stop_function
<a name="l03629"></a>03629             );
<a name="l03630"></a>03630 
<a name="l03631"></a>03631             m_rig-&gt;cmdInertia-&gt;setCmdKeyDelay(
<a name="l03632"></a>03632                 extend_key,
<a name="l03633"></a>03633                 inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#a974e50429cd8a4fca7e9f326caf46ab1">start_delay_factor</a>,
<a name="l03634"></a>03634                 inertia.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4299c949c4459d1f6a0fb281d9d64e2">stop_delay_factor</a>,
<a name="l03635"></a>03635                 start_function,
<a name="l03636"></a>03636                 stop_function
<a name="l03637"></a>03637             );
<a name="l03638"></a>03638         }
<a name="l03639"></a>03639         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inertia.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a0de247f14ef22453dd249a58a74d1a29">_start_delay_factor_set</a> || inertia.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a33017bbfc4914e4fc59563542e628809">_stop_delay_factor_set</a>)
<a name="l03640"></a>03640         {
<a name="l03641"></a>03641             m_rig-&gt;cmdInertia-&gt;setCmdKeyDelay(
<a name="l03642"></a>03642                 contract_key,
<a name="l03643"></a>03643                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#a974e50429cd8a4fca7e9f326caf46ab1">start_delay_factor</a>,
<a name="l03644"></a>03644                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4299c949c4459d1f6a0fb281d9d64e2">stop_delay_factor</a>,
<a name="l03645"></a>03645                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#a940044fc40a8b1d6614fe83d4cbf0c19">start_function</a>,
<a name="l03646"></a>03646                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4899a8aac32426e9dd74f73fe7d7892">stop_function</a>
<a name="l03647"></a>03647             );
<a name="l03648"></a>03648 
<a name="l03649"></a>03649             m_rig-&gt;cmdInertia-&gt;setCmdKeyDelay(
<a name="l03650"></a>03650                 extend_key,
<a name="l03651"></a>03651                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#a974e50429cd8a4fca7e9f326caf46ab1">start_delay_factor</a>,
<a name="l03652"></a>03652                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4299c949c4459d1f6a0fb281d9d64e2">stop_delay_factor</a>,
<a name="l03653"></a>03653                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#a940044fc40a8b1d6614fe83d4cbf0c19">start_function</a>,
<a name="l03654"></a>03654                 inertia_defaults.<a class="code" href="struct_rig_def_1_1_inertia.html#aa4899a8aac32426e9dd74f73fe7d7892">stop_function</a>
<a name="l03655"></a>03655             );
<a name="l03656"></a>03656         }
<a name="l03657"></a>03657     }
<a name="l03658"></a>03658 }
<a name="l03659"></a>03659 
<a name="l03660"></a><a class="code" href="class_rig_spawner.html#aed4c991796b214da85294fe6d4964c42">03660</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aed4c991796b214da85294fe6d4964c42">RigSpawner::ProcessCommand</a>(<a class="code" href="struct_rig_def_1_1_command2.html">RigDef::Command2</a> &amp; def)
<a name="l03661"></a>03661 {
<a name="l03662"></a>03662     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03663"></a>03663 
<a name="l03664"></a>03664     <span class="keywordflow">if</span> (! CheckBeamLimit(1))
<a name="l03665"></a>03665     {
<a name="l03666"></a>03666         <span class="keywordflow">return</span>;
<a name="l03667"></a>03667     }
<a name="l03668"></a>03668 
<a name="l03669"></a>03669     <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l03670"></a>03670     <span class="keywordtype">int</span> node_1_index = FindNodeIndex(def.<a class="code" href="struct_rig_def_1_1_command2.html#a48d07240a51f7c2ce574a56a7abda4dd">nodes</a>[0]);
<a name="l03671"></a>03671     <span class="keywordtype">int</span> node_2_index = FindNodeIndex(def.<a class="code" href="struct_rig_def_1_1_command2.html#a48d07240a51f7c2ce574a56a7abda4dd">nodes</a>[1]);
<a name="l03672"></a>03672     <span class="keywordflow">if</span> (node_1_index == -1 || node_2_index == -1)
<a name="l03673"></a>03673     {
<a name="l03674"></a>03674         AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to fetch node&quot;</span>);
<a name="l03675"></a>03675         <span class="keywordflow">return</span>;
<a name="l03676"></a>03676     }
<a name="l03677"></a>03677     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(m_rig-&gt;nodes[node_1_index], m_rig-&gt;nodes[node_2_index], def.<a class="code" href="struct_rig_def_1_1_command2.html#ab96a356cabcb43857f884aa4ffe69fdc">beam_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_command2.html#ade46e3280f029e6bad4abd24aa38e87f">detacher_group</a>);
<a name="l03678"></a>03678     CalculateBeamLength(beam);
<a name="l03679"></a>03679     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_command2.html#ab96a356cabcb43857f884aa4ffe69fdc">beam_defaults</a>-&gt;GetScaledBreakingThreshold()); <span class="comment">/* Override settings from AddBeam() */</span>
<a name="l03680"></a>03680     SetBeamSpring(beam, def.<a class="code" href="struct_rig_def_1_1_command2.html#ab96a356cabcb43857f884aa4ffe69fdc">beam_defaults</a>-&gt;GetScaledSpringiness());
<a name="l03681"></a>03681     SetBeamDamping(beam, def.<a class="code" href="struct_rig_def_1_1_command2.html#ab96a356cabcb43857f884aa4ffe69fdc">beam_defaults</a>-&gt;GetScaledDamping());
<a name="l03682"></a>03682     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03683"></a>03683 
<a name="l03684"></a>03684     <span class="comment">/* Options */</span>
<a name="l03685"></a>03685     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_command2.html#a5de77f913030c108b92326df1ea192b8">options</a>, RigDef::Command2::OPTION_i_INVISIBLE)) {
<a name="l03686"></a>03686         beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>;
<a name="l03687"></a>03687     }
<a name="l03688"></a>03688     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_command2.html#a5de77f913030c108b92326df1ea192b8">options</a>, RigDef::Command2::OPTION_r_ROPE)) {
<a name="l03689"></a>03689         beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a24d6f5addc374131ab07a16c222d6992">ROPE</a>;
<a name="l03690"></a>03690     }
<a name="l03691"></a>03691     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_command2.html#a5de77f913030c108b92326df1ea192b8">options</a>, RigDef::Command2::OPTION_p_PRESS_ONCE)) {
<a name="l03692"></a>03692         beam.<a class="code" href="structbeam__t.html#ac77c82e2762a9b7b684e37464826e240">isOnePressMode</a> = 1;
<a name="l03693"></a>03693     }
<a name="l03694"></a>03694     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_command2.html#a5de77f913030c108b92326df1ea192b8">options</a>, RigDef::Command2::OPTION_o_PRESS_ONCE_CENTER)) {
<a name="l03695"></a>03695         beam.<a class="code" href="structbeam__t.html#ac77c82e2762a9b7b684e37464826e240">isOnePressMode</a> = 2;
<a name="l03696"></a>03696     }
<a name="l03697"></a>03697     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_command2.html#a5de77f913030c108b92326df1ea192b8">options</a>, RigDef::Command2::OPTION_f_NOT_FASTER)) {
<a name="l03698"></a>03698         beam.<a class="code" href="structbeam__t.html#a6a099253f84fb4db289c846e7cbd76af">isForceRestricted</a> = <span class="keyword">true</span>;
<a name="l03699"></a>03699     }
<a name="l03700"></a>03700     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_command2.html#a5de77f913030c108b92326df1ea192b8">options</a>, RigDef::Command2::OPTION_c_AUTO_CENTER)) {
<a name="l03701"></a>03701         beam.<a class="code" href="structbeam__t.html#a34387f9c54c6457c2c114f01eb903e2d">isCentering</a> = <span class="keyword">true</span>;
<a name="l03702"></a>03702     }
<a name="l03703"></a>03703 
<a name="l03704"></a>03704     beam.<a class="code" href="structbeam__t.html#a56392ecaa08c8b8bec4abdc1ec204d25">commandRatioShort</a>     = def.<a class="code" href="struct_rig_def_1_1_command2.html#ae602dd5800860ca670568ce20d230bee">shorten_rate</a>;
<a name="l03705"></a>03705     beam.<a class="code" href="structbeam__t.html#ab0ab6a1847baf4011bf0b58a742189dd">commandRatioLong</a>      = def.<a class="code" href="struct_rig_def_1_1_command2.html#a3eabcdde35d9fe2099870aa26aa990c3">lengthen_rate</a>;
<a name="l03706"></a>03706     beam.<a class="code" href="structbeam__t.html#a49deacaa83d59050c7613aa9d3c486b7">commandShort</a>          = def.<a class="code" href="struct_rig_def_1_1_command2.html#aec4b03b9c64df22ef2deeb2ef2309b72">max_contraction</a>;
<a name="l03707"></a>03707     beam.<a class="code" href="structbeam__t.html#a22e9fa02eb5a1a4760b77f0197ab87ee">commandLong</a>           = def.<a class="code" href="struct_rig_def_1_1_command2.html#ab379426d340b476ca105b0107cff2440">max_extension</a>;
<a name="l03708"></a>03708     beam.<a class="code" href="structbeam__t.html#accbb36efbd5fafa1499d9c1e4f36b149">commandEngineCoupling</a> = def.<a class="code" href="struct_rig_def_1_1_command2.html#a619853236db8b6b58261ae77870f49a1">affect_engine</a>;
<a name="l03709"></a>03709     beam.<a class="code" href="structbeam__t.html#ababe7796ecc18ee31ddf38e9bf0f69f4">commandNeedsEngine</a>    = def.<a class="code" href="struct_rig_def_1_1_command2.html#a03cde25e23806d350d5712012a41ccc2">needs_engine</a>;
<a name="l03710"></a>03710 
<a name="l03711"></a>03711     <span class="comment">/* set the middle of the command, so its not required to recalculate this everytime ... */</span>
<a name="l03712"></a>03712     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_command2.html#ab379426d340b476ca105b0107cff2440">max_extension</a> &gt; def.<a class="code" href="struct_rig_def_1_1_command2.html#aec4b03b9c64df22ef2deeb2ef2309b72">max_contraction</a>)
<a name="l03713"></a>03713     {
<a name="l03714"></a>03714         beam.<a class="code" href="structbeam__t.html#a28ee8a9e3bcab6b876818cbf370852b8">centerLength</a> = (def.<a class="code" href="struct_rig_def_1_1_command2.html#ab379426d340b476ca105b0107cff2440">max_extension</a> - def.<a class="code" href="struct_rig_def_1_1_command2.html#aec4b03b9c64df22ef2deeb2ef2309b72">max_contraction</a>) / 2 + def.<a class="code" href="struct_rig_def_1_1_command2.html#aec4b03b9c64df22ef2deeb2ef2309b72">max_contraction</a>;
<a name="l03715"></a>03715     }
<a name="l03716"></a>03716     <span class="keywordflow">else</span>
<a name="l03717"></a>03717     {
<a name="l03718"></a>03718         beam.<a class="code" href="structbeam__t.html#a28ee8a9e3bcab6b876818cbf370852b8">centerLength</a> = (def.<a class="code" href="struct_rig_def_1_1_command2.html#aec4b03b9c64df22ef2deeb2ef2309b72">max_contraction</a> - def.<a class="code" href="struct_rig_def_1_1_command2.html#ab379426d340b476ca105b0107cff2440">max_extension</a>) / 2 + def.<a class="code" href="struct_rig_def_1_1_command2.html#ab379426d340b476ca105b0107cff2440">max_extension</a>;
<a name="l03719"></a>03719     }
<a name="l03720"></a>03720 
<a name="l03721"></a>03721     _ProcessCommandKeyInertia(def.<a class="code" href="struct_rig_def_1_1_command2.html#a5b26ca4473c6b08c33011eae14223fde">inertia</a>, *def.<a class="code" href="struct_rig_def_1_1_command2.html#a16ffe82b35c1c4a4016b7baf351e6489">inertia_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_command2.html#a4a9b8a43b785607f65880dafa9f46c21">contract_key</a>, def.<a class="code" href="struct_rig_def_1_1_command2.html#a38bffb59565f0bbfdcbaea2057a0e92b">extend_key</a>);    
<a name="l03722"></a>03722 
<a name="l03723"></a>03723     <span class="comment">/* Add keys */</span>
<a name="l03724"></a>03724     <a class="code" href="structcommand__t.html">command_t</a>* contract_command = &amp;m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_command2.html#a4a9b8a43b785607f65880dafa9f46c21">contract_key</a>];
<a name="l03725"></a>03725     contract_command-&gt;<a class="code" href="structcommand__t.html#a2e3d6de7dc233335c142f470224465e6">beams</a>.push_back(-beam_index);
<a name="l03726"></a>03726     <span class="keywordflow">if</span> (contract_command-&gt;<a class="code" href="structcommand__t.html#a15f4b56154aa9b8c8f8f5cc3936372b8">description</a>.empty())
<a name="l03727"></a>03727     {
<a name="l03728"></a>03728         contract_command-&gt;<a class="code" href="structcommand__t.html#a15f4b56154aa9b8c8f8f5cc3936372b8">description</a> = def.<a class="code" href="struct_rig_def_1_1_command2.html#a0f852bcff0dd10ba340b9217bf8ba93d">description</a>;
<a name="l03729"></a>03729     }
<a name="l03730"></a>03730 
<a name="l03731"></a>03731     <a class="code" href="structcommand__t.html">command_t</a>* extend_command = &amp;m_rig-&gt;commandkey[def.<a class="code" href="struct_rig_def_1_1_command2.html#a38bffb59565f0bbfdcbaea2057a0e92b">extend_key</a>];
<a name="l03732"></a>03732     extend_command-&gt;<a class="code" href="structcommand__t.html#a2e3d6de7dc233335c142f470224465e6">beams</a>.push_back(beam_index);
<a name="l03733"></a>03733     <span class="keywordflow">if</span> (extend_command-&gt;<a class="code" href="structcommand__t.html#a15f4b56154aa9b8c8f8f5cc3936372b8">description</a>.empty())
<a name="l03734"></a>03734     {
<a name="l03735"></a>03735         extend_command-&gt;<a class="code" href="structcommand__t.html#a15f4b56154aa9b8c8f8f5cc3936372b8">description</a> = def.<a class="code" href="struct_rig_def_1_1_command2.html#a0f852bcff0dd10ba340b9217bf8ba93d">description</a>;
<a name="l03736"></a>03736     }
<a name="l03737"></a>03737 
<a name="l03738"></a>03738     <span class="keywordtype">bool</span> attach_to_scene = (beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> != <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a9b28f43cd91bf9ab179c58fa77a613d6">BEAM_VIRTUAL</a> &amp;&amp; beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> != <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a7acff4517c1614edded0989bf5162652">BEAM_INVISIBLE</a> &amp;&amp; beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> != <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>);
<a name="l03739"></a>03739     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_command2.html#ab96a356cabcb43857f884aa4ffe69fdc">beam_defaults</a>, attach_to_scene);
<a name="l03740"></a>03740 
<a name="l03741"></a>03741     m_rig-&gt;free_commands++;
<a name="l03742"></a>03742     m_rig-&gt;hascommands = 1;
<a name="l03743"></a>03743 }
<a name="l03744"></a>03744 
<a name="l03745"></a><a class="code" href="class_rig_spawner.html#afcd325c22640d901cd34de93f0484740">03745</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#afcd325c22640d901cd34de93f0484740">RigSpawner::ProcessAnimator</a>(<a class="code" href="struct_rig_def_1_1_animator.html">RigDef::Animator</a> &amp; def)
<a name="l03746"></a>03746 {
<a name="l03747"></a>03747     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03748"></a>03748 
<a name="l03749"></a>03749     <span class="keywordflow">if</span> (! CheckBeamLimit(1) || ! CheckHydroLimit(1))
<a name="l03750"></a>03750     {
<a name="l03751"></a>03751         <span class="keywordflow">return</span>;
<a name="l03752"></a>03752     }
<a name="l03753"></a>03753 
<a name="l03754"></a>03754     <span class="keywordflow">if</span> (m_rig-&gt;hydroInertia != <span class="keyword">nullptr</span>)
<a name="l03755"></a>03755     {
<a name="l03756"></a>03756         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_animator.html#afeb252bd40350fc9bd10654bc5f496b1">inertia_defaults</a>-&gt;start_delay_factor &gt; 0 &amp;&amp; def.<a class="code" href="struct_rig_def_1_1_animator.html#afeb252bd40350fc9bd10654bc5f496b1">inertia_defaults</a>-&gt;stop_delay_factor &gt; 0)
<a name="l03757"></a>03757         {
<a name="l03758"></a>03758             m_rig-&gt;hydroInertia-&gt;setCmdKeyDelay(
<a name="l03759"></a>03759                 m_rig-&gt;free_hydro,
<a name="l03760"></a>03760                 def.<a class="code" href="struct_rig_def_1_1_animator.html#afeb252bd40350fc9bd10654bc5f496b1">inertia_defaults</a>-&gt;start_delay_factor,
<a name="l03761"></a>03761                 def.<a class="code" href="struct_rig_def_1_1_animator.html#afeb252bd40350fc9bd10654bc5f496b1">inertia_defaults</a>-&gt;stop_delay_factor,
<a name="l03762"></a>03762                 def.<a class="code" href="struct_rig_def_1_1_animator.html#afeb252bd40350fc9bd10654bc5f496b1">inertia_defaults</a>-&gt;start_function,
<a name="l03763"></a>03763                 def.<a class="code" href="struct_rig_def_1_1_animator.html#afeb252bd40350fc9bd10654bc5f496b1">inertia_defaults</a>-&gt;stop_function
<a name="l03764"></a>03764             );
<a name="l03765"></a>03765         }
<a name="l03766"></a>03766     }
<a name="l03767"></a>03767 
<a name="l03768"></a>03768     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03769"></a>03769     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> anim_flags = 0;
<a name="l03770"></a>03770     <span class="keywordtype">float</span> anim_option = 0;
<a name="l03771"></a>03771 
<a name="l03772"></a>03772     <span class="comment">/* Options. &#39;{&#39; intentionally misplaced. */</span>
<a name="l03773"></a>03773 
<a name="l03774"></a>03774     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a782695f24bfa4a723eeb9d944d3bad58">RigDef::Animator::OPTION_VISIBLE</a>)) {
<a name="l03775"></a>03775         hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03776"></a>03776     }
<a name="l03777"></a>03777     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a8ab9709b913c08abd6beb1d5a2553147">RigDef::Animator::OPTION_INVISIBLE</a>)) {
<a name="l03778"></a>03778         hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>;
<a name="l03779"></a>03779     }
<a name="l03780"></a>03780     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#aca0fa83ca1b9dedee91c0d1c5a351dc7">RigDef::Animator::OPTION_AIRSPEED</a>)) {
<a name="l03781"></a>03781         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a09f3cc3a9e5a06073eb5305bf5ee22b7">ANIM_FLAG_AIRSPEED</a>);
<a name="l03782"></a>03782     }
<a name="l03783"></a>03783     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a30bd033db1ff70d9df2e70deaaf10df4">RigDef::Animator::OPTION_VERTICAL_VELOCITY</a>)) {
<a name="l03784"></a>03784         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a5720e55cfcc50e503f11f91e4b364760">ANIM_FLAG_VVI</a>);
<a name="l03785"></a>03785     }
<a name="l03786"></a>03786     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#ae8bef9a0c90ca952af34aaafe502d5b7">RigDef::Animator::OPTION_ANGLE_OF_ATTACK</a>)) {
<a name="l03787"></a>03787         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a18751276139a896667dfe69b9e28ad14">ANIM_FLAG_AOA</a>);
<a name="l03788"></a>03788     }
<a name="l03789"></a>03789     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#aafed5619bc811c08868f67c061e870b2">RigDef::Animator::OPTION_FLAP</a>)) {
<a name="l03790"></a>03790         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a9b28ff675b27cafe2c5d43f4c683f3ec">ANIM_FLAG_FLAP</a>);
<a name="l03791"></a>03791     }
<a name="l03792"></a>03792     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a84cef18391907d68308fedc851c62f53">RigDef::Animator::OPTION_AIR_BRAKE</a>)) {
<a name="l03793"></a>03793         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a7a1409d70a1aff5d5726057447f5fed6">ANIM_FLAG_AIRBRAKE</a>);
<a name="l03794"></a>03794     }
<a name="l03795"></a>03795     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#ae65de1e075011d507e9190cbd02f9a76">RigDef::Animator::OPTION_ROLL</a>)) {
<a name="l03796"></a>03796         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ac7049c44ea826423cd65f0f97ee7db09">ANIM_FLAG_ROLL</a>);
<a name="l03797"></a>03797     }
<a name="l03798"></a>03798     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#ab97b3f851d9d3ca27b570e326b1b6459">RigDef::Animator::OPTION_PITCH</a>)) {
<a name="l03799"></a>03799         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aa32dcb1565f706311a59932363327ff8">ANIM_FLAG_PITCH</a>);
<a name="l03800"></a>03800     }
<a name="l03801"></a>03801     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#ac972c1c39a71929361b5482c53367874">RigDef::Animator::OPTION_BRAKES</a>)) {
<a name="l03802"></a>03802         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a7fca60b90dfd77fab816143552331889">ANIM_FLAG_BRAKE</a>);
<a name="l03803"></a>03803     }
<a name="l03804"></a>03804     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#ab7a633a1ea2b4e9f21ae53a420685d92">RigDef::Animator::OPTION_ACCEL</a>)) {
<a name="l03805"></a>03805         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034afd98e9a63a7b7ed744b2270f955a4532">ANIM_FLAG_ACCEL</a>);
<a name="l03806"></a>03806     }
<a name="l03807"></a>03807     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#acdc98b29efc4398361fe482dae66fe58">RigDef::Animator::OPTION_CLUTCH</a>)) {
<a name="l03808"></a>03808         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a621316d9e84e1d5c105439134d54a153">ANIM_FLAG_CLUTCH</a>);
<a name="l03809"></a>03809     }
<a name="l03810"></a>03810     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a184c8379b35c464393e7a455452558e9">RigDef::Animator::OPTION_SPEEDO</a>)) {
<a name="l03811"></a>03811         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a5b8f9fe7bbc358fcb6b65d50e394fb3c">ANIM_FLAG_SPEEDO</a>);
<a name="l03812"></a>03812     }
<a name="l03813"></a>03813     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#aec6decb2d446393adaffe30668642d82">RigDef::Animator::OPTION_TACHO</a>)) {
<a name="l03814"></a>03814         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ac885ea69cc6648d0197c5a60cf78a3f6">ANIM_FLAG_TACHO</a>);
<a name="l03815"></a>03815     }
<a name="l03816"></a>03816     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#aa9fc2574bb1689bc209f03a2011158de">RigDef::Animator::OPTION_TURBO</a>)) {
<a name="l03817"></a>03817         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aa62dfdc082b90d00272e218ea117fbc2">ANIM_FLAG_TURBO</a>);
<a name="l03818"></a>03818     }
<a name="l03819"></a>03819     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a4512cd70c68d78fe696d3d61a707020e">RigDef::Animator::OPTION_PARKING</a>)) {
<a name="l03820"></a>03820         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ad0fafb8888f2f597f16d30af1bf18840">ANIM_FLAG_PBRAKE</a>);
<a name="l03821"></a>03821     }
<a name="l03822"></a>03822     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a6cc5d57b259316a78a7aeb44105c7b94">RigDef::Animator::OPTION_TORQUE</a>)) {
<a name="l03823"></a>03823         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aee8a151f04bb8a51644053aeb961fc10">ANIM_FLAG_TORQUE</a>);
<a name="l03824"></a>03824     }
<a name="l03825"></a>03825     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a6aaca52a03bec4d602f8625e93d6f628">RigDef::Animator::OPTION_BOAT_THROTTLE</a>)) {
<a name="l03826"></a>03826         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034ad28aca782bd8e4ad42ec47f8cbac5a1f">ANIM_FLAG_BTHROTTLE</a>);
<a name="l03827"></a>03827     }
<a name="l03828"></a>03828     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a104e81972968fe003a253898ab3241ed">RigDef::Animator::OPTION_BOAT_RUDDER</a>)) {
<a name="l03829"></a>03829         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034aa99404a8d349a348dfe64886f78fafa4">ANIM_FLAG_BRUDDER</a>);
<a name="l03830"></a>03830     }
<a name="l03831"></a>03831     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#ae619f14d88c9eb8b82e3fd61bd487cef">RigDef::Animator::OPTION_SHIFT_LEFT_RIGHT</a>)) {
<a name="l03832"></a>03832         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l03833"></a>03833         anim_option = 1.f;
<a name="l03834"></a>03834     }
<a name="l03835"></a>03835     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a81b3afc41428896dbe62abff9bd0cfd8">RigDef::Animator::OPTION_SHIFT_BACK_FORTH</a>)) {
<a name="l03836"></a>03836         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l03837"></a>03837         anim_option = 2.f;
<a name="l03838"></a>03838     }
<a name="l03839"></a>03839     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#af4698ddd0fa2a0763b3e429929ee7ac6">RigDef::Animator::OPTION_SEQUENTIAL_SHIFT</a>)) {
<a name="l03840"></a>03840         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l03841"></a>03841         anim_option = 3.f;
<a name="l03842"></a>03842     }
<a name="l03843"></a>03843     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#acb60a5e8045805eec499ba963b053d93">RigDef::Animator::OPTION_GEAR_SELECT</a>)) {
<a name="l03844"></a>03844         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a701e2ec0d5059fd39a2588d15b988962">ANIM_FLAG_SHIFTER</a>);
<a name="l03845"></a>03845         anim_option = 4.f;
<a name="l03846"></a>03846     }
<a name="l03847"></a>03847     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a6ad2518ce5d0cb2afd22725329a0692b">RigDef::Animator::OPTION_ALTIMETER_100K</a>)) {
<a name="l03848"></a>03848         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a12457c45931e4754166f40f356b7d4bf">ANIM_FLAG_ALTIMETER</a>);
<a name="l03849"></a>03849         anim_option = 1.f;
<a name="l03850"></a>03850     }
<a name="l03851"></a>03851     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a2e619f8e518cc9138eea973a30a484ca">RigDef::Animator::OPTION_ALTIMETER_10K</a>)) {
<a name="l03852"></a>03852         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a12457c45931e4754166f40f356b7d4bf">ANIM_FLAG_ALTIMETER</a>);
<a name="l03853"></a>03853         anim_option = 2.f;
<a name="l03854"></a>03854     }
<a name="l03855"></a>03855     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a87993ff216cee780907a08f6e4a2cf6d">RigDef::Animator::OPTION_ALTIMETER_1K</a>)) {
<a name="l03856"></a>03856         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a12457c45931e4754166f40f356b7d4bf">ANIM_FLAG_ALTIMETER</a>);
<a name="l03857"></a>03857         anim_option = 3.f;
<a name="l03858"></a>03858     }
<a name="l03859"></a>03859     
<a name="l03860"></a>03860     <span class="comment">/* Aerial */</span>
<a name="l03861"></a>03861     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#a14b14912bdfc73fc477f18678e29c588">flags</a>, <a class="code" href="struct_rig_def_1_1_aero_animator.html#a7cb00bcd62fc389ab593e6ceebfd8f2b">RigDef::AeroAnimator::OPTION_THROTTLE</a>)) {
<a name="l03862"></a>03862         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a41c65943f7670904b0614c81218f95af">ANIM_FLAG_THROTTLE</a>);
<a name="l03863"></a>03863         anim_option = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#af132ea8b91f592db306b3e7527880907">motor</a>);
<a name="l03864"></a>03864     }
<a name="l03865"></a>03865     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#a14b14912bdfc73fc477f18678e29c588">flags</a>, <a class="code" href="struct_rig_def_1_1_aero_animator.html#a8dec90e8479b9450c20ceb0addecfd9b">RigDef::AeroAnimator::OPTION_RPM</a>)) {
<a name="l03866"></a>03866         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a72f876cc96347534e2d8af28f8955ada">ANIM_FLAG_RPM</a>);
<a name="l03867"></a>03867         anim_option = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#af132ea8b91f592db306b3e7527880907">motor</a>);
<a name="l03868"></a>03868     }
<a name="l03869"></a>03869     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#a14b14912bdfc73fc477f18678e29c588">flags</a>, <a class="code" href="struct_rig_def_1_1_aero_animator.html#aad9cd66a359ad2054b1d9c2fa59e4601">RigDef::AeroAnimator::OPTION_TORQUE</a>)) {
<a name="l03870"></a>03870         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a440ec65a53d462324e31f84109c18851">ANIM_FLAG_AETORQUE</a>);
<a name="l03871"></a>03871         anim_option = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#af132ea8b91f592db306b3e7527880907">motor</a>);
<a name="l03872"></a>03872     }
<a name="l03873"></a>03873     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#a14b14912bdfc73fc477f18678e29c588">flags</a>, <a class="code" href="struct_rig_def_1_1_aero_animator.html#a116af949d5370923ce6eb03fc24e3b75">RigDef::AeroAnimator::OPTION_PITCH</a>)) {
<a name="l03874"></a>03874         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a019e3e9c3b97a6e7fe0c18549b8abe92">ANIM_FLAG_AEPITCH</a>);
<a name="l03875"></a>03875         anim_option = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#af132ea8b91f592db306b3e7527880907">motor</a>);
<a name="l03876"></a>03876     }
<a name="l03877"></a>03877     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#a14b14912bdfc73fc477f18678e29c588">flags</a>, <a class="code" href="struct_rig_def_1_1_aero_animator.html#a291bbe86914c4401bc42d5c3007d8e0e">RigDef::AeroAnimator::OPTION_STATUS</a>)) {
<a name="l03878"></a>03878         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(anim_flags, <a class="code" href="_beam_data_8h.html#aac34dfe6c6b73b43a4656c9dce041034a9d024a577f80d1729027b79642988200">ANIM_FLAG_AESTATUS</a>);
<a name="l03879"></a>03879         anim_option = <span class="keyword">static_cast&lt;</span><span class="keywordtype">float</span><span class="keyword">&gt;</span>(def.<a class="code" href="struct_rig_def_1_1_animator.html#a7fcb54be773d2d8c2d42f2a5d0e1638d">aero_animator</a>.<a class="code" href="struct_rig_def_1_1_aero_animator.html#af132ea8b91f592db306b3e7527880907">motor</a>);
<a name="l03880"></a>03880     }
<a name="l03881"></a>03881 
<a name="l03882"></a>03882     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l03883"></a>03883     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(GetNode(def.<a class="code" href="struct_rig_def_1_1_animator.html#ae9c18e082ca5bed478bb5b74733ffbf0">nodes</a>[0]), GetNode(def.<a class="code" href="struct_rig_def_1_1_animator.html#ae9c18e082ca5bed478bb5b74733ffbf0">nodes</a>[1]), def.<a class="code" href="struct_rig_def_1_1_animator.html#a48c65c22edd0bd37fdbb98d298b29166">beam_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_animator.html#adfd01deccaf84750608c922ca304f7ca">detacher_group</a>);
<a name="l03884"></a>03884     <span class="comment">/* set the limits to something with sense by default */</span>
<a name="l03885"></a>03885     beam.<a class="code" href="structbeam__t.html#af85ad7bcb782f7fcab155bc93ddcc27d">shortbound</a> = 0.99999f;
<a name="l03886"></a>03886     beam.<a class="code" href="structbeam__t.html#a4acafe687c44c7f729c2fafd9a8f3e3d">longbound</a> = 1000000.0f;
<a name="l03887"></a>03887     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = hydro_type;
<a name="l03888"></a>03888     beam.<a class="code" href="structbeam__t.html#a3c522186adcacd0df5a15797ab654908" title="hydro rotation ratio">hydroRatio</a> = def.<a class="code" href="struct_rig_def_1_1_animator.html#a315413328d71362303f43504442bafca">lenghtening_factor</a>;
<a name="l03889"></a>03889     beam.<a class="code" href="structbeam__t.html#a374f52da21bfb9d7a5b6b66791769553">animFlags</a> = anim_flags;
<a name="l03890"></a>03890     beam.<a class="code" href="structbeam__t.html#a043afe8baef7138384e0dbc296e0c56d">animOption</a> = anim_option;
<a name="l03891"></a>03891     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a> = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l03892"></a>03892     CalculateBeamLength(beam);
<a name="l03893"></a>03893     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_animator.html#a48c65c22edd0bd37fdbb98d298b29166">beam_defaults</a>-&gt;GetScaledBreakingThreshold());
<a name="l03894"></a>03894     SetBeamSpring(beam, def.<a class="code" href="struct_rig_def_1_1_animator.html#a48c65c22edd0bd37fdbb98d298b29166">beam_defaults</a>-&gt;GetScaledSpringiness());
<a name="l03895"></a>03895     SetBeamDamping(beam, def.<a class="code" href="struct_rig_def_1_1_animator.html#a48c65c22edd0bd37fdbb98d298b29166">beam_defaults</a>-&gt;GetScaledDamping());
<a name="l03896"></a>03896     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_animator.html#a48c65c22edd0bd37fdbb98d298b29166">beam_defaults</a>, hydro_type != <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>);
<a name="l03897"></a>03897 
<a name="l03898"></a>03898     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#ac25cb1301ce9528e15569222ad89090d">RigDef::Animator::OPTION_SHORT_LIMIT</a>)) 
<a name="l03899"></a>03899     {
<a name="l03900"></a>03900         beam.<a class="code" href="structbeam__t.html#af85ad7bcb782f7fcab155bc93ddcc27d">shortbound</a> = def.<a class="code" href="struct_rig_def_1_1_animator.html#a6f704529ebb3b02b3a8fb11f8344bcd1">short_limit</a>;
<a name="l03901"></a>03901     }
<a name="l03902"></a>03902     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_animator.html#aa85e9883da76a9e855eec1dd6bed8aa1">flags</a>, <a class="code" href="struct_rig_def_1_1_animator.html#a919b9f0b5c9fd695d5a82405980eac7c">RigDef::Animator::OPTION_LONG_LIMIT</a>)) 
<a name="l03903"></a>03903     {
<a name="l03904"></a>03904         beam.<a class="code" href="structbeam__t.html#a4acafe687c44c7f729c2fafd9a8f3e3d">longbound</a> = def.<a class="code" href="struct_rig_def_1_1_animator.html#a94e0049079d4d2e8fb1df7f8a7886cf6">long_limit</a>;
<a name="l03905"></a>03905     }
<a name="l03906"></a>03906 
<a name="l03907"></a>03907     m_rig-&gt;hydro[m_rig-&gt;free_hydro] = beam_index;
<a name="l03908"></a>03908     m_rig-&gt;free_hydro++;
<a name="l03909"></a>03909 }
<a name="l03910"></a>03910 
<a name="l03911"></a><a class="code" href="class_rig_spawner.html#a0db27e19456b71711bc1a80791c0d156">03911</a> <a class="code" href="structbeam__t.html">beam_t</a> &amp; <a class="code" href="class_rig_spawner.html#a0db27e19456b71711bc1a80791c0d156">RigSpawner::AddBeam</a>(
<a name="l03912"></a>03912     <a class="code" href="structnode__t.html">node_t</a> &amp; node_1, 
<a name="l03913"></a>03913     <a class="code" href="structnode__t.html">node_t</a> &amp; node_2, 
<a name="l03914"></a>03914     boost::shared_ptr&lt;RigDef::BeamDefaults&gt; &amp; beam_defaults,
<a name="l03915"></a>03915     <span class="keywordtype">int</span> detacher_group
<a name="l03916"></a>03916 )
<a name="l03917"></a>03917 {
<a name="l03918"></a>03918     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03919"></a>03919 
<a name="l03920"></a>03920     <span class="comment">/* Init */</span>
<a name="l03921"></a>03921     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetAndInitFreeBeam(node_1, node_2);
<a name="l03922"></a>03922     beam.<a class="code" href="structbeam__t.html#a4877f7993c9d813a12d2a98e66a33dc5" title="Attribute: detacher group number (integer)">detacher_group</a> = detacher_group;
<a name="l03923"></a>03923     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a> = beam_defaults-&gt;visual_beam_diameter;
<a name="l03924"></a>03924     beam.<a class="code" href="structbeam__t.html#a7056fd64d16dff1edba5c533c9a4f86d">disabled</a> = <span class="keyword">false</span>;
<a name="l03925"></a>03925 
<a name="l03926"></a>03926     <span class="comment">/* Breaking threshold (strength) */</span>
<a name="l03927"></a>03927     <span class="keywordtype">float</span> strength = beam_defaults-&gt;breaking_threshold_constant;
<a name="l03928"></a>03928     beam.<a class="code" href="structbeam__t.html#a3b76bd7e50991e55ba669e20032feec0">strength</a> = strength;
<a name="l03929"></a>03929     beam.<a class="code" href="structbeam__t.html#a9deeb6c2f764d9f66ab5b2d1fea6d468" title="initial strength">iStrength</a> = strength;
<a name="l03930"></a>03930 
<a name="l03931"></a>03931     <span class="comment">/* Deformation */</span>
<a name="l03932"></a>03932     SetBeamDeformationThreshold(beam, beam_defaults);
<a name="l03933"></a>03933 
<a name="l03934"></a>03934     <span class="keywordtype">float</span> plastic_coef = beam_defaults-&gt;plastic_deformation_coefficient;
<a name="l03935"></a>03935     beam.<a class="code" href="structbeam__t.html#ab36a5ad2e437b69aeadda61dd3e5fa08">plastic_coef</a> = plastic_coef;
<a name="l03936"></a>03936     beam.<a class="code" href="structbeam__t.html#abed8f0f238a42c38fc1ddc7b9a9a6b8d">default_plastic_coef</a> = plastic_coef;
<a name="l03937"></a>03937 
<a name="l03938"></a>03938     <span class="keywordflow">return</span> beam;
<a name="l03939"></a>03939 }
<a name="l03940"></a>03940 
<a name="l03941"></a><a class="code" href="class_rig_spawner.html#a3f465e0ae8c34f8814f4b4e38d4e60ab">03941</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a3f465e0ae8c34f8814f4b4e38d4e60ab">RigSpawner::SetBeamStrength</a>(<a class="code" href="structbeam__t.html">beam_t</a> &amp; beam, <span class="keywordtype">float</span> strength)
<a name="l03942"></a>03942 {
<a name="l03943"></a>03943     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03944"></a>03944 
<a name="l03945"></a>03945     beam.<a class="code" href="structbeam__t.html#a3b76bd7e50991e55ba669e20032feec0">strength</a> = strength;
<a name="l03946"></a>03946     beam.<a class="code" href="structbeam__t.html#a9deeb6c2f764d9f66ab5b2d1fea6d468" title="initial strength">iStrength</a> = strength;
<a name="l03947"></a>03947 }
<a name="l03948"></a>03948 
<a name="l03949"></a><a class="code" href="class_rig_spawner.html#aecb79e73c17cd72c117c6d945be89ad1">03949</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aecb79e73c17cd72c117c6d945be89ad1">RigSpawner::ProcessHydro</a>(<a class="code" href="struct_rig_def_1_1_hydro.html">RigDef::Hydro</a> &amp; def)
<a name="l03950"></a>03950 {
<a name="l03951"></a>03951     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l03952"></a>03952 
<a name="l03953"></a>03953     <span class="keywordflow">if</span> (! CheckHydroLimit(1) || ! CheckBeamLimit(1))
<a name="l03954"></a>03954     {
<a name="l03955"></a>03955         <span class="keywordflow">return</span>;
<a name="l03956"></a>03956     }
<a name="l03957"></a>03957 
<a name="l03958"></a>03958     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03959"></a>03959     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hydro_flags = 0;
<a name="l03960"></a>03960 
<a name="l03961"></a>03961     <span class="comment">// Parse options</span>
<a name="l03962"></a>03962     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_hydro.html#a3375fbe3bb0f3026b96d1a7186bf4e60">options</a>.empty()) <span class="comment">// Parse as if option &#39;n&#39; (OPTION_n_NORMAL) was present</span>
<a name="l03963"></a>03963     {
<a name="l03964"></a>03964         hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03965"></a>03965         hydro_flags |= <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa3ff5ee8f96c1deeb47e8e7adc99604b3">HYDRO_FLAG_DIR</a>;
<a name="l03966"></a>03966     }
<a name="l03967"></a>03967     <span class="keywordflow">else</span>
<a name="l03968"></a>03968     {
<a name="l03969"></a>03969         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; def.<a class="code" href="struct_rig_def_1_1_hydro.html#a3375fbe3bb0f3026b96d1a7186bf4e60">options</a>.length(); ++i)
<a name="l03970"></a>03970         {
<a name="l03971"></a>03971             <span class="keyword">const</span> <span class="keywordtype">char</span> c = def.<a class="code" href="struct_rig_def_1_1_hydro.html#a3375fbe3bb0f3026b96d1a7186bf4e60">options</a>[i];
<a name="l03972"></a>03972             <span class="keywordflow">switch</span> (c)
<a name="l03973"></a>03973             {
<a name="l03974"></a>03974                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a67f51e04b4402292b43aea1be029675d">RigDef::Hydro::OPTION_i_INVISIBLE</a>:  <span class="comment">// i</span>
<a name="l03975"></a>03975                     hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>;
<a name="l03976"></a>03976                     <span class="keywordflow">break</span>;
<a name="l03977"></a>03977                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#ab7ceec353a54e1a85078dc776e969352">RigDef::Hydro::OPTION_n_NORMAL</a>:  <span class="comment">// n</span>
<a name="l03978"></a>03978                     hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l03979"></a>03979                     hydro_flags |= <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa3ff5ee8f96c1deeb47e8e7adc99604b3">HYDRO_FLAG_DIR</a>;
<a name="l03980"></a>03980                     <span class="keywordflow">break</span>;
<a name="l03981"></a>03981                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a58220f566dd5a6fdfc9e1b7d02fb4982">RigDef::Hydro::OPTION_s_DISABLE_ON_HIGH_SPEED</a>:  <span class="comment">// &#39;s&#39;: // speed changing hydro</span>
<a name="l03982"></a>03982                     hydro_flags |= <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa109c779382844ca5fdb8e7be0f3c173a">HYDRO_FLAG_SPEED</a>;
<a name="l03983"></a>03983                     <span class="keywordflow">break</span>;
<a name="l03984"></a>03984                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a131907e974aa595f99fa7533afd9c638">RigDef::Hydro::OPTION_a_INPUT_AILERON</a>:  <span class="comment">// &#39;a&#39;:</span>
<a name="l03985"></a>03985                     hydro_flags |= <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5e151cf7a0debbb376cc9aefb2ac00a0">HYDRO_FLAG_AILERON</a>;
<a name="l03986"></a>03986                     <span class="keywordflow">break</span>;
<a name="l03987"></a>03987                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#ae746bb82829cc08ea71d55d7d4e886cf">RigDef::Hydro::OPTION_r_INPUT_RUDDER</a>:  <span class="comment">// &#39;r&#39;:</span>
<a name="l03988"></a>03988                     hydro_flags |= <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad3517a02da9fa3d66507e9d7fa1a20c1">HYDRO_FLAG_RUDDER</a>;
<a name="l03989"></a>03989                     <span class="keywordflow">break</span>;
<a name="l03990"></a>03990                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a6402b8eb86e1144e2c3d36000c661521">RigDef::Hydro::OPTION_e_INPUT_ELEVATOR</a>:  <span class="comment">// &#39;e&#39;:</span>
<a name="l03991"></a>03991                     hydro_flags |= <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad07b12ce2e80bae31ccd567f10c0d663">HYDRO_FLAG_ELEVATOR</a>;
<a name="l03992"></a>03992                     <span class="keywordflow">break</span>;
<a name="l03993"></a>03993                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a0097084ad984a97671f2fdc82a80d896">RigDef::Hydro::OPTION_u_INPUT_AILERON_ELEVATOR</a>:  <span class="comment">// &#39;u&#39;:</span>
<a name="l03994"></a>03994                     hydro_flags |= (<a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5e151cf7a0debbb376cc9aefb2ac00a0">HYDRO_FLAG_AILERON</a> | <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad07b12ce2e80bae31ccd567f10c0d663">HYDRO_FLAG_ELEVATOR</a>);
<a name="l03995"></a>03995                     <span class="keywordflow">break</span>;
<a name="l03996"></a>03996                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#aee7076426354989ef11ad154b30997fe">RigDef::Hydro::OPTION_v_INPUT_InvAILERON_ELEVATOR</a>:  <span class="comment">// &#39;v&#39;:</span>
<a name="l03997"></a>03997                     hydro_flags |= (<a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fab3616d71cf1f0d815a7b1f33ca4d3c37">HYDRO_FLAG_REV_AILERON</a> | <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad07b12ce2e80bae31ccd567f10c0d663">HYDRO_FLAG_ELEVATOR</a>);
<a name="l03998"></a>03998                     <span class="keywordflow">break</span>;
<a name="l03999"></a>03999                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a461054e3b33f86307c29d15bcff3549d">RigDef::Hydro::OPTION_x_INPUT_AILERON_RUDDER</a>:  <span class="comment">// &#39;x&#39;:</span>
<a name="l04000"></a>04000                     hydro_flags |= (<a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5e151cf7a0debbb376cc9aefb2ac00a0">HYDRO_FLAG_AILERON</a> | <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad3517a02da9fa3d66507e9d7fa1a20c1">HYDRO_FLAG_RUDDER</a>);
<a name="l04001"></a>04001                     <span class="keywordflow">break</span>;
<a name="l04002"></a>04002                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a113d8ea6d6093dac8a7f122a74bfb94a">RigDef::Hydro::OPTION_y_INPUT_InvAILERON_RUDDER</a>:  <span class="comment">// &#39;y&#39;:</span>
<a name="l04003"></a>04003                     hydro_flags |= (<a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fab3616d71cf1f0d815a7b1f33ca4d3c37">HYDRO_FLAG_REV_AILERON</a> | <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad3517a02da9fa3d66507e9d7fa1a20c1">HYDRO_FLAG_RUDDER</a>);
<a name="l04004"></a>04004                     <span class="keywordflow">break</span>;
<a name="l04005"></a>04005                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#ae68a6d6bdab9ef13bd7358b945844220">RigDef::Hydro::OPTION_g_INPUT_ELEVATOR_RUDDER</a>:  <span class="comment">// &#39;g&#39;:</span>
<a name="l04006"></a>04006                     hydro_flags |= (<a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad07b12ce2e80bae31ccd567f10c0d663">HYDRO_FLAG_ELEVATOR</a> | <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad3517a02da9fa3d66507e9d7fa1a20c1">HYDRO_FLAG_RUDDER</a>);
<a name="l04007"></a>04007                     <span class="keywordflow">break</span>;
<a name="l04008"></a>04008                 <span class="keywordflow">case</span> <a class="code" href="struct_rig_def_1_1_hydro.html#a9a5a696b7c1c1dda05f34e2135ff7387">RigDef::Hydro::OPTION_h_INPUT_InvELEVATOR_RUDDER</a>:  <span class="comment">// &#39;h&#39;:</span>
<a name="l04009"></a>04009                     hydro_flags |= (<a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa315c87a8576f94e81c56094f0eb9ce96">HYDRO_FLAG_REV_ELEVATOR</a> | <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fad3517a02da9fa3d66507e9d7fa1a20c1">HYDRO_FLAG_RUDDER</a>);
<a name="l04010"></a>04010                     <span class="keywordflow">break</span>;
<a name="l04011"></a>04011                 <span class="keywordflow">default</span>:
<a name="l04012"></a>04012                     this-&gt;AddMessage(Message::TYPE_WARNING, std::string(<span class="stringliteral">&quot;Ignoring invalid flag:&quot;</span>) + c);
<a name="l04013"></a>04013                     <span class="keywordflow">break</span>;
<a name="l04014"></a>04014             }
<a name="l04015"></a>04015             
<a name="l04016"></a>04016             <span class="comment">// NOTE: This is a quirk ported from v0.4.0.7 spawner (for compatibility)</span>
<a name="l04017"></a>04017             <span class="comment">//       This code obviously belongs after the options-loop.</span>
<a name="l04018"></a>04018             <span class="comment">//       However, since it&#39;s inside the loop, it only works correctly if the &#39;i&#39; flag is last.</span>
<a name="l04019"></a>04019             <span class="comment">//</span>
<a name="l04020"></a>04020             <span class="comment">// ORIGINAL COMMENT: if you use the i flag on its own, add the direction to it</span>
<a name="l04021"></a>04021             <span class="keywordflow">if</span> (hydro_type == <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a> &amp;&amp; !hydro_flags)
<a name="l04022"></a>04022             {
<a name="l04023"></a>04023                 hydro_flags |= <a class="code" href="_beam_data_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa3ff5ee8f96c1deeb47e8e7adc99604b3">HYDRO_FLAG_DIR</a>;
<a name="l04024"></a>04024             }
<a name="l04025"></a>04025         }
<a name="l04026"></a>04026     }
<a name="l04027"></a>04027 
<a name="l04028"></a>04028     <span class="comment">/* Inertia */</span>
<a name="l04029"></a>04029     <span class="keywordflow">if</span> (m_rig-&gt;hydroInertia != <span class="keyword">nullptr</span>)
<a name="l04030"></a>04030     {
<a name="l04031"></a>04031         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_hydro.html#a8fd76b6cd714fb64d9691693b5b1dd18">inertia</a>.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a0de247f14ef22453dd249a58a74d1a29">_start_delay_factor_set</a> &amp;&amp; def.<a class="code" href="struct_rig_def_1_1_hydro.html#a8fd76b6cd714fb64d9691693b5b1dd18">inertia</a>.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a33017bbfc4914e4fc59563542e628809">_stop_delay_factor_set</a>)
<a name="l04032"></a>04032         {
<a name="l04033"></a>04033             m_rig-&gt;hydroInertia-&gt;setCmdKeyDelay(
<a name="l04034"></a>04034                 m_rig-&gt;free_hydro,  
<a name="l04035"></a>04035                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;start_delay_factor,
<a name="l04036"></a>04036                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;stop_delay_factor,
<a name="l04037"></a>04037                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;start_function,
<a name="l04038"></a>04038                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;stop_function
<a name="l04039"></a>04039             );
<a name="l04040"></a>04040         }
<a name="l04041"></a>04041         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_hydro.html#a8fd76b6cd714fb64d9691693b5b1dd18">inertia</a>.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a0de247f14ef22453dd249a58a74d1a29">_start_delay_factor_set</a> || def.<a class="code" href="struct_rig_def_1_1_hydro.html#a8fd76b6cd714fb64d9691693b5b1dd18">inertia</a>.<a class="code" href="struct_rig_def_1_1_optional_inertia.html#a33017bbfc4914e4fc59563542e628809">_stop_delay_factor_set</a>)
<a name="l04042"></a>04042         {
<a name="l04043"></a>04043             m_rig-&gt;hydroInertia-&gt;setCmdKeyDelay(
<a name="l04044"></a>04044                 m_rig-&gt;free_hydro,  
<a name="l04045"></a>04045                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;start_delay_factor,
<a name="l04046"></a>04046                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;stop_delay_factor,
<a name="l04047"></a>04047                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;start_function,
<a name="l04048"></a>04048                 def.<a class="code" href="struct_rig_def_1_1_hydro.html#a4dab1bcae1289a5633db586ba136d378">inertia_defaults</a>-&gt;stop_function
<a name="l04049"></a>04049             );
<a name="l04050"></a>04050         }
<a name="l04051"></a>04051     }
<a name="l04052"></a>04052 
<a name="l04053"></a>04053     <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l04054"></a>04054     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetAndInitFreeBeam(GetNode(def.<a class="code" href="struct_rig_def_1_1_hydro.html#a9435dd81577249609b1bd027baa884ff">nodes</a>[0]), GetNode(def.<a class="code" href="struct_rig_def_1_1_hydro.html#a9435dd81577249609b1bd027baa884ff">nodes</a>[1]));
<a name="l04055"></a>04055     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_hydro.html#aed6a017a89ba69b61b23b8333657cc82">beam_defaults</a>-&gt;GetScaledBreakingThreshold());
<a name="l04056"></a>04056     CalculateBeamLength(beam);
<a name="l04057"></a>04057     SetBeamDeformationThreshold(beam, def.<a class="code" href="struct_rig_def_1_1_hydro.html#aed6a017a89ba69b61b23b8333657cc82">beam_defaults</a>);
<a name="l04058"></a>04058     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a>                 = hydro_type;
<a name="l04059"></a>04059     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a>                    = def.<a class="code" href="struct_rig_def_1_1_hydro.html#aed6a017a89ba69b61b23b8333657cc82">beam_defaults</a>-&gt;GetScaledSpringiness();
<a name="l04060"></a>04060     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a>                    = def.<a class="code" href="struct_rig_def_1_1_hydro.html#aed6a017a89ba69b61b23b8333657cc82">beam_defaults</a>-&gt;GetScaledDamping();
<a name="l04061"></a>04061     beam.<a class="code" href="structbeam__t.html#a4877f7993c9d813a12d2a98e66a33dc5" title="Attribute: detacher group number (integer)">detacher_group</a>       = def.<a class="code" href="struct_rig_def_1_1_hydro.html#ab2aef47f0840c49d6530cc00f50f9d9a">detacher_group</a>;
<a name="l04062"></a>04062     beam.<a class="code" href="structbeam__t.html#a280cf3a49c52748189c682cb76613468">hydroFlags</a>           = hydro_flags;
<a name="l04063"></a>04063     beam.<a class="code" href="structbeam__t.html#a3c522186adcacd0df5a15797ab654908" title="hydro rotation ratio">hydroRatio</a>           = def.<a class="code" href="struct_rig_def_1_1_hydro.html#a225a6483b30728e181d758b671d7beb5">lenghtening_factor</a>;
<a name="l04064"></a>04064     beam.<a class="code" href="structbeam__t.html#ab36a5ad2e437b69aeadda61dd3e5fa08">plastic_coef</a>         = def.<a class="code" href="struct_rig_def_1_1_hydro.html#aed6a017a89ba69b61b23b8333657cc82">beam_defaults</a>-&gt;plastic_deformation_coefficient;
<a name="l04065"></a>04065     beam.<a class="code" href="structbeam__t.html#abed8f0f238a42c38fc1ddc7b9a9a6b8d">default_plastic_coef</a> = def.<a class="code" href="struct_rig_def_1_1_hydro.html#aed6a017a89ba69b61b23b8333657cc82">beam_defaults</a>-&gt;plastic_deformation_coefficient;
<a name="l04066"></a>04066     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a>             = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l04067"></a>04067 
<a name="l04068"></a>04068     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_hydro.html#aed6a017a89ba69b61b23b8333657cc82">beam_defaults</a>, (hydro_type == <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>));
<a name="l04069"></a>04069 
<a name="l04070"></a>04070     m_rig-&gt;hydro[m_rig-&gt;free_hydro] = beam_index;
<a name="l04071"></a>04071     m_rig-&gt;free_hydro++;
<a name="l04072"></a>04072 }
<a name="l04073"></a>04073 
<a name="l04074"></a><a class="code" href="class_rig_spawner.html#a0b341e8598fdf987065bf608b768cbbe">04074</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a0b341e8598fdf987065bf608b768cbbe">RigSpawner::ProcessShock2</a>(<a class="code" href="struct_rig_def_1_1_shock2.html">RigDef::Shock2</a> &amp; def)
<a name="l04075"></a>04075 {
<a name="l04076"></a>04076     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04077"></a>04077 
<a name="l04078"></a>04078     <span class="keywordflow">if</span> (! CheckShockLimit(1) || ! CheckBeamLimit(1))
<a name="l04079"></a>04079     {
<a name="l04080"></a>04080         <span class="keywordflow">return</span>;
<a name="l04081"></a>04081     }
<a name="l04082"></a>04082 
<a name="l04083"></a>04083     <a class="code" href="structnode__t.html">node_t</a> &amp; node_1 = GetNode(def.<a class="code" href="struct_rig_def_1_1_shock2.html#a19248178ff7ff2dd39a6c1ca8a0744b0">nodes</a>[0]);
<a name="l04084"></a>04084     <a class="code" href="structnode__t.html">node_t</a> &amp; node_2 = GetNode(def.<a class="code" href="struct_rig_def_1_1_shock2.html#a19248178ff7ff2dd39a6c1ca8a0744b0">nodes</a>[1]);
<a name="l04085"></a>04085     <span class="keywordtype">float</span> short_bound = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a29a95e5b35a656f7b7337a22284dbb32" title="Maximum contraction limit, in percentage ( 1.00 = 100% )">short_bound</a>;
<a name="l04086"></a>04086     <span class="keywordtype">float</span> long_bound = def.<a class="code" href="struct_rig_def_1_1_shock2.html#adeaec6bd27bd74d778eafdcdd65ec3e5" title="Maximum extension limit, in percentage ( 1.00 = 100% )">long_bound</a>;
<a name="l04087"></a>04087     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l04088"></a>04088     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shock_flags = <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da018fcd7fd5a8c7ba2dcbbaa35910cfeb">SHOCK_FLAG_NORMAL</a> | <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291dabb8966de43739d2d6e6ecaf1570fde71">SHOCK_FLAG_ISSHOCK2</a>;
<a name="l04089"></a>04089 
<a name="l04090"></a>04090     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9cdf6403d5447eacc0bdeedb0aebefaf" title="Bit flags.">options</a>, RigDef::Shock2::OPTION_i_INVISIBLE))
<a name="l04091"></a>04091     {
<a name="l04092"></a>04092         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da86aa4d52e258bb9715a49015a1d7fe53">SHOCK_FLAG_INVISIBLE</a>);
<a name="l04093"></a>04093         hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>;
<a name="l04094"></a>04094     }
<a name="l04095"></a>04095     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9cdf6403d5447eacc0bdeedb0aebefaf" title="Bit flags.">options</a>, RigDef::Shock2::OPTION_s_SOFT_BUMP_BOUNDS))
<a name="l04096"></a>04096     {
<a name="l04097"></a>04097         <a class="code" href="_bit_flags_8h.html#a2acc2f1379be18c803fa356995d0dabd">BITMASK_SET_0</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da018fcd7fd5a8c7ba2dcbbaa35910cfeb">SHOCK_FLAG_NORMAL</a>); <span class="comment">/* Not normal anymore */</span>
<a name="l04098"></a>04098         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da421cdb8b9b39eb988f7570e7906dc7e9">SHOCK_FLAG_SOFTBUMP</a>);
<a name="l04099"></a>04099     }
<a name="l04100"></a>04100     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9cdf6403d5447eacc0bdeedb0aebefaf" title="Bit flags.">options</a>, RigDef::Shock2::OPTION_m_METRIC))
<a name="l04101"></a>04101     {
<a name="l04102"></a>04102         <span class="keywordtype">float</span> beam_length = node_1.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.distance(node_2.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>);
<a name="l04103"></a>04103         short_bound /= beam_length;
<a name="l04104"></a>04104         long_bound /= beam_length;
<a name="l04105"></a>04105     }
<a name="l04106"></a>04106     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9cdf6403d5447eacc0bdeedb0aebefaf" title="Bit flags.">options</a>, RigDef::Shock2::OPTION_M_ABSOLUTE_METRIC))
<a name="l04107"></a>04107     {
<a name="l04108"></a>04108         <span class="keywordtype">float</span> beam_length = node_1.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.distance(node_2.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>);
<a name="l04109"></a>04109         short_bound = (beam_length - short_bound) / beam_length;
<a name="l04110"></a>04110         long_bound = (long_bound - beam_length) / beam_length;
<a name="l04111"></a>04111 
<a name="l04112"></a>04112         <span class="keywordflow">if</span> (long_bound &lt; 0.f)
<a name="l04113"></a>04113         {
<a name="l04114"></a>04114             AddMessage(
<a name="l04115"></a>04115                 Message::TYPE_WARNING, 
<a name="l04116"></a>04116                 <span class="stringliteral">&quot;Metric shock length calculation failed, &#39;short_bound&#39; less than beams spawn length. Resetting to beam&#39;s spawn length (short_bound = 0)&quot;</span>
<a name="l04117"></a>04117             );
<a name="l04118"></a>04118             long_bound = 0.f;
<a name="l04119"></a>04119         }
<a name="l04120"></a>04120 
<a name="l04121"></a>04121         <span class="keywordflow">if</span> (short_bound &gt; 1.f)
<a name="l04122"></a>04122         {
<a name="l04123"></a>04123             AddMessage(
<a name="l04124"></a>04124                 Message::TYPE_WARNING, 
<a name="l04125"></a>04125                 <span class="stringliteral">&quot;Metric shock length calculation failed, &#39;short_bound&#39; less than 0 meters. Resetting to 0 meters (short_bound = 1)&quot;</span>
<a name="l04126"></a>04126             );
<a name="l04127"></a>04127             short_bound = 1.f;
<a name="l04128"></a>04128         }
<a name="l04129"></a>04129     }
<a name="l04130"></a>04130     
<a name="l04131"></a>04131     <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l04132"></a>04132     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetAndInitFreeBeam(node_1, node_2);
<a name="l04133"></a>04133     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9252b1a7bb08b545bb8d26b9a693e0c5">beam_defaults</a>-&gt;breaking_threshold_constant * 4.f);
<a name="l04134"></a>04134     SetBeamDeformationThreshold(beam, def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9252b1a7bb08b545bb8d26b9a693e0c5">beam_defaults</a>);
<a name="l04135"></a>04135     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a>                 = hydro_type;
<a name="l04136"></a>04136     beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a>              = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a696845de03029f4206a9af01e8c13c69" title="shock2">SHOCK2</a>;
<a name="l04137"></a>04137     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a>                    = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a89dc983239b0355025a200862194ccfe" title="Spring value applied when the shock is compressing.">spring_in</a>;
<a name="l04138"></a>04138     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a>                    = def.<a class="code" href="struct_rig_def_1_1_shock2.html#aebf1286d4b0ba5f7d9b1ae9aaecd4176" title="Damping value applied when the shock is compressing.">damp_in</a>;
<a name="l04139"></a>04139     beam.<a class="code" href="structbeam__t.html#af85ad7bcb782f7fcab155bc93ddcc27d">shortbound</a>           = short_bound;
<a name="l04140"></a>04140     beam.<a class="code" href="structbeam__t.html#a4acafe687c44c7f729c2fafd9a8f3e3d">longbound</a>            = long_bound;
<a name="l04141"></a>04141     beam.<a class="code" href="structbeam__t.html#ab36a5ad2e437b69aeadda61dd3e5fa08">plastic_coef</a>         = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9252b1a7bb08b545bb8d26b9a693e0c5">beam_defaults</a>-&gt;plastic_deformation_coefficient;
<a name="l04142"></a>04142     beam.<a class="code" href="structbeam__t.html#abed8f0f238a42c38fc1ddc7b9a9a6b8d">default_plastic_coef</a> = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9252b1a7bb08b545bb8d26b9a693e0c5">beam_defaults</a>-&gt;plastic_deformation_coefficient;
<a name="l04143"></a>04143     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a>             = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l04144"></a>04144 
<a name="l04145"></a>04145     <span class="comment">/* Length + pre-compression */</span>
<a name="l04146"></a>04146     CalculateBeamLength(beam);
<a name="l04147"></a>04147     beam.<a class="code" href="structbeam__t.html#a97e6ce14fdcf35d1c7b8c40b40998ede" title="length">L</a>          *= def.<a class="code" href="struct_rig_def_1_1_shock2.html#aab99986424ef1e79baf57b39d13d4334" title="Changes compression or extension of the suspension when the truck spawns. This can be used to &quot;level&quot;...">precompression</a>;
<a name="l04148"></a>04148     beam.<a class="code" href="structbeam__t.html#ace384f1fca382d1df48d29c895a29bc3" title="reference length">refL</a>       *= def.<a class="code" href="struct_rig_def_1_1_shock2.html#aab99986424ef1e79baf57b39d13d4334" title="Changes compression or extension of the suspension when the truck spawns. This can be used to &quot;level&quot;...">precompression</a>;
<a name="l04149"></a>04149     beam.<a class="code" href="structbeam__t.html#a65d3452c6840de148c962b20defb45b6" title="hydro reference len">Lhydro</a>     *= def.<a class="code" href="struct_rig_def_1_1_shock2.html#aab99986424ef1e79baf57b39d13d4334" title="Changes compression or extension of the suspension when the truck spawns. This can be used to &quot;level&quot;...">precompression</a>;
<a name="l04150"></a>04150 
<a name="l04151"></a>04151     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9252b1a7bb08b545bb8d26b9a693e0c5">beam_defaults</a>, hydro_type != <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>);
<a name="l04152"></a>04152 
<a name="l04153"></a>04153     <a class="code" href="structshock__t.html">shock_t</a> &amp; shock  = GetFreeShock();
<a name="l04154"></a>04154     shock.<a class="code" href="structshock__t.html#ac15672f0e15504873d07b4d8124593f2">flags</a>      = shock_flags;
<a name="l04155"></a>04155     shock.<a class="code" href="structshock__t.html#acecec1828893e798ff56a8b7be346cb1" title="set beam default for spring">sbd_spring</a> = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9252b1a7bb08b545bb8d26b9a693e0c5">beam_defaults</a>-&gt;springiness;
<a name="l04156"></a>04156     shock.<a class="code" href="structshock__t.html#aa54a428648c23e2661e932758d3db794" title="set beam default for damping">sbd_damp</a>   = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a9252b1a7bb08b545bb8d26b9a693e0c5">beam_defaults</a>-&gt;damping_constant;
<a name="l04157"></a>04157     shock.<a class="code" href="structshock__t.html#ab357d6f6c438ddd3b0ce53b891156e16">springin</a>   = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a89dc983239b0355025a200862194ccfe" title="Spring value applied when the shock is compressing.">spring_in</a>;
<a name="l04158"></a>04158     shock.<a class="code" href="structshock__t.html#a2c3890b7c00f3312f5c8446e60f162f5">dampin</a>     = def.<a class="code" href="struct_rig_def_1_1_shock2.html#aebf1286d4b0ba5f7d9b1ae9aaecd4176" title="Damping value applied when the shock is compressing.">damp_in</a>;
<a name="l04159"></a>04159     shock.<a class="code" href="structshock__t.html#a52cd6b506a776ab5b83349eb65384e42">springout</a>  = def.<a class="code" href="struct_rig_def_1_1_shock2.html#aca9d508a5a145eb49491d705336738c6" title="spring value applied when shock extending">spring_out</a>;
<a name="l04160"></a>04160     shock.<a class="code" href="structshock__t.html#ad0296d88eb08466d3a5c826e8c99d43d">dampout</a>    = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a3c9da42224d7cf2609ba6bd578889edd" title="damping value applied when shock extending">damp_out</a>;
<a name="l04161"></a>04161     shock.<a class="code" href="structshock__t.html#a5e67812f7cd86c5410a3b8b56087b7da">sprogin</a>    = def.<a class="code" href="struct_rig_def_1_1_shock2.html#afb46b6fc8614072ef7a0fe2863049cde" title="Progression factor for springin. A value of 0 disables this option. 1...x as multipliers, example:maximum springrate == springrate + (factor*springrate)">progress_factor_spring_in</a>;
<a name="l04162"></a>04162     shock.<a class="code" href="structshock__t.html#ac67e8c73f4021fc4eabe58ab5e39c4bb">dprogin</a>    = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a6ae82f640b5cb8ba5800a14c3a99f74d" title="Progression factor for dampin. 0 = disabled, 1...x as multipliers, example:maximum dampingrate == spr...">progress_factor_damp_in</a>;
<a name="l04163"></a>04163     shock.<a class="code" href="structshock__t.html#a49fd2303968c7ed35db899d93ead2aba">sprogout</a>   = def.<a class="code" href="struct_rig_def_1_1_shock2.html#aadc9b0b323c74f1df132feda13eb7732" title="Progression factor springout, 0 = disabled, 1...x as multipliers, example:maximum springrate == sprin...">progress_factor_spring_out</a>;
<a name="l04164"></a>04164     shock.<a class="code" href="structshock__t.html#afe09d09b2dc2f8826e90a93348c3bdce">dprogout</a>   = def.<a class="code" href="struct_rig_def_1_1_shock2.html#a2d02dda4d5b2984fe645476804670a65" title="Progression factor dampout, 0 = disabled, 1...x as multipliers, example:maximum dampingrate == spring...">progress_factor_damp_out</a>;
<a name="l04165"></a>04165 
<a name="l04166"></a>04166     beam.<a class="code" href="structbeam__t.html#a398694fbd7b6f46eab876121d69ee02f">shock</a> = &amp; shock;
<a name="l04167"></a>04167     shock.<a class="code" href="structshock__t.html#aed2e4a946f40231f4fa8cff04717409b">beamid</a> = beam_index;
<a name="l04168"></a>04168 }
<a name="l04169"></a>04169 
<a name="l04170"></a><a class="code" href="class_rig_spawner.html#a05206213c0eaec3c3bf0571cbe48d1d5">04170</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a05206213c0eaec3c3bf0571cbe48d1d5">RigSpawner::ProcessShock</a>(<a class="code" href="struct_rig_def_1_1_shock.html">RigDef::Shock</a> &amp; def)
<a name="l04171"></a>04171 {
<a name="l04172"></a>04172     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04173"></a>04173 
<a name="l04174"></a>04174     <span class="keywordflow">if</span> (! CheckShockLimit(1) || ! CheckBeamLimit(1))
<a name="l04175"></a>04175     {
<a name="l04176"></a>04176         <span class="keywordflow">return</span>;
<a name="l04177"></a>04177     }
<a name="l04178"></a>04178 
<a name="l04179"></a>04179     <a class="code" href="structnode__t.html">node_t</a> &amp; node_1 = GetNode(def.<a class="code" href="struct_rig_def_1_1_shock.html#a6358d9af8f4e16ec0e394938c161bbed">nodes</a>[0]);
<a name="l04180"></a>04180     <a class="code" href="structnode__t.html">node_t</a> &amp; node_2 = GetNode(def.<a class="code" href="struct_rig_def_1_1_shock.html#a6358d9af8f4e16ec0e394938c161bbed">nodes</a>[1]);
<a name="l04181"></a>04181     <span class="keywordtype">float</span> short_bound = def.<a class="code" href="struct_rig_def_1_1_shock.html#a7e7f7ec2919da837e51d334a61549ae2" title="Maximum contraction. The shortest length the shock can be, as a proportion of its original length...">short_bound</a>;
<a name="l04182"></a>04182     <span class="keywordtype">float</span> long_bound = def.<a class="code" href="struct_rig_def_1_1_shock.html#a9f56bb2c3bffcf4e19c4728c40f967fb" title="Maximum extension. The longest length a shock can be, as a proportion of its original length...">long_bound</a>;
<a name="l04183"></a>04183     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l04184"></a>04184     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> shock_flags = <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da018fcd7fd5a8c7ba2dcbbaa35910cfeb">SHOCK_FLAG_NORMAL</a>;
<a name="l04185"></a>04185 
<a name="l04186"></a>04186     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock.html#a3010fbe5fe7d4834e4a53308692ab5ca" title="Bit flags.">options</a>, RigDef::Shock::OPTION_i_INVISIBLE))
<a name="l04187"></a>04187     {
<a name="l04188"></a>04188         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da86aa4d52e258bb9715a49015a1d7fe53">SHOCK_FLAG_INVISIBLE</a>);
<a name="l04189"></a>04189         hydro_type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a5be34e9e01ae386fa307a3aa737cb42f">BEAM_INVISIBLE_HYDRO</a>;
<a name="l04190"></a>04190     }
<a name="l04191"></a>04191     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock.html#a3010fbe5fe7d4834e4a53308692ab5ca" title="Bit flags.">options</a>, RigDef::Shock::OPTION_L_ACTIVE_LEFT))
<a name="l04192"></a>04192     {
<a name="l04193"></a>04193         <a class="code" href="_bit_flags_8h.html#a2acc2f1379be18c803fa356995d0dabd">BITMASK_SET_0</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da018fcd7fd5a8c7ba2dcbbaa35910cfeb">SHOCK_FLAG_NORMAL</a>); <span class="comment">/* Not normal anymore */</span>
<a name="l04194"></a>04194         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da8e19960237c16cfcae531d1e4f05a520">SHOCK_FLAG_LACTIVE</a>);
<a name="l04195"></a>04195         m_rig-&gt;free_active_shock++; <span class="comment">/* This has no array associated with it. its just to determine if there are active shocks! */</span>
<a name="l04196"></a>04196     }
<a name="l04197"></a>04197     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock.html#a3010fbe5fe7d4834e4a53308692ab5ca" title="Bit flags.">options</a>, RigDef::Shock::OPTION_L_ACTIVE_LEFT))
<a name="l04198"></a>04198     {
<a name="l04199"></a>04199         <a class="code" href="_bit_flags_8h.html#a2acc2f1379be18c803fa356995d0dabd">BITMASK_SET_0</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da018fcd7fd5a8c7ba2dcbbaa35910cfeb">SHOCK_FLAG_NORMAL</a>); <span class="comment">/* Not normal anymore */</span>
<a name="l04200"></a>04200         <a class="code" href="_bit_flags_8h.html#a8035c206e8a0c99371d29413fe0d0b57">BITMASK_SET_1</a>(shock_flags, <a class="code" href="_beam_data_8h.html#a0944a4353780132eeab7b06e3e42291da87cb137b9d9b1f920f2961d6b7da1f56">SHOCK_FLAG_RACTIVE</a>);
<a name="l04201"></a>04201         m_rig-&gt;free_active_shock++; <span class="comment">/* This has no array associated with it. its just to determine if there are active shocks! */</span>
<a name="l04202"></a>04202     }
<a name="l04203"></a>04203     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_shock.html#a3010fbe5fe7d4834e4a53308692ab5ca" title="Bit flags.">options</a>, RigDef::Shock::OPTION_m_METRIC))
<a name="l04204"></a>04204     {
<a name="l04205"></a>04205         <span class="keywordtype">float</span> beam_length = node_1.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.distance(node_2.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>);
<a name="l04206"></a>04206         short_bound /= beam_length;
<a name="l04207"></a>04207         long_bound /= beam_length;
<a name="l04208"></a>04208     }
<a name="l04209"></a>04209     
<a name="l04210"></a>04210     <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l04211"></a>04211     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(node_1, node_2, def.<a class="code" href="struct_rig_def_1_1_shock.html#aa04b58972b9518a4390e764fa4cac2fc">beam_defaults</a>, <a class="code" href="_beam_data_8h.html#a4caf8d8f829279fba122163d961608a4adb909700ae2e4f59afb0a7b7adccddff">DEFAULT_DETACHER_GROUP</a>);
<a name="l04212"></a>04212     beam.<a class="code" href="structbeam__t.html#af85ad7bcb782f7fcab155bc93ddcc27d">shortbound</a> = short_bound;
<a name="l04213"></a>04213     beam.<a class="code" href="structbeam__t.html#a4acafe687c44c7f729c2fafd9a8f3e3d">longbound</a>  = long_bound;
<a name="l04214"></a>04214     beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a>    = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a529ecdf951f828a68dac101249641a58" title="shock1">SHOCK1</a>;
<a name="l04215"></a>04215     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a>       = hydro_type;
<a name="l04216"></a>04216     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a>          = def.<a class="code" href="struct_rig_def_1_1_shock.html#a2f978bbd5d29cadd1cbcf4761651992e" title="The &#39;stiffness&#39; of the shock. The higher the value, the less the shock will move for a given bump...">spring_rate</a>;
<a name="l04217"></a>04217     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a>          = def.<a class="code" href="struct_rig_def_1_1_shock.html#a22ada094b49ea26de1724808f79d80ca" title="The &#39;resistance to motion&#39; of the shock. The best value is given by this equation: 2 * sqrt(suspended...">damping</a>;
<a name="l04218"></a>04218     SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_shock.html#aa04b58972b9518a4390e764fa4cac2fc">beam_defaults</a>-&gt;breaking_threshold_constant * 4.f);
<a name="l04219"></a>04219     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a>   = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l04220"></a>04220 
<a name="l04221"></a>04221     <span class="comment">/* Length + pre-compression */</span>
<a name="l04222"></a>04222     CalculateBeamLength(beam);
<a name="l04223"></a>04223     beam.<a class="code" href="structbeam__t.html#a97e6ce14fdcf35d1c7b8c40b40998ede" title="length">L</a>          *= def.<a class="code" href="struct_rig_def_1_1_shock.html#a626b09f4def0c0d03aaaab7bf341c7df" title="Changes compression or extension of the suspension when the truck spawns. This can be used to &quot;level&quot;...">precompression</a>;
<a name="l04224"></a>04224     beam.<a class="code" href="structbeam__t.html#ace384f1fca382d1df48d29c895a29bc3" title="reference length">refL</a>       *= def.<a class="code" href="struct_rig_def_1_1_shock.html#a626b09f4def0c0d03aaaab7bf341c7df" title="Changes compression or extension of the suspension when the truck spawns. This can be used to &quot;level&quot;...">precompression</a>;
<a name="l04225"></a>04225     beam.<a class="code" href="structbeam__t.html#a65d3452c6840de148c962b20defb45b6" title="hydro reference len">Lhydro</a>     *= def.<a class="code" href="struct_rig_def_1_1_shock.html#a626b09f4def0c0d03aaaab7bf341c7df" title="Changes compression or extension of the suspension when the truck spawns. This can be used to &quot;level&quot;...">precompression</a>;
<a name="l04226"></a>04226 
<a name="l04227"></a>04227     <a class="code" href="structshock__t.html">shock_t</a> &amp; shock  = GetFreeShock();
<a name="l04228"></a>04228     shock.<a class="code" href="structshock__t.html#ac15672f0e15504873d07b4d8124593f2">flags</a>      = shock_flags;
<a name="l04229"></a>04229     shock.<a class="code" href="structshock__t.html#acecec1828893e798ff56a8b7be346cb1" title="set beam default for spring">sbd_spring</a> = def.<a class="code" href="struct_rig_def_1_1_shock.html#aa04b58972b9518a4390e764fa4cac2fc">beam_defaults</a>-&gt;springiness;
<a name="l04230"></a>04230     shock.<a class="code" href="structshock__t.html#aa54a428648c23e2661e932758d3db794" title="set beam default for damping">sbd_damp</a>   = def.<a class="code" href="struct_rig_def_1_1_shock.html#aa04b58972b9518a4390e764fa4cac2fc">beam_defaults</a>-&gt;damping_constant;
<a name="l04231"></a>04231 
<a name="l04232"></a>04232     <span class="comment">/* Create beam visuals, but don&#39;t attach them to scene graph */</span>
<a name="l04233"></a>04233     <span class="comment">/* Old parser did it like this, I don&#39;t know why ~ only_a_ptr 13-04-14 */</span>
<a name="l04234"></a>04234     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_shock.html#aa04b58972b9518a4390e764fa4cac2fc">beam_defaults</a>, <span class="keyword">false</span>);
<a name="l04235"></a>04235 
<a name="l04236"></a>04236     beam.<a class="code" href="structbeam__t.html#a398694fbd7b6f46eab876121d69ee02f">shock</a> = &amp; shock;
<a name="l04237"></a>04237     shock.<a class="code" href="structshock__t.html#aed2e4a946f40231f4fa8cff04717409b">beamid</a> = beam_index;
<a name="l04238"></a>04238 }
<a name="l04239"></a>04239 
<a name="l04240"></a><a class="code" href="class_rig_spawner.html#ac1666ca45b7e9429ec6c075155e6391e">04240</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ac1666ca45b7e9429ec6c075155e6391e">RigSpawner::FetchAxisNodes</a>(
<a name="l04241"></a>04241     <a class="code" href="structnode__t.html">node_t</a>* &amp; axis_node_1, 
<a name="l04242"></a>04242     <a class="code" href="structnode__t.html">node_t</a>* &amp; axis_node_2, 
<a name="l04243"></a>04243     <a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; axis_node_1_id,
<a name="l04244"></a>04244     <a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; axis_node_2_id
<a name="l04245"></a>04245 )
<a name="l04246"></a>04246 {
<a name="l04247"></a>04247     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04248"></a>04248 
<a name="l04249"></a>04249     axis_node_1 = GetNodePointer(axis_node_1_id);
<a name="l04250"></a>04250     axis_node_2 = GetNodePointer(axis_node_2_id);
<a name="l04251"></a>04251 
<a name="l04252"></a>04252     <span class="comment">/* Enforce the &quot;second node must have a larger Z coordinate than the first&quot; constraint */</span>
<a name="l04253"></a>04253     <span class="keywordflow">if</span> (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z &gt; axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z)
<a name="l04254"></a>04254     {
<a name="l04255"></a>04255         <a class="code" href="structnode__t.html">node_t</a> *swap = axis_node_1;
<a name="l04256"></a>04256         axis_node_1 = axis_node_2;
<a name="l04257"></a>04257         axis_node_2 = swap;
<a name="l04258"></a>04258     }   
<a name="l04259"></a>04259 }
<a name="l04260"></a>04260 
<a name="l04261"></a><a class="code" href="class_rig_spawner.html#a74b318d0efa34034129ae112311faa4c">04261</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a74b318d0efa34034129ae112311faa4c">RigSpawner::ProcessFlexBodyWheel</a>(<a class="code" href="struct_rig_def_1_1_flex_body_wheel.html">RigDef::FlexBodyWheel</a> &amp; def)
<a name="l04262"></a>04262 {   
<a name="l04263"></a>04263     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04264"></a>04264 
<a name="l04265"></a>04265     <span class="comment">/* Check capacities */</span>
<a name="l04266"></a>04266     CheckNodeLimit(def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 4);
<a name="l04267"></a>04267     CheckBeamLimit(def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * (def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>()) ? 26 : 25);
<a name="l04268"></a>04268     CheckFlexbodyLimit(1);
<a name="l04269"></a>04269 
<a name="l04270"></a>04270     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index = m_rig-&gt;free_node;
<a name="l04271"></a>04271     <a class="code" href="structwheel__t.html">wheel_t</a> &amp; wheel = m_rig-&gt;wheels[m_rig-&gt;free_wheel];
<a name="l04272"></a>04272 
<a name="l04273"></a>04273     <a class="code" href="structnode__t.html">node_t</a> *axis_node_1 = <span class="keyword">nullptr</span>;
<a name="l04274"></a>04274     <a class="code" href="structnode__t.html">node_t</a> *axis_node_2 = <span class="keyword">nullptr</span>;
<a name="l04275"></a>04275     FetchAxisNodes(axis_node_1, axis_node_2, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0], def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]);
<a name="l04276"></a>04276 
<a name="l04277"></a>04277     <span class="comment">/* Rigidity node */</span>
<a name="l04278"></a>04278     <a class="code" href="structnode__t.html">node_t</a> *rigidity_node = <span class="keyword">nullptr</span>;
<a name="l04279"></a>04279     <a class="code" href="structnode__t.html">node_t</a> *axis_node_closest_to_rigidity_node = <span class="keyword">nullptr</span>;
<a name="l04280"></a>04280     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l04281"></a>04281     {
<a name="l04282"></a>04282         rigidity_node = GetNodePointer(def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>);
<a name="l04283"></a>04283         Ogre::Real distance_1 = (rigidity_node-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l04284"></a>04284         Ogre::Real distance_2 = (rigidity_node-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l04285"></a>04285         axis_node_closest_to_rigidity_node = ((distance_1 &lt; distance_2)) ? axis_node_1 : axis_node_2;
<a name="l04286"></a>04286     }
<a name="l04287"></a>04287 
<a name="l04288"></a>04288     <span class="comment">/* Node&amp;beam generation */</span>
<a name="l04289"></a>04289     Ogre::Vector3 axis_vector = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>;
<a name="l04290"></a>04290     wheel.<a class="code" href="structwheel__t.html#ac81081cce7bc97477a1595c3fb9b11d6">width</a> = axis_vector.length(); <span class="comment">/* wheel_def.width is ignored. */</span>
<a name="l04291"></a>04291     axis_vector.normalise();
<a name="l04292"></a>04292     Ogre::Vector3 rim_ray_vector = axis_vector.perpendicular() * def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a>;
<a name="l04293"></a>04293     Ogre::Quaternion rim_ray_rotator = Ogre::Quaternion(Ogre::Degree(-360.f / (def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2)), axis_vector);
<a name="l04294"></a>04294 
<a name="l04295"></a>04295     <span class="comment">/* Rim nodes */</span>
<a name="l04296"></a>04296     <span class="comment">/* NOTE: node.iswheel is not used for rim nodes */</span>
<a name="l04297"></a>04297     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l04298"></a>04298     {
<a name="l04299"></a>04299         <span class="keywordtype">float</span> node_mass = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a> / (4.f * def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l04300"></a>04300 
<a name="l04301"></a>04301         <span class="comment">/* Outer ring */</span>
<a name="l04302"></a>04302         Ogre::Vector3 ray_point = axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + rim_ray_vector;
<a name="l04303"></a>04303         rim_ray_vector = rim_ray_rotator * rim_ray_vector;
<a name="l04304"></a>04304 
<a name="l04305"></a>04305         <a class="code" href="structnode__t.html">node_t</a> &amp; outer_node      = GetFreeNode();
<a name="l04306"></a>04306         InitNode(outer_node, ray_point, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l04307"></a>04307 
<a name="l04308"></a>04308         outer_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>          = node_mass;
<a name="l04309"></a>04309         outer_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>            = -1; <span class="comment">// Orig: hardcoded (addWheel2)</span>
<a name="l04310"></a>04310         outer_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a>       = m_rig-&gt;free_wheel;
<a name="l04311"></a>04311         outer_node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;friction;
<a name="l04312"></a>04312         AdjustNodeBuoyancy(outer_node, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l04313"></a>04313 
<a name="l04314"></a>04314         <span class="comment">/* Inner ring */</span>
<a name="l04315"></a>04315         ray_point = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + rim_ray_vector;
<a name="l04316"></a>04316         rim_ray_vector = rim_ray_rotator * rim_ray_vector;
<a name="l04317"></a>04317 
<a name="l04318"></a>04318         <a class="code" href="structnode__t.html">node_t</a> &amp; inner_node      = GetFreeNode();
<a name="l04319"></a>04319         InitNode(inner_node, ray_point, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l04320"></a>04320 
<a name="l04321"></a>04321         inner_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>          = node_mass;
<a name="l04322"></a>04322         inner_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>            = -1; <span class="comment">// Orig: hardcoded (addWheel2)</span>
<a name="l04323"></a>04323         inner_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a>       = m_rig-&gt;free_wheel;
<a name="l04324"></a>04324         inner_node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;friction;
<a name="l04325"></a>04325         AdjustNodeBuoyancy(inner_node, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l04326"></a>04326 
<a name="l04327"></a>04327         <span class="comment">/* Wheel object */</span>
<a name="l04328"></a>04328         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[i * 2]       = &amp; outer_node;
<a name="l04329"></a>04329         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[(i * 2) + 1] = &amp; inner_node;
<a name="l04330"></a>04330     }
<a name="l04331"></a>04331 
<a name="l04332"></a>04332     Ogre::Vector3 tyre_ray_vector = axis_vector.perpendicular() * def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>;
<a name="l04333"></a>04333     Ogre::Quaternion&amp; tyre_ray_rotator = rim_ray_rotator;
<a name="l04334"></a>04334     tyre_ray_vector = tyre_ray_rotator * tyre_ray_vector;
<a name="l04335"></a>04335 
<a name="l04336"></a>04336     <span class="comment">/* Tyre nodes */</span>
<a name="l04337"></a>04337     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l04338"></a>04338     {
<a name="l04339"></a>04339         <span class="comment">/* Outer ring */</span>
<a name="l04340"></a>04340         <span class="keywordtype">float</span> node_mass = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a> / (4.f * def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l04341"></a>04341         Ogre::Vector3 ray_point = axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + tyre_ray_vector;
<a name="l04342"></a>04342         tyre_ray_vector = tyre_ray_rotator * tyre_ray_vector;
<a name="l04343"></a>04343 
<a name="l04344"></a>04344         <a class="code" href="structnode__t.html">node_t</a> &amp; outer_node = GetFreeNode();
<a name="l04345"></a>04345         InitNode(outer_node, ray_point);
<a name="l04346"></a>04346         outer_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>          = node_mass;
<a name="l04347"></a>04347         outer_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>            = -1; <span class="comment">// Orig: hardcoded (addWheel3)</span>
<a name="l04348"></a>04348         outer_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a>       = m_rig-&gt;free_wheel;
<a name="l04349"></a>04349         outer_node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;friction;
<a name="l04350"></a>04350         outer_node.<a class="code" href="structnode__t.html#a0b5dc5e5d52e4ceb38098496e2ceb889">volume_coef</a>   = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;volume;
<a name="l04351"></a>04351         outer_node.<a class="code" href="structnode__t.html#af1f7dc09cc03753872adca7816e572b5">surface_coef</a>  = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;surface;
<a name="l04352"></a>04352         outer_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a>       = m_rig-&gt;free_wheel*2+1;
<a name="l04353"></a>04353         AdjustNodeBuoyancy(outer_node, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l04354"></a>04354 
<a name="l04355"></a>04355         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; outer_contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l04356"></a>04356         outer_contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = outer_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l04357"></a>04357         outer_contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l04358"></a>04358         outer_contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l04359"></a>04359         m_rig-&gt;free_contacter++;
<a name="l04360"></a>04360 
<a name="l04361"></a>04361         <span class="comment">/* Inner ring */</span>
<a name="l04362"></a>04362         ray_point = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + tyre_ray_vector;
<a name="l04363"></a>04363         tyre_ray_vector = tyre_ray_rotator * tyre_ray_vector;
<a name="l04364"></a>04364 
<a name="l04365"></a>04365         <a class="code" href="structnode__t.html">node_t</a> &amp; inner_node = GetFreeNode();
<a name="l04366"></a>04366         InitNode(inner_node, ray_point);
<a name="l04367"></a>04367         inner_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>          = node_mass;
<a name="l04368"></a>04368         inner_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>            = -1; <span class="comment">// Orig: hardcoded (addWheel3)</span>
<a name="l04369"></a>04369         inner_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a>       = m_rig-&gt;free_wheel;
<a name="l04370"></a>04370         inner_node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;friction;
<a name="l04371"></a>04371         inner_node.<a class="code" href="structnode__t.html#a0b5dc5e5d52e4ceb38098496e2ceb889">volume_coef</a>   = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;volume;
<a name="l04372"></a>04372         inner_node.<a class="code" href="structnode__t.html#af1f7dc09cc03753872adca7816e572b5">surface_coef</a>  = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;surface;
<a name="l04373"></a>04373         inner_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a>       = m_rig-&gt;free_wheel*2+2;
<a name="l04374"></a>04374         AdjustNodeBuoyancy(inner_node, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l04375"></a>04375 
<a name="l04376"></a>04376         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; inner_contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l04377"></a>04377         inner_contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = inner_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l04378"></a>04378         inner_contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l04379"></a>04379         inner_contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l04380"></a>04380         m_rig-&gt;free_contacter++;
<a name="l04381"></a>04381 
<a name="l04382"></a>04382         <span class="comment">/* Wheel object */</span>
<a name="l04383"></a>04383         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[i * 2] = &amp; outer_node;
<a name="l04384"></a>04384         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[(i * 2) + 1] = &amp; inner_node;
<a name="l04385"></a>04385     }
<a name="l04386"></a>04386 
<a name="l04387"></a>04387     <span class="comment">/* Beams */</span>
<a name="l04388"></a>04388     <span class="keywordtype">float</span> strength = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>-&gt;breaking_threshold_constant;
<a name="l04389"></a>04389     <span class="keywordtype">float</span> rim_spring = def.<a class="code" href="struct_rig_def_1_1_flex_body_wheel.html#a7589328ba94874767a17f9d5431ca375">rim_springiness</a>;
<a name="l04390"></a>04390     <span class="keywordtype">float</span> rim_damp = def.<a class="code" href="struct_rig_def_1_1_flex_body_wheel.html#ab83cd72d8fe87b9ccc698ca4aefb27da">rim_damping</a>;
<a name="l04391"></a>04391     <span class="keywordtype">float</span> tyre_spring = def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#ad3d997d002b790fba62a9cf73690e94d">tyre_springiness</a>;
<a name="l04392"></a>04392     <span class="keywordtype">float</span> tyre_damp = def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a610463f462d96962e86e0121dbf94c62">tyre_damping</a>;
<a name="l04393"></a>04393     <span class="keywordtype">float</span> tread_spring = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>-&gt;springiness;
<a name="l04394"></a>04394     <span class="keywordtype">float</span> tread_damp = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>-&gt;damping_constant;
<a name="l04395"></a>04395     <span class="comment">/* </span>
<a name="l04396"></a>04396 <span class="comment">        Calculate the point where the support beams get stiff and prevent the tire tread nodes </span>
<a name="l04397"></a>04397 <span class="comment">        bounce into the rim rimradius / tire radius and add 5%, this is a shortbound calc in % ! </span>
<a name="l04398"></a>04398 <span class="comment">    */</span>
<a name="l04399"></a>04399     <span class="keywordtype">float</span> support_beams_short_bound = 1.0f - ((def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a> / def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>) * 0.95f);
<a name="l04400"></a>04400 
<a name="l04401"></a>04401     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l04402"></a>04402     {
<a name="l04403"></a>04403         <span class="comment">/* --- Rim ---  */</span>
<a name="l04404"></a>04404 
<a name="l04405"></a>04405         <span class="comment">/* Rim axis to rim ring */</span>
<a name="l04406"></a>04406         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rim_outer_node_index = base_node_index + (i * 2);
<a name="l04407"></a>04407         <a class="code" href="structnode__t.html">node_t</a> *rim_outer_node = &amp; m_rig-&gt;nodes[rim_outer_node_index];
<a name="l04408"></a>04408         <a class="code" href="structnode__t.html">node_t</a> *rim_inner_node = &amp; m_rig-&gt;nodes[rim_outer_node_index + 1];
<a name="l04409"></a>04409 
<a name="l04410"></a>04410         AddWheelBeam(axis_node_1, rim_outer_node, rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04411"></a>04411         AddWheelBeam(axis_node_2, rim_inner_node, rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04412"></a>04412         AddWheelBeam(axis_node_2, rim_outer_node, rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04413"></a>04413         AddWheelBeam(axis_node_1, rim_inner_node, rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04414"></a>04414 
<a name="l04415"></a>04415         <span class="comment">/* Reinforcement rim ring */</span>
<a name="l04416"></a>04416         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rim_next_outer_node_index = base_node_index + (((i + 1) % def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>) * 2);
<a name="l04417"></a>04417         <a class="code" href="structnode__t.html">node_t</a> *rim_next_outer_node = &amp; m_rig-&gt;nodes[rim_next_outer_node_index];
<a name="l04418"></a>04418         <a class="code" href="structnode__t.html">node_t</a> *rim_next_inner_node = &amp; m_rig-&gt;nodes[rim_next_outer_node_index + 1];
<a name="l04419"></a>04419 
<a name="l04420"></a>04420         AddWheelBeam(rim_outer_node, rim_inner_node,      rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04421"></a>04421         AddWheelBeam(rim_outer_node, rim_next_outer_node, rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04422"></a>04422         AddWheelBeam(rim_inner_node, rim_next_inner_node, rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04423"></a>04423         AddWheelBeam(rim_inner_node, rim_next_outer_node, rim_spring, rim_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04424"></a>04424     }
<a name="l04425"></a>04425 
<a name="l04426"></a>04426     <span class="comment">/* Tyre beams */</span>
<a name="l04427"></a>04427     <span class="comment">/* Quick&amp;dirty port from original SerializedRig::addWheel3() */</span>
<a name="l04428"></a>04428     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l04429"></a>04429     {
<a name="l04430"></a>04430         <span class="keywordtype">int</span> rim_node_index    = base_node_index + i*2;
<a name="l04431"></a>04431         <span class="keywordtype">int</span> tyre_node_index   = base_node_index + i*2 + def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>*2;
<a name="l04432"></a>04432         <a class="code" href="structnode__t.html">node_t</a> * rim_node     = &amp; m_rig-&gt;nodes[rim_node_index];
<a name="l04433"></a>04433 
<a name="l04434"></a>04434         AddWheelBeam(rim_node, &amp; m_rig-&gt;nodes[tyre_node_index], tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04435"></a>04435 
<a name="l04436"></a>04436         <span class="keywordtype">int</span> tyre_base_index = (i == 0) ? tyre_node_index + (def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2) : tyre_node_index;
<a name="l04437"></a>04437         AddWheelBeam(rim_node, &amp; m_rig-&gt;nodes[tyre_base_index - 1], tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04438"></a>04438         AddWheelBeam(rim_node, &amp; m_rig-&gt;nodes[tyre_base_index - 2], tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04439"></a>04439 
<a name="l04440"></a>04440         <a class="code" href="structnode__t.html">node_t</a> * next_rim_node = &amp; m_rig-&gt;nodes[rim_node_index + 1];
<a name="l04441"></a>04441         AddWheelBeam(next_rim_node, &amp; m_rig-&gt;nodes[tyre_node_index],     tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04442"></a>04442         AddWheelBeam(next_rim_node, &amp; m_rig-&gt;nodes[tyre_node_index + 1], tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04443"></a>04443 
<a name="l04444"></a>04444         {   
<a name="l04445"></a>04445             <span class="keywordtype">int</span> index = (i == 0) ? tyre_node_index + (def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2) - 1 : tyre_node_index - 1;
<a name="l04446"></a>04446             <a class="code" href="structnode__t.html">node_t</a> * tyre_node = &amp; m_rig-&gt;nodes[index];
<a name="l04447"></a>04447             AddWheelBeam(next_rim_node, tyre_node, tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04448"></a>04448         }
<a name="l04449"></a>04449         
<a name="l04450"></a>04450         <span class="comment">//reinforcement (tire tread)</span>
<a name="l04451"></a>04451         {
<a name="l04452"></a>04452             <span class="comment">// Very messy port :(</span>
<a name="l04453"></a>04453             <span class="comment">// Aliases</span>
<a name="l04454"></a>04454             <span class="keywordtype">int</span> rimnode = rim_node_index;
<a name="l04455"></a>04455             <span class="keywordtype">int</span> rays = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>;
<a name="l04456"></a>04456 
<a name="l04457"></a>04457             AddWheelBeam(&amp;m_rig-&gt;nodes[rimnode+rays*2], &amp;m_rig-&gt;nodes[base_node_index+i*2+1+rays*2], tread_spring, tread_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04458"></a>04458             AddWheelBeam(&amp;m_rig-&gt;nodes[rimnode+rays*2], &amp;m_rig-&gt;nodes[base_node_index+((i+1)%rays)*2+rays*2], tread_spring, tread_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04459"></a>04459             AddWheelBeam(&amp;m_rig-&gt;nodes[base_node_index+i*2+1+rays*2], &amp;m_rig-&gt;nodes[base_node_index+((i+1)%rays)*2+1+rays*2], tread_spring, tread_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04460"></a>04460             AddWheelBeam(&amp;m_rig-&gt;nodes[rimnode+1+rays*2], &amp;m_rig-&gt;nodes[base_node_index+((i+1)%rays)*2+rays*2], tread_spring, tread_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04461"></a>04461 
<a name="l04462"></a>04462             <span class="keywordflow">if</span> (rigidity_node != <span class="keyword">nullptr</span>)
<a name="l04463"></a>04463             {
<a name="l04464"></a>04464                 
<a name="l04465"></a>04465                 <span class="keywordflow">if</span> (axis_node_closest_to_rigidity_node == axis_node_1)
<a name="l04466"></a>04466                 {
<a name="l04467"></a>04467                     axis_node_closest_to_rigidity_node = &amp; m_rig-&gt;nodes[base_node_index+i*2+rays*2];
<a name="l04468"></a>04468                 } <span class="keywordflow">else</span>
<a name="l04469"></a>04469                 {
<a name="l04470"></a>04470                     axis_node_closest_to_rigidity_node = &amp; m_rig-&gt;nodes[base_node_index+i*2+1+rays*2];
<a name="l04471"></a>04471                 };
<a name="l04472"></a>04472                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index = AddWheelBeam(rigidity_node, axis_node_closest_to_rigidity_node, tyre_spring, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04473"></a>04473                 GetBeam(beam_index).type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a9b28f43cd91bf9ab179c58fa77a613d6">BEAM_VIRTUAL</a>;
<a name="l04474"></a>04474             }
<a name="l04475"></a>04475         }
<a name="l04476"></a>04476     }
<a name="l04477"></a>04477 
<a name="l04478"></a>04478     <span class="comment">//calculate the point where the support beams get stiff and prevent the tire tread nodes bounce into the rim rimradius / tire radius and add 5%, this is a shortbound calc in % !</span>
<a name="l04479"></a>04479     <span class="keywordtype">float</span> length = 1.0f - ((def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a> / def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>) * 0.95f);
<a name="l04480"></a>04480     <span class="keywordtype">float</span> ropespring = def.<a class="code" href="struct_rig_def_1_1_flex_body_wheel.html#a7589328ba94874767a17f9d5431ca375">rim_springiness</a>;
<a name="l04481"></a>04481 
<a name="l04482"></a>04482     <span class="keywordflow">if</span> (ropespring &lt;= <a class="code" href="_beam_data_8h.html#a049040ae0d86d8d3abce13f440368090">DEFAULT_SPRING</a>)
<a name="l04483"></a>04483         ropespring = <a class="code" href="_beam_data_8h.html#a049040ae0d86d8d3abce13f440368090">DEFAULT_SPRING</a>;
<a name="l04484"></a>04484 
<a name="l04485"></a>04485     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l04486"></a>04486     {
<a name="l04487"></a>04487         <span class="comment">//tiretread anti collapse reinforcements, using precalced support beams</span>
<a name="l04488"></a>04488         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tirenode = base_node_index + i*2 + def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>*2;
<a name="l04489"></a>04489         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index;
<a name="l04490"></a>04490 
<a name="l04491"></a>04491         beam_index = AddWheelBeam(axis_node_1, &amp;m_rig-&gt;nodes[tirenode],     tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04492"></a>04492         GetBeam(beam_index).shortbound = length;
<a name="l04493"></a>04493         GetBeam(beam_index).longbound  = 0.f;
<a name="l04494"></a>04494         GetBeam(beam_index).bounded = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a529ecdf951f828a68dac101249641a58" title="shock1">SHOCK1</a>;
<a name="l04495"></a>04495 
<a name="l04496"></a>04496         beam_index = AddWheelBeam(axis_node_2, &amp;m_rig-&gt;nodes[tirenode + 1], tyre_spring/2.f, tyre_damp, def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>);
<a name="l04497"></a>04497         GetBeam(beam_index).shortbound = length;
<a name="l04498"></a>04498         GetBeam(beam_index).longbound  = 0.f;
<a name="l04499"></a>04499         GetBeam(beam_index).bounded = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a529ecdf951f828a68dac101249641a58" title="shock1">SHOCK1</a>;
<a name="l04500"></a>04500     }
<a name="l04501"></a>04501 
<a name="l04502"></a>04502     <span class="comment">/* Wheel object */</span>
<a name="l04503"></a>04503     wheel.<a class="code" href="structwheel__t.html#adb4ed40345c4bb7e19d788b050149300">braked</a> = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a>;
<a name="l04504"></a>04504     wheel.<a class="code" href="structwheel__t.html#a65e28800f237ae95c86b0bea0942f5b9">propulsed</a> = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a>;
<a name="l04505"></a>04505     wheel.<a class="code" href="structwheel__t.html#a02c5f9e521db3371c7e212588ccc319a">nbnodes</a> = 2 * def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>;
<a name="l04506"></a>04506     wheel.<a class="code" href="structwheel__t.html#a6cf8fe4b687a7e4abe51819eac224bc1">refnode0</a> = axis_node_1;
<a name="l04507"></a>04507     wheel.<a class="code" href="structwheel__t.html#a507a081a13d6c5a10e75c31a341e2fad">refnode1</a> = axis_node_2;
<a name="l04508"></a>04508     wheel.<a class="code" href="structwheel__t.html#ae855fe55ef613caa097a04cee756ea74">radius</a> = def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>;
<a name="l04509"></a>04509     wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a> = GetNodePointer(def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a>);
<a name="l04510"></a>04510 
<a name="l04511"></a>04511     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a> != <a class="code" href="struct_rig_def_1_1_wheels.html#a07d9912ae1c5e7f667cb8c75661dbbfdac9aba3f776881618d2964d9da37a0fa5">RigDef::Wheels::PROPULSION_NONE</a>)
<a name="l04512"></a>04512     {
<a name="l04513"></a>04513         <span class="comment">/* for inter-differential locking */</span>
<a name="l04514"></a>04514         m_rig-&gt;proped_wheels++;
<a name="l04515"></a>04515         m_rig-&gt;proppairs[m_rig-&gt;proped_wheels] = m_rig-&gt;free_wheel;
<a name="l04516"></a>04516         m_rig-&gt;propwheelcount++;
<a name="l04517"></a>04517     }
<a name="l04518"></a>04518     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a> != <a class="code" href="struct_rig_def_1_1_wheels.html#aadb771065ed24e681acf7ab7e2520bc5a8b6fb3addf046eb5ca89430156a86fae">RigDef::Wheels::BRAKING_NO</a>)
<a name="l04519"></a>04519     {
<a name="l04520"></a>04520         m_rig-&gt;braked_wheels++;
<a name="l04521"></a>04521     }
<a name="l04522"></a>04522 
<a name="l04523"></a>04523     <span class="comment">/* Find near attach */</span>
<a name="l04524"></a>04524     Ogre::Real length_1 = (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l04525"></a>04525     Ogre::Real length_2 = (axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l04526"></a>04526     wheel.<a class="code" href="structwheel__t.html#afd87b102a9f5ae471095bfbcff958862">near_attach</a> = (length_1 &lt; length_2) ? axis_node_1 : axis_node_2;
<a name="l04527"></a>04527 
<a name="l04528"></a>04528     <span class="comment">/* Create visuals */</span>
<a name="l04529"></a>04529     BuildMeshWheelVisuals(
<a name="l04530"></a>04530         m_rig-&gt;free_wheel, 
<a name="l04531"></a>04531         base_node_index, 
<a name="l04532"></a>04532         axis_node_1-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04533"></a>04533         axis_node_2-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04534"></a>04534         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l04535"></a>04535         def.<a class="code" href="struct_rig_def_1_1_flex_body_wheel.html#a64678fa2a6ef6b255142d987e2e6c75e">rim_mesh_name</a>,
<a name="l04536"></a>04536         <span class="stringliteral">&quot;tracks/trans&quot;</span>, <span class="comment">// Rim material name. Original parser: was hardcoded in BTS_FLEXBODYWHEELS</span>
<a name="l04537"></a>04537         def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a>,
<a name="l04538"></a>04538         def.<a class="code" href="struct_rig_def_1_1_flex_body_wheel.html#a58948637a6c30d8f732a77a5a366c9d2">side</a> != <a class="code" href="struct_rig_def_1_1_mesh_wheel.html#af699d01e3d1bda900be710256d58f9f7abcee8ea57fa8ca53df33f548c504460f">RigDef::MeshWheel::SIDE_RIGHT</a>
<a name="l04539"></a>04539         );
<a name="l04540"></a>04540 
<a name="l04541"></a>04541     <span class="comment">/* Create flexbody */</span>
<a name="l04542"></a>04542     <span class="keywordtype">char</span> flexbody_name[256];
<a name="l04543"></a>04543     sprintf(flexbody_name, <span class="stringliteral">&quot;flexbody-%s-%i&quot;</span>, m_rig-&gt;truckname, m_rig-&gt;free_flexbody);
<a name="l04544"></a>04544 
<a name="l04545"></a>04545     <span class="keywordtype">int</span> num_nodes = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 4;
<a name="l04546"></a>04546     std::vector&lt;unsigned int&gt; node_indices;
<a name="l04547"></a>04547     node_indices.reserve(num_nodes);
<a name="l04548"></a>04548     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; num_nodes; ++i)
<a name="l04549"></a>04549     {
<a name="l04550"></a>04550         node_indices.push_back( base_node_index + i );
<a name="l04551"></a>04551     }
<a name="l04552"></a>04552 
<a name="l04553"></a>04553     m_rig-&gt;flexbodies[m_rig-&gt;free_flexbody] = m_flex_factory.CreateFlexBody(
<a name="l04554"></a>04554         m_rig-&gt;free_node,
<a name="l04555"></a>04555         def.<a class="code" href="struct_rig_def_1_1_flex_body_wheel.html#a11b657fed9e49b2f395483964bc18d77">tyre_mesh_name</a>.c_str(),
<a name="l04556"></a>04556         flexbody_name,
<a name="l04557"></a>04557         axis_node_1-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04558"></a>04558         axis_node_2-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04559"></a>04559         <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(base_node_index),
<a name="l04560"></a>04560         Ogre::Vector3(0.5,0,0),
<a name="l04561"></a>04561         Ogre::Quaternion::ZERO,
<a name="l04562"></a>04562         node_indices
<a name="l04563"></a>04563         );
<a name="l04564"></a>04564 
<a name="l04565"></a>04565     m_rig-&gt;free_flexbody++;
<a name="l04566"></a>04566 
<a name="l04567"></a>04567     <span class="comment">/* Advance */</span>
<a name="l04568"></a>04568     m_rig-&gt;free_wheel++;
<a name="l04569"></a>04569 }
<a name="l04570"></a>04570 
<a name="l04571"></a><a class="code" href="class_rig_spawner.html#ad72c148d1e31707da1c46f6db608a4fa">04571</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ad72c148d1e31707da1c46f6db608a4fa">RigSpawner::ProcessMeshWheel</a>(<a class="code" href="struct_rig_def_1_1_mesh_wheel.html">RigDef::MeshWheel</a> &amp; meshwheel_def)
<a name="l04572"></a>04572 {
<a name="l04573"></a>04573     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04574"></a>04574 
<a name="l04575"></a>04575     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index = m_rig-&gt;free_node;
<a name="l04576"></a>04576     <a class="code" href="structnode__t.html">node_t</a> *axis_node_1 = GetNodePointer(meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0]);
<a name="l04577"></a>04577     <a class="code" href="structnode__t.html">node_t</a> *axis_node_2 = GetNodePointer(meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]);
<a name="l04578"></a>04578 
<a name="l04579"></a>04579     <span class="comment">/* Enforce the &quot;second node must have a larger Z coordinate than the first&quot; constraint */</span>
<a name="l04580"></a>04580     <span class="keywordflow">if</span> (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z &gt; axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z)
<a name="l04581"></a>04581     {
<a name="l04582"></a>04582         <a class="code" href="structnode__t.html">node_t</a> *swap = axis_node_1;
<a name="l04583"></a>04583         axis_node_1 = axis_node_2;
<a name="l04584"></a>04584         axis_node_2 = swap;
<a name="l04585"></a>04585     }   
<a name="l04586"></a>04586 
<a name="l04587"></a>04587     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index = BuildWheelObjectAndNodes(
<a name="l04588"></a>04588         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l04589"></a>04589         axis_node_1,
<a name="l04590"></a>04590         axis_node_2,
<a name="l04591"></a>04591         GetNodePointer(meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a>),
<a name="l04592"></a>04592         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2,
<a name="l04593"></a>04593         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 8,
<a name="l04594"></a>04594         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a1940add20de2127b3a1dab8be6246368">tyre_radius</a>,
<a name="l04595"></a>04595         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a>,
<a name="l04596"></a>04596         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a>,
<a name="l04597"></a>04597         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>,
<a name="l04598"></a>04598         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a>
<a name="l04599"></a>04599     );
<a name="l04600"></a>04600 
<a name="l04601"></a>04601     BuildWheelBeams(
<a name="l04602"></a>04602         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l04603"></a>04603         base_node_index,
<a name="l04604"></a>04604         axis_node_1,
<a name="l04605"></a>04605         axis_node_2,
<a name="l04606"></a>04606         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a7aad96759a4a928bab56cb63e78db2e7">spring</a>,      <span class="comment">/* Tyre */</span>
<a name="l04607"></a>04607         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a5f3d5a2415bec8eb5ac515c701a2da7c">damping</a>,     <span class="comment">/* Tyre */</span>
<a name="l04608"></a>04608         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a7aad96759a4a928bab56cb63e78db2e7">spring</a>,      <span class="comment">/* Rim */</span>
<a name="l04609"></a>04609         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a5f3d5a2415bec8eb5ac515c701a2da7c">damping</a>,     <span class="comment">/* Rim */</span>
<a name="l04610"></a>04610         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>,
<a name="l04611"></a>04611         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>
<a name="l04612"></a>04612     );
<a name="l04613"></a>04613 
<a name="l04614"></a>04614     BuildMeshWheelVisuals(
<a name="l04615"></a>04615         wheel_index, 
<a name="l04616"></a>04616         base_node_index, 
<a name="l04617"></a>04617         axis_node_1-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04618"></a>04618         axis_node_2-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04619"></a>04619         meshwheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l04620"></a>04620         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a09cabf7baa4911b9ef88757fa7e99ec5">mesh_name</a>,
<a name="l04621"></a>04621         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a5ea041d0cba6dd6e4e19a528cf3ac2a7">material_name</a>,
<a name="l04622"></a>04622         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a68d9460a2c63c863476987672d58c01f">rim_radius</a>,
<a name="l04623"></a>04623         meshwheel_def.<a class="code" href="struct_rig_def_1_1_mesh_wheel.html#a1c790d8fbe8e794963a4795a2c71c066">side</a> != <a class="code" href="struct_rig_def_1_1_mesh_wheel.html#af699d01e3d1bda900be710256d58f9f7abcee8ea57fa8ca53df33f548c504460f">RigDef::MeshWheel::SIDE_RIGHT</a>
<a name="l04624"></a>04624         );
<a name="l04625"></a>04625 }
<a name="l04626"></a>04626 
<a name="l04627"></a><a class="code" href="class_rig_spawner.html#aae67054f7f6994dfa4accc9ceebbf0f0">04627</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aae67054f7f6994dfa4accc9ceebbf0f0">RigSpawner::ProcessMeshWheel2</a>(<a class="code" href="struct_rig_def_1_1_mesh_wheel2.html">RigDef::MeshWheel2</a> &amp; def)
<a name="l04628"></a>04628 {
<a name="l04629"></a>04629     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04630"></a>04630 
<a name="l04631"></a>04631     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index = m_rig-&gt;free_node;
<a name="l04632"></a>04632     <a class="code" href="structnode__t.html">node_t</a> *axis_node_1 = GetNodePointer(def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0]);
<a name="l04633"></a>04633     <a class="code" href="structnode__t.html">node_t</a> *axis_node_2 = GetNodePointer(def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]);
<a name="l04634"></a>04634 
<a name="l04635"></a>04635     <span class="keywordflow">if</span> (axis_node_1 == <span class="keyword">nullptr</span> || axis_node_2 == <span class="keyword">nullptr</span>)
<a name="l04636"></a>04636     {
<a name="l04637"></a>04637         this-&gt;AddMessage(Message::TYPE_ERROR, <span class="stringliteral">&quot;Failed to find axis nodes, skipping meshwheel2...&quot;</span>);
<a name="l04638"></a>04638         <span class="keywordflow">return</span>;
<a name="l04639"></a>04639     }
<a name="l04640"></a>04640 
<a name="l04641"></a>04641     <span class="comment">/* Enforce the &quot;second node must have a larger Z coordinate than the first&quot; constraint */</span>
<a name="l04642"></a>04642     <span class="keywordflow">if</span> (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z &gt; axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z)
<a name="l04643"></a>04643     {
<a name="l04644"></a>04644         <a class="code" href="structnode__t.html">node_t</a> *swap = axis_node_1;
<a name="l04645"></a>04645         axis_node_1 = axis_node_2;
<a name="l04646"></a>04646         axis_node_2 = swap;
<a name="l04647"></a>04647     }   
<a name="l04648"></a>04648 
<a name="l04649"></a>04649     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index = BuildWheelObjectAndNodes(
<a name="l04650"></a>04650         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l04651"></a>04651         axis_node_1,
<a name="l04652"></a>04652         axis_node_2,
<a name="l04653"></a>04653         GetNodePointer(def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a>),
<a name="l04654"></a>04654         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2,
<a name="l04655"></a>04655         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 8,
<a name="l04656"></a>04656         def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>,
<a name="l04657"></a>04657         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a>,
<a name="l04658"></a>04658         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a>,
<a name="l04659"></a>04659         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>,
<a name="l04660"></a>04660         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a>
<a name="l04661"></a>04661     );
<a name="l04662"></a>04662 
<a name="l04663"></a>04663     <span class="comment">/* --- Beams --- */</span>
<a name="l04664"></a>04664     <span class="comment">/* Use data from directive &#39;set_beam_defaults&#39; for the tiretread beams */</span>
<a name="l04665"></a>04665     <span class="keywordtype">float</span> tyre_spring = def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#ad3d997d002b790fba62a9cf73690e94d">tyre_springiness</a>;
<a name="l04666"></a>04666     <span class="keywordtype">float</span> tyre_damp = def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a610463f462d96962e86e0121dbf94c62">tyre_damping</a>;
<a name="l04667"></a>04667     <span class="keywordtype">float</span> rim_spring = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>-&gt;springiness;
<a name="l04668"></a>04668     <span class="keywordtype">float</span> rim_damp = def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>-&gt;damping_constant;
<a name="l04669"></a>04669 
<a name="l04670"></a>04670     BuildWheelBeams(
<a name="l04671"></a>04671         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l04672"></a>04672         base_node_index,
<a name="l04673"></a>04673         axis_node_1,
<a name="l04674"></a>04674         axis_node_2,
<a name="l04675"></a>04675         tyre_spring,
<a name="l04676"></a>04676         tyre_damp,
<a name="l04677"></a>04677         rim_spring,
<a name="l04678"></a>04678         rim_damp,
<a name="l04679"></a>04679         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>,
<a name="l04680"></a>04680         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>,
<a name="l04681"></a>04681         0.15 <span class="comment">// max_extension</span>
<a name="l04682"></a>04682     );
<a name="l04683"></a>04683 
<a name="l04684"></a>04684     <span class="comment">/* --- Visuals --- */</span>
<a name="l04685"></a>04685     BuildMeshWheelVisuals(
<a name="l04686"></a>04686         wheel_index, 
<a name="l04687"></a>04687         base_node_index, 
<a name="l04688"></a>04688         axis_node_1-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04689"></a>04689         axis_node_2-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l04690"></a>04690         def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l04691"></a>04691         def.<a class="code" href="struct_rig_def_1_1_mesh_wheel2.html#a6f70cd49a9acbb47ec7f1c6b77f5ed3f">mesh_name</a>,
<a name="l04692"></a>04692         def.<a class="code" href="struct_rig_def_1_1_mesh_wheel2.html#a416c9d3cadd3f84f2c641b61a20aa478">material_name</a>,
<a name="l04693"></a>04693         def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a>,
<a name="l04694"></a>04694         def.<a class="code" href="struct_rig_def_1_1_mesh_wheel2.html#a698d95a43779ef502495c7bc4ef0449a">side</a> != <a class="code" href="struct_rig_def_1_1_mesh_wheel.html#af699d01e3d1bda900be710256d58f9f7abcee8ea57fa8ca53df33f548c504460f">RigDef::MeshWheel::SIDE_RIGHT</a>
<a name="l04695"></a>04695         );
<a name="l04696"></a>04696 }
<a name="l04697"></a>04697 
<a name="l04698"></a><a class="code" href="class_rig_spawner.html#a5967e3e6fae63a547d6b51c07d80e4da">04698</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a5967e3e6fae63a547d6b51c07d80e4da">RigSpawner::BuildMeshWheelVisuals</a>(
<a name="l04699"></a>04699     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index,
<a name="l04700"></a>04700     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index,
<a name="l04701"></a>04701     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> axis_node_1_index,
<a name="l04702"></a>04702     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> axis_node_2_index,
<a name="l04703"></a>04703     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_rays,
<a name="l04704"></a>04704     Ogre::String mesh_name,
<a name="l04705"></a>04705     Ogre::String material_name,
<a name="l04706"></a>04706     <span class="keywordtype">float</span> rim_radius,
<a name="l04707"></a>04707     <span class="keywordtype">bool</span> rim_reverse
<a name="l04708"></a>04708 )
<a name="l04709"></a>04709 {
<a name="l04710"></a>04710     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04711"></a>04711 
<a name="l04712"></a>04712     std::stringstream wheel_name;
<a name="l04713"></a>04713     wheel_name &lt;&lt; <span class="stringliteral">&quot;wheel-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; wheel_index;
<a name="l04714"></a>04714     std::stringstream entity_name;
<a name="l04715"></a>04715     entity_name &lt;&lt; <span class="stringliteral">&quot;wheelobj-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; wheel_index;
<a name="l04716"></a>04716 
<a name="l04717"></a>04717     m_rig-&gt;vwheels[wheel_index].fm = <span class="keyword">new</span> <a class="code" href="class_flex_mesh_wheel.html">FlexMeshWheel</a>(
<a name="l04718"></a>04718         wheel_name.str(),
<a name="l04719"></a>04719         m_rig-&gt;nodes,
<a name="l04720"></a>04720         axis_node_1_index,
<a name="l04721"></a>04721         axis_node_2_index,
<a name="l04722"></a>04722         base_node_index,
<a name="l04723"></a>04723         num_rays,
<a name="l04724"></a>04724         mesh_name,
<a name="l04725"></a>04725         material_name,
<a name="l04726"></a>04726         rim_radius,
<a name="l04727"></a>04727         rim_reverse,
<a name="l04728"></a>04728         m_rig-&gt;materialFunctionMapper,
<a name="l04729"></a>04729         m_rig-&gt;usedSkin,
<a name="l04730"></a>04730         m_rig-&gt;materialReplacer
<a name="l04731"></a>04731     );
<a name="l04732"></a>04732     m_rig-&gt;vwheels[wheel_index].meshwheel = <span class="keyword">true</span>;
<a name="l04733"></a>04733 
<a name="l04734"></a>04734     <span class="keywordflow">try</span>
<a name="l04735"></a>04735     {
<a name="l04736"></a>04736         m_rig-&gt;vwheels[wheel_index].cnode = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l04737"></a>04737         Ogre::Entity *ec = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createEntity(entity_name.str(), wheel_name.str());
<a name="l04738"></a>04738         <span class="keywordflow">if</span> (ec)
<a name="l04739"></a>04739         {
<a name="l04740"></a>04740             m_rig-&gt;deletion_Entities.emplace_back(ec);
<a name="l04741"></a>04741             m_rig-&gt;vwheels[wheel_index].cnode-&gt;attachObject(ec);
<a name="l04742"></a>04742         }
<a name="l04743"></a>04743         
<a name="l04744"></a>04744         <a class="code" href="class_material_function_mapper.html#abee8fd1cc0b52699d3babb4b5e84b477">MaterialFunctionMapper::replaceSimpleMeshMaterials</a>(ec, Ogre::ColourValue(0, 0.5, 0.5));
<a name="l04745"></a>04745         <span class="keywordflow">if</span> (m_rig-&gt;materialFunctionMapper != <span class="keyword">nullptr</span>)
<a name="l04746"></a>04746         {
<a name="l04747"></a>04747             m_rig-&gt;materialFunctionMapper-&gt;replaceMeshMaterials(ec);
<a name="l04748"></a>04748         }
<a name="l04749"></a>04749         <span class="keywordflow">if</span> (m_rig-&gt;materialReplacer != <span class="keyword">nullptr</span>) 
<a name="l04750"></a>04750         {   
<a name="l04751"></a>04751             m_rig-&gt;materialReplacer-&gt;replaceMeshMaterials(ec);
<a name="l04752"></a>04752         }
<a name="l04753"></a>04753         <span class="keywordflow">if</span> (m_rig-&gt;usedSkin != <span class="keyword">nullptr</span>)
<a name="l04754"></a>04754         {
<a name="l04755"></a>04755             m_rig-&gt;usedSkin-&gt;replaceMeshMaterials(ec);
<a name="l04756"></a>04756         }       
<a name="l04757"></a>04757     } 
<a name="l04758"></a>04758     <span class="keywordflow">catch</span>(...)
<a name="l04759"></a>04759     {
<a name="l04760"></a>04760         std::stringstream msg;
<a name="l04761"></a>04761         msg &lt;&lt; <span class="stringliteral">&quot;Error loading mesh: &quot;</span> &lt;&lt; mesh_name;
<a name="l04762"></a>04762         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l04763"></a>04763     }
<a name="l04764"></a>04764 }
<a name="l04765"></a>04765 
<a name="l04766"></a><a class="code" href="class_rig_spawner.html#a9a358c692e839da8a8261818019e406f">04766</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a9a358c692e839da8a8261818019e406f">RigSpawner::BuildWheelObjectAndNodes</a>( 
<a name="l04767"></a>04767     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_rays,
<a name="l04768"></a>04768     <a class="code" href="structnode__t.html">node_t</a> *axis_node_1,
<a name="l04769"></a>04769     <a class="code" href="structnode__t.html">node_t</a> *axis_node_2,
<a name="l04770"></a>04770     <a class="code" href="structnode__t.html">node_t</a> *reference_arm_node,
<a name="l04771"></a>04771     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> reserve_nodes,
<a name="l04772"></a>04772     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> reserve_beams,
<a name="l04773"></a>04773     <span class="keywordtype">float</span> wheel_radius,
<a name="l04774"></a>04774     <a class="code" href="struct_rig_def_1_1_wheels.html#a07d9912ae1c5e7f667cb8c75661dbbfd">RigDef::Wheels::Propulsion</a> propulsion,
<a name="l04775"></a>04775     <a class="code" href="struct_rig_def_1_1_wheels.html#aadb771065ed24e681acf7ab7e2520bc5">RigDef::Wheels::Braking</a> braking,
<a name="l04776"></a>04776     boost::shared_ptr&lt;RigDef::NodeDefaults&gt; node_defaults,
<a name="l04777"></a>04777     <span class="keywordtype">float</span> wheel_mass,
<a name="l04778"></a>04778     <span class="keywordtype">bool</span> set_param_iswheel, <span class="comment">/* Default: true */</span>
<a name="l04779"></a>04779     <span class="keywordtype">float</span> wheel_width       <span class="comment">/* Default: -1.f */</span>
<a name="l04780"></a>04780 )
<a name="l04781"></a>04781 {
<a name="l04782"></a>04782     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04783"></a>04783 
<a name="l04784"></a>04784     <span class="comment">/* Check capacity */</span>
<a name="l04785"></a>04785     CheckNodeLimit(reserve_nodes);
<a name="l04786"></a>04786     CheckBeamLimit(reserve_beams);
<a name="l04787"></a>04787 
<a name="l04788"></a>04788     <a class="code" href="structwheel__t.html">wheel_t</a> &amp; wheel = m_rig-&gt;wheels[m_rig-&gt;free_wheel];
<a name="l04789"></a>04789 
<a name="l04790"></a>04790     <span class="comment">/* Axis */</span>
<a name="l04791"></a>04791     Ogre::Vector3 axis_vector = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>;
<a name="l04792"></a>04792     <span class="keywordtype">float</span> axis_length = axis_vector.length();
<a name="l04793"></a>04793     axis_vector.normalise();
<a name="l04794"></a>04794 
<a name="l04795"></a>04795     <span class="comment">/* Wheel object */</span>
<a name="l04796"></a>04796     wheel.<a class="code" href="structwheel__t.html#adb4ed40345c4bb7e19d788b050149300">braked</a>    = braking;
<a name="l04797"></a>04797     wheel.<a class="code" href="structwheel__t.html#a65e28800f237ae95c86b0bea0942f5b9">propulsed</a> = propulsion;
<a name="l04798"></a>04798     wheel.<a class="code" href="structwheel__t.html#a02c5f9e521db3371c7e212588ccc319a">nbnodes</a>   = 2 * num_rays;
<a name="l04799"></a>04799     wheel.<a class="code" href="structwheel__t.html#a6cf8fe4b687a7e4abe51819eac224bc1">refnode0</a>  = axis_node_1;
<a name="l04800"></a>04800     wheel.<a class="code" href="structwheel__t.html#a507a081a13d6c5a10e75c31a341e2fad">refnode1</a>  = axis_node_2;
<a name="l04801"></a>04801     wheel.<a class="code" href="structwheel__t.html#ae855fe55ef613caa097a04cee756ea74">radius</a>    = wheel_radius;
<a name="l04802"></a>04802     wheel.<a class="code" href="structwheel__t.html#ac81081cce7bc97477a1595c3fb9b11d6">width</a>     = (wheel_width &lt; 0) ? axis_length : wheel_width;
<a name="l04803"></a>04803     wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>       = reference_arm_node;
<a name="l04804"></a>04804 
<a name="l04805"></a>04805     <span class="comment">/* Find near attach */</span>
<a name="l04806"></a>04806     Ogre::Real length_1 = (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l04807"></a>04807     Ogre::Real length_2 = (axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l04808"></a>04808     wheel.<a class="code" href="structwheel__t.html#afd87b102a9f5ae471095bfbcff958862">near_attach</a> = (length_1 &lt; length_2) ? axis_node_1 : axis_node_2;
<a name="l04809"></a>04809 
<a name="l04810"></a>04810     <span class="keywordflow">if</span> (propulsion != <a class="code" href="struct_rig_def_1_1_wheels.html#a07d9912ae1c5e7f667cb8c75661dbbfdac9aba3f776881618d2964d9da37a0fa5">RigDef::Wheels::PROPULSION_NONE</a>)
<a name="l04811"></a>04811     {
<a name="l04812"></a>04812         m_rig-&gt;propwheelcount++;
<a name="l04813"></a>04813         <span class="comment">/* for inter-differential locking */</span>
<a name="l04814"></a>04814         m_rig-&gt;proped_wheels++;
<a name="l04815"></a>04815         m_rig-&gt;proppairs[m_rig-&gt;proped_wheels] = m_rig-&gt;free_wheel;
<a name="l04816"></a>04816     }
<a name="l04817"></a>04817     <span class="keywordflow">if</span> (braking != <a class="code" href="struct_rig_def_1_1_wheels.html#aadb771065ed24e681acf7ab7e2520bc5a8b6fb3addf046eb5ca89430156a86fae">RigDef::Wheels::BRAKING_NO</a>)
<a name="l04818"></a>04818     {
<a name="l04819"></a>04819         m_rig-&gt;braked_wheels++;
<a name="l04820"></a>04820     }
<a name="l04821"></a>04821     
<a name="l04822"></a>04822     <span class="comment">/* Nodes */</span>
<a name="l04823"></a>04823     Ogre::Vector3 ray_vector = axis_vector.perpendicular() * wheel_radius;
<a name="l04824"></a>04824     Ogre::Quaternion ray_rotator = Ogre::Quaternion(Ogre::Degree(-360.0 / (num_rays * 2)), axis_vector);
<a name="l04825"></a>04825 
<a name="l04826"></a>04826 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l04827"></a>04827 <span class="preprocessor"></span>    <span class="comment">// TRUCK PARSER 2013 DEBUG</span>
<a name="l04828"></a>04828     std::stringstream msg;
<a name="l04829"></a>04829     msg &lt;&lt; <span class="stringliteral">&quot;\nDBG RigSpawner::BuildWheelObjectAndNodes()\nDBG nodebase:&quot;</span> &lt;&lt; m_rig-&gt;free_node &lt;&lt;<span class="stringliteral">&quot;, axis-node-0:&quot;</span>&lt;&lt;axis_node_1-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> &lt;&lt;<span class="stringliteral">&quot;, axis-node-1:&quot;</span>&lt;&lt;axis_node_2-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>&lt;&lt;<span class="stringliteral">&quot;\n&quot;</span>;
<a name="l04830"></a>04830     msg &lt;&lt; <span class="stringliteral">&quot;DBG ==== Adding nodes ====&quot;</span>;
<a name="l04831"></a>04831     <span class="comment">// END</span>
<a name="l04832"></a>04832 <span class="preprocessor">#endif</span>
<a name="l04833"></a>04833 <span class="preprocessor"></span>
<a name="l04834"></a>04834     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; num_rays; i++)
<a name="l04835"></a>04835     {
<a name="l04836"></a>04836         <span class="comment">/* Outer ring */</span>
<a name="l04837"></a>04837         Ogre::Vector3 ray_point = axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + ray_vector;
<a name="l04838"></a>04838         ray_vector = ray_rotator * ray_vector;
<a name="l04839"></a>04839 
<a name="l04840"></a>04840         <a class="code" href="structnode__t.html">node_t</a> &amp; outer_node = GetFreeNode();
<a name="l04841"></a>04841         InitNode(outer_node, ray_point, node_defaults);
<a name="l04842"></a>04842         outer_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>    = wheel_mass / (2.f * num_rays);
<a name="l04843"></a>04843         outer_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> = (set_param_iswheel) ? (m_rig-&gt;free_wheel * 2) + 1 : 0;
<a name="l04844"></a>04844         outer_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>      = -1; <span class="comment">// Orig: hardcoded (BTS_WHEELS)</span>
<a name="l04845"></a>04845         outer_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = m_rig-&gt;free_wheel;
<a name="l04846"></a>04846         AdjustNodeBuoyancy(outer_node, node_defaults);
<a name="l04847"></a>04847 
<a name="l04848"></a>04848         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; outer_contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l04849"></a>04849         outer_contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = outer_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l04850"></a>04850         outer_contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l04851"></a>04851         outer_contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l04852"></a>04852         m_rig-&gt;free_contacter++;
<a name="l04853"></a>04853 
<a name="l04854"></a>04854         <span class="comment">/* Inner ring */</span>
<a name="l04855"></a>04855         ray_point = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + ray_vector;
<a name="l04856"></a>04856         ray_vector = ray_rotator * ray_vector;
<a name="l04857"></a>04857 
<a name="l04858"></a>04858         <a class="code" href="structnode__t.html">node_t</a> &amp; inner_node = GetFreeNode();
<a name="l04859"></a>04859         InitNode(inner_node, ray_point, node_defaults);
<a name="l04860"></a>04860         inner_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>    = wheel_mass / (2.f * num_rays);
<a name="l04861"></a>04861         inner_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> = (set_param_iswheel) ? (m_rig-&gt;free_wheel * 2) + 2 : 0;
<a name="l04862"></a>04862         inner_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>      = -1; <span class="comment">// Orig: hardcoded (BTS_WHEELS)</span>
<a name="l04863"></a>04863         inner_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = m_rig-&gt;free_wheel; 
<a name="l04864"></a>04864         AdjustNodeBuoyancy(inner_node, node_defaults);
<a name="l04865"></a>04865 
<a name="l04866"></a>04866         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l04867"></a>04867         contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = inner_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l04868"></a>04868         contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l04869"></a>04869         contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l04870"></a>04870         m_rig-&gt;free_contacter++;
<a name="l04871"></a>04871 
<a name="l04872"></a>04872         <span class="comment">/* Wheel object */</span>
<a name="l04873"></a>04873         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[i * 2] = &amp; outer_node;
<a name="l04874"></a>04874         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[(i * 2) + 1] = &amp; inner_node;
<a name="l04875"></a>04875 
<a name="l04876"></a>04876 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l04877"></a>04877 <span class="preprocessor"></span>        <span class="comment">// TRUCK PARSER 2013 DEBUG</span>
<a name="l04878"></a>04878         <span class="keywordtype">int</span> modifier = 0;
<a name="l04879"></a>04879         msg &lt;&lt; <span class="stringliteral">&quot;\nDBG\tN1: index=&quot;</span> &lt;&lt; outer_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier &lt;&lt;<span class="stringliteral">&quot;, wheelid=&quot;</span> &lt;&lt; outer_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> &lt;&lt; <span class="stringliteral">&quot;, iswheel=&quot;</span> &lt;&lt; outer_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> 
<a name="l04880"></a>04880             &lt;&lt;<span class="stringliteral">&quot;, X=&quot;</span> &lt;&lt; outer_node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.x &lt;&lt;<span class="stringliteral">&quot;, Y=&quot;</span> &lt;&lt; outer_node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.y &lt;&lt;<span class="stringliteral">&quot;, Z=&quot;</span> &lt;&lt; outer_node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.z &lt;&lt; std::endl
<a name="l04881"></a>04881             &lt;&lt; <span class="stringliteral">&quot;DBG\tN2: index=&quot;</span> &lt;&lt; inner_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier &lt;&lt;<span class="stringliteral">&quot;, wheelid=&quot;</span> &lt;&lt; inner_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> &lt;&lt; <span class="stringliteral">&quot;, iswheel=&quot;</span> &lt;&lt; inner_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> 
<a name="l04882"></a>04882             &lt;&lt;<span class="stringliteral">&quot;, X=&quot;</span> &lt;&lt; inner_node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.x &lt;&lt;<span class="stringliteral">&quot;, Y=&quot;</span> &lt;&lt; inner_node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.y &lt;&lt;<span class="stringliteral">&quot;, Z=&quot;</span> &lt;&lt; inner_node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.z;
<a name="l04883"></a>04883         <span class="comment">// END</span>
<a name="l04884"></a>04884 <span class="preprocessor">#endif</span>
<a name="l04885"></a>04885 <span class="preprocessor"></span>    }
<a name="l04886"></a>04886 
<a name="l04887"></a>04887 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l04888"></a>04888 <span class="preprocessor"></span>    <span class="comment">// TRUCK PARSER 2013 DEBUG</span>
<a name="l04889"></a>04889     <a class="code" href="_ro_r_prerequisites_8h.html#af855c94dc540e943632089ce7496faac">LOG</a>(msg.str());
<a name="l04890"></a>04890     <span class="comment">// END</span>
<a name="l04891"></a>04891 <span class="preprocessor">#endif</span>
<a name="l04892"></a>04892 <span class="preprocessor"></span>
<a name="l04893"></a>04893     <span class="comment">/* Advance */</span>
<a name="l04894"></a>04894     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index = m_rig-&gt;free_wheel;
<a name="l04895"></a>04895     m_rig-&gt;free_wheel++;
<a name="l04896"></a>04896     <span class="keywordflow">return</span> wheel_index;
<a name="l04897"></a>04897 }
<a name="l04898"></a>04898 
<a name="l04899"></a><a class="code" href="class_rig_spawner.html#ac58fc155344e0db4a8437ca23b6f595e">04899</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ac58fc155344e0db4a8437ca23b6f595e">RigSpawner::AdjustNodeBuoyancy</a>(<a class="code" href="structnode__t.html">node_t</a> &amp; node, <a class="code" href="struct_rig_def_1_1_node.html">RigDef::Node</a> &amp; node_def, boost::shared_ptr&lt;RigDef::NodeDefaults&gt; defaults)
<a name="l04900"></a>04900 {
<a name="l04901"></a>04901     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04902"></a>04902 
<a name="l04903"></a>04903     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> options = (defaults-&gt;options | node_def.<a class="code" href="struct_rig_def_1_1_node.html#a5f1dd7c05dbec4aaf10ddc4442b4bb16" title="Bit flags.">options</a>); <span class="comment">// Merge flags</span>
<a name="l04904"></a>04904     node.<a class="code" href="structnode__t.html#aa6d41098f414f67de26fb0dcaf97e864">buoyancy</a> = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_b_EXTRA_BUOYANCY) ? 10000.f : m_rig-&gt;truckmass/15.f;
<a name="l04905"></a>04905 }
<a name="l04906"></a>04906 
<a name="l04907"></a><a class="code" href="class_rig_spawner.html#ac5d3b0a6fd8af00aad4a6ca9b6377f54">04907</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ac58fc155344e0db4a8437ca23b6f595e">RigSpawner::AdjustNodeBuoyancy</a>(<a class="code" href="structnode__t.html">node_t</a> &amp; node, boost::shared_ptr&lt;RigDef::NodeDefaults&gt; defaults)
<a name="l04908"></a>04908 {
<a name="l04909"></a>04909     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04910"></a>04910 
<a name="l04911"></a>04911     node.<a class="code" href="structnode__t.html#aa6d41098f414f67de26fb0dcaf97e864">buoyancy</a> = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(defaults-&gt;options, RigDef::Node::OPTION_b_EXTRA_BUOYANCY) ? 10000.f : m_rig-&gt;truckmass/15.f;
<a name="l04912"></a>04912 }
<a name="l04913"></a>04913 
<a name="l04914"></a><a class="code" href="class_rig_spawner.html#a543e1548ecf1c4ae4de8174e951d8832">04914</a> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a543e1548ecf1c4ae4de8174e951d8832">RigSpawner::FindLowestNodeInRig</a>()
<a name="l04915"></a>04915 {
<a name="l04916"></a>04916     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04917"></a>04917 
<a name="l04918"></a>04918     <span class="keywordtype">int</span> lowest_node_index = 0;
<a name="l04919"></a>04919     <span class="keywordtype">float</span> lowest_y = m_rig-&gt;nodes[0].AbsPosition.y;
<a name="l04920"></a>04920 
<a name="l04921"></a>04921     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; m_rig-&gt;free_node; i++)
<a name="l04922"></a>04922     {
<a name="l04923"></a>04923         <span class="keywordtype">float</span> y = m_rig-&gt;nodes[i].AbsPosition.y;
<a name="l04924"></a>04924         <span class="keywordflow">if</span> (y &lt; lowest_y)
<a name="l04925"></a>04925         {
<a name="l04926"></a>04926             lowest_y = y;
<a name="l04927"></a>04927             lowest_node_index = i;
<a name="l04928"></a>04928         }
<a name="l04929"></a>04929     }
<a name="l04930"></a>04930 
<a name="l04931"></a>04931     <span class="keywordflow">return</span> lowest_node_index;
<a name="l04932"></a>04932 }
<a name="l04933"></a>04933 
<a name="l04934"></a><a class="code" href="class_rig_spawner.html#a3b859f5890ffdbdc6aa36a44a8c208c2">04934</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a3b859f5890ffdbdc6aa36a44a8c208c2">RigSpawner::BuildWheelBeams</a>(
<a name="l04935"></a>04935     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_rays,
<a name="l04936"></a>04936     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index,
<a name="l04937"></a>04937     <a class="code" href="structnode__t.html">node_t</a> *axis_node_1,
<a name="l04938"></a>04938     <a class="code" href="structnode__t.html">node_t</a> *axis_node_2,
<a name="l04939"></a>04939     <span class="keywordtype">float</span> tyre_spring,
<a name="l04940"></a>04940     <span class="keywordtype">float</span> tyre_damping,
<a name="l04941"></a>04941     <span class="keywordtype">float</span> rim_spring,
<a name="l04942"></a>04942     <span class="keywordtype">float</span> rim_damping,
<a name="l04943"></a>04943     boost::shared_ptr&lt;RigDef::BeamDefaults&gt; beam_defaults,
<a name="l04944"></a>04944     <a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; rigidity_node_id,
<a name="l04945"></a>04945     <span class="keywordtype">float</span> max_extension <span class="comment">// = 0.f</span>
<a name="l04946"></a>04946 )
<a name="l04947"></a>04947 {
<a name="l04948"></a>04948     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l04949"></a>04949     
<a name="l04950"></a>04950 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l04951"></a>04951 <span class="preprocessor"></span>    <span class="comment">// DEBUG</span>
<a name="l04952"></a>04952     std::stringstream msg;
<a name="l04953"></a>04953     msg &lt;&lt; <span class="stringliteral">&quot;==== BEAMS ====&quot;</span>;
<a name="l04954"></a>04954     <span class="comment">// END DEBUG</span>
<a name="l04955"></a>04955 <span class="preprocessor">#endif</span>
<a name="l04956"></a>04956 <span class="preprocessor"></span>
<a name="l04957"></a>04957     <span class="comment">/* Find out where to connect rigidity node */</span>
<a name="l04958"></a>04958     <span class="keywordtype">bool</span> rigidity_beam_side_1 = <span class="keyword">false</span>;
<a name="l04959"></a>04959     <a class="code" href="structnode__t.html">node_t</a> *rigidity_node = <span class="keyword">nullptr</span>;
<a name="l04960"></a>04960     <span class="keywordflow">if</span> (rigidity_node_id.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l04961"></a>04961     {
<a name="l04962"></a>04962         rigidity_node = GetNodePointerOrThrow(rigidity_node_id);
<a name="l04963"></a>04963         <span class="keywordtype">float</span> distance_1 = rigidity_node-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.distance(axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>);
<a name="l04964"></a>04964         <span class="keywordtype">float</span> distance_2 = rigidity_node-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.distance(axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>);
<a name="l04965"></a>04965         rigidity_beam_side_1 = distance_1 &lt; distance_2;
<a name="l04966"></a>04966     }
<a name="l04967"></a>04967 
<a name="l04968"></a>04968     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; num_rays; i++)
<a name="l04969"></a>04969     {
<a name="l04970"></a>04970         <span class="comment">/* Bounded */</span>
<a name="l04971"></a>04971         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> outer_ring_node_index = base_node_index + (i * 2);
<a name="l04972"></a>04972         <a class="code" href="structnode__t.html">node_t</a> *outer_ring_node = &amp; m_rig-&gt;nodes[outer_ring_node_index];
<a name="l04973"></a>04973         <a class="code" href="structnode__t.html">node_t</a> *inner_ring_node = &amp; m_rig-&gt;nodes[outer_ring_node_index + 1];
<a name="l04974"></a>04974         
<a name="l04975"></a>04975         AddWheelBeam(axis_node_1, outer_ring_node, tyre_spring, tyre_damping, beam_defaults, 0.66f, max_extension);
<a name="l04976"></a>04976         AddWheelBeam(axis_node_2, inner_ring_node, tyre_spring, tyre_damping, beam_defaults, 0.66f, max_extension);
<a name="l04977"></a>04977         AddWheelBeam(axis_node_2, outer_ring_node, tyre_spring, tyre_damping, beam_defaults);
<a name="l04978"></a>04978         AddWheelBeam(axis_node_1, inner_ring_node, tyre_spring, tyre_damping, beam_defaults);
<a name="l04979"></a>04979 
<a name="l04980"></a>04980         <span class="comment">/* Reinforcement */</span>
<a name="l04981"></a>04981         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> next_outer_ring_node_index = base_node_index + (((i + 1) % num_rays) * 2);
<a name="l04982"></a>04982         <a class="code" href="structnode__t.html">node_t</a> *next_outer_ring_node = &amp; m_rig-&gt;nodes[next_outer_ring_node_index];
<a name="l04983"></a>04983         <a class="code" href="structnode__t.html">node_t</a> *next_inner_ring_node = &amp; m_rig-&gt;nodes[next_outer_ring_node_index + 1];
<a name="l04984"></a>04984 
<a name="l04985"></a>04985         AddWheelBeam(outer_ring_node, inner_ring_node,      rim_spring, rim_damping, beam_defaults);
<a name="l04986"></a>04986         AddWheelBeam(outer_ring_node, next_outer_ring_node, rim_spring, rim_damping, beam_defaults);
<a name="l04987"></a>04987         AddWheelBeam(inner_ring_node, next_inner_ring_node, rim_spring, rim_damping, beam_defaults);
<a name="l04988"></a>04988         AddWheelBeam(inner_ring_node, next_outer_ring_node, rim_spring, rim_damping, beam_defaults);
<a name="l04989"></a>04989 
<a name="l04990"></a>04990 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l04991"></a>04991 <span class="preprocessor"></span>        <span class="comment">// TRUCK PARSER 2013 DEBUG</span>
<a name="l04992"></a>04992         <span class="keywordtype">int</span> modifier = 0;
<a name="l04993"></a>04993         msg&lt;&lt;<span class="stringliteral">&quot;\nDBG\tBounded: &quot;</span>;
<a name="l04994"></a>04994         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;axis_node_1-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;outer_ring_node-&gt;pos + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l04995"></a>04995         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;axis_node_2-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;inner_ring_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l04996"></a>04996         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;axis_node_2-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;outer_ring_node-&gt;pos + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l04997"></a>04997         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;axis_node_1-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;inner_ring_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot;]&quot;</span>;
<a name="l04998"></a>04998         <span class="comment">//reinforcement</span>
<a name="l04999"></a>04999         msg&lt;&lt;<span class="stringliteral">&quot;\nDBG\tReinforcement: &quot;</span>;
<a name="l05000"></a>05000         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;outer_ring_node-&gt;pos + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;inner_ring_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>      + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l05001"></a>05001         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;outer_ring_node-&gt;pos + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;next_outer_ring_node-&gt;pos + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l05002"></a>05002         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;inner_ring_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;next_inner_ring_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l05003"></a>05003         msg&lt;&lt;<span class="stringliteral">&quot;[&quot;</span>&lt;&lt;inner_ring_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;next_outer_ring_node-&gt;pos + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l05004"></a>05004         <span class="comment">// END</span>
<a name="l05005"></a>05005 <span class="preprocessor">#endif</span>
<a name="l05006"></a>05006 <span class="preprocessor"></span>
<a name="l05007"></a>05007         <span class="comment">/* Rigidity beams */</span>
<a name="l05008"></a>05008         <span class="keywordflow">if</span> (rigidity_node != <span class="keyword">nullptr</span>)
<a name="l05009"></a>05009         {
<a name="l05010"></a>05010             <a class="code" href="structnode__t.html">node_t</a> *target_node = (rigidity_beam_side_1) ? outer_ring_node : inner_ring_node;
<a name="l05011"></a>05011             <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index = AddWheelBeam(rigidity_node, target_node, tyre_spring, tyre_damping, beam_defaults, -1.f, -1.f, <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a9b28f43cd91bf9ab179c58fa77a613d6">BEAM_VIRTUAL</a>);
<a name="l05012"></a>05012             m_rig-&gt;beams[beam_index].type = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a9b28f43cd91bf9ab179c58fa77a613d6">BEAM_VIRTUAL</a>;
<a name="l05013"></a>05013 
<a name="l05014"></a>05014 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l05015"></a>05015 <span class="preprocessor"></span>            <span class="comment">// DEBUG</span>
<a name="l05016"></a>05016             msg&lt;&lt;<span class="stringliteral">&quot;\nDBG\tRigidityBeam: [&quot;</span>&lt;&lt;rigidity_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot; &quot;</span>&lt;&lt;target_node-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> + modifier&lt;&lt;<span class="stringliteral">&quot;] &quot;</span>;
<a name="l05017"></a>05017             msg&lt;&lt;((rigidity_beam_side_1) ? <span class="stringliteral">&quot;(outer)&quot;</span> : <span class="stringliteral">&quot;(inner)&quot;</span>);
<a name="l05018"></a>05018             <span class="comment">// END</span>
<a name="l05019"></a>05019 <span class="preprocessor">#endif</span>
<a name="l05020"></a>05020 <span class="preprocessor"></span>        }
<a name="l05021"></a>05021     }
<a name="l05022"></a>05022 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l05023"></a>05023 <span class="preprocessor"></span>    <span class="comment">// TRUCK PARSER 2013 DEBUG</span>
<a name="l05024"></a>05024     <a class="code" href="_ro_r_prerequisites_8h.html#af855c94dc540e943632089ce7496faac">LOG</a>(msg.str());
<a name="l05025"></a>05025     <span class="comment">// END</span>
<a name="l05026"></a>05026 <span class="preprocessor">#endif</span>
<a name="l05027"></a>05027 <span class="preprocessor"></span>}
<a name="l05028"></a>05028 
<a name="l05029"></a><a class="code" href="class_rig_spawner.html#a868ac33e51a8dc7d35bddc6f6a5f186a">05029</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a868ac33e51a8dc7d35bddc6f6a5f186a">RigSpawner::AddWheel</a>(<a class="code" href="struct_rig_def_1_1_wheel.html">RigDef::Wheel</a> &amp; wheel_def)
<a name="l05030"></a>05030 {
<a name="l05031"></a>05031     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05032"></a>05032 
<a name="l05033"></a>05033     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index = m_rig-&gt;free_node;
<a name="l05034"></a>05034     <a class="code" href="structnode__t.html">node_t</a> *axis_node_1 = GetNodePointer(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0]);
<a name="l05035"></a>05035     <a class="code" href="structnode__t.html">node_t</a> *axis_node_2 = GetNodePointer(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]);
<a name="l05036"></a>05036 
<a name="l05037"></a>05037     <span class="keywordflow">if</span> (axis_node_1 == <span class="keyword">nullptr</span> || axis_node_2 == <span class="keyword">nullptr</span>)
<a name="l05038"></a>05038     {
<a name="l05039"></a>05039         std::stringstream msg;
<a name="l05040"></a>05040         msg &lt;&lt; <span class="stringliteral">&quot;Error creating &#39;wheel&#39;: Some axis nodes were not found&quot;</span>;
<a name="l05041"></a>05041         msg &lt;&lt; <span class="stringliteral">&quot; (Node1: &quot;</span> &lt;&lt; wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>() &lt;&lt; <span class="stringliteral">&quot; =&gt; &quot;</span> &lt;&lt; (axis_node_1 == <span class="keyword">nullptr</span>) ? <span class="stringliteral">&quot;NOT FOUND)&quot;</span> : <span class="stringliteral">&quot;found)&quot;</span>;
<a name="l05042"></a>05042         msg &lt;&lt; <span class="stringliteral">&quot; (Node2: &quot;</span> &lt;&lt; wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>() &lt;&lt; <span class="stringliteral">&quot; =&gt; &quot;</span> &lt;&lt; (axis_node_2 == <span class="keyword">nullptr</span>) ? <span class="stringliteral">&quot;NOT FOUND)&quot;</span> : <span class="stringliteral">&quot;found)&quot;</span>;
<a name="l05043"></a>05043         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l05044"></a>05044         <span class="keywordflow">return</span> -1;
<a name="l05045"></a>05045     }
<a name="l05046"></a>05046 
<a name="l05047"></a>05047     <span class="comment">/* Enforce the &quot;second node must have a larger Z coordinate than the first&quot; constraint */</span>
<a name="l05048"></a>05048     <span class="keywordflow">if</span> (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z &gt; axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z)
<a name="l05049"></a>05049     {
<a name="l05050"></a>05050         <a class="code" href="structnode__t.html">node_t</a> *swap = axis_node_1;
<a name="l05051"></a>05051         axis_node_1 = axis_node_2;
<a name="l05052"></a>05052         axis_node_2 = swap;
<a name="l05053"></a>05053     }   
<a name="l05054"></a>05054 
<a name="l05055"></a>05055     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index = BuildWheelObjectAndNodes(
<a name="l05056"></a>05056         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l05057"></a>05057         axis_node_1,
<a name="l05058"></a>05058         axis_node_2,
<a name="l05059"></a>05059         GetNodePointer(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a>),
<a name="l05060"></a>05060         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2,
<a name="l05061"></a>05061         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 8,
<a name="l05062"></a>05062         wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#a906e2dac6a8360135aeb06254ddf98f2">radius</a>,
<a name="l05063"></a>05063         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a>,
<a name="l05064"></a>05064         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a>,
<a name="l05065"></a>05065         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>,
<a name="l05066"></a>05066         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a>,
<a name="l05067"></a>05067         <span class="keyword">true</span>,
<a name="l05068"></a>05068         -1.f <span class="comment">// Set width to axis length (width in definition is ignored)</span>
<a name="l05069"></a>05069     );
<a name="l05070"></a>05070 
<a name="l05071"></a>05071     BuildWheelBeams(
<a name="l05072"></a>05072         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l05073"></a>05073         base_node_index,
<a name="l05074"></a>05074         axis_node_1,
<a name="l05075"></a>05075         axis_node_2,
<a name="l05076"></a>05076         wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#ae6e58725b52ac956379910702bc481aa">springiness</a>, <span class="comment">/* Tyre */</span>
<a name="l05077"></a>05077         wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#a3b8c333fcd89cb2346995e0a98c8128b">damping</a>,     <span class="comment">/* Tyre */</span>
<a name="l05078"></a>05078         wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#ae6e58725b52ac956379910702bc481aa">springiness</a>, <span class="comment">/* Rim */</span>
<a name="l05079"></a>05079         wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#a3b8c333fcd89cb2346995e0a98c8128b">damping</a>,     <span class="comment">/* Rim */</span>
<a name="l05080"></a>05080         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>,
<a name="l05081"></a>05081         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>
<a name="l05082"></a>05082     );
<a name="l05083"></a>05083 
<a name="l05084"></a>05084     CreateWheelVisuals(wheel_index, wheel_def, base_node_index);
<a name="l05085"></a>05085 
<a name="l05086"></a>05086     <span class="keywordflow">return</span> wheel_index;
<a name="l05087"></a>05087 }
<a name="l05088"></a>05088 
<a name="l05089"></a>05089 <span class="preprocessor">#if 0 // refactored into pieces</span>
<a name="l05090"></a>05090 <span class="preprocessor"></span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a868ac33e51a8dc7d35bddc6f6a5f186a">RigSpawner::AddWheel</a>(<a class="code" href="struct_rig_def_1_1_wheel.html">RigDef::Wheel</a> &amp; wheel_def)
<a name="l05091"></a>05091 {
<a name="l05092"></a>05092     <span class="comment">/* Check capacity */</span>
<a name="l05093"></a>05093     CheckNodeLimit(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2);
<a name="l05094"></a>05094     CheckBeamLimit(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 8);
<a name="l05095"></a>05095 
<a name="l05096"></a>05096     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index = m_rig-&gt;free_node;
<a name="l05097"></a>05097     <a class="code" href="structwheel__t.html">wheel_t</a> &amp; wheel = m_rig-&gt;wheels[m_rig-&gt;free_wheel];
<a name="l05098"></a>05098 
<a name="l05099"></a>05099     <span class="comment">/* Enforce the &quot;second node must have a larger Z coordinate than the first&quot; constraint */</span>
<a name="l05100"></a>05100     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> axis_nodes[2];
<a name="l05101"></a>05101     <span class="keywordflow">if</span> (GetNode(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0]).RelPosition.z &lt; GetNode(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]).RelPosition.z)
<a name="l05102"></a>05102     {
<a name="l05103"></a>05103         axis_nodes[0] = GetNodeIndexOrThrow(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0]);
<a name="l05104"></a>05104         axis_nodes[1] = GetNodeIndexOrThrow(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]);
<a name="l05105"></a>05105     }
<a name="l05106"></a>05106     <span class="keywordflow">else</span>
<a name="l05107"></a>05107     {
<a name="l05108"></a>05108         axis_nodes[0] = GetNodeIndexOrThrow(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]);
<a name="l05109"></a>05109         axis_nodes[1] = GetNodeIndexOrThrow(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0]);
<a name="l05110"></a>05110     }
<a name="l05111"></a>05111     <a class="code" href="structnode__t.html">node_t</a> &amp; axis_node_1 = m_rig-&gt;nodes[axis_nodes[0]];
<a name="l05112"></a>05112     <a class="code" href="structnode__t.html">node_t</a> &amp; axis_node_2 = m_rig-&gt;nodes[axis_nodes[1]];
<a name="l05113"></a>05113 
<a name="l05114"></a>05114     Ogre::Vector3 axis_vector = axis_node_2.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_1.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>;
<a name="l05115"></a>05115     axis_vector.normalise();
<a name="l05116"></a>05116     Ogre::Vector3 ray_vector = axis_vector.perpendicular() * wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#a906e2dac6a8360135aeb06254ddf98f2">radius</a>;
<a name="l05117"></a>05117     Ogre::Quaternion ray_rotator = Ogre::Quaternion(Ogre::Degree(-360.f / wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 2), axis_vector);
<a name="l05118"></a>05118 
<a name="l05119"></a>05119     <span class="comment">/* Nodes */</span>
<a name="l05120"></a>05120     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l05121"></a>05121     {
<a name="l05122"></a>05122         <span class="comment">/* Outer ring */</span>
<a name="l05123"></a>05123         Ogre::Vector3 ray_point = axis_node_1.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + ray_vector;
<a name="l05124"></a>05124         ray_vector = ray_rotator * ray_vector;
<a name="l05125"></a>05125 
<a name="l05126"></a>05126         <a class="code" href="structnode__t.html">node_t</a> &amp; outer_node = GetFreeNode();
<a name="l05127"></a>05127         InitNode(outer_node, ray_point, wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l05128"></a>05128         outer_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>    = wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a> / (2.f * wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l05129"></a>05129         outer_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> = (m_rig-&gt;free_wheel * 2) + 1;
<a name="l05130"></a>05130         outer_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>      = -1; <span class="comment">// Orig: hardcoded (BTS_WHEELS)</span>
<a name="l05131"></a>05131         outer_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = m_rig-&gt;free_wheel;
<a name="l05132"></a>05132 
<a name="l05133"></a>05133         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l05134"></a>05134         contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = outer_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l05135"></a>05135         contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l05136"></a>05136         contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l05137"></a>05137         m_rig-&gt;free_contacter++;
<a name="l05138"></a>05138 
<a name="l05139"></a>05139         <span class="comment">/* Inner ring */</span>
<a name="l05140"></a>05140         ray_point = axis_node_2.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + ray_vector;
<a name="l05141"></a>05141         ray_vector = ray_rotator * ray_vector;
<a name="l05142"></a>05142 
<a name="l05143"></a>05143         <a class="code" href="structnode__t.html">node_t</a> &amp; inner_node = GetFreeNode();
<a name="l05144"></a>05144         InitNode(inner_node, ray_point, wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l05145"></a>05145         inner_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>    = wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a> / (2.f * wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l05146"></a>05146         inner_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> = (m_rig-&gt;free_wheel * 2) + 2;
<a name="l05147"></a>05147         inner_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>      = -1; <span class="comment">// Orig: hardcoded (BTS_WHEELS)</span>
<a name="l05148"></a>05148         inner_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = m_rig-&gt;free_wheel; 
<a name="l05149"></a>05149 
<a name="l05150"></a>05150         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l05151"></a>05151         contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = inner_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l05152"></a>05152         contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l05153"></a>05153         contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l05154"></a>05154         m_rig-&gt;free_contacter++;
<a name="l05155"></a>05155 
<a name="l05156"></a>05156         <span class="comment">/* Wheel object */</span>
<a name="l05157"></a>05157         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[i * 2] = &amp; outer_node;
<a name="l05158"></a>05158         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[(i * 2) + 1] = &amp; inner_node;
<a name="l05159"></a>05159     }
<a name="l05160"></a>05160 
<a name="l05161"></a>05161     <span class="comment">/* Beams */</span>
<a name="l05162"></a>05162     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l05163"></a>05163     {
<a name="l05164"></a>05164         <span class="comment">/* Bounded */</span>
<a name="l05165"></a>05165         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> outer_ring_node_index = base_node_index + (i * 2);
<a name="l05166"></a>05166         <a class="code" href="structnode__t.html">node_t</a> *outer_ring_node = &amp; m_rig-&gt;nodes[outer_ring_node_index];
<a name="l05167"></a>05167         <a class="code" href="structnode__t.html">node_t</a> *inner_ring_node = &amp; m_rig-&gt;nodes[outer_ring_node_index + 1];
<a name="l05168"></a>05168         
<a name="l05169"></a>05169         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index = SectionWheelsAddBeam(wheel_def, &amp; axis_node_1, outer_ring_node);
<a name="l05170"></a>05170         GetBeam(beam_index).shortbound = 0.66f;
<a name="l05171"></a>05171         GetBeam(beam_index).longbound = 0.0f;
<a name="l05172"></a>05172         beam_index = SectionWheelsAddBeam(wheel_def, &amp; axis_node_2, inner_ring_node);
<a name="l05173"></a>05173         GetBeam(beam_index).shortbound = 0.66f;
<a name="l05174"></a>05174         GetBeam(beam_index).longbound = 0.0f;
<a name="l05175"></a>05175         SectionWheelsAddBeam(wheel_def, &amp; axis_node_2, outer_ring_node);
<a name="l05176"></a>05176         SectionWheelsAddBeam(wheel_def, &amp; axis_node_1, inner_ring_node);
<a name="l05177"></a>05177 
<a name="l05178"></a>05178         <span class="comment">/* Reinforcement */</span>
<a name="l05179"></a>05179         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> next_outer_ring_node_index = base_node_index + (((i + 1) % wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>) * 2);
<a name="l05180"></a>05180         <a class="code" href="structnode__t.html">node_t</a> *next_outer_ring_node = &amp; m_rig-&gt;nodes[next_outer_ring_node_index];
<a name="l05181"></a>05181         <a class="code" href="structnode__t.html">node_t</a> *next_inner_ring_node = &amp; m_rig-&gt;nodes[next_outer_ring_node_index + 1];
<a name="l05182"></a>05182 
<a name="l05183"></a>05183         SectionWheelsAddBeam(wheel_def, outer_ring_node, inner_ring_node);
<a name="l05184"></a>05184         SectionWheelsAddBeam(wheel_def, outer_ring_node, next_outer_ring_node);
<a name="l05185"></a>05185         SectionWheelsAddBeam(wheel_def, inner_ring_node, next_inner_ring_node);
<a name="l05186"></a>05186         SectionWheelsAddBeam(wheel_def, inner_ring_node, next_outer_ring_node);
<a name="l05187"></a>05187     }
<a name="l05188"></a>05188 
<a name="l05189"></a>05189     <span class="comment">/* Wheel object */</span>
<a name="l05190"></a>05190     wheel.<a class="code" href="structwheel__t.html#adb4ed40345c4bb7e19d788b050149300">braked</a>    = wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a>;
<a name="l05191"></a>05191     wheel.<a class="code" href="structwheel__t.html#a65e28800f237ae95c86b0bea0942f5b9">propulsed</a> = wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a>;
<a name="l05192"></a>05192     wheel.<a class="code" href="structwheel__t.html#a02c5f9e521db3371c7e212588ccc319a">nbnodes</a>   = 2 * wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>;
<a name="l05193"></a>05193     wheel.<a class="code" href="structwheel__t.html#a6cf8fe4b687a7e4abe51819eac224bc1">refnode0</a>  = &amp; axis_node_1;
<a name="l05194"></a>05194     wheel.<a class="code" href="structwheel__t.html#a507a081a13d6c5a10e75c31a341e2fad">refnode1</a>  = &amp; axis_node_2;
<a name="l05195"></a>05195     wheel.<a class="code" href="structwheel__t.html#ae855fe55ef613caa097a04cee756ea74">radius</a>    = wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#a906e2dac6a8360135aeb06254ddf98f2">radius</a>;
<a name="l05196"></a>05196     wheel.<a class="code" href="structwheel__t.html#ac81081cce7bc97477a1595c3fb9b11d6">width</a>     = axis_vector.length(); <span class="comment">/* wheel_def.width is ignored. */</span>
<a name="l05197"></a>05197     wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>       = GetNodePointer(wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a>);
<a name="l05198"></a>05198 
<a name="l05199"></a>05199     <span class="keywordflow">if</span> (wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a> != <a class="code" href="struct_rig_def_1_1_wheels.html#a07d9912ae1c5e7f667cb8c75661dbbfdac9aba3f776881618d2964d9da37a0fa5">RigDef::Wheels::PROPULSION_NONE</a>)
<a name="l05200"></a>05200     {
<a name="l05201"></a>05201         m_rig-&gt;propwheelcount++;
<a name="l05202"></a>05202         <span class="comment">/* for inter-differential locking */</span>
<a name="l05203"></a>05203         m_rig-&gt;proped_wheels++;
<a name="l05204"></a>05204         m_rig-&gt;proppairs[m_rig-&gt;proped_wheels] = m_rig-&gt;free_wheel;
<a name="l05205"></a>05205     }
<a name="l05206"></a>05206     <span class="keywordflow">if</span> (wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a> != <a class="code" href="struct_rig_def_1_1_wheels.html#aadb771065ed24e681acf7ab7e2520bc5a8b6fb3addf046eb5ca89430156a86fae">RigDef::Wheels::BRAKING_NO</a>)
<a name="l05207"></a>05207     {
<a name="l05208"></a>05208         m_rig-&gt;braked_wheels++;
<a name="l05209"></a>05209     }
<a name="l05210"></a>05210 
<a name="l05211"></a>05211     <span class="comment">/* Find near attach */</span>
<a name="l05212"></a>05212     Ogre::Real length_1 = (axis_node_1.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l05213"></a>05213     Ogre::Real length_2 = (axis_node_2.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l05214"></a>05214     wheel.<a class="code" href="structwheel__t.html#afd87b102a9f5ae471095bfbcff958862">near_attach</a> = &amp; ((length_1 &lt; length_2) ? axis_node_1 : axis_node_2);
<a name="l05215"></a>05215 
<a name="l05216"></a>05216     <span class="comment">/* Advance */</span>
<a name="l05217"></a>05217     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index = m_rig-&gt;free_wheel;
<a name="l05218"></a>05218     m_rig-&gt;free_wheel++;
<a name="l05219"></a>05219     <span class="keywordflow">return</span> wheel_index;
<a name="l05220"></a>05220 }
<a name="l05221"></a>05221 <span class="preprocessor">#endif</span>
<a name="l05222"></a>05222 <span class="preprocessor"></span>
<a name="l05223"></a><a class="code" href="class_rig_spawner.html#ae332e2222319fffdc15fb5f1e5653064">05223</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#ae332e2222319fffdc15fb5f1e5653064">RigSpawner::AddWheel2</a>(<a class="code" href="struct_rig_def_1_1_wheel2.html">RigDef::Wheel2</a> &amp; wheel_2_def)
<a name="l05224"></a>05224 {
<a name="l05225"></a>05225     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05226"></a>05226 
<a name="l05227"></a>05227     <span class="comment">/* Check capacity */</span>
<a name="l05228"></a>05228     CheckNodeLimit(wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * 4);
<a name="l05229"></a>05229     CheckBeamLimit(wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> * (wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>()) ? 26 : 25);
<a name="l05230"></a>05230 
<a name="l05231"></a>05231     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> base_node_index = m_rig-&gt;free_node;
<a name="l05232"></a>05232     <a class="code" href="structwheel__t.html">wheel_t</a> &amp; wheel = m_rig-&gt;wheels[m_rig-&gt;free_wheel];
<a name="l05233"></a>05233     <a class="code" href="structnode__t.html">node_t</a> *axis_node_1 = GetNodePointer(wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0]);
<a name="l05234"></a>05234     <a class="code" href="structnode__t.html">node_t</a> *axis_node_2 = GetNodePointer(wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1]);
<a name="l05235"></a>05235 
<a name="l05236"></a>05236     <span class="keywordflow">if</span> (axis_node_1 == <span class="keyword">nullptr</span> || axis_node_2 == <span class="keyword">nullptr</span>)
<a name="l05237"></a>05237     {
<a name="l05238"></a>05238         std::stringstream msg;
<a name="l05239"></a>05239         msg &lt;&lt; <span class="stringliteral">&quot;Error creating &#39;wheel2&#39;: Some axis nodes were not found&quot;</span>;
<a name="l05240"></a>05240         msg &lt;&lt; <span class="stringliteral">&quot; (Node1: &quot;</span> &lt;&lt; wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>() &lt;&lt; <span class="stringliteral">&quot; =&gt; &quot;</span> &lt;&lt; (axis_node_1 == <span class="keyword">nullptr</span>) ? <span class="stringliteral">&quot;NOT FOUND)&quot;</span> : <span class="stringliteral">&quot;found)&quot;</span>;
<a name="l05241"></a>05241         msg &lt;&lt; <span class="stringliteral">&quot; (Node2: &quot;</span> &lt;&lt; wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>() &lt;&lt; <span class="stringliteral">&quot; =&gt; &quot;</span> &lt;&lt; (axis_node_2 == <span class="keyword">nullptr</span>) ? <span class="stringliteral">&quot;NOT FOUND)&quot;</span> : <span class="stringliteral">&quot;found)&quot;</span>;
<a name="l05242"></a>05242         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l05243"></a>05243         <span class="keywordflow">return</span> -1;
<a name="l05244"></a>05244     }
<a name="l05245"></a>05245 
<a name="l05246"></a>05246     <span class="comment">/* Enforce the &quot;second node must have a larger Z coordinate than the first&quot; constraint */</span>
<a name="l05247"></a>05247     <span class="keywordflow">if</span> (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z &gt; axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>.z)
<a name="l05248"></a>05248     {
<a name="l05249"></a>05249         <a class="code" href="structnode__t.html">node_t</a> *swap = axis_node_1;
<a name="l05250"></a>05250         axis_node_1 = axis_node_2;
<a name="l05251"></a>05251         axis_node_2 = swap;
<a name="l05252"></a>05252     }   
<a name="l05253"></a>05253 
<a name="l05254"></a>05254     <span class="comment">/* Rigidity node */</span>
<a name="l05255"></a>05255     <a class="code" href="structnode__t.html">node_t</a> *axis_node_closest_to_rigidity_node = <span class="keyword">nullptr</span>;
<a name="l05256"></a>05256     <span class="keywordflow">if</span> (wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l05257"></a>05257     {
<a name="l05258"></a>05258         <a class="code" href="structnode__t.html">node_t</a> &amp; rigidity_node = GetNode(wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>);
<a name="l05259"></a>05259         Ogre::Real distance_1 = (rigidity_node.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l05260"></a>05260         Ogre::Real distance_2 = (rigidity_node.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l05261"></a>05261         axis_node_closest_to_rigidity_node = ((distance_1 &lt; distance_2)) ? axis_node_1 : axis_node_2;
<a name="l05262"></a>05262     }
<a name="l05263"></a>05263 
<a name="l05264"></a>05264     <span class="comment">/* Node&amp;beam generation */</span>
<a name="l05265"></a>05265     Ogre::Vector3 axis_vector = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>;
<a name="l05266"></a>05266     axis_vector.normalise();
<a name="l05267"></a>05267     Ogre::Vector3 rim_ray_vector = Ogre::Vector3(0, wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a>, 0);
<a name="l05268"></a>05268     Ogre::Quaternion rim_ray_rotator = Ogre::Quaternion(Ogre::Degree(-360.f / wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>), axis_vector);
<a name="l05269"></a>05269 
<a name="l05270"></a>05270     <span class="comment">/* Width */</span>
<a name="l05271"></a>05271     wheel.<a class="code" href="structwheel__t.html#ac81081cce7bc97477a1595c3fb9b11d6">width</a> = axis_vector.length(); <span class="comment">/* wheel_def.width is ignored. */</span>
<a name="l05272"></a>05272 
<a name="l05273"></a>05273     <span class="comment">/* Rim nodes */</span>
<a name="l05274"></a>05274     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l05275"></a>05275     {
<a name="l05276"></a>05276         <span class="keywordtype">float</span> node_mass = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a> / (4.f * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l05277"></a>05277 
<a name="l05278"></a>05278         <span class="comment">/* Outer ring */</span>
<a name="l05279"></a>05279         Ogre::Vector3 ray_point = axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + rim_ray_vector;
<a name="l05280"></a>05280 
<a name="l05281"></a>05281         <a class="code" href="structnode__t.html">node_t</a> &amp; outer_node = GetFreeNode();
<a name="l05282"></a>05282         InitNode(outer_node, ray_point, wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l05283"></a>05283         outer_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>    = node_mass;
<a name="l05284"></a>05284         outer_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> = (m_rig-&gt;free_wheel * 2) + 1;
<a name="l05285"></a>05285         outer_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>      = -1; <span class="comment">// Orig: hardcoded (addWheel2)</span>
<a name="l05286"></a>05286         outer_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = m_rig-&gt;free_wheel;
<a name="l05287"></a>05287 
<a name="l05288"></a>05288         <span class="comment">/* Inner ring */</span>
<a name="l05289"></a>05289         ray_point = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + rim_ray_vector;
<a name="l05290"></a>05290 
<a name="l05291"></a>05291         <a class="code" href="structnode__t.html">node_t</a> &amp; inner_node = GetFreeNode();
<a name="l05292"></a>05292         InitNode(inner_node, ray_point, wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>);
<a name="l05293"></a>05293         inner_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>    = node_mass;
<a name="l05294"></a>05294         inner_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a> = (m_rig-&gt;free_wheel * 2) + 2;
<a name="l05295"></a>05295         inner_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>      = -1; <span class="comment">// Orig: hardcoded (addWheel2)</span>
<a name="l05296"></a>05296         inner_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = m_rig-&gt;free_wheel;
<a name="l05297"></a>05297 
<a name="l05298"></a>05298         <span class="comment">/* Wheel object */</span>
<a name="l05299"></a>05299         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[i * 2] = &amp; outer_node;
<a name="l05300"></a>05300         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[(i * 2) + 1] = &amp; inner_node;
<a name="l05301"></a>05301 
<a name="l05302"></a>05302         rim_ray_vector = rim_ray_rotator * rim_ray_vector;
<a name="l05303"></a>05303     }
<a name="l05304"></a>05304 
<a name="l05305"></a>05305     Ogre::Vector3 tyre_ray_vector = Ogre::Vector3(0, wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>, 0);
<a name="l05306"></a>05306     Ogre::Quaternion tyre_ray_rotator = Ogre::Quaternion(Ogre::Degree(-180.f / wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>), axis_vector);
<a name="l05307"></a>05307     tyre_ray_vector = tyre_ray_rotator * tyre_ray_vector;
<a name="l05308"></a>05308 
<a name="l05309"></a>05309     <span class="comment">/* Tyre nodes */</span>
<a name="l05310"></a>05310     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l05311"></a>05311     {
<a name="l05312"></a>05312         <span class="comment">/* Outer ring */</span>
<a name="l05313"></a>05313         Ogre::Vector3 ray_point = axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + tyre_ray_vector;
<a name="l05314"></a>05314 
<a name="l05315"></a>05315         <a class="code" href="structnode__t.html">node_t</a> &amp; outer_node = GetFreeNode();
<a name="l05316"></a>05316         InitNode(outer_node, ray_point);
<a name="l05317"></a>05317         outer_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>          = (0.67f * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a>) / (2.f * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l05318"></a>05318         outer_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a>       = (m_rig-&gt;free_wheel * 2) + 1;
<a name="l05319"></a>05319         outer_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>            = -1; <span class="comment">// Orig: hardcoded (addWheel2)</span>
<a name="l05320"></a>05320         outer_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a>       = m_rig-&gt;free_wheel;
<a name="l05321"></a>05321         outer_node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = wheel.<a class="code" href="structwheel__t.html#ac81081cce7bc97477a1595c3fb9b11d6">width</a> * <a class="code" href="_beam_data_8h.html#a37ef395009c19101e43ca4a12fa5ff0e">WHEEL_FRICTION_COEF</a>;
<a name="l05322"></a>05322         outer_node.<a class="code" href="structnode__t.html#a0b5dc5e5d52e4ceb38098496e2ceb889">volume_coef</a>   = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;volume;
<a name="l05323"></a>05323         outer_node.<a class="code" href="structnode__t.html#af1f7dc09cc03753872adca7816e572b5">surface_coef</a>  = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;surface;
<a name="l05324"></a>05324 
<a name="l05325"></a>05325         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l05326"></a>05326         contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = outer_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l05327"></a>05327         contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l05328"></a>05328         contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l05329"></a>05329         m_rig-&gt;free_contacter++;
<a name="l05330"></a>05330 
<a name="l05331"></a>05331         <span class="comment">/* Inner ring */</span>
<a name="l05332"></a>05332         ray_point = axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> + tyre_ray_vector;
<a name="l05333"></a>05333 
<a name="l05334"></a>05334         <a class="code" href="structnode__t.html">node_t</a> &amp; inner_node = GetFreeNode();
<a name="l05335"></a>05335         InitNode(inner_node, ray_point);
<a name="l05336"></a>05336         inner_node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a>          = (0.33f * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a>) / (2.f * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l05337"></a>05337         inner_node.<a class="code" href="structnode__t.html#abbecfc58f8efb9c46b6c4bcb8899e28d" title="0=no, 1, 2=wheel1 3,4=wheel2, etc...">iswheel</a>       = (m_rig-&gt;free_wheel * 2) + 2;
<a name="l05338"></a>05338         inner_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a>            = -1; <span class="comment">// Orig: hardcoded (addWheel2)</span>
<a name="l05339"></a>05339         inner_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a>       = m_rig-&gt;free_wheel;
<a name="l05340"></a>05340         inner_node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = wheel.<a class="code" href="structwheel__t.html#ac81081cce7bc97477a1595c3fb9b11d6">width</a> * <a class="code" href="_beam_data_8h.html#a37ef395009c19101e43ca4a12fa5ff0e">WHEEL_FRICTION_COEF</a>;
<a name="l05341"></a>05341         inner_node.<a class="code" href="structnode__t.html#a0b5dc5e5d52e4ceb38098496e2ceb889">volume_coef</a>   = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;volume;
<a name="l05342"></a>05342         inner_node.<a class="code" href="structnode__t.html#af1f7dc09cc03753872adca7816e572b5">surface_coef</a>  = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afda1fbd28f08d9e58295e37f9f9eca77">node_defaults</a>-&gt;surface;
<a name="l05343"></a>05343 
<a name="l05344"></a>05344         <a class="code" href="structcontacter__t.html">contacter_t</a> &amp; inner_contacter = m_rig-&gt;contacters[m_rig-&gt;free_contacter];
<a name="l05345"></a>05345         inner_contacter.<a class="code" href="structcontacter__t.html#a37002f1c40cd0ae138baf4d4d4f3dad5">nodeid</a>        = inner_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>; <span class="comment">/* Node index */</span>
<a name="l05346"></a>05346         inner_contacter.<a class="code" href="structcontacter__t.html#ad327383dd8467d5a4d09cbf0d12e7fb6">contacted</a>     = 0;
<a name="l05347"></a>05347         inner_contacter.<a class="code" href="structcontacter__t.html#aa79573f2eb2b4d4e0fa56e105e45cf79">opticontact</a>   = 0;
<a name="l05348"></a>05348         m_rig-&gt;free_contacter++;
<a name="l05349"></a>05349 
<a name="l05350"></a>05350         <span class="comment">/* Wheel object */</span>
<a name="l05351"></a>05351         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[i * 2] = &amp; outer_node;
<a name="l05352"></a>05352         wheel.<a class="code" href="structwheel__t.html#a6e30ffc4e6b2536b7dd313e16c3db827">nodes</a>[(i * 2) + 1] = &amp; inner_node;
<a name="l05353"></a>05353 
<a name="l05354"></a>05354         tyre_ray_vector = rim_ray_rotator * tyre_ray_vector; <span class="comment">// This is OK</span>
<a name="l05355"></a>05355     }
<a name="l05356"></a>05356 
<a name="l05357"></a>05357     <span class="comment">/* Beams */</span>
<a name="l05358"></a>05358     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>; i++)
<a name="l05359"></a>05359     {
<a name="l05360"></a>05360         <span class="comment">/* --- Rim ---  */</span>
<a name="l05361"></a>05361 
<a name="l05362"></a>05362         <span class="comment">/* Bounded */</span>
<a name="l05363"></a>05363         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rim_outer_node_index = base_node_index + (i * 2);
<a name="l05364"></a>05364         <a class="code" href="structnode__t.html">node_t</a> *rim_outer_node = &amp; m_rig-&gt;nodes[rim_outer_node_index];
<a name="l05365"></a>05365         <a class="code" href="structnode__t.html">node_t</a> *rim_inner_node = &amp; m_rig-&gt;nodes[rim_outer_node_index + 1];
<a name="l05366"></a>05366 
<a name="l05367"></a>05367         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index;
<a name="l05368"></a>05368         beam_index = AddWheelRimBeam(wheel_2_def, axis_node_1, rim_outer_node);
<a name="l05369"></a>05369         GetBeam(beam_index).shortbound = 0.66;
<a name="l05370"></a>05370         beam_index = AddWheelRimBeam(wheel_2_def, axis_node_2, rim_inner_node);
<a name="l05371"></a>05371         GetBeam(beam_index).shortbound = 0.66;
<a name="l05372"></a>05372         AddWheelRimBeam(wheel_2_def, axis_node_2, rim_outer_node);
<a name="l05373"></a>05373         AddWheelRimBeam(wheel_2_def, axis_node_1, rim_inner_node);
<a name="l05374"></a>05374 
<a name="l05375"></a>05375         <span class="comment">/* Reinforcement */</span>
<a name="l05376"></a>05376         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> rim_next_outer_node_index = base_node_index + (((i + 1) % wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>) * 2);
<a name="l05377"></a>05377         <a class="code" href="structnode__t.html">node_t</a> *rim_next_outer_node = &amp; m_rig-&gt;nodes[rim_next_outer_node_index];
<a name="l05378"></a>05378         <a class="code" href="structnode__t.html">node_t</a> *rim_next_inner_node = &amp; m_rig-&gt;nodes[rim_next_outer_node_index + 1];
<a name="l05379"></a>05379 
<a name="l05380"></a>05380         AddWheelRimBeam(wheel_2_def, axis_node_1, rim_outer_node);
<a name="l05381"></a>05381         AddWheelRimBeam(wheel_2_def, rim_outer_node, rim_inner_node);
<a name="l05382"></a>05382         AddWheelRimBeam(wheel_2_def, rim_outer_node, rim_next_outer_node);
<a name="l05383"></a>05383         AddWheelRimBeam(wheel_2_def, rim_inner_node, rim_next_inner_node);
<a name="l05384"></a>05384         AddWheelRimBeam(wheel_2_def, rim_outer_node, rim_next_inner_node);
<a name="l05385"></a>05385         AddWheelRimBeam(wheel_2_def, rim_inner_node, rim_next_outer_node);
<a name="l05386"></a>05386         <span class="keywordflow">if</span> (axis_node_closest_to_rigidity_node != <span class="keyword">nullptr</span>)
<a name="l05387"></a>05387         {
<a name="l05388"></a>05388             <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetFreeBeam();
<a name="l05389"></a>05389             InitBeam(beam, GetNodePointer(wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>), axis_node_closest_to_rigidity_node);
<a name="l05390"></a>05390             beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a9b28f43cd91bf9ab179c58fa77a613d6">BEAM_VIRTUAL</a>;
<a name="l05391"></a>05391             beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_wheel2.html#ac7fe9bc2faea336ae9b15ed15a859233">rim_springiness</a>;
<a name="l05392"></a>05392             beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_wheel2.html#afa9867e9a67c8ab4c21f5ba77fc2cb42">rim_damping</a>;
<a name="l05393"></a>05393             SetBeamStrength(beam, wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>-&gt;breaking_threshold_constant);
<a name="l05394"></a>05394         }
<a name="l05395"></a>05395 
<a name="l05396"></a>05396         <span class="comment">/* --- Tyre --- */</span>
<a name="l05397"></a>05397 
<a name="l05398"></a>05398         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tyre_node_index = rim_outer_node_index + (2 * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l05399"></a>05399         <a class="code" href="structnode__t.html">node_t</a> *tyre_outer_node = &amp; m_rig-&gt;nodes[tyre_node_index];
<a name="l05400"></a>05400         <a class="code" href="structnode__t.html">node_t</a> *tyre_inner_node = &amp; m_rig-&gt;nodes[tyre_node_index + 1];
<a name="l05401"></a>05401         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tyre_next_node_index = rim_next_outer_node_index + (2 * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>);
<a name="l05402"></a>05402         <a class="code" href="structnode__t.html">node_t</a> *tyre_next_outer_node = &amp; m_rig-&gt;nodes[tyre_next_node_index];
<a name="l05403"></a>05403         <a class="code" href="structnode__t.html">node_t</a> *tyre_next_inner_node = &amp; m_rig-&gt;nodes[tyre_next_node_index + 1];
<a name="l05404"></a>05404 
<a name="l05405"></a>05405         <span class="comment">/* Tyre band */</span>
<a name="l05406"></a>05406         AddTyreBeam(wheel_2_def, tyre_outer_node, tyre_next_outer_node);
<a name="l05407"></a>05407         AddTyreBeam(wheel_2_def, tyre_outer_node, tyre_next_inner_node);
<a name="l05408"></a>05408         AddTyreBeam(wheel_2_def, tyre_inner_node, tyre_next_outer_node);
<a name="l05409"></a>05409         AddTyreBeam(wheel_2_def, tyre_inner_node, tyre_next_inner_node);
<a name="l05410"></a>05410         <span class="comment">/* Tyre sidewalls */</span>
<a name="l05411"></a>05411         AddTyreBeam(wheel_2_def, tyre_outer_node, rim_outer_node);
<a name="l05412"></a>05412         AddTyreBeam(wheel_2_def, tyre_outer_node, rim_next_outer_node);
<a name="l05413"></a>05413         AddTyreBeam(wheel_2_def, tyre_inner_node, rim_inner_node);
<a name="l05414"></a>05414         AddTyreBeam(wheel_2_def, tyre_inner_node, rim_next_inner_node);
<a name="l05415"></a>05415         <span class="comment">/* Reinforcement */</span>
<a name="l05416"></a>05416         AddTyreBeam(wheel_2_def, tyre_outer_node, rim_inner_node);
<a name="l05417"></a>05417         AddTyreBeam(wheel_2_def, tyre_outer_node, rim_next_inner_node);
<a name="l05418"></a>05418         AddTyreBeam(wheel_2_def, tyre_inner_node, rim_outer_node);
<a name="l05419"></a>05419         AddTyreBeam(wheel_2_def, tyre_inner_node, rim_next_outer_node);
<a name="l05420"></a>05420         <span class="comment">/* Backpressure, bounded */</span>
<a name="l05421"></a>05421         AddTyreBeam(wheel_2_def, axis_node_1, tyre_outer_node);
<a name="l05422"></a>05422         AddTyreBeam(wheel_2_def, axis_node_2, tyre_inner_node);
<a name="l05423"></a>05423     }
<a name="l05424"></a>05424 
<a name="l05425"></a>05425     <span class="comment">/* Wheel object */</span>
<a name="l05426"></a>05426     wheel.<a class="code" href="structwheel__t.html#adb4ed40345c4bb7e19d788b050149300">braked</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a>;
<a name="l05427"></a>05427     wheel.<a class="code" href="structwheel__t.html#a65e28800f237ae95c86b0bea0942f5b9">propulsed</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a>;
<a name="l05428"></a>05428     wheel.<a class="code" href="structwheel__t.html#a02c5f9e521db3371c7e212588ccc319a">nbnodes</a> = 2 * wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>;
<a name="l05429"></a>05429     wheel.<a class="code" href="structwheel__t.html#a6cf8fe4b687a7e4abe51819eac224bc1">refnode0</a> = axis_node_1;
<a name="l05430"></a>05430     wheel.<a class="code" href="structwheel__t.html#a507a081a13d6c5a10e75c31a341e2fad">refnode1</a> = axis_node_2;
<a name="l05431"></a>05431     wheel.<a class="code" href="structwheel__t.html#ae855fe55ef613caa097a04cee756ea74">radius</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a>;
<a name="l05432"></a>05432     wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a> = GetNodePointer(wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a>);
<a name="l05433"></a>05433 
<a name="l05434"></a>05434     <span class="keywordflow">if</span> (wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a> != <a class="code" href="struct_rig_def_1_1_wheels.html#a07d9912ae1c5e7f667cb8c75661dbbfdac9aba3f776881618d2964d9da37a0fa5">RigDef::Wheels::PROPULSION_NONE</a>)
<a name="l05435"></a>05435     {
<a name="l05436"></a>05436         <span class="comment">/* for inter-differential locking */</span>
<a name="l05437"></a>05437         m_rig-&gt;proped_wheels++;
<a name="l05438"></a>05438         m_rig-&gt;proppairs[m_rig-&gt;proped_wheels] = m_rig-&gt;free_wheel;
<a name="l05439"></a>05439     }
<a name="l05440"></a>05440     <span class="keywordflow">if</span> (wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a> != <a class="code" href="struct_rig_def_1_1_wheels.html#aadb771065ed24e681acf7ab7e2520bc5a8b6fb3addf046eb5ca89430156a86fae">RigDef::Wheels::BRAKING_NO</a>)
<a name="l05441"></a>05441     {
<a name="l05442"></a>05442         m_rig-&gt;braked_wheels++;
<a name="l05443"></a>05443     }
<a name="l05444"></a>05444 
<a name="l05445"></a>05445     <span class="comment">/* Find near attach */</span>
<a name="l05446"></a>05446     Ogre::Real length_1 = (axis_node_1-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l05447"></a>05447     Ogre::Real length_2 = (axis_node_2-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - wheel.<a class="code" href="structwheel__t.html#a898de60810e87c7f9e57831f68aa5c04">arm</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l05448"></a>05448     wheel.<a class="code" href="structwheel__t.html#afd87b102a9f5ae471095bfbcff958862">near_attach</a> = (length_1 &lt; length_2) ? axis_node_1 : axis_node_2;
<a name="l05449"></a>05449 
<a name="l05450"></a>05450     <span class="comment">/* Advance */</span>
<a name="l05451"></a>05451     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index = m_rig-&gt;free_wheel;
<a name="l05452"></a>05452     m_rig-&gt;free_wheel++;
<a name="l05453"></a>05453     <span class="keywordflow">return</span> wheel_index;
<a name="l05454"></a>05454 }
<a name="l05455"></a>05455 
<a name="l05456"></a><a class="code" href="class_rig_spawner.html#af5a8a5d3631eed15418b3891882cf2a2">05456</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af5a8a5d3631eed15418b3891882cf2a2">RigSpawner::CreateWheelVisuals</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index, <a class="code" href="struct_rig_def_1_1_wheel.html">RigDef::Wheel</a> &amp; wheel_def, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_base_index)
<a name="l05457"></a>05457 {
<a name="l05458"></a>05458     <span class="comment">// Wrapper, not profiling</span>
<a name="l05459"></a>05459 
<a name="l05460"></a>05460     CreateWheelVisuals(
<a name="l05461"></a>05461         wheel_index, 
<a name="l05462"></a>05462         node_base_index, 
<a name="l05463"></a>05463         wheel_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l05464"></a>05464         wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#afd866793928126d98e6c161fec8a344d">face_material_name</a>,
<a name="l05465"></a>05465         wheel_def.<a class="code" href="struct_rig_def_1_1_wheel.html#ab52ab4c6189604fe1d5fa45adfd59c10">band_material_name</a>,
<a name="l05466"></a>05466         <span class="keyword">false</span>
<a name="l05467"></a>05467         );
<a name="l05468"></a>05468 }
<a name="l05469"></a>05469 
<a name="l05470"></a><a class="code" href="class_rig_spawner.html#aa4f1e5c8e97757c27d2a80472f888aae">05470</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af5a8a5d3631eed15418b3891882cf2a2">RigSpawner::CreateWheelVisuals</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index, <a class="code" href="struct_rig_def_1_1_wheel2.html">RigDef::Wheel2</a> &amp; wheel_2_def, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_base_index)
<a name="l05471"></a>05471 {
<a name="l05472"></a>05472     <span class="comment">// Wrapper, not profiling</span>
<a name="l05473"></a>05473 
<a name="l05474"></a>05474     CreateWheelVisuals(
<a name="l05475"></a>05475         wheel_index, 
<a name="l05476"></a>05476         node_base_index, 
<a name="l05477"></a>05477         wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>,
<a name="l05478"></a>05478         wheel_2_def.<a class="code" href="struct_rig_def_1_1_wheel2.html#a20715e03f4b17512e17bd946f158eb1b">face_material_name</a>,
<a name="l05479"></a>05479         wheel_2_def.<a class="code" href="struct_rig_def_1_1_wheel2.html#aa6417eaa7aa54d449cf57980e58721e0">band_material_name</a>,
<a name="l05480"></a>05480         <span class="keyword">true</span>,
<a name="l05481"></a>05481         wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a8947716de1b3ef17a2da4706123647a5">rim_radius</a> / wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>
<a name="l05482"></a>05482         );
<a name="l05483"></a>05483 }
<a name="l05484"></a>05484 
<a name="l05485"></a><a class="code" href="class_rig_spawner.html#ae83a5403e44fcc6fefc45cc427862f7f">05485</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af5a8a5d3631eed15418b3891882cf2a2">RigSpawner::CreateWheelVisuals</a>(
<a name="l05486"></a>05486     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index, 
<a name="l05487"></a>05487     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_base_index,
<a name="l05488"></a>05488     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> num_rays,
<a name="l05489"></a>05489     Ogre::String <span class="keyword">const</span> &amp; rim_material_name,
<a name="l05490"></a>05490     Ogre::String <span class="keyword">const</span> &amp; band_material_name,
<a name="l05491"></a>05491     <span class="keywordtype">bool</span> separate_rim,
<a name="l05492"></a>05492     <span class="keywordtype">float</span> rim_ratio
<a name="l05493"></a>05493 )
<a name="l05494"></a>05494 {
<a name="l05495"></a>05495     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05496"></a>05496 
<a name="l05497"></a>05497     <a class="code" href="structwheel__t.html">wheel_t</a> &amp; wheel = m_rig-&gt;wheels[wheel_index];
<a name="l05498"></a>05498     <a class="code" href="structvwheel__t.html">vwheel_t</a> &amp; visual_wheel = m_rig-&gt;vwheels[wheel_index];
<a name="l05499"></a>05499 
<a name="l05500"></a>05500     std::stringstream wheel_mesh_name;
<a name="l05501"></a>05501     wheel_mesh_name &lt;&lt; <span class="stringliteral">&quot;wheel-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; wheel_index;
<a name="l05502"></a>05502     std::stringstream wheel_name_i;
<a name="l05503"></a>05503     wheel_name_i &lt;&lt; <span class="stringliteral">&quot;wheelobj-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; wheel_index;
<a name="l05504"></a>05504 
<a name="l05505"></a>05505     visual_wheel.<a class="code" href="structvwheel__t.html#a39887a350784d6a49400e64a31155685">meshwheel</a> = <span class="keyword">false</span>;
<a name="l05506"></a>05506     visual_wheel.<a class="code" href="structvwheel__t.html#a048795d0ab4858cacec15fc616fd0e04">fm</a> = <span class="keyword">new</span> <a class="code" href="class_flex_mesh.html">FlexMesh</a>(
<a name="l05507"></a>05507         wheel_mesh_name.str(),
<a name="l05508"></a>05508         m_rig-&gt;nodes,
<a name="l05509"></a>05509         wheel.<a class="code" href="structwheel__t.html#a6cf8fe4b687a7e4abe51819eac224bc1">refnode0</a>-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l05510"></a>05510         wheel.<a class="code" href="structwheel__t.html#a507a081a13d6c5a10e75c31a341e2fad">refnode1</a>-&gt;<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>,
<a name="l05511"></a>05511         node_base_index,
<a name="l05512"></a>05512         num_rays,
<a name="l05513"></a>05513         rim_material_name,
<a name="l05514"></a>05514         band_material_name,
<a name="l05515"></a>05515         separate_rim,
<a name="l05516"></a>05516         rim_ratio
<a name="l05517"></a>05517     );
<a name="l05518"></a>05518 
<a name="l05519"></a>05519     <span class="keywordflow">try</span>
<a name="l05520"></a>05520     {
<a name="l05521"></a>05521         Ogre::Entity *ec = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createEntity(wheel_name_i.str(), wheel_mesh_name.str());
<a name="l05522"></a>05522         <a class="code" href="class_material_function_mapper.html#abee8fd1cc0b52699d3babb4b5e84b477">MaterialFunctionMapper::replaceSimpleMeshMaterials</a>(ec, Ogre::ColourValue(0, 0.5, 0.5));
<a name="l05523"></a>05523         <span class="keywordflow">if</span> (m_rig-&gt;materialFunctionMapper != <span class="keyword">nullptr</span>)
<a name="l05524"></a>05524         {
<a name="l05525"></a>05525             m_rig-&gt;materialFunctionMapper-&gt;replaceMeshMaterials(ec);
<a name="l05526"></a>05526         }
<a name="l05527"></a>05527         <span class="keywordflow">if</span> (m_rig-&gt;materialReplacer != <span class="keyword">nullptr</span>)
<a name="l05528"></a>05528         {
<a name="l05529"></a>05529             m_rig-&gt;materialReplacer-&gt;replaceMeshMaterials(ec);
<a name="l05530"></a>05530         }
<a name="l05531"></a>05531         <span class="keywordflow">if</span> (m_rig-&gt;usedSkin != <span class="keyword">nullptr</span>)
<a name="l05532"></a>05532         {
<a name="l05533"></a>05533             m_rig-&gt;usedSkin-&gt;replaceMeshMaterials(ec);
<a name="l05534"></a>05534         }
<a name="l05535"></a>05535         visual_wheel.<a class="code" href="structvwheel__t.html#ab5da808f349e7aa1a93ee5cc5f814d51">cnode</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l05536"></a>05536         m_rig-&gt;deletion_Entities.emplace_back(ec);
<a name="l05537"></a>05537         visual_wheel.<a class="code" href="structvwheel__t.html#ab5da808f349e7aa1a93ee5cc5f814d51">cnode</a>-&gt;attachObject(ec);
<a name="l05538"></a>05538     }
<a name="l05539"></a>05539     <span class="keywordflow">catch</span> (...)
<a name="l05540"></a>05540     {
<a name="l05541"></a>05541         std::stringstream msg;
<a name="l05542"></a>05542         msg &lt;&lt; <span class="stringliteral">&quot;Failed to load mesh &#39;&quot;</span> &lt;&lt; wheel_mesh_name.str() &lt;&lt; <span class="stringliteral">&quot;&#39;&quot;</span>;
<a name="l05543"></a>05543         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l05544"></a>05544     }
<a name="l05545"></a>05545 }
<a name="l05546"></a>05546 
<a name="l05547"></a><a class="code" href="class_rig_spawner.html#a69896aa8b7a430b9df970d054aeb85a9">05547</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a69896aa8b7a430b9df970d054aeb85a9">RigSpawner::AddWheelBeam</a>(
<a name="l05548"></a>05548     <a class="code" href="structnode__t.html">node_t</a> *node_1, 
<a name="l05549"></a>05549     <a class="code" href="structnode__t.html">node_t</a> *node_2, 
<a name="l05550"></a>05550     <span class="keywordtype">float</span> spring, 
<a name="l05551"></a>05551     <span class="keywordtype">float</span> damping, 
<a name="l05552"></a>05552     boost::shared_ptr&lt;RigDef::BeamDefaults&gt; beam_defaults,
<a name="l05553"></a>05553     <span class="keywordtype">float</span> max_contraction,   <span class="comment">/* Default: -1.f */</span>
<a name="l05554"></a>05554     <span class="keywordtype">float</span> max_extension,     <span class="comment">/* Default: -1.f */</span>
<a name="l05555"></a>05555     <span class="keywordtype">int</span> type                 <span class="comment">/* Default: BEAM_INVISIBLE */</span>
<a name="l05556"></a>05556 )
<a name="l05557"></a>05557 {
<a name="l05558"></a>05558     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05559"></a>05559 
<a name="l05560"></a>05560     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = m_rig-&gt;free_beam;
<a name="l05561"></a>05561     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(*node_1, *node_2, beam_defaults, <a class="code" href="_beam_data_8h.html#a4caf8d8f829279fba122163d961608a4adb909700ae2e4f59afb0a7b7adccddff">DEFAULT_DETACHER_GROUP</a>); 
<a name="l05562"></a>05562     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = type;
<a name="l05563"></a>05563     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = spring;
<a name="l05564"></a>05564     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = damping;
<a name="l05565"></a>05565     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a> = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l05566"></a>05566     <span class="keywordflow">if</span> (max_contraction &gt; 0.f)
<a name="l05567"></a>05567     {
<a name="l05568"></a>05568         beam.<a class="code" href="structbeam__t.html#af85ad7bcb782f7fcab155bc93ddcc27d">shortbound</a> = max_contraction;
<a name="l05569"></a>05569         beam.<a class="code" href="structbeam__t.html#a4acafe687c44c7f729c2fafd9a8f3e3d">longbound</a> = max_extension;
<a name="l05570"></a>05570         beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a529ecdf951f828a68dac101249641a58" title="shock1">SHOCK1</a>;
<a name="l05571"></a>05571     }
<a name="l05572"></a>05572     CalculateBeamLength(beam);
<a name="l05573"></a>05573 
<a name="l05574"></a>05574     <span class="keywordflow">if</span> (type != <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a9b28f43cd91bf9ab179c58fa77a613d6">BEAM_VIRTUAL</a>)
<a name="l05575"></a>05575     {
<a name="l05576"></a>05576         <span class="comment">/* Create visuals, but don&#39;t attach to scene-graph (compatibility with show-skeleton function) */</span>
<a name="l05577"></a>05577         CreateBeamVisuals(beam, index, beam_defaults, <span class="keyword">false</span>);
<a name="l05578"></a>05578     }
<a name="l05579"></a>05579 
<a name="l05580"></a>05580     <span class="keywordflow">return</span> index;
<a name="l05581"></a>05581 }
<a name="l05582"></a>05582 
<a name="l05583"></a><a class="code" href="class_rig_spawner.html#a3dcc0d63f53e00a9d1810f1565ef358c">05583</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a3dcc0d63f53e00a9d1810f1565ef358c">RigSpawner::AddWheelRimBeam</a>(<a class="code" href="struct_rig_def_1_1_wheel2.html">RigDef::Wheel2</a> &amp; wheel_2_def, <a class="code" href="structnode__t.html">node_t</a> *node_1, <a class="code" href="structnode__t.html">node_t</a> *node_2)
<a name="l05584"></a>05584 {
<a name="l05585"></a>05585     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05586"></a>05586 
<a name="l05587"></a>05587     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index = _SectionWheels2AddBeam(wheel_2_def, node_1, node_2);
<a name="l05588"></a>05588     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetBeam(beam_index);
<a name="l05589"></a>05589     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_wheel2.html#ac7fe9bc2faea336ae9b15ed15a859233">rim_springiness</a>;
<a name="l05590"></a>05590     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_wheel2.html#afa9867e9a67c8ab4c21f5ba77fc2cb42">rim_damping</a>;
<a name="l05591"></a>05591     <span class="keywordflow">return</span> beam_index;
<a name="l05592"></a>05592 }
<a name="l05593"></a>05593 
<a name="l05594"></a><a class="code" href="class_rig_spawner.html#a51a389f943b17205cd5de0578e9ad6b7">05594</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a51a389f943b17205cd5de0578e9ad6b7">RigSpawner::AddTyreBeam</a>(<a class="code" href="struct_rig_def_1_1_wheel2.html">RigDef::Wheel2</a> &amp; wheel_2_def, <a class="code" href="structnode__t.html">node_t</a> *node_1, <a class="code" href="structnode__t.html">node_t</a> *node_2)
<a name="l05595"></a>05595 {
<a name="l05596"></a>05596     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05597"></a>05597 
<a name="l05598"></a>05598     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index = _SectionWheels2AddBeam(wheel_2_def, node_1, node_2);
<a name="l05599"></a>05599     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetBeam(beam_index);
<a name="l05600"></a>05600     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#ad3d997d002b790fba62a9cf73690e94d">tyre_springiness</a>;
<a name="l05601"></a>05601     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a610463f462d96962e86e0121dbf94c62">tyre_damping</a>;
<a name="l05602"></a>05602 
<a name="l05603"></a>05603     m_rig-&gt;pressure_beams[m_rig-&gt;free_pressure_beam] = beam_index;
<a name="l05604"></a>05604     m_rig-&gt;free_pressure_beam++;
<a name="l05605"></a>05605 
<a name="l05606"></a>05606     <span class="keywordflow">return</span> beam_index;
<a name="l05607"></a>05607 }
<a name="l05608"></a>05608 
<a name="l05609"></a><a class="code" href="class_rig_spawner.html#a38fb102d54e3398e7038aaa4ffdf5207">05609</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#a38fb102d54e3398e7038aaa4ffdf5207">RigSpawner::_SectionWheels2AddBeam</a>(<a class="code" href="struct_rig_def_1_1_wheel2.html">RigDef::Wheel2</a> &amp; wheel_2_def, <a class="code" href="structnode__t.html">node_t</a> *node_1, <a class="code" href="structnode__t.html">node_t</a> *node_2)
<a name="l05610"></a>05610 {
<a name="l05611"></a>05611     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05612"></a>05612 
<a name="l05613"></a>05613     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index = m_rig-&gt;free_beam;
<a name="l05614"></a>05614     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetFreeBeam();
<a name="l05615"></a>05615     InitBeam(beam, node_1, node_2);
<a name="l05616"></a>05616     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a7acff4517c1614edded0989bf5162652">BEAM_INVISIBLE</a>;
<a name="l05617"></a>05617     SetBeamStrength(beam, wheel_2_def.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a0c714a88324f6175af48909dea5b82ab">beam_defaults</a>-&gt;breaking_threshold_constant);
<a name="l05618"></a>05618     <span class="keywordflow">return</span> index;
<a name="l05619"></a>05619 }
<a name="l05620"></a>05620 
<a name="l05621"></a><a class="code" href="class_rig_spawner.html#ad5112786fa1f296bfaed456d33bdeab1">05621</a> <a class="code" href="struct_rig_def_1_1_wheel.html">RigDef::Wheel</a> <a class="code" href="class_rig_spawner.html#ad5112786fa1f296bfaed456d33bdeab1">RigSpawner::DowngradeWheel2</a>(<a class="code" href="struct_rig_def_1_1_wheel2.html">RigDef::Wheel2</a> &amp; wheel_2)
<a name="l05622"></a>05622 {
<a name="l05623"></a>05623     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05624"></a>05624 
<a name="l05625"></a>05625     <a class="code" href="struct_rig_def_1_1_wheel.html">RigDef::Wheel</a> wheel;
<a name="l05626"></a>05626     wheel.<a class="code" href="struct_rig_def_1_1_wheel.html#a906e2dac6a8360135aeb06254ddf98f2">radius</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#aba28567b0b52e5ec6fd64dfc0a5108bd">tyre_radius</a>;
<a name="l05627"></a>05627     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a7a96dd584f67f6db7367e3b9f883ef70">width</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a7a96dd584f67f6db7367e3b9f883ef70">width</a>;
<a name="l05628"></a>05628     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2c30ff095fe5e839268629d9362f0d9d">num_rays</a>;
<a name="l05629"></a>05629     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0] = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[0];
<a name="l05630"></a>05630     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1] = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a9bdaffc0e3c81587a89c021abfce91c3">nodes</a>[1];
<a name="l05631"></a>05631     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a82cf55a516f7fa8c8d3cb8da832457e4">rigidity_node</a>;
<a name="l05632"></a>05632     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a46964892b687b17c70c62eac98c3f46f">braking</a>;
<a name="l05633"></a>05633     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a2e99bb276d0543791e33f412f727171a">propulsion</a>;
<a name="l05634"></a>05634     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#afa59c7e5491ae69b016b3c1cf62c4eb4">reference_arm_node</a>;
<a name="l05635"></a>05635     wheel.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel.html#a049388b5d59e7a9c8495826da07cabbe">mass</a>;
<a name="l05636"></a>05636     wheel.<a class="code" href="struct_rig_def_1_1_wheel.html#ae6e58725b52ac956379910702bc481aa">springiness</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#ad3d997d002b790fba62a9cf73690e94d">tyre_springiness</a>;
<a name="l05637"></a>05637     wheel.<a class="code" href="struct_rig_def_1_1_wheel.html#a3b8c333fcd89cb2346995e0a98c8128b">damping</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_base_wheel2.html#a610463f462d96962e86e0121dbf94c62">tyre_damping</a>;
<a name="l05638"></a>05638     wheel.<a class="code" href="struct_rig_def_1_1_wheel.html#afd866793928126d98e6c161fec8a344d">face_material_name</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_wheel2.html#a20715e03f4b17512e17bd946f158eb1b">face_material_name</a>;
<a name="l05639"></a>05639     wheel.<a class="code" href="struct_rig_def_1_1_wheel.html#ab52ab4c6189604fe1d5fa45adfd59c10">band_material_name</a> = wheel_2.<a class="code" href="struct_rig_def_1_1_wheel2.html#aa6417eaa7aa54d449cf57980e58721e0">band_material_name</a>;
<a name="l05640"></a>05640     <span class="keywordflow">return</span> wheel;
<a name="l05641"></a>05641 }
<a name="l05642"></a>05642 
<a name="l05643"></a><a class="code" href="class_rig_spawner.html#ad597832deb63331a7fa460a4182103fd">05643</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ad597832deb63331a7fa460a4182103fd">RigSpawner::ProcessWheel2</a>(<a class="code" href="struct_rig_def_1_1_wheel2.html">RigDef::Wheel2</a> &amp; def)
<a name="l05644"></a>05644 {
<a name="l05645"></a>05645     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05646"></a>05646 
<a name="l05647"></a>05647     <span class="keywordflow">if</span> (m_rig-&gt;enable_wheel2)
<a name="l05648"></a>05648     {
<a name="l05649"></a>05649         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_base_index = m_rig-&gt;free_node;
<a name="l05650"></a>05650         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> wheel_index = AddWheel2(def);
<a name="l05651"></a>05651         CreateWheelVisuals(wheel_index, def, node_base_index);
<a name="l05652"></a>05652     }
<a name="l05653"></a>05653     <span class="keywordflow">else</span>
<a name="l05654"></a>05654     {
<a name="l05655"></a>05655         <a class="code" href="struct_rig_def_1_1_wheel.html">RigDef::Wheel</a> wheel_def = DowngradeWheel2(def);
<a name="l05656"></a>05656             AddWheel(wheel_def);
<a name="l05657"></a>05657     }
<a name="l05658"></a>05658 };
<a name="l05659"></a>05659 
<a name="l05660"></a><a class="code" href="class_rig_spawner.html#a3cc8237ac98ac9453a265fd4c1b90b1d">05660</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a3cc8237ac98ac9453a265fd4c1b90b1d">RigSpawner::ProcessWheel</a>(<a class="code" href="struct_rig_def_1_1_wheel.html">RigDef::Wheel</a> &amp; def)
<a name="l05661"></a>05661 {
<a name="l05662"></a>05662     AddWheel(def);
<a name="l05663"></a>05663 };
<a name="l05664"></a>05664 
<a name="l05665"></a><a class="code" href="class_rig_spawner.html#ac542d3289a8cd0239057791143a6ecec">05665</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ac542d3289a8cd0239057791143a6ecec">RigSpawner::ProcessSlopeBrake</a>(<a class="code" href="struct_rig_def_1_1_slope_brake.html">RigDef::SlopeBrake</a> &amp; def)
<a name="l05666"></a>05666 {
<a name="l05667"></a>05667     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05668"></a>05668 
<a name="l05669"></a>05669     <span class="comment">// #1: regulating_force</span>
<a name="l05670"></a>05670     <span class="keywordtype">float</span> force = def.<a class="code" href="struct_rig_def_1_1_slope_brake.html#a2d101511b88067b1dc639be212043a9a">regulating_force</a>;
<a name="l05671"></a>05671     <span class="keywordflow">if</span> (force &lt; 0.f || force &gt; 20.f)
<a name="l05672"></a>05672     {
<a name="l05673"></a>05673         std::stringstream msg;
<a name="l05674"></a>05674         msg &lt;&lt; <span class="stringliteral">&quot;Clamping &#39;regulating_force&#39; value &#39;&quot;</span> &lt;&lt; force &lt;&lt; <span class="stringliteral">&quot;&#39; to allowed range &lt;0 - 20&gt;&quot;</span>;
<a name="l05675"></a>05675         AddMessage(Message::TYPE_INFO, msg.str());
<a name="l05676"></a>05676         force = (force &lt; 0.f) ? 0.f : 20.f;
<a name="l05677"></a>05677     }
<a name="l05678"></a>05678     m_rig-&gt;slopeBrakeFactor = force;
<a name="l05679"></a>05679 
<a name="l05680"></a>05680     <span class="comment">// #2: attach_angle</span>
<a name="l05681"></a>05681     <span class="keywordtype">float</span> attach_angle = def.<a class="code" href="struct_rig_def_1_1_slope_brake.html#adf0855d79267f67f1177784c1cb25c19">attach_angle</a>;
<a name="l05682"></a>05682     <span class="keywordflow">if</span> (attach_angle &lt; 1.f || attach_angle &gt; 45.f)
<a name="l05683"></a>05683     {
<a name="l05684"></a>05684         std::stringstream msg;
<a name="l05685"></a>05685         msg &lt;&lt; <span class="stringliteral">&quot;Clamping &#39;attach_angle&#39; value &#39;&quot;</span> &lt;&lt; force &lt;&lt; <span class="stringliteral">&quot;&#39; to allowed range &lt;1 - 45&gt;&quot;</span>;
<a name="l05686"></a>05686         AddMessage(Message::TYPE_INFO, msg.str());
<a name="l05687"></a>05687         attach_angle = (attach_angle &lt; 1.f) ? 1.f : 45.f;
<a name="l05688"></a>05688     }
<a name="l05689"></a>05689     m_rig-&gt;slopeBrakeAttAngle = attach_angle;
<a name="l05690"></a>05690 
<a name="l05691"></a>05691     <span class="comment">// #3: release_angle</span>
<a name="l05692"></a>05692     <span class="keywordtype">float</span> release_angle = def.<a class="code" href="struct_rig_def_1_1_slope_brake.html#a582274b411655927fe044b06d57e72af">release_angle</a>;
<a name="l05693"></a>05693     <span class="keywordflow">if</span> (release_angle &lt; 1.f || release_angle &gt; 45.f)
<a name="l05694"></a>05694     {
<a name="l05695"></a>05695         std::stringstream msg;
<a name="l05696"></a>05696         msg &lt;&lt; <span class="stringliteral">&quot;Clamping &#39;release_angle&#39; value &#39;&quot;</span> &lt;&lt; force &lt;&lt; <span class="stringliteral">&quot;&#39; to allowed range &lt;1 - 45&gt;&quot;</span>;
<a name="l05697"></a>05697         AddMessage(Message::TYPE_INFO, msg.str());
<a name="l05698"></a>05698         release_angle = (release_angle &lt; 1.f) ? 1.f : 45.f;
<a name="l05699"></a>05699     }
<a name="l05700"></a>05700     m_rig-&gt;slopeBrakeRelAngle = release_angle + attach_angle;
<a name="l05701"></a>05701 
<a name="l05702"></a>05702     <span class="comment">// Flag</span>
<a name="l05703"></a>05703     m_rig-&gt;slopeBrake = <span class="keyword">true</span>;
<a name="l05704"></a>05704 };
<a name="l05705"></a>05705 
<a name="l05706"></a><a class="code" href="class_rig_spawner.html#a1955c4ecd511a27e696ba7ec68ed44ce">05706</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a1955c4ecd511a27e696ba7ec68ed44ce">RigSpawner::ProcessTractionControl</a>(<a class="code" href="struct_rig_def_1_1_traction_control.html">RigDef::TractionControl</a> &amp; def)
<a name="l05707"></a>05707 {
<a name="l05708"></a>05708     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05709"></a>05709 
<a name="l05710"></a>05710     <span class="comment">/* #1: regulating_force */</span>
<a name="l05711"></a>05711     <span class="keywordtype">float</span> force = def.<a class="code" href="struct_rig_def_1_1_traction_control.html#a050ef8c7fed2b07b2b30c2dec87a2fd9">regulation_force</a>;
<a name="l05712"></a>05712     <span class="keywordflow">if</span> (force &lt; 0.f || force &gt; 20.f)
<a name="l05713"></a>05713     {
<a name="l05714"></a>05714         std::stringstream msg;
<a name="l05715"></a>05715         msg &lt;&lt; <span class="stringliteral">&quot;Clamping &#39;regulating_force&#39; value &#39;&quot;</span> &lt;&lt; force &lt;&lt; <span class="stringliteral">&quot;&#39; to allowed range &lt;0 - 20&gt;&quot;</span>;
<a name="l05716"></a>05716         AddMessage(Message::TYPE_INFO, msg.str());
<a name="l05717"></a>05717         force = (force &lt; 0.f) ? 0.f : 20.f;
<a name="l05718"></a>05718     }
<a name="l05719"></a>05719     m_rig-&gt;tc_ratio = force;
<a name="l05720"></a>05720 
<a name="l05721"></a>05721     <span class="comment">/* #2: wheelslip */</span>
<a name="l05722"></a>05722     m_rig-&gt;tc_wheelslip = (def.<a class="code" href="struct_rig_def_1_1_traction_control.html#aa112656bb61d25e8238e7840866bd22f">wheel_slip</a> &lt; 0.f) ? 0.f : def.<a class="code" href="struct_rig_def_1_1_traction_control.html#aa112656bb61d25e8238e7840866bd22f">wheel_slip</a>;
<a name="l05723"></a>05723 
<a name="l05724"></a>05724     <span class="comment">/* #3: fade_speed */</span>
<a name="l05725"></a>05725     m_rig-&gt;tc_fade = (def.<a class="code" href="struct_rig_def_1_1_traction_control.html#abd1b4ecb76b57d40f93aece3f2a708ac">fade_speed</a> &lt; 0.1f) ? 0.1f : def.<a class="code" href="struct_rig_def_1_1_traction_control.html#abd1b4ecb76b57d40f93aece3f2a708ac">fade_speed</a>;
<a name="l05726"></a>05726 
<a name="l05727"></a>05727     <span class="comment">/* #4: pulse/sec */</span>
<a name="l05728"></a>05728     <span class="keywordtype">float</span> pulse = def.<a class="code" href="struct_rig_def_1_1_traction_control.html#a6fd88cf2f0f1c4abcc3366377a96230c">pulse_per_sec</a>;
<a name="l05729"></a>05729     <span class="keywordflow">if</span> (pulse &lt;= 1.0f || pulse &gt;= 2000.0f)
<a name="l05730"></a>05730     {
<a name="l05731"></a>05731         m_rig-&gt;tc_pulse = 1;
<a name="l05732"></a>05732     } 
<a name="l05733"></a>05733     <span class="keywordflow">else</span>
<a name="l05734"></a>05734     {
<a name="l05735"></a>05735         m_rig-&gt;tc_pulse = static_cast &lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&gt; (2000.f / std::fabs(pulse));
<a name="l05736"></a>05736     }
<a name="l05737"></a>05737 
<a name="l05738"></a>05738     <span class="comment">/* #5: mode */</span>
<a name="l05739"></a>05739     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_traction_control.html#ab3539eb1fbeebf858ce90dcf1e01af95" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_ON))
<a name="l05740"></a>05740     {
<a name="l05741"></a>05741         m_rig-&gt;tc_mode = 1;
<a name="l05742"></a>05742     }
<a name="l05743"></a>05743     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_traction_control.html#ab3539eb1fbeebf858ce90dcf1e01af95" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_OFF))
<a name="l05744"></a>05744     {
<a name="l05745"></a>05745         m_rig-&gt;tc_mode = 0;
<a name="l05746"></a>05746     }
<a name="l05747"></a>05747     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_traction_control.html#ab3539eb1fbeebf858ce90dcf1e01af95" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_NO_TOGGLE))
<a name="l05748"></a>05748     {
<a name="l05749"></a>05749         m_rig-&gt;tc_notoggle = <span class="keyword">true</span>;
<a name="l05750"></a>05750     }
<a name="l05751"></a>05751     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_traction_control.html#ab3539eb1fbeebf858ce90dcf1e01af95" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_NO_DASHBOARD))
<a name="l05752"></a>05752     {
<a name="l05753"></a>05753         m_rig-&gt;tc_present = <span class="keyword">false</span>;
<a name="l05754"></a>05754     }
<a name="l05755"></a>05755     <span class="keywordflow">else</span>
<a name="l05756"></a>05756     {
<a name="l05757"></a>05757         m_rig-&gt;tc_present = <span class="keyword">true</span>;
<a name="l05758"></a>05758     }
<a name="l05759"></a>05759 };
<a name="l05760"></a>05760 
<a name="l05761"></a><a class="code" href="class_rig_spawner.html#aed4b3201cb9833f45b8b516ba0e0ac08">05761</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aed4b3201cb9833f45b8b516ba0e0ac08">RigSpawner::ProcessAntiLockBrakes</a>(<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html">RigDef::AntiLockBrakes</a> &amp; def)
<a name="l05762"></a>05762 {
<a name="l05763"></a>05763     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05764"></a>05764 
<a name="l05765"></a>05765     <span class="comment">/* #1: regulating_force */</span>
<a name="l05766"></a>05766     <span class="keywordtype">float</span> force = def.<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html#a5888f772ac8b846466c93c1f7a3fff71">regulation_force</a>;
<a name="l05767"></a>05767     <span class="keywordflow">if</span> (force &lt; 0.f || force &gt; 20.f)
<a name="l05768"></a>05768     {
<a name="l05769"></a>05769         std::stringstream msg;
<a name="l05770"></a>05770         msg &lt;&lt; <span class="stringliteral">&quot;Clamping &#39;regulating_force&#39; value &#39;&quot;</span> &lt;&lt; force &lt;&lt; <span class="stringliteral">&quot;&#39; to allowed range &lt;0 - 20&gt;&quot;</span>;
<a name="l05771"></a>05771         AddMessage(Message::TYPE_INFO, msg.str());
<a name="l05772"></a>05772         force = (force &lt; 0.f) ? 0.f : 20.f;
<a name="l05773"></a>05773     }
<a name="l05774"></a>05774     m_rig-&gt;alb_ratio = force;
<a name="l05775"></a>05775 
<a name="l05776"></a>05776     <span class="comment">/* #2: min_speed */</span>
<a name="l05777"></a>05777     <span class="comment">/* Wheelspeed adaption: 60 sec * 60 mins / 1000(kilometer) = 3.6 to get meter per sec */</span>
<a name="l05778"></a>05778     <span class="keywordtype">float</span> min_speed = def.<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html#ab8a9437eb41bc8c305d7322dbf7b0dae">min_speed</a> / 3.6f;
<a name="l05779"></a>05779     m_rig-&gt;alb_minspeed = std::max(0.5f, min_speed);
<a name="l05780"></a>05780 
<a name="l05781"></a>05781     <span class="comment">/* #3: pulse_per_sec */</span>
<a name="l05782"></a>05782     <span class="keywordtype">float</span> pulse = def.<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html#ae009886a223a5467555ed1bbf9cec2a7">pulse_per_sec</a>;
<a name="l05783"></a>05783     <span class="keywordflow">if</span> (pulse &lt;= 1.0f || pulse &gt;= 2000.0f)
<a name="l05784"></a>05784     {
<a name="l05785"></a>05785         m_rig-&gt;alb_pulse = 1;
<a name="l05786"></a>05786     } 
<a name="l05787"></a>05787     <span class="keywordflow">else</span>
<a name="l05788"></a>05788     {
<a name="l05789"></a>05789         m_rig-&gt;alb_pulse = static_cast &lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>&gt; (2000.f / std::fabs(pulse));
<a name="l05790"></a>05790     }
<a name="l05791"></a>05791 
<a name="l05792"></a>05792     <span class="comment">/* #4: mode */</span>
<a name="l05793"></a>05793     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html#a2b7a358ac3c0e69ee115338cb1bbd351" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_ON))
<a name="l05794"></a>05794     {
<a name="l05795"></a>05795         m_rig-&gt;alb_mode = 1;
<a name="l05796"></a>05796     }
<a name="l05797"></a>05797     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html#a2b7a358ac3c0e69ee115338cb1bbd351" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_OFF))
<a name="l05798"></a>05798     {
<a name="l05799"></a>05799         m_rig-&gt;alb_mode = 0;
<a name="l05800"></a>05800     }
<a name="l05801"></a>05801     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html#a2b7a358ac3c0e69ee115338cb1bbd351" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_NO_TOGGLE))
<a name="l05802"></a>05802     {
<a name="l05803"></a>05803         m_rig-&gt;alb_notoggle = <span class="keyword">true</span>;
<a name="l05804"></a>05804     }
<a name="l05805"></a>05805     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_anti_lock_brakes.html#a2b7a358ac3c0e69ee115338cb1bbd351" title="Bit flags.">mode</a>, RigDef::AntiLockBrakes::MODE_NO_DASHBOARD))
<a name="l05806"></a>05806     {
<a name="l05807"></a>05807         m_rig-&gt;alb_present = <span class="keyword">false</span>;
<a name="l05808"></a>05808     }
<a name="l05809"></a>05809     <span class="keywordflow">else</span>
<a name="l05810"></a>05810     {
<a name="l05811"></a>05811         m_rig-&gt;alb_present = <span class="keyword">true</span>;
<a name="l05812"></a>05812     }
<a name="l05813"></a>05813 }
<a name="l05814"></a>05814 
<a name="l05815"></a><a class="code" href="class_rig_spawner.html#aeb069709d933c8bbf189a97ce5ab9ddd">05815</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aeb069709d933c8bbf189a97ce5ab9ddd">RigSpawner::ProcessBrakes</a>(<a class="code" href="struct_rig_def_1_1_brakes.html">RigDef::Brakes</a> &amp; def)
<a name="l05816"></a>05816 {
<a name="l05817"></a>05817     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05818"></a>05818 
<a name="l05819"></a>05819     m_rig-&gt;brakeforce = def.<a class="code" href="struct_rig_def_1_1_brakes.html#ac586839ca3ab154ecda565574f3adf68">default_braking_force</a>;
<a name="l05820"></a>05820     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_brakes.html#ad27f75c87fe040bd6d7121887c6fdcb8">_parking_brake_force_set</a>)
<a name="l05821"></a>05821     {
<a name="l05822"></a>05822         m_rig-&gt;hbrakeforce = def.<a class="code" href="struct_rig_def_1_1_brakes.html#af4037f1d44558fb40d927bc4a3d99176">parking_brake_force</a>;
<a name="l05823"></a>05823     }
<a name="l05824"></a>05824     <span class="keywordflow">else</span>
<a name="l05825"></a>05825     {
<a name="l05826"></a>05826         m_rig-&gt;hbrakeforce = 2.f * m_rig-&gt;brakeforce;
<a name="l05827"></a>05827     }
<a name="l05828"></a>05828 };
<a name="l05829"></a>05829 
<a name="l05830"></a><a class="code" href="class_rig_spawner.html#af93be1acad4eeedcfd08089422127016">05830</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af93be1acad4eeedcfd08089422127016">RigSpawner::ProcessEngturbo</a>(<a class="code" href="struct_rig_def_1_1_engturbo.html">RigDef::Engturbo</a> &amp; def)
<a name="l05831"></a>05831 {
<a name="l05832"></a>05832     <span class="comment">/* Is this a land vehicle? */</span>
<a name="l05833"></a>05833     <span class="keywordflow">if</span> (m_rig-&gt;engine == <span class="keyword">nullptr</span>)
<a name="l05834"></a>05834     {
<a name="l05835"></a>05835         AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;Section &#39;engturbo&#39; found but no engine defined. Skipping ...&quot;</span>);
<a name="l05836"></a>05836         <span class="keywordflow">return</span>;
<a name="l05837"></a>05837     }
<a name="l05838"></a>05838     
<a name="l05839"></a>05839         <span class="comment">/* Find it */</span>
<a name="l05840"></a>05840     boost::shared_ptr&lt;RigDef::Engturbo&gt; engturbo;
<a name="l05841"></a>05841     std::list&lt;boost::shared_ptr&lt;RigDef::File::Module&gt;&gt;::iterator module_itor = m_selected_modules.begin();
<a name="l05842"></a>05842     <span class="keywordflow">for</span> (; module_itor != m_selected_modules.end(); module_itor++)
<a name="l05843"></a>05843     {
<a name="l05844"></a>05844         <span class="keywordflow">if</span> (module_itor-&gt;get()-&gt;engturbo != <span class="keyword">nullptr</span>)
<a name="l05845"></a>05845         {
<a name="l05846"></a>05846             engturbo = module_itor-&gt;get()-&gt;engturbo;
<a name="l05847"></a>05847         }
<a name="l05848"></a>05848     }
<a name="l05849"></a>05849     
<a name="l05850"></a>05850         <span class="comment">/* Process it */</span>
<a name="l05851"></a>05851     m_rig-&gt;engine-&gt;setTurboOptions(engturbo-&gt;version, engturbo-&gt;tinertiaFactor, engturbo-&gt;nturbos, engturbo-&gt;param1, engturbo-&gt;param2, engturbo-&gt;param3, engturbo-&gt;param4, engturbo-&gt;param5, engturbo-&gt;param6, engturbo-&gt;param7, engturbo-&gt;param8, engturbo-&gt;param9, engturbo-&gt;param10, engturbo-&gt;param11);
<a name="l05852"></a>05852 };
<a name="l05853"></a>05853 
<a name="l05854"></a><a class="code" href="class_rig_spawner.html#a92c3f1643c7895354422b2626da1e068">05854</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a92c3f1643c7895354422b2626da1e068">RigSpawner::ProcessEngoption</a>(<a class="code" href="struct_rig_def_1_1_engoption.html">RigDef::Engoption</a> &amp; def)
<a name="l05855"></a>05855 {
<a name="l05856"></a>05856     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05857"></a>05857 
<a name="l05858"></a>05858     <span class="comment">/* Is this a land vehicle? */</span>
<a name="l05859"></a>05859     <span class="keywordflow">if</span> (m_rig-&gt;engine == <span class="keyword">nullptr</span>)
<a name="l05860"></a>05860     {
<a name="l05861"></a>05861         AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;Section &#39;engoption&#39; found but no engine defined. Skipping ...&quot;</span>);
<a name="l05862"></a>05862         <span class="keywordflow">return</span>;
<a name="l05863"></a>05863     }
<a name="l05864"></a>05864 
<a name="l05865"></a>05865     <span class="comment">/* Find it */</span>
<a name="l05866"></a>05866     boost::shared_ptr&lt;RigDef::Engoption&gt; engoption;
<a name="l05867"></a>05867     std::list&lt;boost::shared_ptr&lt;RigDef::File::Module&gt;&gt;::iterator module_itor = m_selected_modules.begin();
<a name="l05868"></a>05868     <span class="keywordflow">for</span> (; module_itor != m_selected_modules.end(); module_itor++)
<a name="l05869"></a>05869     {
<a name="l05870"></a>05870         <span class="keywordflow">if</span> (module_itor-&gt;get()-&gt;engoption != <span class="keyword">nullptr</span>)
<a name="l05871"></a>05871         {
<a name="l05872"></a>05872             engoption = module_itor-&gt;get()-&gt;engoption;
<a name="l05873"></a>05873         }
<a name="l05874"></a>05874     }
<a name="l05875"></a>05875 
<a name="l05876"></a>05876     <span class="comment">/* Process it */</span>
<a name="l05877"></a>05877     m_rig-&gt;engine-&gt;setOptions(
<a name="l05878"></a>05878         engoption-&gt;inertia,
<a name="l05879"></a>05879         engoption-&gt;type,
<a name="l05880"></a>05880         (engoption-&gt;_clutch_force_use_default) ? -1.f : engoption-&gt;clutch_force,
<a name="l05881"></a>05881         engoption-&gt;shift_time,
<a name="l05882"></a>05882         engoption-&gt;clutch_time,
<a name="l05883"></a>05883         engoption-&gt;post_shift_time,
<a name="l05884"></a>05884         engoption-&gt;idle_rpm,
<a name="l05885"></a>05885         engoption-&gt;stall_rpm,
<a name="l05886"></a>05886         engoption-&gt;max_idle_mixture,
<a name="l05887"></a>05887         engoption-&gt;min_idle_mixture
<a name="l05888"></a>05888     );
<a name="l05889"></a>05889 };
<a name="l05890"></a>05890 
<a name="l05891"></a><a class="code" href="class_rig_spawner.html#a8202cecbd7d7d1f2eb7746d64a3268e4">05891</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a8202cecbd7d7d1f2eb7746d64a3268e4">RigSpawner::ProcessEngine</a>(<a class="code" href="struct_rig_def_1_1_engine.html">RigDef::Engine</a> &amp; def)
<a name="l05892"></a>05892 {
<a name="l05893"></a>05893     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05894"></a>05894 
<a name="l05895"></a>05895     <span class="comment">/* Process it */</span>
<a name="l05896"></a>05896     m_rig-&gt;driveable = <a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18ad70431030b2ce25863bfad2f593091a6" title="its a truck">TRUCK</a>;
<a name="l05897"></a>05897 
<a name="l05898"></a>05898     <span class="comment">/* Process gear list to BeamEngine-compatible format */</span>
<a name="l05899"></a>05899     <span class="comment">/* TODO: Move this to BeamEngine::BeamEngine() */</span>
<a name="l05900"></a>05900     std::vector&lt;float&gt; gears_compat;
<a name="l05901"></a>05901     gears_compat.reserve(2 + def.<a class="code" href="struct_rig_def_1_1_engine.html#a00f8a5f55b5c0d171dbcd4eeab24a331">gear_ratios</a>.size());
<a name="l05902"></a>05902     gears_compat.push_back(def.<a class="code" href="struct_rig_def_1_1_engine.html#aa7bc1a81324521a909a6c6ef9b96f847">reverse_gear_ratio</a>);
<a name="l05903"></a>05903     gears_compat.push_back(def.<a class="code" href="struct_rig_def_1_1_engine.html#a7ba547e77c4fbdcb42da00ff2155672e">neutral_gear_ratio</a>);
<a name="l05904"></a>05904     std::vector&lt;float&gt;::iterator itor = def.<a class="code" href="struct_rig_def_1_1_engine.html#a00f8a5f55b5c0d171dbcd4eeab24a331">gear_ratios</a>.begin();
<a name="l05905"></a>05905     <span class="keywordflow">for</span> (; itor &lt; def.<a class="code" href="struct_rig_def_1_1_engine.html#a00f8a5f55b5c0d171dbcd4eeab24a331">gear_ratios</a>.end(); itor++)
<a name="l05906"></a>05906     {
<a name="l05907"></a>05907         gears_compat.push_back(*itor);
<a name="l05908"></a>05908     }
<a name="l05909"></a>05909 
<a name="l05910"></a>05910     m_rig-&gt;engine = <span class="keyword">new</span> <a class="code" href="class_beam_engine.html">BeamEngine</a>(
<a name="l05911"></a>05911         def.<a class="code" href="struct_rig_def_1_1_engine.html#aae5e74c0b9c47d620f4823fd83119d32">shift_down_rpm</a>,
<a name="l05912"></a>05912         def.<a class="code" href="struct_rig_def_1_1_engine.html#a874a3a66a5bda10008856c8e061800f8">shift_up_rpm</a>,
<a name="l05913"></a>05913         def.<a class="code" href="struct_rig_def_1_1_engine.html#ad0aefd22876c6484c55daa0c509eb700">torque</a>,
<a name="l05914"></a>05914         gears_compat,
<a name="l05915"></a>05915         def.<a class="code" href="struct_rig_def_1_1_engine.html#a3885f5621179c9266aede0c0167c0a87">global_gear_ratio</a>,
<a name="l05916"></a>05916         m_rig-&gt;trucknum
<a name="l05917"></a>05917     );
<a name="l05918"></a>05918 
<a name="l05919"></a>05919     <span class="comment">/* Are there any startup shifter settings? */</span>
<a name="l05920"></a>05920     Ogre::String gearbox_mode = <a class="code" href="_settings_8h.html#a59d79e9512ab19f4eb8a322f1e32dc11">SSETTING</a>(<span class="stringliteral">&quot;gearbox_mode&quot;</span>, <span class="stringliteral">&quot;Automatic shift&quot;</span>);
<a name="l05921"></a>05921     <span class="keywordflow">if</span> (gearbox_mode == <span class="stringliteral">&quot;Manual shift - Auto clutch&quot;</span>)
<a name="l05922"></a>05922         m_rig-&gt;engine-&gt;setAutoMode(<a class="code" href="class_beam_engine.html#a1ef30203bb7f287327f6e6d0bdfcfd13ada329425cc7aae7a4d58cf7fee609ca8">BeamEngine::SEMIAUTO</a>);
<a name="l05923"></a>05923     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gearbox_mode == <span class="stringliteral">&quot;Fully Manual: sequential shift&quot;</span>)
<a name="l05924"></a>05924         m_rig-&gt;engine-&gt;setAutoMode(<a class="code" href="class_beam_engine.html#a1ef30203bb7f287327f6e6d0bdfcfd13a8c16b6dd388d95f372326446e2fa8d54">BeamEngine::MANUAL</a>);
<a name="l05925"></a>05925     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gearbox_mode == <span class="stringliteral">&quot;Fully Manual: stick shift&quot;</span>)
<a name="l05926"></a>05926         m_rig-&gt;engine-&gt;setAutoMode(<a class="code" href="class_beam_engine.html#a1ef30203bb7f287327f6e6d0bdfcfd13a3cb3aad82c3667f5ecc28c33234a9679">BeamEngine::MANUAL_STICK</a>);
<a name="l05927"></a>05927     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (gearbox_mode == <span class="stringliteral">&quot;Fully Manual: stick shift with ranges&quot;</span>)
<a name="l05928"></a>05928         m_rig-&gt;engine-&gt;setAutoMode(<a class="code" href="class_beam_engine.html#a1ef30203bb7f287327f6e6d0bdfcfd13ae81723e4675322662df7311ae7fe08dc">BeamEngine::MANUAL_RANGES</a>);
<a name="l05929"></a>05929 };
<a name="l05930"></a>05930 
<a name="l05931"></a><a class="code" href="class_rig_spawner.html#a1248b17ea206957ff076511d1e5d05cb">05931</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a1248b17ea206957ff076511d1e5d05cb">RigSpawner::ProcessHelp</a>()
<a name="l05932"></a>05932 {
<a name="l05933"></a>05933     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05934"></a>05934 
<a name="l05935"></a>05935     SetCurrentKeyword(<a class="code" href="struct_rig_def_1_1_file.html#add5bea6329504fe29cc675aa7f8a75c3af877bccc3df4ff11c4ce7a3922aaf86b">RigDef::File::KEYWORD_HELP</a>);
<a name="l05936"></a>05936     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> material_count = 0;
<a name="l05937"></a>05937 
<a name="l05938"></a>05938     std::list&lt;boost::shared_ptr&lt;RigDef::File::Module&gt;&gt;::iterator module_itor = m_selected_modules.begin();
<a name="l05939"></a>05939     <span class="keywordflow">for</span> (; module_itor != m_selected_modules.end(); module_itor++)
<a name="l05940"></a>05940     {
<a name="l05941"></a>05941         <span class="keyword">auto</span> module = module_itor-&gt;get();
<a name="l05942"></a>05942         <span class="keywordflow">if</span> (! module-&gt;help_panel_material_name.empty())
<a name="l05943"></a>05943         {
<a name="l05944"></a>05944             strncpy(m_rig-&gt;helpmat, module-&gt;help_panel_material_name.c_str(), <span class="keyword">sizeof</span>(m_rig-&gt;helpmat) - 1);
<a name="l05945"></a>05945             m_rig-&gt;hashelp = 1;
<a name="l05946"></a>05946             material_count++;
<a name="l05947"></a>05947         }
<a name="l05948"></a>05948     }
<a name="l05949"></a>05949 
<a name="l05950"></a>05950     <span class="keywordflow">if</span> (material_count &gt; 1)
<a name="l05951"></a>05951     {
<a name="l05952"></a>05952         std::stringstream msg;
<a name="l05953"></a>05953         msg &lt;&lt; <span class="stringliteral">&quot;Multiple (&quot;</span> &lt;&lt; material_count &lt;&lt; <span class="stringliteral">&quot;) &#39;help&#39; sections found. Using the last one...&quot;</span>;
<a name="l05954"></a>05954         AddMessage(Message::TYPE_WARNING, msg.str());   
<a name="l05955"></a>05955     }
<a name="l05956"></a>05956 
<a name="l05957"></a>05957     SetCurrentKeyword(<a class="code" href="struct_rig_def_1_1_file.html#add5bea6329504fe29cc675aa7f8a75c3a1c5772b1ec3afd9b63e87fb3d53293bc">RigDef::File::KEYWORD_INVALID</a>);
<a name="l05958"></a>05958 };
<a name="l05959"></a>05959 
<a name="l05960"></a><a class="code" href="class_rig_spawner.html#a1907068b56557a26ee1aa7278791510a">05960</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a1907068b56557a26ee1aa7278791510a">RigSpawner::ProcessFileInfo</a>()
<a name="l05961"></a>05961 {
<a name="l05962"></a>05962     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05963"></a>05963 
<a name="l05964"></a>05964     <span class="keywordflow">if</span> (m_file-&gt;file_info != <span class="keyword">nullptr</span>)
<a name="l05965"></a>05965     {
<a name="l05966"></a>05966         <span class="keywordflow">if</span> (m_file-&gt;file_info-&gt;_has_unique_id)
<a name="l05967"></a>05967         {
<a name="l05968"></a>05968             strncpy(m_rig-&gt;uniquetruckid, m_file-&gt;file_info-&gt;unique_id.c_str(), 254);
<a name="l05969"></a>05969         }
<a name="l05970"></a>05970 
<a name="l05971"></a>05971         <span class="keywordflow">if</span> (m_file-&gt;file_info-&gt;_has_category_id)
<a name="l05972"></a>05972         {
<a name="l05973"></a>05973             m_rig-&gt;categoryid = m_file-&gt;file_info-&gt;category_id;
<a name="l05974"></a>05974         }
<a name="l05975"></a>05975 
<a name="l05976"></a>05976         <span class="keywordflow">if</span> (m_file-&gt;file_info-&gt;_has_file_version_set)
<a name="l05977"></a>05977         {
<a name="l05978"></a>05978             m_rig-&gt;truckversion = m_file-&gt;file_info-&gt;file_version;
<a name="l05979"></a>05979         }
<a name="l05980"></a>05980     }
<a name="l05981"></a>05981 }
<a name="l05982"></a>05982 
<a name="l05983"></a><a class="code" href="class_rig_spawner.html#ab6d255de6e33ccbf52e6a1a56559228b">05983</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ab6d255de6e33ccbf52e6a1a56559228b">RigSpawner::ProcessAuthors</a>()
<a name="l05984"></a>05984 {
<a name="l05985"></a>05985     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l05986"></a>05986 
<a name="l05987"></a>05987     SetCurrentKeyword(<a class="code" href="struct_rig_def_1_1_file.html#add5bea6329504fe29cc675aa7f8a75c3a39c2af7343c33e1b74e7389dbf5c6590">RigDef::File::KEYWORD_FILEFORMATVERSION</a>);
<a name="l05988"></a>05988 
<a name="l05989"></a>05989     std::vector&lt;RigDef::Author&gt;::iterator author_itor = m_file-&gt;authors.begin();
<a name="l05990"></a>05990     <span class="keywordflow">for</span> (; author_itor != m_file-&gt;authors.end(); author_itor++)
<a name="l05991"></a>05991     {
<a name="l05992"></a>05992         <a class="code" href="structauthorinfo__t.html">authorinfo_t</a> author;
<a name="l05993"></a>05993         author.<a class="code" href="structauthorinfo__t.html#a37ec998d2d2255045e0460ca2a6c6f2e">type</a> = author_itor-&gt;type;
<a name="l05994"></a>05994         author.<a class="code" href="structauthorinfo__t.html#affb080886aa149a85900662d721d32ea">name</a> = author_itor-&gt;name;
<a name="l05995"></a>05995         author.<a class="code" href="structauthorinfo__t.html#a0bbbfad31d7de718d911dc15a9bda532">email</a> = author_itor-&gt;email;
<a name="l05996"></a>05996         <span class="keywordflow">if</span> (author_itor-&gt;_has_forum_account)
<a name="l05997"></a>05997         {
<a name="l05998"></a>05998             author.<a class="code" href="structauthorinfo__t.html#aaecbc4373abe7c97461c088c80aa5d2c">id</a> = author_itor-&gt;forum_account_id;
<a name="l05999"></a>05999         }
<a name="l06000"></a>06000         m_rig-&gt;authors.push_back(author);
<a name="l06001"></a>06001     }   
<a name="l06002"></a>06002 
<a name="l06003"></a>06003     SetCurrentKeyword(<a class="code" href="struct_rig_def_1_1_file.html#add5bea6329504fe29cc675aa7f8a75c3a1c5772b1ec3afd9b63e87fb3d53293bc">RigDef::File::KEYWORD_INVALID</a>);
<a name="l06004"></a>06004 };
<a name="l06005"></a>06005 
<a name="l06006"></a><a class="code" href="class_rig_spawner.html#aa7136aa4d9840d6a90269d6147fc0e32">06006</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="class_rig_spawner.html#aa7136aa4d9840d6a90269d6147fc0e32">RigSpawner::GetNodeIndexOrThrow</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; node_ref)
<a name="l06007"></a>06007 {
<a name="l06008"></a>06008     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06009"></a>06009 
<a name="l06010"></a>06010     std::pair&lt;unsigned int, bool&gt; result = GetNodeIndex(node_ref);
<a name="l06011"></a>06011     <span class="keywordflow">if</span> (! result.second)
<a name="l06012"></a>06012     {
<a name="l06013"></a>06013         std::stringstream msg;
<a name="l06014"></a>06014         msg &lt;&lt; <span class="stringliteral">&quot;Failed to retrieve required node: &quot;</span> &lt;&lt; node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>();
<a name="l06015"></a>06015         <span class="keywordflow">throw</span> <a class="code" href="class_rig_spawner_1_1_exception.html">Exception</a>(msg.str());
<a name="l06016"></a>06016     }
<a name="l06017"></a>06017     <span class="keywordflow">return</span> result.first;
<a name="l06018"></a>06018 }
<a name="l06019"></a>06019 
<a name="l06020"></a><a class="code" href="class_rig_spawner.html#a5214099a7bdc9471e86a4e6eed00535b">06020</a> <a class="code" href="structnode__t.html">node_t</a> &amp; <a class="code" href="class_rig_spawner.html#a5214099a7bdc9471e86a4e6eed00535b">RigSpawner::GetNodeOrThrow</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; node_ref)
<a name="l06021"></a>06021 {
<a name="l06022"></a>06022     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06023"></a>06023 
<a name="l06024"></a>06024     <span class="keywordflow">return</span> m_rig-&gt;nodes[GetNodeIndexOrThrow(node_ref)];
<a name="l06025"></a>06025 }
<a name="l06026"></a>06026 
<a name="l06027"></a><a class="code" href="class_rig_spawner.html#a3d955c75682e99343116ea14a162cf23">06027</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a3d955c75682e99343116ea14a162cf23">RigSpawner::ProcessCamera</a>(<a class="code" href="struct_rig_def_1_1_camera.html">RigDef::Camera</a> &amp; def)
<a name="l06028"></a>06028 {
<a name="l06029"></a>06029     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06030"></a>06030 
<a name="l06031"></a>06031     <span class="comment">/* Center node */</span>
<a name="l06032"></a>06032     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_camera.html#a75c4993a38f33c507603c106f9f12fe1">center_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l06033"></a>06033     {
<a name="l06034"></a>06034         m_rig-&gt;cameranodepos[m_rig-&gt;freecamera] 
<a name="l06035"></a>06035             = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_camera.html#a75c4993a38f33c507603c106f9f12fe1">center_node</a>));
<a name="l06036"></a>06036     }
<a name="l06037"></a>06037     <span class="keywordflow">else</span>
<a name="l06038"></a>06038     {
<a name="l06039"></a>06039         m_rig-&gt;cameranodepos[m_rig-&gt;freecamera] = -1;
<a name="l06040"></a>06040     }
<a name="l06041"></a>06041 
<a name="l06042"></a>06042     <span class="comment">/* Direction node */</span>
<a name="l06043"></a>06043     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_camera.html#a9e068236ec855da7166bf0058311ea67">back_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l06044"></a>06044     {
<a name="l06045"></a>06045         m_rig-&gt;cameranodedir[m_rig-&gt;freecamera] 
<a name="l06046"></a>06046             = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_camera.html#a9e068236ec855da7166bf0058311ea67">back_node</a>));
<a name="l06047"></a>06047     }
<a name="l06048"></a>06048     <span class="keywordflow">else</span>
<a name="l06049"></a>06049     {
<a name="l06050"></a>06050         m_rig-&gt;cameranodedir[m_rig-&gt;freecamera] = -1;
<a name="l06051"></a>06051     }
<a name="l06052"></a>06052 
<a name="l06053"></a>06053     <span class="comment">/* Roll node */</span>
<a name="l06054"></a>06054     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_camera.html#a584be6975c7b7faa267bc6c0feb21424">left_node</a>.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l06055"></a>06055     {
<a name="l06056"></a>06056         m_rig-&gt;cameranoderoll[m_rig-&gt;freecamera] 
<a name="l06057"></a>06057             = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(GetNodeIndexOrThrow(def.<a class="code" href="struct_rig_def_1_1_camera.html#a584be6975c7b7faa267bc6c0feb21424">left_node</a>));
<a name="l06058"></a>06058     }
<a name="l06059"></a>06059     <span class="keywordflow">else</span>
<a name="l06060"></a>06060     {
<a name="l06061"></a>06061         m_rig-&gt;cameranoderoll[m_rig-&gt;freecamera] = -1;
<a name="l06062"></a>06062     }
<a name="l06063"></a>06063 
<a name="l06064"></a>06064     <span class="comment">/* Advance */</span>
<a name="l06065"></a>06065     m_rig-&gt;freecamera++;
<a name="l06066"></a>06066 };
<a name="l06067"></a>06067 
<a name="l06068"></a><a class="code" href="class_rig_spawner.html#a4329d9ea11190d38df9e3cc2d52f6c30">06068</a> <a class="code" href="structnode__t.html">node_t</a>* <a class="code" href="class_rig_spawner.html#a4329d9ea11190d38df9e3cc2d52f6c30">RigSpawner::GetBeamNodePointer</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; node_ref)
<a name="l06069"></a>06069 {
<a name="l06070"></a>06070     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06071"></a>06071 
<a name="l06072"></a>06072     <a class="code" href="structnode__t.html">node_t</a>* node = GetNodePointer(node_ref);
<a name="l06073"></a>06073     <span class="keywordflow">if</span> (node != <span class="keyword">nullptr</span>)
<a name="l06074"></a>06074     {
<a name="l06075"></a>06075         <span class="keywordflow">return</span> node;
<a name="l06076"></a>06076     }
<a name="l06077"></a>06077     <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l06078"></a>06078 }
<a name="l06079"></a>06079 
<a name="l06080"></a><a class="code" href="class_rig_spawner.html#ae2e38a24de01d01f94de5755b3111f8e">06080</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ae2e38a24de01d01f94de5755b3111f8e">RigSpawner::ProcessBeam</a>(<a class="code" href="struct_rig_def_1_1_beam.html">RigDef::Beam</a> &amp; def)
<a name="l06081"></a>06081 {
<a name="l06082"></a>06082     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06083"></a>06083 
<a name="l06084"></a>06084     <span class="comment">// Nodes</span>
<a name="l06085"></a>06085     <a class="code" href="structnode__t.html">node_t</a>* nodes[] = {<span class="keyword">nullptr</span>, <span class="keyword">nullptr</span>};
<a name="l06086"></a>06086     nodes[0] = GetBeamNodePointer(def.<a class="code" href="struct_rig_def_1_1_beam.html#abc084a33e6f6547aa0a54bbf265c0eeb">nodes</a>[0]);
<a name="l06087"></a>06087     <span class="keywordflow">if</span> (nodes[0] == <span class="keyword">nullptr</span>)
<a name="l06088"></a>06088     {
<a name="l06089"></a>06089         AddMessage(Message::TYPE_WARNING, std::string(<span class="stringliteral">&quot;Ignoring beam, could not find node: &quot;</span>) + def.<a class="code" href="struct_rig_def_1_1_beam.html#abc084a33e6f6547aa0a54bbf265c0eeb">nodes</a>[0].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>());
<a name="l06090"></a>06090         <span class="keywordflow">return</span>;
<a name="l06091"></a>06091     }
<a name="l06092"></a>06092     nodes[1] = GetBeamNodePointer(def.<a class="code" href="struct_rig_def_1_1_beam.html#abc084a33e6f6547aa0a54bbf265c0eeb">nodes</a>[1]);
<a name="l06093"></a>06093     <span class="keywordflow">if</span> (nodes[1] == <span class="keyword">nullptr</span>)
<a name="l06094"></a>06094     {
<a name="l06095"></a>06095         AddMessage(Message::TYPE_WARNING, std::string(<span class="stringliteral">&quot;Ignoring beam, could not find node: &quot;</span>) + def.<a class="code" href="struct_rig_def_1_1_beam.html#abc084a33e6f6547aa0a54bbf265c0eeb">nodes</a>[1].<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>());
<a name="l06096"></a>06096         <span class="keywordflow">return</span>;
<a name="l06097"></a>06097     }
<a name="l06098"></a>06098 
<a name="l06099"></a>06099     <span class="comment">// Beam</span>
<a name="l06100"></a>06100     <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l06101"></a>06101     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetAndInitFreeBeam(*nodes[0], *nodes[1]);
<a name="l06102"></a>06102     beam.<a class="code" href="structbeam__t.html#a7056fd64d16dff1edba5c533c9a4f86d">disabled</a> = <span class="keyword">false</span>;
<a name="l06103"></a>06103     beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a83a5f9df360e2e9881e0d15ab979e8a7">BEAM_NORMAL</a>;
<a name="l06104"></a>06104     beam.<a class="code" href="structbeam__t.html#a4877f7993c9d813a12d2a98e66a33dc5" title="Attribute: detacher group number (integer)">detacher_group</a> = def.<a class="code" href="struct_rig_def_1_1_beam.html#aa2dfd84c4d909dbc59301628f50ecdc3">detacher_group</a>;
<a name="l06105"></a>06105     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>-&gt;GetScaledSpringiness();
<a name="l06106"></a>06106     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>-&gt;GetScaledDamping();
<a name="l06107"></a>06107     beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a> = def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>-&gt;visual_beam_diameter;
<a name="l06108"></a>06108     beam.<a class="code" href="structbeam__t.html#a4ed4ce8b2ed2567d2a2800442007fbfa">minendmass</a> = 1.f; <span class="comment">// Orig = hardcoded in add_beam()</span>
<a name="l06109"></a>06109     beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a69c3572873654b06119fef77969e4711" title="not a shock">NOSHOCK</a>; <span class="comment">// Orig: if (shortbound) ... hardcoded in BTS_BEAMS</span>
<a name="l06110"></a>06110 
<a name="l06111"></a>06111     <span class="comment">/* Deformation */</span>
<a name="l06112"></a>06112     SetBeamDeformationThreshold(beam, def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>);
<a name="l06113"></a>06113             
<a name="l06114"></a>06114     beam.<a class="code" href="structbeam__t.html#ab36a5ad2e437b69aeadda61dd3e5fa08">plastic_coef</a>         = def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>-&gt;plastic_deformation_coefficient;
<a name="l06115"></a>06115     beam.<a class="code" href="structbeam__t.html#abed8f0f238a42c38fc1ddc7b9a9a6b8d">default_plastic_coef</a> = def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>-&gt;plastic_deformation_coefficient;
<a name="l06116"></a>06116 
<a name="l06117"></a>06117     <span class="comment">/* Calculate length */</span>
<a name="l06118"></a>06118     <span class="comment">// orig = precompression hardcoded to 1</span>
<a name="l06119"></a>06119     <span class="keywordtype">float</span> beam_length = (beam.<a class="code" href="structbeam__t.html#aa538bf301652ee7537d259656534768d">p1</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - beam.<a class="code" href="structbeam__t.html#afca9a10cbe0d2ba827c5b430b1e1d154">p2</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l06120"></a>06120     beam.<a class="code" href="structbeam__t.html#a97e6ce14fdcf35d1c7b8c40b40998ede" title="length">L</a>      = beam_length;
<a name="l06121"></a>06121     beam.<a class="code" href="structbeam__t.html#a65d3452c6840de148c962b20defb45b6" title="hydro reference len">Lhydro</a> = beam_length;
<a name="l06122"></a>06122     beam.<a class="code" href="structbeam__t.html#ace384f1fca382d1df48d29c895a29bc3" title="reference length">refL</a>   = beam_length;
<a name="l06123"></a>06123 
<a name="l06124"></a>06124     <span class="comment">/* Strength */</span>
<a name="l06125"></a>06125     <span class="keywordtype">float</span> beam_strength = def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>-&gt;GetScaledBreakingThreshold();
<a name="l06126"></a>06126     beam.<a class="code" href="structbeam__t.html#a3b76bd7e50991e55ba669e20032feec0">strength</a>  = beam_strength;
<a name="l06127"></a>06127     beam.<a class="code" href="structbeam__t.html#a9deeb6c2f764d9f66ab5b2d1fea6d468" title="initial strength">iStrength</a> = beam_strength;
<a name="l06128"></a>06128 
<a name="l06129"></a>06129     <span class="comment">/* Options */</span>
<a name="l06130"></a>06130     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_beam.html#ac38de421870e3bdd021fb951d7111be4" title="Bit flags.">options</a>, RigDef::Beam::OPTION_i_INVISIBLE))
<a name="l06131"></a>06131     {
<a name="l06132"></a>06132         beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a7acff4517c1614edded0989bf5162652">BEAM_INVISIBLE</a>;
<a name="l06133"></a>06133     }
<a name="l06134"></a>06134     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_beam.html#ac38de421870e3bdd021fb951d7111be4" title="Bit flags.">options</a>, RigDef::Beam::OPTION_r_ROPE))
<a name="l06135"></a>06135     {
<a name="l06136"></a>06136         beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a24d6f5addc374131ab07a16c222d6992">ROPE</a>;
<a name="l06137"></a>06137     }
<a name="l06138"></a>06138     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(def.<a class="code" href="struct_rig_def_1_1_beam.html#ac38de421870e3bdd021fb951d7111be4" title="Bit flags.">options</a>, RigDef::Beam::OPTION_s_SUPPORT))
<a name="l06139"></a>06139     {
<a name="l06140"></a>06140         beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a> = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a72a34d3462a4be2ed9be16dff42f78d2">SUPPORTBEAM</a>;
<a name="l06141"></a>06141         beam.<a class="code" href="structbeam__t.html#a4acafe687c44c7f729c2fafd9a8f3e3d">longbound</a> = def.<a class="code" href="struct_rig_def_1_1_beam.html#a8c2371e194a9e70a0576e3911be7dab0">extension_break_limit</a>;
<a name="l06142"></a>06142     }
<a name="l06143"></a>06143 
<a name="l06144"></a>06144     CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_beam.html#a5ed290082130ae889df814baa1f156c7">defaults</a>, <a class="code" href="_bit_flags_8h.html#a43191cd45c8c22dc97bdda0a03c812a6">BITMASK_IS_0</a>(def.<a class="code" href="struct_rig_def_1_1_beam.html#ac38de421870e3bdd021fb951d7111be4" title="Bit flags.">options</a>, RigDef::Beam::OPTION_i_INVISIBLE));
<a name="l06145"></a>06145 }
<a name="l06146"></a>06146 
<a name="l06147"></a><a class="code" href="class_rig_spawner.html#a0f0d2913128c1d18eb7b18e75bb36edb">06147</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a0f0d2913128c1d18eb7b18e75bb36edb">RigSpawner::SetBeamDeformationThreshold</a>(<a class="code" href="structbeam__t.html">beam_t</a> &amp; beam, boost::shared_ptr&lt;RigDef::BeamDefaults&gt; beam_defaults)
<a name="l06148"></a>06148 {
<a name="l06149"></a>06149     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06150"></a>06150 
<a name="l06151"></a>06151     <span class="comment">/*</span>
<a name="l06152"></a>06152 <span class="comment">    ---------------------------------------------------------------------------</span>
<a name="l06153"></a>06153 <span class="comment">        Old parser logic</span>
<a name="l06154"></a>06154 <span class="comment">    ---------------------------------------------------------------------------</span>
<a name="l06155"></a>06155 <span class="comment"></span>
<a name="l06156"></a>06156 <span class="comment">    VAR default_deform              = BEAM_DEFORM (400,000)</span>
<a name="l06157"></a>06157 <span class="comment">    VAR default_deform_scale        = 1</span>
<a name="l06158"></a>06158 <span class="comment">    VAR beam_creak                  = BEAM_CREAK_DEFAULT (100,000)</span>
<a name="l06159"></a>06159 <span class="comment">    VAR enable_advanced_deformation = false</span>
<a name="l06160"></a>06160 <span class="comment"></span>
<a name="l06161"></a>06161 <span class="comment"></span>
<a name="l06162"></a>06162 <span class="comment">    add_beam()</span>
<a name="l06163"></a>06163 <span class="comment">        IF default_deform &lt; beam_creak</span>
<a name="l06164"></a>06164 <span class="comment">            default_deform = beam_creak</span>
<a name="l06165"></a>06165 <span class="comment">        END IF</span>
<a name="l06166"></a>06166 <span class="comment"></span>
<a name="l06167"></a>06167 <span class="comment">        VAR beam;</span>
<a name="l06168"></a>06168 <span class="comment">        beam.default_deform = default_deform * default_deform_scale</span>
<a name="l06169"></a>06169 <span class="comment">    END</span>
<a name="l06170"></a>06170 <span class="comment"></span>
<a name="l06171"></a>06171 <span class="comment">    </span>
<a name="l06172"></a>06172 <span class="comment">    enable_advanced_deformation:</span>
<a name="l06173"></a>06173 <span class="comment">        READ enable_advanced_deformation</span>
<a name="l06174"></a>06174 <span class="comment"></span>
<a name="l06175"></a>06175 <span class="comment"></span>
<a name="l06176"></a>06176 <span class="comment">    set_beam_defaults:</span>
<a name="l06177"></a>06177 <span class="comment">        READ default_deform</span>
<a name="l06178"></a>06178 <span class="comment">        VAR  default_deform_user_defined</span>
<a name="l06179"></a>06179 <span class="comment">        READ default_deform_scale</span>
<a name="l06180"></a>06180 <span class="comment">        VAR  plastic_coef_user_defined</span>
<a name="l06181"></a>06181 <span class="comment"></span>
<a name="l06182"></a>06182 <span class="comment">        IF (!enable_advanced_deformation &amp;&amp; default_deform &lt; BEAM_DEFORM)</span>
<a name="l06183"></a>06183 <span class="comment">           default_deform = BEAM_DEFORM;</span>
<a name="l06184"></a>06184 <span class="comment">        END IF</span>
<a name="l06185"></a>06185 <span class="comment"></span>
<a name="l06186"></a>06186 <span class="comment">        IF (plastic_coef_user_defined)</span>
<a name="l06187"></a>06187 <span class="comment">            beam_creak = 0</span>
<a name="l06188"></a>06188 <span class="comment">        END IF</span>
<a name="l06189"></a>06189 <span class="comment">  </span>
<a name="l06190"></a>06190 <span class="comment">    ---------------------------------------------------------------------------</span>
<a name="l06191"></a>06191 <span class="comment">        TruckParser2013</span>
<a name="l06192"></a>06192 <span class="comment">    ---------------------------------------------------------------------------    </span>
<a name="l06193"></a>06193 <span class="comment"></span>
<a name="l06194"></a>06194 <span class="comment">    VAR beam_defaults</span>
<a name="l06195"></a>06195 <span class="comment">    {</span>
<a name="l06196"></a>06196 <span class="comment">        default_deform                = BEAM_DEFORM</span>
<a name="l06197"></a>06197 <span class="comment">        scale.default_deform          = 1</span>
<a name="l06198"></a>06198 <span class="comment">        _enable_advanced_deformation  = false</span>
<a name="l06199"></a>06199 <span class="comment">        _user_defined                 = false</span>
<a name="l06200"></a>06200 <span class="comment">        _default_deform_set           = false</span>
<a name="l06201"></a>06201 <span class="comment">        _plastic_coef_user_defined    = false</span>
<a name="l06202"></a>06202 <span class="comment">    }</span>
<a name="l06203"></a>06203 <span class="comment"></span>
<a name="l06204"></a>06204 <span class="comment"></span>
<a name="l06205"></a>06205 <span class="comment">    set_beam_defaults:</span>
<a name="l06206"></a>06206 <span class="comment">        READ beam_defaults</span>
<a name="l06207"></a>06207 <span class="comment"></span>
<a name="l06208"></a>06208 <span class="comment"></span>
<a name="l06209"></a>06209 <span class="comment">    add_beam:</span>
<a name="l06210"></a>06210 <span class="comment"></span>
<a name="l06211"></a>06211 <span class="comment">        // Init</span>
<a name="l06212"></a>06212 <span class="comment"></span>
<a name="l06213"></a>06213 <span class="comment">        VAR default_deform = BEAM_DEFORM;</span>
<a name="l06214"></a>06214 <span class="comment">        VAR beam_creak = BEAM_CREAK_DEFAULT;</span>
<a name="l06215"></a>06215 <span class="comment"></span>
<a name="l06216"></a>06216 <span class="comment">        // Old &#39;set_beam_defaults&#39;</span>
<a name="l06217"></a>06217 <span class="comment"></span>
<a name="l06218"></a>06218 <span class="comment">        IF (beam_defaults._is_user_defined)</span>
<a name="l06219"></a>06219 <span class="comment"></span>
<a name="l06220"></a>06220 <span class="comment">            default_deform = beam_defaults.default_deform</span>
<a name="l06221"></a>06221 <span class="comment">            IF (!beam_defaults._enable_advanced_deformation &amp;&amp; default_deform &lt; BEAM_DEFORM)</span>
<a name="l06222"></a>06222 <span class="comment">               default_deform = BEAM_DEFORM;</span>
<a name="l06223"></a>06223 <span class="comment">            END IF</span>
<a name="l06224"></a>06224 <span class="comment"></span>
<a name="l06225"></a>06225 <span class="comment">            IF (beam_defaults._plastic_coef_user_defined &amp;&amp; beam_defaults.plastic_coef &gt;= 0)</span>
<a name="l06226"></a>06226 <span class="comment">                beam_creak = 0</span>
<a name="l06227"></a>06227 <span class="comment">            END IF</span>
<a name="l06228"></a>06228 <span class="comment"></span>
<a name="l06229"></a>06229 <span class="comment">        END IF</span>
<a name="l06230"></a>06230 <span class="comment"></span>
<a name="l06231"></a>06231 <span class="comment">        // Old &#39;add_beam&#39;</span>
<a name="l06232"></a>06232 <span class="comment"></span>
<a name="l06233"></a>06233 <span class="comment">        IF default_deform &lt; beam_creak</span>
<a name="l06234"></a>06234 <span class="comment">            default_deform = beam_creak</span>
<a name="l06235"></a>06235 <span class="comment">        END IF</span>
<a name="l06236"></a>06236 <span class="comment"></span>
<a name="l06237"></a>06237 <span class="comment">        VAR beam;</span>
<a name="l06238"></a>06238 <span class="comment">        beam.default_deform = default_deform * beam_defaults.scale.default_deform</span>
<a name="l06239"></a>06239 <span class="comment">    </span>
<a name="l06240"></a>06240 <span class="comment">    ---------------------------------------------------------------------------</span>
<a name="l06241"></a>06241 <span class="comment">    */</span>
<a name="l06242"></a>06242 
<a name="l06243"></a>06243     <span class="comment">// Old init</span>
<a name="l06244"></a>06244     <span class="keywordtype">float</span> default_deform = <a class="code" href="_beam_data_8h.html#a4a6060abc056aa0b93ac56b1b7b45406">BEAM_DEFORM</a>; 
<a name="l06245"></a>06245     <span class="keywordtype">float</span> beam_creak = <a class="code" href="_beam_data_8h.html#a495ca83e7d34db63ffd76f6cbe1cafc1">BEAM_CREAK_DEFAULT</a>;
<a name="l06246"></a>06246 
<a name="l06247"></a>06247     <span class="comment">// Old &#39;set_beam_defaults&#39;</span>
<a name="l06248"></a>06248     <span class="keywordflow">if</span> (beam_defaults-&gt;_is_user_defined)
<a name="l06249"></a>06249     {
<a name="l06250"></a>06250         default_deform = beam_defaults-&gt;deformation_threshold_constant;
<a name="l06251"></a>06251         <span class="keywordflow">if</span> (!beam_defaults-&gt;_enable_advanced_deformation &amp;&amp; default_deform &lt; <a class="code" href="_beam_data_8h.html#a4a6060abc056aa0b93ac56b1b7b45406">BEAM_DEFORM</a>)
<a name="l06252"></a>06252         {
<a name="l06253"></a>06253             default_deform = <a class="code" href="_beam_data_8h.html#a4a6060abc056aa0b93ac56b1b7b45406">BEAM_DEFORM</a>;
<a name="l06254"></a>06254         }
<a name="l06255"></a>06255 
<a name="l06256"></a>06256         <span class="keywordtype">bool</span> plastic_coef_user_defined = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(beam_defaults-&gt;_user_specified_fields, <a class="code" href="struct_rig_def_1_1_beam_defaults.html#ad686f0ab8f3b53ec53ae94c07a782d24">RigDef::BeamDefaults::PARAM_PLASTIC_DEFORM_COEFFICIENT</a>);
<a name="l06257"></a>06257         <span class="keywordflow">if</span> (plastic_coef_user_defined &amp;&amp; beam_defaults-&gt;plastic_deformation_coefficient &gt;= 0.f)
<a name="l06258"></a>06258         {
<a name="l06259"></a>06259             beam_creak = 0.f;
<a name="l06260"></a>06260         }
<a name="l06261"></a>06261     }
<a name="l06262"></a>06262 
<a name="l06263"></a>06263     <span class="comment">// Old &#39;add_beam&#39;</span>
<a name="l06264"></a>06264     <span class="keywordflow">if</span> (default_deform &lt; beam_creak)
<a name="l06265"></a>06265     {
<a name="l06266"></a>06266         default_deform = beam_creak;
<a name="l06267"></a>06267     }
<a name="l06268"></a>06268 
<a name="l06269"></a>06269     <span class="keywordtype">float</span> deformation_threshold = default_deform * beam_defaults-&gt;scale.deformation_threshold_constant;
<a name="l06270"></a>06270 
<a name="l06271"></a>06271     beam.<a class="code" href="structbeam__t.html#ac55164728d1a16619bde1bbfc702d9e1">default_deform</a>     = deformation_threshold;
<a name="l06272"></a>06272     beam.<a class="code" href="structbeam__t.html#ab690d2b80f39d9397170bb25567ae1e5">minmaxposnegstress</a> = deformation_threshold;
<a name="l06273"></a>06273     beam.<a class="code" href="structbeam__t.html#a39484a0c214d7dba91f00d7630b160ee">maxposstress</a>       = deformation_threshold;
<a name="l06274"></a>06274     beam.<a class="code" href="structbeam__t.html#ab32a52881c3cdefd744606ef0b86c1cf">maxnegstress</a>       = -(deformation_threshold);
<a name="l06275"></a>06275 }
<a name="l06276"></a>06276 
<a name="l06277"></a><a class="code" href="class_rig_spawner.html#a1330d1f9a590276adab19681e53ed99b">06277</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a1330d1f9a590276adab19681e53ed99b">RigSpawner::CreateBeamVisuals</a>(<a class="code" href="structbeam__t.html">beam_t</a> &amp; beam, <span class="keywordtype">int</span> beam_index, boost::shared_ptr&lt;RigDef::BeamDefaults&gt; beam_defaults, <span class="keywordtype">bool</span> activate)
<a name="l06278"></a>06278 {
<a name="l06279"></a>06279     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06280"></a>06280 
<a name="l06281"></a>06281     std::stringstream beam_name;
<a name="l06282"></a>06282     beam_name &lt;&lt; <span class="stringliteral">&quot;beam-&quot;</span> &lt;&lt; m_rig-&gt;truckname &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; beam_index;
<a name="l06283"></a>06283     <span class="keywordflow">try</span>
<a name="l06284"></a>06284     {
<a name="l06285"></a>06285         beam.<a class="code" href="structbeam__t.html#aff519520e0a0495a4d6d895fca408c83" title="visual">mEntity</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createEntity(beam_name.str(), <span class="stringliteral">&quot;beam.mesh&quot;</span>);
<a name="l06286"></a>06286     }
<a name="l06287"></a>06287     <span class="keywordflow">catch</span> (...)
<a name="l06288"></a>06288     {
<a name="l06289"></a>06289         <span class="keywordflow">throw</span> <a class="code" href="class_rig_spawner_1_1_exception.html">Exception</a>(<span class="stringliteral">&quot;Failed to load file &#39;beam.mesh&#39; (should come with RoR installation)&quot;</span>);
<a name="l06290"></a>06290     }
<a name="l06291"></a>06291     m_rig-&gt;deletion_Entities.push_back(beam.<a class="code" href="structbeam__t.html#aff519520e0a0495a4d6d895fca408c83" title="visual">mEntity</a>);
<a name="l06292"></a>06292     beam.<a class="code" href="structbeam__t.html#a75eba7838bbbca59b4fdedd6c1c8df20" title="visual">mSceneNode</a> = m_rig-&gt;beamsRoot-&gt;createChildSceneNode();
<a name="l06293"></a>06293     beam.<a class="code" href="structbeam__t.html#a75eba7838bbbca59b4fdedd6c1c8df20" title="visual">mSceneNode</a>-&gt;setScale(beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a>, -1, beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a>);
<a name="l06294"></a>06294     <span class="keywordflow">if</span> (beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> == <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a> || beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> == <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9aec156315fe4432c998ad109a03ac066f">BEAM_MARKED</a>)
<a name="l06295"></a>06295     {
<a name="l06296"></a>06296         beam.<a class="code" href="structbeam__t.html#aff519520e0a0495a4d6d895fca408c83" title="visual">mEntity</a>-&gt;setMaterialName(<span class="stringliteral">&quot;tracks/Chrome&quot;</span>);
<a name="l06297"></a>06297     }
<a name="l06298"></a>06298     <span class="keywordflow">else</span>
<a name="l06299"></a>06299     {
<a name="l06300"></a>06300         beam.<a class="code" href="structbeam__t.html#aff519520e0a0495a4d6d895fca408c83" title="visual">mEntity</a>-&gt;setMaterialName(beam_defaults-&gt;beam_material_name);
<a name="l06301"></a>06301     }
<a name="l06302"></a>06302 
<a name="l06303"></a>06303     <span class="comment">/* Attach visuals */</span>
<a name="l06304"></a>06304     <span class="keywordflow">if</span> (activate)
<a name="l06305"></a>06305     {
<a name="l06306"></a>06306         beam.<a class="code" href="structbeam__t.html#a75eba7838bbbca59b4fdedd6c1c8df20" title="visual">mSceneNode</a>-&gt;attachObject(beam.<a class="code" href="structbeam__t.html#aff519520e0a0495a4d6d895fca408c83" title="visual">mEntity</a>);
<a name="l06307"></a>06307     }   
<a name="l06308"></a>06308 }
<a name="l06309"></a>06309 
<a name="l06310"></a><a class="code" href="class_rig_spawner.html#a03a29cbb75d3e8cbe1ef319676ffb4df">06310</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a03a29cbb75d3e8cbe1ef319676ffb4df">RigSpawner::CalculateBeamLength</a>(<a class="code" href="structbeam__t.html">beam_t</a> &amp; beam)
<a name="l06311"></a>06311 {
<a name="l06312"></a>06312     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06313"></a>06313 
<a name="l06314"></a>06314     <span class="keywordtype">float</span> beam_length = (beam.<a class="code" href="structbeam__t.html#aa538bf301652ee7537d259656534768d">p1</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> - beam.<a class="code" href="structbeam__t.html#afca9a10cbe0d2ba827c5b430b1e1d154">p2</a>-&gt;<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a>).length();
<a name="l06315"></a>06315     beam.<a class="code" href="structbeam__t.html#a97e6ce14fdcf35d1c7b8c40b40998ede" title="length">L</a> = beam_length;
<a name="l06316"></a>06316     beam.<a class="code" href="structbeam__t.html#a65d3452c6840de148c962b20defb45b6" title="hydro reference len">Lhydro</a> = beam_length;
<a name="l06317"></a>06317     beam.<a class="code" href="structbeam__t.html#ace384f1fca382d1df48d29c895a29bc3" title="reference length">refL</a> = beam_length;
<a name="l06318"></a>06318 }
<a name="l06319"></a>06319 
<a name="l06320"></a><a class="code" href="class_rig_spawner.html#a9eef494b9c79ad9a39f9c24b1faeccb0">06320</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a9eef494b9c79ad9a39f9c24b1faeccb0">RigSpawner::InitBeam</a>(<a class="code" href="structbeam__t.html">beam_t</a> &amp; beam, <a class="code" href="structnode__t.html">node_t</a> *node_1, <a class="code" href="structnode__t.html">node_t</a> *node_2)
<a name="l06321"></a>06321 {
<a name="l06322"></a>06322     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06323"></a>06323 
<a name="l06324"></a>06324     beam.<a class="code" href="structbeam__t.html#aa538bf301652ee7537d259656534768d">p1</a> = node_1;
<a name="l06325"></a>06325     beam.<a class="code" href="structbeam__t.html#afca9a10cbe0d2ba827c5b430b1e1d154">p2</a> = node_2;
<a name="l06326"></a>06326 
<a name="l06327"></a>06327     <span class="comment">/* Length */</span>
<a name="l06328"></a>06328     CalculateBeamLength(beam);
<a name="l06329"></a>06329 
<a name="l06330"></a>06330     <span class="comment">/* Misc */</span>
<a name="l06331"></a>06331     beam.<a class="code" href="structbeam__t.html#a4ed4ce8b2ed2567d2a2800442007fbfa">minendmass</a> = 1.f; <span class="comment">// Orig = hardcoded in add_beam()</span>
<a name="l06332"></a>06332 }
<a name="l06333"></a>06333 
<a name="l06334"></a><a class="code" href="class_rig_spawner.html#a6bfcada82322e490117f4f5441665830">06334</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a6bfcada82322e490117f4f5441665830">RigSpawner::AddMessage</a>(<a class="code" href="struct_rig_spawner_1_1_message.html#a70621faa456cbd0e89a1f9f4d4e104a0">RigSpawner::Message::Type</a> type, Ogre::String <span class="keyword">const</span> &amp; text)
<a name="l06335"></a>06335 {
<a name="l06336"></a>06336     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06337"></a>06337 
<a name="l06338"></a>06338     <span class="comment">/* Add message to report */</span>
<a name="l06339"></a>06339     m_messages.push_back(<a class="code" href="struct_rig_spawner_1_1_message.html">Message</a>(type, text, m_current_keyword));
<a name="l06340"></a>06340 
<a name="l06341"></a>06341     <span class="comment">/* Log message immediately (to put other log messages in context) */</span>
<a name="l06342"></a>06342     std::stringstream report;
<a name="l06343"></a>06343     report &lt;&lt; <span class="stringliteral">&quot; == RigSpawner: &quot;</span>;
<a name="l06344"></a>06344     <span class="keywordflow">switch</span> (type)
<a name="l06345"></a>06345     {
<a name="l06346"></a>06346         <span class="keywordflow">case</span> (<a class="code" href="struct_rig_spawner_1_1_message.html#a70621faa456cbd0e89a1f9f4d4e104a0a885131395adf388b313505b33df89ccc">RigSpawner::Message::TYPE_INTERNAL_ERROR</a>): 
<a name="l06347"></a>06347             report &lt;&lt; <span class="stringliteral">&quot;INTERNAL ERROR&quot;</span>; 
<a name="l06348"></a>06348             ++m_messages_num_errors;
<a name="l06349"></a>06349             <span class="keywordflow">break</span>;
<a name="l06350"></a>06350 
<a name="l06351"></a>06351         <span class="keywordflow">case</span> (<a class="code" href="struct_rig_spawner_1_1_message.html#a70621faa456cbd0e89a1f9f4d4e104a0a6ab0a5199edc7f88a41713154945a925">RigSpawner::Message::TYPE_ERROR</a>):
<a name="l06352"></a>06352             report &lt;&lt; <span class="stringliteral">&quot;ERROR&quot;</span>;
<a name="l06353"></a>06353             ++m_messages_num_errors; 
<a name="l06354"></a>06354             <span class="keywordflow">break</span>;
<a name="l06355"></a>06355 
<a name="l06356"></a>06356         <span class="keywordflow">case</span> (<a class="code" href="struct_rig_spawner_1_1_message.html#a70621faa456cbd0e89a1f9f4d4e104a0aa2580c6b105efc7317d34db80fd0e747">RigSpawner::Message::TYPE_WARNING</a>):
<a name="l06357"></a>06357             report &lt;&lt; <span class="stringliteral">&quot;WARNING&quot;</span>;
<a name="l06358"></a>06358             ++m_messages_num_warnings; 
<a name="l06359"></a>06359             <span class="keywordflow">break</span>;
<a name="l06360"></a>06360 
<a name="l06361"></a>06361         <span class="keywordflow">default</span>:
<a name="l06362"></a>06362             report &lt;&lt; <span class="stringliteral">&quot;INFO&quot;</span>;
<a name="l06363"></a>06363             ++m_messages_num_other;
<a name="l06364"></a>06364             <span class="keywordflow">break</span>;
<a name="l06365"></a>06365     }
<a name="l06366"></a>06366     report &lt;&lt; <span class="stringliteral">&quot; (Keyword &quot;</span> &lt;&lt; <a class="code" href="struct_rig_def_1_1_file.html#aecfdfd70221c860aebb6edf3f40d78d2">RigDef::File::KeywordToString</a>(m_current_keyword) &lt;&lt; <span class="stringliteral">&quot;) &quot;</span> &lt;&lt; text;
<a name="l06367"></a>06367     Ogre::LogManager::getSingleton().logMessage(report.str());
<a name="l06368"></a>06368 }
<a name="l06369"></a>06369 
<a name="l06370"></a><a class="code" href="class_rig_spawner.html#a432b93e5b4d3ce715fa3e0739a907b1c">06370</a> std::pair&lt;unsigned int, bool&gt; <a class="code" href="class_rig_spawner.html#a432b93e5b4d3ce715fa3e0739a907b1c">RigSpawner::GetNodeIndex</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; node_ref, <span class="keywordtype">bool</span> quiet <span class="comment">/* Default: false */</span>)
<a name="l06371"></a>06371 {
<a name="l06372"></a>06372     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06373"></a>06373 
<a name="l06374"></a>06374     <span class="keywordflow">if</span> (!node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a5912183c0dfa018a32190a5bc89b53c8">IsValidAnyState</a>())
<a name="l06375"></a>06375     {
<a name="l06376"></a>06376         <span class="keywordflow">if</span> (! quiet)
<a name="l06377"></a>06377         {
<a name="l06378"></a>06378             AddMessage(Message::TYPE_ERROR, std::string(<span class="stringliteral">&quot;Attempt to resolve invalid node reference: &quot;</span>) + node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>());
<a name="l06379"></a>06379         }
<a name="l06380"></a>06380         <span class="keywordflow">return</span> std::make_pair(0, <span class="keyword">false</span>);
<a name="l06381"></a>06381     }
<a name="l06382"></a>06382     <span class="keywordtype">bool</span> is_imported = node_ref.GetImportState_IsValid();
<a name="l06383"></a>06383     <span class="keywordtype">bool</span> is_named = (is_imported ? node_ref.GetImportState_IsResolvedNamed() : node_ref.GetRegularState_IsNamed());
<a name="l06384"></a>06384     <span class="keywordflow">if</span> (is_named)
<a name="l06385"></a>06385     {
<a name="l06386"></a>06386         <span class="keyword">auto</span> result = m_named_nodes.find(node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a80f06d82da5ac28617eca47baa590821">Str</a>());
<a name="l06387"></a>06387         <span class="keywordflow">if</span> (result != m_named_nodes.end())
<a name="l06388"></a>06388         {
<a name="l06389"></a>06389             <span class="keywordflow">return</span> std::make_pair(result-&gt;second, <span class="keyword">true</span>);
<a name="l06390"></a>06390         }
<a name="l06391"></a>06391         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (! quiet)
<a name="l06392"></a>06392         {
<a name="l06393"></a>06393             std::stringstream msg;
<a name="l06394"></a>06394             msg &lt;&lt; <span class="stringliteral">&quot;Failed to resolve node-ref (node not found):&quot;</span> &lt;&lt; node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>();
<a name="l06395"></a>06395             AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06396"></a>06396         }
<a name="l06397"></a>06397         <span class="keywordflow">return</span> std::make_pair(0, <span class="keyword">false</span>);
<a name="l06398"></a>06398     }
<a name="l06399"></a>06399     <span class="keywordflow">else</span>
<a name="l06400"></a>06400     {
<a name="l06401"></a>06401         <span class="comment">// Imported nodes pass without check</span>
<a name="l06402"></a>06402         <span class="keywordflow">if</span> (!is_imported &amp;&amp; (node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a654831f9421f9d314d849f966f70a04d">Num</a>() &gt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(m_rig-&gt;free_node)))
<a name="l06403"></a>06403         {
<a name="l06404"></a>06404             <span class="keywordflow">if</span> (! quiet)
<a name="l06405"></a>06405             {
<a name="l06406"></a>06406                 std::stringstream msg;
<a name="l06407"></a>06407                 msg &lt;&lt; <span class="stringliteral">&quot;Failed to resolve node-ref (node index too big, node count is: &quot;</span>&lt;&lt;m_rig-&gt;free_node&lt;&lt;<span class="stringliteral">&quot;): &quot;</span> &lt;&lt; node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>();
<a name="l06408"></a>06408                 AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06409"></a>06409             }
<a name="l06410"></a>06410             <span class="keywordflow">return</span> std::make_pair(0, <span class="keyword">false</span>);
<a name="l06411"></a>06411         }
<a name="l06412"></a>06412         <span class="keywordflow">return</span> std::make_pair(node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a654831f9421f9d314d849f966f70a04d">Num</a>(), <span class="keyword">true</span>);
<a name="l06413"></a>06413     }
<a name="l06414"></a>06414 }
<a name="l06415"></a>06415 
<a name="l06416"></a><a class="code" href="class_rig_spawner.html#aa4ef04fd8cc1f6b2ca623a887f045f8f">06416</a> <a class="code" href="structnode__t.html">node_t</a>* <a class="code" href="class_rig_spawner.html#aa4ef04fd8cc1f6b2ca623a887f045f8f">RigSpawner::GetNodePointer</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; node_ref)
<a name="l06417"></a>06417 {
<a name="l06418"></a>06418     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06419"></a>06419 
<a name="l06420"></a>06420     std::pair&lt;unsigned int, bool&gt; result = GetNodeIndex(node_ref);
<a name="l06421"></a>06421     <span class="keywordflow">if</span> (result.second)
<a name="l06422"></a>06422     {
<a name="l06423"></a>06423         <span class="keywordflow">return</span> &amp; m_rig-&gt;nodes[result.first];
<a name="l06424"></a>06424     }
<a name="l06425"></a>06425     <span class="keywordflow">else</span>
<a name="l06426"></a>06426     {
<a name="l06427"></a>06427         <span class="keywordflow">return</span> <span class="keyword">nullptr</span>;
<a name="l06428"></a>06428     }
<a name="l06429"></a>06429 }
<a name="l06430"></a>06430 
<a name="l06431"></a><a class="code" href="class_rig_spawner.html#a00bf8b74f800ff79a370be18d5f0e7c4">06431</a> <a class="code" href="structnode__t.html">node_t</a>* <a class="code" href="class_rig_spawner.html#a00bf8b74f800ff79a370be18d5f0e7c4">RigSpawner::GetNodePointerOrThrow</a>(<a class="code" href="class_rig_def_1_1_node_1_1_ref.html">RigDef::Node::Ref</a> <span class="keyword">const</span> &amp; node_ref)
<a name="l06432"></a>06432 {
<a name="l06433"></a>06433     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06434"></a>06434 
<a name="l06435"></a>06435     <a class="code" href="structnode__t.html">node_t</a> *node = GetNodePointer(node_ref);
<a name="l06436"></a>06436     <span class="keywordflow">if</span> (node == <span class="keyword">nullptr</span>)
<a name="l06437"></a>06437     {
<a name="l06438"></a>06438         std::stringstream msg;
<a name="l06439"></a>06439         msg &lt;&lt; <span class="stringliteral">&quot;Required node not found: &quot;</span> &lt;&lt; node_ref.<a class="code" href="class_rig_def_1_1_node_1_1_ref.html#a141e4a4770a737736436a3746a31f3ea">ToString</a>();
<a name="l06440"></a>06440         <span class="keywordflow">throw</span> <a class="code" href="class_rig_spawner_1_1_exception.html">Exception</a>(msg.str());
<a name="l06441"></a>06441     }
<a name="l06442"></a>06442     <span class="keywordflow">return</span> node;
<a name="l06443"></a>06443 }
<a name="l06444"></a>06444 
<a name="l06445"></a><a class="code" href="class_rig_spawner.html#a42bbb19b1c1bb15764ed357f078a19fc">06445</a> std::pair&lt;unsigned int, bool&gt; <a class="code" href="class_rig_spawner.html#a42bbb19b1c1bb15764ed357f078a19fc">RigSpawner::AddNode</a>(<a class="code" href="class_rig_def_1_1_node_1_1_id.html">RigDef::Node::Id</a> &amp; <span class="keywordtype">id</span>)
<a name="l06446"></a>06446 {
<a name="l06447"></a>06447     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06448"></a>06448 
<a name="l06449"></a>06449     <span class="keywordflow">if</span> (!<span class="keywordtype">id</span>.IsValid())
<a name="l06450"></a>06450     {
<a name="l06451"></a>06451         std::stringstream msg;
<a name="l06452"></a>06452         msg &lt;&lt; <span class="stringliteral">&quot;Attempt to add node with &#39;INVALID&#39; flag: &quot;</span> &lt;&lt; <span class="keywordtype">id</span>.ToString() &lt;&lt; <span class="stringliteral">&quot; (number of nodes at this point: &quot;</span> &lt;&lt; m_rig-&gt;free_node &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;
<a name="l06453"></a>06453         this-&gt;AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06454"></a>06454         <span class="keywordflow">return</span> std::make_pair(0, <span class="keyword">false</span>);
<a name="l06455"></a>06455     }
<a name="l06456"></a>06456     <span class="keywordflow">if</span> ((m_rig-&gt;free_node + 1) &gt; <a class="code" href="_beam_data_8h.html#acc4b987a9b4c8d2ff8bcbdb08c5343e5" title="maximum number of nodes per truck">MAX_NODES</a>)
<a name="l06457"></a>06457     {
<a name="l06458"></a>06458         std::stringstream msg;
<a name="l06459"></a>06459         msg &lt;&lt; <span class="stringliteral">&quot;Node limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#acc4b987a9b4c8d2ff8bcbdb08c5343e5" title="maximum number of nodes per truck">MAX_NODES</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded with node: &quot;</span> &lt;&lt; <span class="keywordtype">id</span>.ToString();
<a name="l06460"></a>06460         this-&gt;AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06461"></a>06461         <span class="keywordflow">return</span> std::make_pair(0, <span class="keyword">false</span>);
<a name="l06462"></a>06462     }
<a name="l06463"></a>06463     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.IsTypeNamed())
<a name="l06464"></a>06464     {
<a name="l06465"></a>06465         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_index = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(m_rig-&gt;free_node);
<a name="l06466"></a>06466         <span class="keyword">auto</span> insert_result = m_named_nodes.insert(std::make_pair(<span class="keywordtype">id</span>.Str(), new_index));
<a name="l06467"></a>06467         <span class="keywordflow">if</span> (! insert_result.second)
<a name="l06468"></a>06468         {
<a name="l06469"></a>06469             std::stringstream msg;
<a name="l06470"></a>06470             msg &lt;&lt; <span class="stringliteral">&quot;Ignoring named node! Duplicate name: &quot;</span> &lt;&lt; <span class="keywordtype">id</span>.Str() &lt;&lt; <span class="stringliteral">&quot; (number of nodes at this point: &quot;</span> &lt;&lt; m_rig-&gt;free_node &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;
<a name="l06471"></a>06471             this-&gt;AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06472"></a>06472             <span class="keywordflow">return</span> std::make_pair(0, <span class="keyword">false</span>);
<a name="l06473"></a>06473         }
<a name="l06474"></a>06474         m_rig-&gt;free_node++;
<a name="l06475"></a>06475         <span class="keywordflow">return</span> std::make_pair(new_index, <span class="keyword">true</span>);
<a name="l06476"></a>06476     }
<a name="l06477"></a>06477     <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.IsTypeNumbered())
<a name="l06478"></a>06478     {
<a name="l06479"></a>06479         <span class="keywordflow">if</span> (<span class="keywordtype">id</span>.Num() &lt; static_cast&lt;unsigned int&gt;(m_rig-&gt;free_node))
<a name="l06480"></a>06480         {
<a name="l06481"></a>06481             std::stringstream msg;
<a name="l06482"></a>06482             msg &lt;&lt; <span class="stringliteral">&quot;Duplicate node number, previous definition will be overriden! - &quot;</span> &lt;&lt; <span class="keywordtype">id</span>.ToString() &lt;&lt; <span class="stringliteral">&quot; (number of nodes at this point: &quot;</span> &lt;&lt; m_rig-&gt;free_node &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;
<a name="l06483"></a>06483             this-&gt;AddMessage(Message::TYPE_WARNING, msg.str());
<a name="l06484"></a>06484         }
<a name="l06485"></a>06485         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> new_index = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(m_rig-&gt;free_node);
<a name="l06486"></a>06486         m_rig-&gt;free_node++;
<a name="l06487"></a>06487         <span class="keywordflow">return</span> std::make_pair(new_index, <span class="keyword">true</span>);
<a name="l06488"></a>06488     }
<a name="l06489"></a>06489     <span class="comment">// Invalid node ID without type flag!</span>
<a name="l06490"></a>06490     <span class="keywordflow">throw</span> <a class="code" href="class_rig_spawner_1_1_exception.html">Exception</a>(<span class="stringliteral">&quot;Invalid Node::Id without type flags!&quot;</span>);
<a name="l06491"></a>06491 }
<a name="l06492"></a>06492 
<a name="l06493"></a><a class="code" href="class_rig_spawner.html#a6518929c282a78ec26de9cf88a3c2032">06493</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a6518929c282a78ec26de9cf88a3c2032">RigSpawner::ProcessNode</a>(<a class="code" href="struct_rig_def_1_1_node.html">RigDef::Node</a> &amp; def)
<a name="l06494"></a>06494 {
<a name="l06495"></a>06495     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06496"></a>06496 
<a name="l06497"></a>06497     std::pair&lt;unsigned int, bool&gt; inserted_node = AddNode(def.<a class="code" href="struct_rig_def_1_1_node.html#a6becadb0fb729208ba9327f621561403">id</a>);
<a name="l06498"></a>06498     <span class="keywordflow">if</span> (! inserted_node.second)
<a name="l06499"></a>06499     {
<a name="l06500"></a>06500         <span class="keywordflow">return</span>;
<a name="l06501"></a>06501     }
<a name="l06502"></a>06502 
<a name="l06503"></a>06503     <a class="code" href="structnode__t.html">node_t</a> &amp; node = m_rig-&gt;nodes[inserted_node.first];
<a name="l06504"></a>06504     node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> = inserted_node.first; <span class="comment">/* Node index */</span>
<a name="l06505"></a>06505     node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">int</span><span class="keyword">&gt;</span>(def.<a class="code" href="struct_rig_def_1_1_node.html#a6becadb0fb729208ba9327f621561403">id</a>.<a class="code" href="class_rig_def_1_1_node_1_1_id.html#a43bc911c3609a030eef1be677d0555bc">Num</a>());
<a name="l06506"></a>06506 
<a name="l06507"></a>06507     <span class="comment">/* Positioning */</span>
<a name="l06508"></a>06508     Ogre::Vector3 node_position = m_spawn_position + m_spawn_rotation * def.<a class="code" href="struct_rig_def_1_1_node.html#ac760c8ef35c83b3eed3f284c161314e0">position</a>;
<a name="l06509"></a>06509     node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a> = node_position; 
<a name="l06510"></a>06510     node.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> = node_position - m_rig-&gt;origin;
<a name="l06511"></a>06511     node.<a class="code" href="structnode__t.html#a6e5d916f33fdec1abede8ff9eb541364" title="absolute, per-frame smooth, must be used for visual effects only">smoothpos</a>   = node_position;
<a name="l06512"></a>06512     node.<a class="code" href="structnode__t.html#a8c74d000a299f979a0ec536518a522ab" title="initial position, absolute">iPosition</a>   = node_position;
<a name="l06513"></a>06513     <span class="keywordflow">if</span> (node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> != 0)
<a name="l06514"></a>06514     {
<a name="l06515"></a>06515         node.<a class="code" href="structnode__t.html#a5c4f10620bc281e94a113ef1c296f853" title="initial distance from node0 during loading - used to check for loose parts">iDistance</a> = (m_rig-&gt;nodes[0].AbsPosition - node_position).squaredLength();
<a name="l06516"></a>06516     }
<a name="l06517"></a>06517         
<a name="l06518"></a>06518     node.<a class="code" href="structnode__t.html#a58041d39f6da5f25c1e3a8f62dee01e1" title="{DRY | DRIPPING | WET}">wetstate</a> = <a class="code" href="_beam_data_8h.html#a7ff5f2dff38e7639981794c43dc9167baac846926be1306ef258549902ab00a25" title="node is dry">DRY</a>; <span class="comment">// orig = hardcoded (init_node)</span>
<a name="l06519"></a>06519     node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = -1; <span class="comment">// Hardcoded in orig (bts_nodes, call to init_node())</span>
<a name="l06520"></a>06520     node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = def.<a class="code" href="struct_rig_def_1_1_node.html#aed9625dea7293e9f05cb511e35596eef">node_defaults</a>-&gt;friction;
<a name="l06521"></a>06521     node.<a class="code" href="structnode__t.html#a0b5dc5e5d52e4ceb38098496e2ceb889">volume_coef</a> = def.<a class="code" href="struct_rig_def_1_1_node.html#aed9625dea7293e9f05cb511e35596eef">node_defaults</a>-&gt;volume;
<a name="l06522"></a>06522     node.<a class="code" href="structnode__t.html#af1f7dc09cc03753872adca7816e572b5">surface_coef</a> = def.<a class="code" href="struct_rig_def_1_1_node.html#aed9625dea7293e9f05cb511e35596eef">node_defaults</a>-&gt;surface;
<a name="l06523"></a>06523     node.<a class="code" href="structnode__t.html#a0e878fe75b80991f48856bc920406b35">collisionBoundingBoxID</a> = -1; <span class="comment">// orig = hardcoded (init_node)</span>
<a name="l06524"></a>06524     node.<a class="code" href="structnode__t.html#aef05ecf1894a1c0ef547c5da5a50cef1">iIsSkin</a> = <span class="keyword">true</span>; <span class="comment">// orig = hardcoded (bts_nodes)</span>
<a name="l06525"></a>06525 
<a name="l06526"></a>06526     <span class="comment">/* Mass */</span>
<a name="l06527"></a>06527     <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_node.html#aed9625dea7293e9f05cb511e35596eef">node_defaults</a>-&gt;load_weight &gt;= 0.f) <span class="comment">// The &gt;= operator is in orig.</span>
<a name="l06528"></a>06528     {
<a name="l06529"></a>06529         <span class="comment">// orig = further override of hardcoded default.</span>
<a name="l06530"></a>06530         node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a> = def.<a class="code" href="struct_rig_def_1_1_node.html#aed9625dea7293e9f05cb511e35596eef">node_defaults</a>-&gt;load_weight; 
<a name="l06531"></a>06531         node.<a class="code" href="structnode__t.html#a45fd3fc39d920ef1e5a06f226838b3da" title="Loaded (by vehicle cargo)? {0/1}.">masstype</a> = <a class="code" href="_beam_data_8h.html#a39fca1837c5ce7715cbf571669660c13a6ba6e7d94e312d27b7521bdcb495b989">NODE_LOADED</a>;
<a name="l06532"></a>06532         node.<a class="code" href="structnode__t.html#a16521f9548143a68c3a9c403f19b0087">overrideMass</a> = <span class="keyword">true</span>;
<a name="l06533"></a>06533     }
<a name="l06534"></a>06534     <span class="keywordflow">else</span>
<a name="l06535"></a>06535     {
<a name="l06536"></a>06536         node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a> = 10; <span class="comment">// Hardcoded in original (bts_nodes, call to init_node())</span>
<a name="l06537"></a>06537         node.<a class="code" href="structnode__t.html#a45fd3fc39d920ef1e5a06f226838b3da" title="Loaded (by vehicle cargo)? {0/1}.">masstype</a> = <a class="code" href="_beam_data_8h.html#a39fca1837c5ce7715cbf571669660c13a36cb9de51e36cd015ac75b4d8a755044">NODE_NORMAL</a>; <span class="comment">// orig = hardcoded (bts_nodes)</span>
<a name="l06538"></a>06538     }
<a name="l06539"></a>06539 
<a name="l06540"></a>06540     <span class="comment">/* Gravity */</span>
<a name="l06541"></a>06541     <span class="keywordtype">float</span> gravity = -9.81f;
<a name="l06542"></a>06542     <span class="keywordflow">if</span>(<a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#a23825f69e60897a660d18659399e0de2">terrainManager</a>)
<a name="l06543"></a>06543     {
<a name="l06544"></a>06544         gravity = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#a23825f69e60897a660d18659399e0de2">terrainManager</a>-&gt;<a class="code" href="class_terrain_manager.html#a02de3af7287847607182da563f4bbf2f">getGravity</a>();
<a name="l06545"></a>06545     }
<a name="l06546"></a>06546     node.<a class="code" href="structnode__t.html#af27253462d7242ba74c4998adb22a10e">gravimass</a> = Ogre::Vector3(0, node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a> * gravity, 0);
<a name="l06547"></a>06547 
<a name="l06548"></a>06548     <span class="comment">/* Lockgroup */</span>
<a name="l06549"></a>06549     node.<a class="code" href="structnode__t.html#a83f4454e1fedea625c98c43b6361e880">lockgroup</a> = (m_file-&gt;lockgroup_default_nolock) ? <a class="code" href="struct_rig_def_1_1_lockgroup.html#af9c43afc7eefa88a2ec1fee5d53f4f77">RigDef::Lockgroup::LOCKGROUP_NOLOCK</a> : <a class="code" href="struct_rig_def_1_1_lockgroup.html#af1dca013ef66d135fd97d5b209828d89">RigDef::Lockgroup::LOCKGROUP_DEFAULT</a>;
<a name="l06550"></a>06550 
<a name="l06551"></a>06551     <span class="comment">/* Options */</span>
<a name="l06552"></a>06552     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> options = def.<a class="code" href="struct_rig_def_1_1_node.html#a5f1dd7c05dbec4aaf10ddc4442b4bb16" title="Bit flags.">options</a> | def.<a class="code" href="struct_rig_def_1_1_node.html#aed9625dea7293e9f05cb511e35596eef">node_defaults</a>-&gt;options; <span class="comment">/* Merge bit flags */</span>
<a name="l06553"></a>06553     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_l_LOAD_WEIGHT))
<a name="l06554"></a>06554     {
<a name="l06555"></a>06555         <span class="keywordflow">if</span> (def.<a class="code" href="struct_rig_def_1_1_node.html#a58edb162b6bce2e19d0f65acb2393602">_has_load_weight_override</a>)
<a name="l06556"></a>06556         {
<a name="l06557"></a>06557             node.<a class="code" href="structnode__t.html#a45fd3fc39d920ef1e5a06f226838b3da" title="Loaded (by vehicle cargo)? {0/1}.">masstype</a> = <a class="code" href="_beam_data_8h.html#a39fca1837c5ce7715cbf571669660c13a6ba6e7d94e312d27b7521bdcb495b989">NODE_LOADED</a>;
<a name="l06558"></a>06558             node.<a class="code" href="structnode__t.html#a16521f9548143a68c3a9c403f19b0087">overrideMass</a> = <span class="keyword">true</span>;
<a name="l06559"></a>06559             node.<a class="code" href="structnode__t.html#a4c5024a6f4ca1cb81ae59505e429b017">mass</a> = def.<a class="code" href="struct_rig_def_1_1_node.html#ab2883d7455cdcc7eae1dc959c5c61a0c">load_weight_override</a>;
<a name="l06560"></a>06560         }
<a name="l06561"></a>06561         <span class="keywordflow">else</span>
<a name="l06562"></a>06562         {
<a name="l06563"></a>06563             node.<a class="code" href="structnode__t.html#a45fd3fc39d920ef1e5a06f226838b3da" title="Loaded (by vehicle cargo)? {0/1}.">masstype</a> = <a class="code" href="_beam_data_8h.html#a39fca1837c5ce7715cbf571669660c13a6ba6e7d94e312d27b7521bdcb495b989">NODE_LOADED</a>;
<a name="l06564"></a>06564             m_rig-&gt;masscount++;
<a name="l06565"></a>06565         }
<a name="l06566"></a>06566     }
<a name="l06567"></a>06567     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_e_TERRAIN_EDIT_POINT))
<a name="l06568"></a>06568     {
<a name="l06569"></a>06569         <span class="keywordflow">if</span>(! m_rig-&gt;networking)
<a name="l06570"></a>06570         {
<a name="l06571"></a>06571             m_rig-&gt;editorId = node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>;
<a name="l06572"></a>06572         }
<a name="l06573"></a>06573     }
<a name="l06574"></a>06574     <span class="keywordflow">if</span> (<a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_h_HOOK_POINT))
<a name="l06575"></a>06575     {
<a name="l06576"></a>06576         <span class="comment">/* Link [current-node] -&gt; [node-0] */</span>
<a name="l06577"></a>06577         <span class="comment">/* If current node is 0, link [node-0] -&gt; [node-1] */</span>
<a name="l06578"></a>06578         <a class="code" href="structnode__t.html">node_t</a> &amp; node_2 = (node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> == 0) ? GetNode(1) : GetNode(0);
<a name="l06579"></a>06579         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l06580"></a>06580 
<a name="l06581"></a>06581         <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(node, node_2, def.<a class="code" href="struct_rig_def_1_1_node.html#a5c1eee086ae4f98c4156ca8cf8985d21">beam_defaults</a>, def.<a class="code" href="struct_rig_def_1_1_node.html#ad06861ab140cf8a6d015f99edd24e15a">detacher_group</a>);
<a name="l06582"></a>06582         SetBeamStrength(beam, def.<a class="code" href="struct_rig_def_1_1_node.html#a5c1eee086ae4f98c4156ca8cf8985d21">beam_defaults</a>-&gt;GetScaledBreakingThreshold() * 100.f);
<a name="l06583"></a>06583         beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a>              = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9ab522c320ea8aec4b2c603a232c1358bf">BEAM_HYDRO</a>;
<a name="l06584"></a>06584         beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a>                 = def.<a class="code" href="struct_rig_def_1_1_node.html#a5c1eee086ae4f98c4156ca8cf8985d21">beam_defaults</a>-&gt;GetScaledDamping() * 0.1f;
<a name="l06585"></a>06585         beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a>                 = def.<a class="code" href="struct_rig_def_1_1_node.html#a5c1eee086ae4f98c4156ca8cf8985d21">beam_defaults</a>-&gt;GetScaledSpringiness();
<a name="l06586"></a>06586         beam.<a class="code" href="structbeam__t.html#ae0e22659b0a6b1509b857380ecb5ce0f" title="Values (unnamed enum) { SHOCK1=1, SHOCK2=2, SUPPORTBEAM=3, ROPE=4 }.">bounded</a>           = <a class="code" href="_beam_data_8h.html#aabfcbcb5ac86a1edac4035264bc7d2b8a24d6f5addc374131ab07a16c222d6992">ROPE</a>;
<a name="l06587"></a>06587         beam.<a class="code" href="structbeam__t.html#a7056fd64d16dff1edba5c533c9a4f86d">disabled</a>          = <span class="keyword">true</span>;
<a name="l06588"></a>06588         beam.<a class="code" href="structbeam__t.html#a97e6ce14fdcf35d1c7b8c40b40998ede" title="length">L</a>                 = <a class="code" href="_beam_data_8h.html#a84039de9af4c8e67995d53b534b77b5d">HOOK_RANGE_DEFAULT</a>;
<a name="l06589"></a>06589         beam.<a class="code" href="structbeam__t.html#a65d3452c6840de148c962b20defb45b6" title="hydro reference len">Lhydro</a>            = <a class="code" href="_beam_data_8h.html#a84039de9af4c8e67995d53b534b77b5d">HOOK_RANGE_DEFAULT</a>;
<a name="l06590"></a>06590         beam.<a class="code" href="structbeam__t.html#ace384f1fca382d1df48d29c895a29bc3" title="reference length">refL</a>              = <a class="code" href="_beam_data_8h.html#a84039de9af4c8e67995d53b534b77b5d">HOOK_RANGE_DEFAULT</a>;
<a name="l06591"></a>06591         beam.<a class="code" href="structbeam__t.html#a56392ecaa08c8b8bec4abdc1ec204d25">commandRatioShort</a> = <a class="code" href="_beam_data_8h.html#a9a66d793c818665dbc71fa6dd2cdd7fa">HOOK_SPEED_DEFAULT</a>;
<a name="l06592"></a>06592         beam.<a class="code" href="structbeam__t.html#ab0ab6a1847baf4011bf0b58a742189dd">commandRatioLong</a>  = <a class="code" href="_beam_data_8h.html#a9a66d793c818665dbc71fa6dd2cdd7fa">HOOK_SPEED_DEFAULT</a>;
<a name="l06593"></a>06593         beam.<a class="code" href="structbeam__t.html#a49deacaa83d59050c7613aa9d3c486b7">commandShort</a>      = 0.0f;
<a name="l06594"></a>06594         beam.<a class="code" href="structbeam__t.html#a22e9fa02eb5a1a4760b77f0197ab87ee">commandLong</a>       = 1.0f;
<a name="l06595"></a>06595         beam.<a class="code" href="structbeam__t.html#af07708c1109a50ffc8d54da3d189e732">maxtiestress</a>      = <a class="code" href="_beam_data_8h.html#a980a5c3893a3d4982fb54030a2e6067e">HOOK_FORCE_DEFAULT</a>;
<a name="l06596"></a>06596         beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a>          = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l06597"></a>06597         SetBeamDeformationThreshold(beam, def.<a class="code" href="struct_rig_def_1_1_node.html#a5c1eee086ae4f98c4156ca8cf8985d21">beam_defaults</a>);
<a name="l06598"></a>06598         CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_node.html#a5c1eee086ae4f98c4156ca8cf8985d21">beam_defaults</a>, <span class="keyword">false</span>);
<a name="l06599"></a>06599             
<a name="l06600"></a>06600         <span class="comment">// Logic cloned from SerializedRig.cpp, section BTS_NODES</span>
<a name="l06601"></a>06601         <a class="code" href="structhook__t.html">hook_t</a> hook;
<a name="l06602"></a>06602         hook.<a class="code" href="structhook__t.html#a4e61cb96ef56f046555db72624c1403f">hookNode</a>          = &amp; node;
<a name="l06603"></a>06603         hook.<a class="code" href="structhook__t.html#a43430cce00fdb5ed7418458f1c572c84">group</a>             = -1;
<a name="l06604"></a>06604         hook.<a class="code" href="structhook__t.html#af36a71d0753fdea9ee8527f2951208d0">locked</a>            = <a class="code" href="_beam_data_8h.html#a94798fdadfbf49a7c658ace669a1d310a4ade5a087dd858a01c36ce7ad8f64e36" title="lock not locked">UNLOCKED</a>;
<a name="l06605"></a>06605         hook.<a class="code" href="structhook__t.html#a1cbfbe2118e9159948d25a0c05da3e2e">lockNode</a>          = 0;
<a name="l06606"></a>06606         hook.<a class="code" href="structhook__t.html#a529898bb6aa999b971fd563110047e5d">lockTruck</a>         = 0;
<a name="l06607"></a>06607         hook.<a class="code" href="structhook__t.html#a200e7ec953561f447333dc0f1265b600">lockNodes</a>         = <span class="keyword">true</span>;
<a name="l06608"></a>06608         hook.<a class="code" href="structhook__t.html#ad70c41204141991e5686bad7dc566279">lockgroup</a>         = -1;
<a name="l06609"></a>06609         hook.<a class="code" href="structhook__t.html#ab206cc031a404ae1ab75e2533f1cc618">beam</a>              = &amp; beam;
<a name="l06610"></a>06610         hook.<a class="code" href="structhook__t.html#a4dbd0e551163d656c302c709da09c0d0">maxforce</a>          = <a class="code" href="_beam_data_8h.html#a980a5c3893a3d4982fb54030a2e6067e">HOOK_FORCE_DEFAULT</a>;
<a name="l06611"></a>06611         hook.<a class="code" href="structhook__t.html#aa973528b0525d1a6d31dcf84552b214b">lockrange</a>         = <a class="code" href="_beam_data_8h.html#a84039de9af4c8e67995d53b534b77b5d">HOOK_RANGE_DEFAULT</a>;
<a name="l06612"></a>06612         hook.<a class="code" href="structhook__t.html#a95bb8b2ced0b0557fe3a5ba37b6673e7">lockspeed</a>         = <a class="code" href="_beam_data_8h.html#a9a66d793c818665dbc71fa6dd2cdd7fa">HOOK_SPEED_DEFAULT</a>;
<a name="l06613"></a>06613         hook.<a class="code" href="structhook__t.html#aff82f72e9d013b3af885ee2d852b7280">selflock</a>          = <span class="keyword">false</span>;
<a name="l06614"></a>06614         hook.<a class="code" href="structhook__t.html#a190579b61f34bc5e3a0c9d5e3295ac54">nodisable</a>         = <span class="keyword">false</span>;
<a name="l06615"></a>06615         hook.<a class="code" href="structhook__t.html#a3bebb9e9433d7cd3ccdf7dc04d3420ea">timer</a>             = 0.0f;
<a name="l06616"></a>06616         hook.<a class="code" href="structhook__t.html#aa63e9bc8212cf7f280651ed33ecd4174">timer_preset</a>      = <a class="code" href="_beam_data_8h.html#a5e34723501a12a1ea9f94922c4d1c4b2">HOOK_LOCK_TIMER_DEFAULT</a>;
<a name="l06617"></a>06617         hook.<a class="code" href="structhook__t.html#a4f30c362e2e4c9f63f0d38aa16de000b">autolock</a>          = <span class="keyword">false</span>;
<a name="l06618"></a>06618         hook.<a class="code" href="structhook__t.html#ae6610b5315de112dd406e5daff464a9b">is_hook_visible</a>   = <span class="keyword">false</span>;
<a name="l06619"></a>06619         m_rig-&gt;hooks.push_back(hook);
<a name="l06620"></a>06620     }
<a name="l06621"></a>06621     AdjustNodeBuoyancy(node, def, def.<a class="code" href="struct_rig_def_1_1_node.html#aed9625dea7293e9f05cb511e35596eef">node_defaults</a>);
<a name="l06622"></a>06622     node.<a class="code" href="structnode__t.html#ae47fdbdb2a8baf168be89b3c78da7b4f" title="{ 0=Mouse grab, 1=No mouse grab, 2=Mouse grab with force display}">mouseGrabMode</a>     = (def.<a class="code" href="struct_rig_def_1_1_node.html#a5f1dd7c05dbec4aaf10ddc4442b4bb16" title="Bit flags.">options</a> == 0u) ? 2 : node.<a class="code" href="structnode__t.html#ae47fdbdb2a8baf168be89b3c78da7b4f" title="{ 0=Mouse grab, 1=No mouse grab, 2=Mouse grab with force display}">mouseGrabMode</a>; <span class="comment">// 2 = n = mouse grab enabled</span>
<a name="l06623"></a>06623     node.<a class="code" href="structnode__t.html#ae47fdbdb2a8baf168be89b3c78da7b4f" title="{ 0=Mouse grab, 1=No mouse grab, 2=Mouse grab with force display}">mouseGrabMode</a>     = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_n_MOUSE_GRAB) ? 2 : node.<a class="code" href="structnode__t.html#ae47fdbdb2a8baf168be89b3c78da7b4f" title="{ 0=Mouse grab, 1=No mouse grab, 2=Mouse grab with force display}">mouseGrabMode</a>;
<a name="l06624"></a>06624     node.<a class="code" href="structnode__t.html#ae47fdbdb2a8baf168be89b3c78da7b4f" title="{ 0=Mouse grab, 1=No mouse grab, 2=Mouse grab with force display}">mouseGrabMode</a>     = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_m_NO_MOUSE_GRAB) ? 1 : node.<a class="code" href="structnode__t.html#ae47fdbdb2a8baf168be89b3c78da7b4f" title="{ 0=Mouse grab, 1=No mouse grab, 2=Mouse grab with force display}">mouseGrabMode</a>;
<a name="l06625"></a>06625     node.<a class="code" href="structnode__t.html#a77b759073138a6beb1e714babeb4ee74" title="Bool{0/1}.">contactless</a>       = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_c_NO_GROUND_CONTACT) ? 1 : 0;
<a name="l06626"></a>06626     node.<a class="code" href="structnode__t.html#a99cf4d560c6fcd93dde6c48ee3094c6a">disable_particles</a> = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_p_NO_PARTICLES);
<a name="l06627"></a>06627     node.<a class="code" href="structnode__t.html#ade055011390f7011cb86360513d02be7">disable_sparks</a>    = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_f_NO_SPARKS);
<a name="l06628"></a>06628         
<a name="l06629"></a>06629     m_rig-&gt;smokeRef        = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_y_EXHAUST_DIRECTION) ? node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> : 0;
<a name="l06630"></a>06630     m_rig-&gt;smokeId         = <a class="code" href="_bit_flags_8h.html#a2e2441abbc5b22ba112107a88360a0e7">BITMASK_IS_1</a>(options, RigDef::Node::OPTION_x_EXHAUST_POINT) ? node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> : 0;
<a name="l06631"></a>06631 
<a name="l06632"></a>06632 <span class="preprocessor">#ifdef DEBUG_TRUCKPARSER2013</span>
<a name="l06633"></a>06633 <span class="preprocessor"></span>    <span class="comment">// DEBUG</span>
<a name="l06634"></a>06634     std::stringstream msg;
<a name="l06635"></a>06635     msg&lt;&lt;<span class="stringliteral">&quot;DBG ProcessNode() pos=&quot;</span>&lt;&lt;node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>&lt;&lt;<span class="stringliteral">&quot;, id=&quot;</span>&lt;&lt;node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a> &lt;&lt; <span class="stringliteral">&quot;, X=&quot;</span> &lt;&lt; node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.x &lt;&lt; <span class="stringliteral">&quot;, Y=&quot;</span> &lt;&lt; node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.y &lt;&lt; <span class="stringliteral">&quot;, Z=&quot;</span> &lt;&lt; node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>.z;
<a name="l06636"></a>06636     <a class="code" href="_ro_r_prerequisites_8h.html#af855c94dc540e943632089ce7496faac">LOG</a>(msg.str());
<a name="l06637"></a>06637     <span class="comment">// END</span>
<a name="l06638"></a>06638 <span class="preprocessor">#endif</span>
<a name="l06639"></a>06639 <span class="preprocessor"></span>}
<a name="l06640"></a>06640 
<a name="l06641"></a><a class="code" href="class_rig_spawner.html#ab5cc550460b6d5c4d080ad24fe2eaa70">06641</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ab5cc550460b6d5c4d080ad24fe2eaa70">RigSpawner::AddExhaust</a>(
<a name="l06642"></a>06642         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> emitter_node_idx,
<a name="l06643"></a>06643         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> direction_node_idx,
<a name="l06644"></a>06644         <span class="keywordtype">bool</span> old_format,
<a name="l06645"></a>06645         Ogre::String *user_material_name
<a name="l06646"></a>06646     )
<a name="l06647"></a>06647 {
<a name="l06648"></a>06648     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06649"></a>06649 
<a name="l06650"></a>06650     <span class="keywordflow">if</span> (m_rig-&gt;disable_smoke)
<a name="l06651"></a>06651     {
<a name="l06652"></a>06652         <span class="keywordflow">return</span>;
<a name="l06653"></a>06653     }
<a name="l06654"></a>06654     <a class="code" href="structexhaust__t.html">exhaust_t</a> exhaust;
<a name="l06655"></a>06655     exhaust.<a class="code" href="structexhaust__t.html#a2b7657f951482ce38a72c347809f539b">emitterNode</a> = emitter_node_idx;
<a name="l06656"></a>06656     exhaust.<a class="code" href="structexhaust__t.html#a125e03e4b6add2a031f73a19881e3035">directionNode</a> = direction_node_idx;
<a name="l06657"></a>06657     exhaust.<a class="code" href="structexhaust__t.html#ab718fc960742f3b3955a0bbb86b7a5ab" title="False if defined in &#39;exhausts&#39; section, true if defined in &#39;nodes&#39; by &#39;x&#39;/&#39;y&#39; flag.">isOldFormat</a> = old_format;
<a name="l06658"></a>06658 
<a name="l06659"></a>06659     Ogre::String material_name;
<a name="l06660"></a>06660     <span class="keywordflow">if</span> (user_material_name != <span class="keyword">nullptr</span>)
<a name="l06661"></a>06661     {
<a name="l06662"></a>06662         material_name = *user_material_name;
<a name="l06663"></a>06663     }
<a name="l06664"></a>06664     <span class="keywordflow">else</span>
<a name="l06665"></a>06665     {
<a name="l06666"></a>06666         material_name = <span class="stringliteral">&quot;tracks/Smoke&quot;</span>;
<a name="l06667"></a>06667     }
<a name="l06668"></a>06668 
<a name="l06669"></a>06669     <span class="keywordflow">if</span> (m_rig-&gt;usedSkin != <span class="keyword">nullptr</span> &amp;&amp; m_rig-&gt;usedSkin-&gt;hasReplacementForMaterial(material_name))
<a name="l06670"></a>06670     {
<a name="l06671"></a>06671         Ogre::String new_material = m_rig-&gt;usedSkin-&gt;getReplacementForMaterial(material_name);
<a name="l06672"></a>06672         <span class="keywordflow">if</span> (! new_material.empty())
<a name="l06673"></a>06673         {
<a name="l06674"></a>06674             material_name = new_material;
<a name="l06675"></a>06675         }
<a name="l06676"></a>06676         <span class="keywordflow">else</span>
<a name="l06677"></a>06677         {
<a name="l06678"></a>06678             AddMessage(Message::TYPE_INTERNAL_ERROR, <span class="stringliteral">&quot;AddExhaust(): Material replacer returned empty string.&quot;</span>);
<a name="l06679"></a>06679         }
<a name="l06680"></a>06680     }
<a name="l06681"></a>06681     
<a name="l06682"></a>06682     std::stringstream particle_sys_name;
<a name="l06683"></a>06683     particle_sys_name &lt;&lt; <span class="stringliteral">&quot;exhaust-&quot;</span> &lt;&lt; m_rig-&gt;exhausts.size() &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; m_rig-&gt;truckname;
<a name="l06684"></a>06684     exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a> = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createParticleSystem(particle_sys_name.str(), material_name);
<a name="l06685"></a>06685     <span class="keywordflow">if</span> (exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a> == <span class="keyword">nullptr</span>)
<a name="l06686"></a>06686     {
<a name="l06687"></a>06687         AddMessage(Message::TYPE_INTERNAL_ERROR, <span class="stringliteral">&quot;Failed to create exhaust&quot;</span>);
<a name="l06688"></a>06688         <span class="keywordflow">return</span>;
<a name="l06689"></a>06689     }
<a name="l06690"></a>06690     exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a>-&gt;setVisibilityFlags(<a class="code" href="_ro_r_prerequisites_8h.html#aa24bfd5037bf9378843410b02d8b2e87a7bea7de2683569c69b09f7cf482272d6">DEPTHMAP_DISABLED</a>); <span class="comment">// Disable particles in depthmap</span>
<a name="l06691"></a>06691 
<a name="l06692"></a>06692     
<a name="l06693"></a>06693     exhaust.<a class="code" href="structexhaust__t.html#aa92b4afbbad118ec282621b7b6a3ac6e">smokeNode</a> = m_parent_scene_node-&gt;createChildSceneNode();
<a name="l06694"></a>06694     exhaust.<a class="code" href="structexhaust__t.html#aa92b4afbbad118ec282621b7b6a3ac6e">smokeNode</a>-&gt;attachObject(exhaust.<a class="code" href="structexhaust__t.html#a96b8a1360aecbcf9d5794d5dd4c5d04d">smoker</a>);
<a name="l06695"></a>06695     exhaust.<a class="code" href="structexhaust__t.html#aa92b4afbbad118ec282621b7b6a3ac6e">smokeNode</a>-&gt;setPosition(m_rig-&gt;nodes[exhaust.<a class="code" href="structexhaust__t.html#a2b7657f951482ce38a72c347809f539b">emitterNode</a>].AbsPosition);
<a name="l06696"></a>06696 
<a name="l06697"></a>06697     m_rig-&gt;nodes[emitter_node_idx].isHot = <span class="keyword">true</span>;
<a name="l06698"></a>06698     m_rig-&gt;nodes[direction_node_idx].iIsSkin = <span class="keyword">true</span>;
<a name="l06699"></a>06699     m_rig-&gt;nodes[emitter_node_idx].isHot = <span class="keyword">true</span>;
<a name="l06700"></a>06700     m_rig-&gt;nodes[direction_node_idx].iIsSkin = <span class="keyword">true</span>;
<a name="l06701"></a>06701 
<a name="l06702"></a>06702     m_rig-&gt;exhausts.push_back(exhaust);
<a name="l06703"></a>06703 }
<a name="l06704"></a>06704 
<a name="l06705"></a><a class="code" href="class_rig_spawner.html#a391d2bf9df3e16d242881fe9df512a3e">06705</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a391d2bf9df3e16d242881fe9df512a3e">RigSpawner::AddModule</a>(Ogre::String <span class="keyword">const</span> &amp; module_name)
<a name="l06706"></a>06706 {
<a name="l06707"></a>06707     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06708"></a>06708 
<a name="l06709"></a>06709     std::map&lt; Ogre::String, boost::shared_ptr&lt;RigDef::File::Module&gt; &gt;::iterator result 
<a name="l06710"></a>06710         = m_file-&gt;modules.find(module_name);
<a name="l06711"></a>06711 
<a name="l06712"></a>06712     <span class="keywordflow">if</span> (result != m_file-&gt;modules.end())
<a name="l06713"></a>06713     {
<a name="l06714"></a>06714         m_selected_modules.push_back(result-&gt;second);
<a name="l06715"></a>06715         <a class="code" href="_ro_r_prerequisites_8h.html#af855c94dc540e943632089ce7496faac">LOG</a>(<span class="stringliteral">&quot; == RigSpawner: Module added to configuration: &quot;</span> + module_name);
<a name="l06716"></a>06716         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06717"></a>06717     }
<a name="l06718"></a>06718     AddMessage(Message::TYPE_WARNING, <span class="stringliteral">&quot;Selected module not found: &quot;</span> + module_name);
<a name="l06719"></a>06719     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06720"></a>06720 }
<a name="l06721"></a>06721 
<a name="l06722"></a><a class="code" href="class_rig_spawner.html#ab2cc93fdfa0364ff987f1ae89713ca05">06722</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ab2cc93fdfa0364ff987f1ae89713ca05">RigSpawner::ProcessCinecam</a>(<a class="code" href="struct_rig_def_1_1_cinecam.html">RigDef::Cinecam</a> &amp; def)
<a name="l06723"></a>06723 {
<a name="l06724"></a>06724     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06725"></a>06725 
<a name="l06726"></a>06726     <span class="keywordflow">if</span> (! CheckNodeLimit(1) &amp;&amp; ! CheckBeamLimit(8))
<a name="l06727"></a>06727     {
<a name="l06728"></a>06728         <span class="keywordflow">return</span>;
<a name="l06729"></a>06729     }
<a name="l06730"></a>06730             
<a name="l06731"></a>06731     <span class="comment">/* Node */</span>
<a name="l06732"></a>06732     Ogre::Vector3 node_pos = m_spawn_position + m_spawn_rotation * def.<a class="code" href="struct_rig_def_1_1_cinecam.html#a0e0affdfabad16ad8b5a0734bc5c7c05">position</a>;
<a name="l06733"></a>06733     <a class="code" href="structnode__t.html">node_t</a> &amp; camera_node = GetAndInitFreeNode(node_pos);
<a name="l06734"></a>06734     camera_node.<a class="code" href="structnode__t.html#a77b759073138a6beb1e714babeb4ee74" title="Bool{0/1}.">contactless</a> = 1; <span class="comment">// Orig: hardcoded in BTS_CINECAM</span>
<a name="l06735"></a>06735     camera_node.<a class="code" href="structnode__t.html#a7d1dbb7d0b0f2cdba863499c5ccdeb00" title="Wheel index.">wheelid</a> = -1;
<a name="l06736"></a>06736     camera_node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = <a class="code" href="_beam_data_8h.html#ac09362aa1c172297e2183bc83c304821">NODE_FRICTION_COEF_DEFAULT</a>; <span class="comment">// Node defaults are ignored here.</span>
<a name="l06737"></a>06737     camera_node.<a class="code" href="structnode__t.html#ad7efd0642b0f6f76831483999c523a2d" title="Numeric identifier assigned in rig-definition file (if used), or -1 if the node was generated dynamic...">id</a> = -1;
<a name="l06738"></a>06738     AdjustNodeBuoyancy(camera_node, def.<a class="code" href="struct_rig_def_1_1_cinecam.html#a92a6cca05a40b19e1c939c940d426abf">node_defaults</a>);
<a name="l06739"></a>06739     camera_node.<a class="code" href="structnode__t.html#a0b5dc5e5d52e4ceb38098496e2ceb889">volume_coef</a>   = def.<a class="code" href="struct_rig_def_1_1_cinecam.html#a92a6cca05a40b19e1c939c940d426abf">node_defaults</a>-&gt;volume;
<a name="l06740"></a>06740     camera_node.<a class="code" href="structnode__t.html#af1f7dc09cc03753872adca7816e572b5">surface_coef</a>  = def.<a class="code" href="struct_rig_def_1_1_cinecam.html#a92a6cca05a40b19e1c939c940d426abf">node_defaults</a>-&gt;surface;
<a name="l06741"></a>06741 
<a name="l06742"></a>06742     m_rig-&gt;cinecameranodepos[m_rig-&gt;freecinecamera] = camera_node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a>;
<a name="l06743"></a>06743     m_rig-&gt;freecinecamera++;
<a name="l06744"></a>06744 
<a name="l06745"></a>06745     <span class="comment">/* Beams */</span>
<a name="l06746"></a>06746     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; 8; i++)
<a name="l06747"></a>06747     {
<a name="l06748"></a>06748         <span class="keywordtype">int</span> beam_index = m_rig-&gt;free_beam;
<a name="l06749"></a>06749         <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = AddBeam(camera_node, GetNode(def.<a class="code" href="struct_rig_def_1_1_cinecam.html#a6ba9c57f01f4c8dfad95fc816edd4d36">nodes</a>[i]), def.<a class="code" href="struct_rig_def_1_1_cinecam.html#aa144fbad5eb09b4deda9b79f78090bb0">beam_defaults</a>, <a class="code" href="_beam_data_8h.html#a4caf8d8f829279fba122163d961608a4adb909700ae2e4f59afb0a7b7adccddff">DEFAULT_DETACHER_GROUP</a>);
<a name="l06750"></a>06750         beam.<a class="code" href="structbeam__t.html#a923fedd2d43e1239aa32f251e69b689e" title="Beam type (unnamed enum) { BEAM_NORMAL=0, BEAM_HYDRO=1, BEAM_VIRTUAL=2, BEAM_MARKED=3, BEAM_INVISIBLE=4, BEAM_INVISIBLE_HYDRO=5 }.">type</a> = <a class="code" href="_beam_data_8h.html#aae05225933a42f81e7c4a9fb286596f9a7acff4517c1614edded0989bf5162652">BEAM_INVISIBLE</a>;
<a name="l06751"></a>06751         CalculateBeamLength(beam);
<a name="l06752"></a>06752         beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = def.<a class="code" href="struct_rig_def_1_1_cinecam.html#a6b129be07ce76f7d1754707a265d6405">spring</a>;
<a name="l06753"></a>06753         beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = def.<a class="code" href="struct_rig_def_1_1_cinecam.html#a0b0641bbe255244ac047aa73d09609ac">damping</a>;
<a name="l06754"></a>06754         beam.<a class="code" href="structbeam__t.html#a4a622350eb54e982816a623d8305ca44">diameter</a> = <a class="code" href="_beam_data_8h.html#a1666e0284e55300ca8651e6300a2df3d" title="5 centimeters default beam width">DEFAULT_BEAM_DIAMETER</a>;
<a name="l06755"></a>06755         CreateBeamVisuals(beam, beam_index, def.<a class="code" href="struct_rig_def_1_1_cinecam.html#aa144fbad5eb09b4deda9b79f78090bb0">beam_defaults</a>, <span class="keyword">false</span>);
<a name="l06756"></a>06756     }
<a name="l06757"></a>06757 
<a name="l06758"></a>06758     <span class="comment">/* Cabin light */</span>
<a name="l06759"></a>06759     <span class="keywordflow">if</span> (m_rig-&gt;flaresMode &gt;= 2 &amp;&amp; m_rig-&gt;cablight == <span class="keyword">nullptr</span>)
<a name="l06760"></a>06760     {
<a name="l06761"></a>06761         std::stringstream light_name;
<a name="l06762"></a>06762         light_name &lt;&lt; <span class="stringliteral">&quot;cabinlight-&quot;</span> &lt;&lt; m_rig-&gt;truckname;
<a name="l06763"></a>06763         m_rig-&gt;cablight = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;createLight(light_name.str());
<a name="l06764"></a>06764         m_rig-&gt;cablight-&gt;setType(Ogre::Light::LT_POINT);
<a name="l06765"></a>06765         m_rig-&gt;cablight-&gt;setDiffuseColour( Ogre::ColourValue(0.4, 0.4, 0.3));
<a name="l06766"></a>06766         m_rig-&gt;cablight-&gt;setSpecularColour( Ogre::ColourValue(0.4, 0.4, 0.3));
<a name="l06767"></a>06767         m_rig-&gt;cablight-&gt;setAttenuation(20, 1, 0, 0);
<a name="l06768"></a>06768         m_rig-&gt;cablight-&gt;setCastShadows(<span class="keyword">false</span>);
<a name="l06769"></a>06769         m_rig-&gt;cablight-&gt;setVisible(<span class="keyword">true</span>);
<a name="l06770"></a>06770 
<a name="l06771"></a>06771         m_rig-&gt;cablightNode = <a class="code" href="_main_thread_8cpp.html#aa88203d48340f609e6b6c7f1471f3b8e">gEnv</a>-&gt;<a class="code" href="class_global_environment.html#af1dd98dd6dbe5353a6a0b7bd2a2e42ee">sceneManager</a>-&gt;getRootSceneNode()-&gt;createChildSceneNode();
<a name="l06772"></a>06772         m_rig-&gt;cablightNode-&gt;attachObject(m_rig-&gt;cablight);
<a name="l06773"></a>06773         m_rig-&gt;cablightNode-&gt;setVisible(<span class="keyword">false</span>);
<a name="l06774"></a>06774         m_rig-&gt;deletion_sceneNodes.emplace_back(m_rig-&gt;cablightNode);
<a name="l06775"></a>06775     }
<a name="l06776"></a>06776 };
<a name="l06777"></a>06777 
<a name="l06778"></a><a class="code" href="class_rig_spawner.html#af36d294a9a7c783d542251e41426208a">06778</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af36d294a9a7c783d542251e41426208a">RigSpawner::InitNode</a>(<a class="code" href="structnode__t.html">node_t</a> &amp; node, Ogre::Vector3 <span class="keyword">const</span> &amp; position)
<a name="l06779"></a>06779 {
<a name="l06780"></a>06780     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06781"></a>06781 
<a name="l06782"></a>06782     <span class="comment">/* Position */</span>
<a name="l06783"></a>06783     node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a> = position;
<a name="l06784"></a>06784     node.<a class="code" href="structnode__t.html#a850e3027dab6b9c2d1056f74adbeee39" title="relative to the local physics origin (one origin per truck) (shaky)">RelPosition</a> = position - m_rig-&gt;origin;
<a name="l06785"></a>06785     node.<a class="code" href="structnode__t.html#a6e5d916f33fdec1abede8ff9eb541364" title="absolute, per-frame smooth, must be used for visual effects only">smoothpos</a> = position;
<a name="l06786"></a>06786     node.<a class="code" href="structnode__t.html#a8c74d000a299f979a0ec536518a522ab" title="initial position, absolute">iPosition</a> = position;
<a name="l06787"></a>06787     <span class="keywordflow">if</span> (node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> != 0)
<a name="l06788"></a>06788     {
<a name="l06789"></a>06789         node.<a class="code" href="structnode__t.html#a5c4f10620bc281e94a113ef1c296f853" title="initial distance from node0 during loading - used to check for loose parts">iDistance</a> = (m_rig-&gt;nodes[0].AbsPosition - position).squaredLength();
<a name="l06790"></a>06790     }
<a name="l06791"></a>06791 
<a name="l06792"></a>06792     <span class="comment">/* Misc. */</span>
<a name="l06793"></a>06793     node.<a class="code" href="structnode__t.html#a0e878fe75b80991f48856bc920406b35">collisionBoundingBoxID</a> = -1; <span class="comment">// orig = hardcoded (init_node)</span>
<a name="l06794"></a>06794     node.<a class="code" href="structnode__t.html#a58041d39f6da5f25c1e3a8f62dee01e1" title="{DRY | DRIPPING | WET}">wetstate</a> = <a class="code" href="_beam_data_8h.html#a7ff5f2dff38e7639981794c43dc9167baac846926be1306ef258549902ab00a25" title="node is dry">DRY</a>; <span class="comment">// orig = hardcoded (init_node)</span>
<a name="l06795"></a>06795 }
<a name="l06796"></a>06796 
<a name="l06797"></a><a class="code" href="class_rig_spawner.html#ad4adbe284f705d9dec53bdf0fbe4a409">06797</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af36d294a9a7c783d542251e41426208a">RigSpawner::InitNode</a>(
<a name="l06798"></a>06798     <a class="code" href="structnode__t.html">node_t</a> &amp; node, 
<a name="l06799"></a>06799     Ogre::Vector3 <span class="keyword">const</span> &amp; position,
<a name="l06800"></a>06800     boost::shared_ptr&lt;RigDef::NodeDefaults&gt; node_defaults
<a name="l06801"></a>06801 )
<a name="l06802"></a>06802 {
<a name="l06803"></a>06803     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06804"></a>06804 
<a name="l06805"></a>06805     InitNode(node, position);
<a name="l06806"></a>06806     node.<a class="code" href="structnode__t.html#a9fdd212bac0c687d81bd3e4fd2b099fb">friction_coef</a> = node_defaults-&gt;friction;
<a name="l06807"></a>06807     node.<a class="code" href="structnode__t.html#a0b5dc5e5d52e4ceb38098496e2ceb889">volume_coef</a> = node_defaults-&gt;volume;
<a name="l06808"></a>06808     node.<a class="code" href="structnode__t.html#af1f7dc09cc03753872adca7816e572b5">surface_coef</a> = node_defaults-&gt;surface;
<a name="l06809"></a>06809 }
<a name="l06810"></a>06810 
<a name="l06811"></a><a class="code" href="class_rig_spawner.html#aa7118fc14a29ece0a25b88d4ab200637">06811</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#aa7118fc14a29ece0a25b88d4ab200637">RigSpawner::ProcessGlobals</a>(<a class="code" href="struct_rig_def_1_1_globals.html">RigDef::Globals</a> &amp; def)
<a name="l06812"></a>06812 {
<a name="l06813"></a>06813     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06814"></a>06814 
<a name="l06815"></a>06815     m_rig-&gt;truckmass = def.<a class="code" href="struct_rig_def_1_1_globals.html#a7df0742afda289790b6b0beb1d0357c7">dry_mass</a>;
<a name="l06816"></a>06816     m_rig-&gt;loadmass = def.<a class="code" href="struct_rig_def_1_1_globals.html#a40605f47fa039afe62c7e56d127c6236">cargo_mass</a>;
<a name="l06817"></a>06817 
<a name="l06818"></a>06818     <span class="keywordflow">if</span> (! def.<a class="code" href="struct_rig_def_1_1_globals.html#a7fa30f1f005f4f9b5d9ce5f7a8dd8ca8">material_name</a>.empty())
<a name="l06819"></a>06819     {
<a name="l06820"></a>06820         Ogre::String material_name = def.<a class="code" href="struct_rig_def_1_1_globals.html#a7fa30f1f005f4f9b5d9ce5f7a8dd8ca8">material_name</a>;
<a name="l06821"></a>06821 
<a name="l06822"></a>06822         <span class="comment">/* Check for skin */</span>
<a name="l06823"></a>06823         <span class="keywordflow">if</span> (m_rig-&gt;usedSkin != <span class="keyword">nullptr</span> &amp;&amp; m_rig-&gt;usedSkin-&gt;hasReplacementForMaterial(def.<a class="code" href="struct_rig_def_1_1_globals.html#a7fa30f1f005f4f9b5d9ce5f7a8dd8ca8">material_name</a>))
<a name="l06824"></a>06824         {
<a name="l06825"></a>06825             Ogre::String skin_mat_name = m_rig-&gt;usedSkin-&gt;getReplacementForMaterial(def.<a class="code" href="struct_rig_def_1_1_globals.html#a7fa30f1f005f4f9b5d9ce5f7a8dd8ca8">material_name</a>);
<a name="l06826"></a>06826             <span class="keywordflow">if</span> (! skin_mat_name.empty())
<a name="l06827"></a>06827             {
<a name="l06828"></a>06828                 material_name = skin_mat_name;
<a name="l06829"></a>06829             }
<a name="l06830"></a>06830         }
<a name="l06831"></a>06831 
<a name="l06832"></a>06832         <span class="comment">/* Clone the material */</span>
<a name="l06833"></a>06833         Ogre::MaterialPtr mat = Ogre::MaterialManager::getSingleton().getByName(material_name);
<a name="l06834"></a>06834         <span class="keywordflow">if</span> (mat.isNull())
<a name="l06835"></a>06835         {
<a name="l06836"></a>06836             std::stringstream msg;
<a name="l06837"></a>06837             msg &lt;&lt; <span class="stringliteral">&quot;Material &#39;&quot;</span> &lt;&lt; material_name &lt;&lt; <span class="stringliteral">&quot;&#39; defined in section &#39;globals&#39; not found. Trying material &#39;tracks/transred&#39;&quot;</span>;
<a name="l06838"></a>06838             AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06839"></a>06839 
<a name="l06840"></a>06840             mat = Ogre::MaterialManager::getSingleton().getByName(<span class="stringliteral">&quot;tracks/transred&quot;</span>);
<a name="l06841"></a>06841             <span class="keywordflow">if</span> (mat.isNull())
<a name="l06842"></a>06842             {
<a name="l06843"></a>06843                 <span class="keywordflow">throw</span> <a class="code" href="class_rig_spawner_1_1_exception.html">Exception</a>(<span class="stringliteral">&quot;Vehicle material (or a built-in replacement) was not found.&quot;</span>);
<a name="l06844"></a>06844             }
<a name="l06845"></a>06845         }
<a name="l06846"></a>06846         std::stringstream mat_clone_name;
<a name="l06847"></a>06847         mat_clone_name &lt;&lt; material_name &lt;&lt; <span class="stringliteral">&quot;-&quot;</span> &lt;&lt; m_rig-&gt;truckname;
<a name="l06848"></a>06848         mat-&gt;clone(mat_clone_name.str());
<a name="l06849"></a>06849         strncpy(m_rig-&gt;texname, mat_clone_name.str().c_str(), <span class="keyword">sizeof</span>(m_rig-&gt;texname));
<a name="l06850"></a>06850     }
<a name="l06851"></a>06851 }
<a name="l06852"></a>06852 
<a name="l06853"></a>06853 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l06854"></a>06854 <span class="comment">/* Limits.</span>
<a name="l06855"></a>06855 <span class="comment">/* -------------------------------------------------------------------------- */</span>
<a name="l06856"></a>06856 
<a name="l06857"></a><a class="code" href="class_rig_spawner.html#a33598f58057895496a73c51aa6a340a0">06857</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a33598f58057895496a73c51aa6a340a0">RigSpawner::CheckNodeLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06858"></a>06858 {
<a name="l06859"></a>06859     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06860"></a>06860 
<a name="l06861"></a>06861     <span class="keywordflow">if</span> ((m_rig-&gt;free_node + count) &gt; <a class="code" href="_beam_data_8h.html#acc4b987a9b4c8d2ff8bcbdb08c5343e5" title="maximum number of nodes per truck">MAX_NODES</a>)
<a name="l06862"></a>06862     {
<a name="l06863"></a>06863         std::stringstream msg;
<a name="l06864"></a>06864         msg &lt;&lt; <span class="stringliteral">&quot;Node limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#acc4b987a9b4c8d2ff8bcbdb08c5343e5" title="maximum number of nodes per truck">MAX_NODES</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06865"></a>06865         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06866"></a>06866         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06867"></a>06867     }
<a name="l06868"></a>06868     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06869"></a>06869 }
<a name="l06870"></a>06870 
<a name="l06871"></a><a class="code" href="class_rig_spawner.html#a58f09d8a9aadd3de0454bdb5cd3ae2d3">06871</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a58f09d8a9aadd3de0454bdb5cd3ae2d3">RigSpawner::CheckBeamLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06872"></a>06872 {
<a name="l06873"></a>06873     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06874"></a>06874 
<a name="l06875"></a>06875     <span class="keywordflow">if</span> ((m_rig-&gt;free_beam + count) &gt; <a class="code" href="_beam_data_8h.html#aaabcdd3815618aaf2d54ce6a8aa5f8fc" title="maximum number of beams per truck">MAX_BEAMS</a>)
<a name="l06876"></a>06876     {
<a name="l06877"></a>06877         std::stringstream msg;
<a name="l06878"></a>06878         msg &lt;&lt; <span class="stringliteral">&quot;Beam limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#aaabcdd3815618aaf2d54ce6a8aa5f8fc" title="maximum number of beams per truck">MAX_BEAMS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06879"></a>06879         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06880"></a>06880         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06881"></a>06881     }
<a name="l06882"></a>06882     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06883"></a>06883 }
<a name="l06884"></a>06884 
<a name="l06885"></a><a class="code" href="class_rig_spawner.html#a9fc82dcfa405a539b12a0b5bb260521b">06885</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a9fc82dcfa405a539b12a0b5bb260521b">RigSpawner::CheckShockLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06886"></a>06886 {
<a name="l06887"></a>06887     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06888"></a>06888 
<a name="l06889"></a>06889     <span class="keywordflow">if</span> ((m_rig-&gt;free_shock + count) &gt; <a class="code" href="_beam_data_8h.html#a347e9ed33415367f068cc850aca3f1bf" title="maximum number of shocks per truck">MAX_SHOCKS</a>)
<a name="l06890"></a>06890     {
<a name="l06891"></a>06891         std::stringstream msg;
<a name="l06892"></a>06892         msg &lt;&lt; <span class="stringliteral">&quot;Shock limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a347e9ed33415367f068cc850aca3f1bf" title="maximum number of shocks per truck">MAX_SHOCKS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06893"></a>06893         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06894"></a>06894         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06895"></a>06895     }
<a name="l06896"></a>06896     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06897"></a>06897 }
<a name="l06898"></a>06898 
<a name="l06899"></a><a class="code" href="class_rig_spawner.html#acafa934c61bd6817ae60d8cf3b015ff3">06899</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#acafa934c61bd6817ae60d8cf3b015ff3">RigSpawner::CheckRotatorLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06900"></a>06900 {
<a name="l06901"></a>06901     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06902"></a>06902 
<a name="l06903"></a>06903     <span class="keywordflow">if</span> ((m_rig-&gt;free_rotator + count) &gt; <a class="code" href="_beam_data_8h.html#afc65fb8bf8a716d476f7caf3adf3d244" title="maximum number of rotators per truck">MAX_ROTATORS</a>)
<a name="l06904"></a>06904     {
<a name="l06905"></a>06905         std::stringstream msg;
<a name="l06906"></a>06906         msg &lt;&lt; <span class="stringliteral">&quot;Rotator limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#afc65fb8bf8a716d476f7caf3adf3d244" title="maximum number of rotators per truck">MAX_ROTATORS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06907"></a>06907         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06908"></a>06908         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06909"></a>06909     }
<a name="l06910"></a>06910     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06911"></a>06911 }
<a name="l06912"></a>06912 
<a name="l06913"></a><a class="code" href="class_rig_spawner.html#ae5dfbe90a6b84c32b72c90dc7b8167c4">06913</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#ae5dfbe90a6b84c32b72c90dc7b8167c4">RigSpawner::CheckHydroLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06914"></a>06914 {
<a name="l06915"></a>06915     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06916"></a>06916 
<a name="l06917"></a>06917     <span class="keywordflow">if</span> ((m_rig-&gt;free_shock + count) &gt; <a class="code" href="_beam_data_8h.html#a4686970bc9a4c77850f6654d2ef35b2f" title="maximum number of hydros per truck">MAX_HYDROS</a>)
<a name="l06918"></a>06918     {
<a name="l06919"></a>06919         std::stringstream msg;
<a name="l06920"></a>06920         msg &lt;&lt; <span class="stringliteral">&quot;Hydro limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a4686970bc9a4c77850f6654d2ef35b2f" title="maximum number of hydros per truck">MAX_HYDROS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06921"></a>06921         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06922"></a>06922         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06923"></a>06923     }
<a name="l06924"></a>06924     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06925"></a>06925 }
<a name="l06926"></a>06926 
<a name="l06927"></a><a class="code" href="class_rig_spawner.html#a1cda6e1f5b5d5ba939065140d2e7131d">06927</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a1cda6e1f5b5d5ba939065140d2e7131d">RigSpawner::CheckParticleLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06928"></a>06928 {
<a name="l06929"></a>06929     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06930"></a>06930 
<a name="l06931"></a>06931     <span class="keywordflow">if</span> ((m_rig-&gt;free_cparticle + count) &gt; <a class="code" href="_beam_data_8h.html#a765529327415100d437d11398bfd96a8" title="maximum number of custom particles per truck">MAX_CPARTICLES</a>)
<a name="l06932"></a>06932     {
<a name="l06933"></a>06933         std::stringstream msg;
<a name="l06934"></a>06934         msg &lt;&lt; <span class="stringliteral">&quot;Particle limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a765529327415100d437d11398bfd96a8" title="maximum number of custom particles per truck">MAX_CPARTICLES</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06935"></a>06935         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06936"></a>06936         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06937"></a>06937     }
<a name="l06938"></a>06938     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06939"></a>06939 }
<a name="l06940"></a>06940 
<a name="l06941"></a><a class="code" href="class_rig_spawner.html#a917f70f4a5967a720193fbc1e04e8c03">06941</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a917f70f4a5967a720193fbc1e04e8c03">RigSpawner::CheckAxleLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06942"></a>06942 {
<a name="l06943"></a>06943     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06944"></a>06944 
<a name="l06945"></a>06945     <span class="keywordflow">if</span> ((m_rig-&gt;free_axle + count) &gt; <a class="code" href="_beam_data_8h.html#a7bc15dd4ec4eb931d4e179788511fa3a" title="maximum number of wheels per truck">MAX_WHEELS</a>/2)
<a name="l06946"></a>06946     {
<a name="l06947"></a>06947         std::stringstream msg;
<a name="l06948"></a>06948         msg &lt;&lt; <span class="stringliteral">&quot;Axle limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a7bc15dd4ec4eb931d4e179788511fa3a" title="maximum number of wheels per truck">MAX_WHEELS</a>/2 &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06949"></a>06949         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06950"></a>06950         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06951"></a>06951     }
<a name="l06952"></a>06952     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06953"></a>06953 }
<a name="l06954"></a>06954 
<a name="l06955"></a><a class="code" href="class_rig_spawner.html#a9eaf255db5a67788e0d4659d3790bab4">06955</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a9eaf255db5a67788e0d4659d3790bab4">RigSpawner::CheckPropLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06956"></a>06956 {   
<a name="l06957"></a>06957     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06958"></a>06958 
<a name="l06959"></a>06959     <span class="keywordflow">if</span> ((m_rig-&gt;free_prop + count) &gt; <a class="code" href="_beam_data_8h.html#af876256b421729dad97404a478d3b67e" title="maximum number of props per truck">MAX_PROPS</a>)
<a name="l06960"></a>06960     {
<a name="l06961"></a>06961         std::stringstream msg;
<a name="l06962"></a>06962         msg &lt;&lt; <span class="stringliteral">&quot;Prop limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#af876256b421729dad97404a478d3b67e" title="maximum number of props per truck">MAX_PROPS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06963"></a>06963         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06964"></a>06964         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06965"></a>06965     }
<a name="l06966"></a>06966     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06967"></a>06967 }
<a name="l06968"></a>06968 
<a name="l06969"></a><a class="code" href="class_rig_spawner.html#aa0ac4f968ab4c325804d82c8c8b45f51">06969</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#aa0ac4f968ab4c325804d82c8c8b45f51">RigSpawner::CheckFlexbodyLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06970"></a>06970 {
<a name="l06971"></a>06971     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06972"></a>06972 
<a name="l06973"></a>06973     <span class="keywordflow">if</span> ((m_rig-&gt;free_flexbody + count) &gt; <a class="code" href="_beam_data_8h.html#a362bb9882ac976f00f9d374003efddf6" title="maximum number of flexbodies per truck">MAX_FLEXBODIES</a>)
<a name="l06974"></a>06974     {
<a name="l06975"></a>06975         std::stringstream msg;
<a name="l06976"></a>06976         msg &lt;&lt; <span class="stringliteral">&quot;Flexbody limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a362bb9882ac976f00f9d374003efddf6" title="maximum number of flexbodies per truck">MAX_FLEXBODIES</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06977"></a>06977         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06978"></a>06978         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06979"></a>06979     }
<a name="l06980"></a>06980     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06981"></a>06981 }
<a name="l06982"></a>06982 
<a name="l06983"></a><a class="code" href="class_rig_spawner.html#acd074b946edc9afa8b1db3089170e27f">06983</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#acd074b946edc9afa8b1db3089170e27f">RigSpawner::CheckSubmeshLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06984"></a>06984 {
<a name="l06985"></a>06985     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l06986"></a>06986 
<a name="l06987"></a>06987     <span class="keywordflow">if</span> ((m_rig-&gt;free_sub + count) &gt; <a class="code" href="_beam_data_8h.html#a959c5481bfa137d1373cad16bd46ca7c" title="maximum number of submeshes per truck">MAX_SUBMESHES</a>)
<a name="l06988"></a>06988     {
<a name="l06989"></a>06989         std::stringstream msg;
<a name="l06990"></a>06990         msg &lt;&lt; <span class="stringliteral">&quot;Submesh limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a959c5481bfa137d1373cad16bd46ca7c" title="maximum number of submeshes per truck">MAX_SUBMESHES</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l06991"></a>06991         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l06992"></a>06992         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l06993"></a>06993     }
<a name="l06994"></a>06994     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l06995"></a>06995 }
<a name="l06996"></a>06996 
<a name="l06997"></a><a class="code" href="class_rig_spawner.html#a86e4e05f2f1983d1d6806ceb6d19b9f8">06997</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a86e4e05f2f1983d1d6806ceb6d19b9f8">RigSpawner::CheckTexcoordLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l06998"></a>06998 {
<a name="l06999"></a>06999     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07000"></a>07000 
<a name="l07001"></a>07001     <span class="keywordflow">if</span> ((m_rig-&gt;free_texcoord + count) &gt; <a class="code" href="_beam_data_8h.html#acb4973acaec83598dfc3ec3ad794139f" title="maximum number of texture coordinates per truck">MAX_TEXCOORDS</a>)
<a name="l07002"></a>07002     {
<a name="l07003"></a>07003         std::stringstream msg;
<a name="l07004"></a>07004         msg &lt;&lt; <span class="stringliteral">&quot;Texcoord limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#acb4973acaec83598dfc3ec3ad794139f" title="maximum number of texture coordinates per truck">MAX_TEXCOORDS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07005"></a>07005         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07006"></a>07006         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07007"></a>07007     }
<a name="l07008"></a>07008     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07009"></a>07009 }
<a name="l07010"></a>07010 
<a name="l07011"></a>07011 <span class="comment">/* Static version */</span>
<a name="l07012"></a><a class="code" href="class_rig_spawner.html#ad678ba872f2e0a5aa9375575ccb2c9fb">07012</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#ad678ba872f2e0a5aa9375575ccb2c9fb">RigSpawner::CheckSoundScriptLimit</a>(<a class="code" href="class_beam.html">Beam</a> *vehicle, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07013"></a>07013 {
<a name="l07014"></a>07014     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07015"></a>07015 
<a name="l07016"></a>07016     <span class="comment">//return CheckSoundScriptLimit(m_rig, count);</span>
<a name="l07017"></a>07017     <span class="keywordflow">if</span> ((vehicle-&gt;<a class="code" href="structrig__t.html#a84827602fd06d83ceb927e7274decb26">free_soundsource</a> + count) &gt; <a class="code" href="_beam_data_8h.html#ac94a83da980ae8f4c68a8c758f0eabe0" title="maximum number of soundsscripts per truck">MAX_SOUNDSCRIPTS_PER_TRUCK</a>)
<a name="l07018"></a>07018     {
<a name="l07019"></a>07019         std::stringstream msg;
<a name="l07020"></a>07020         msg &lt;&lt; <span class="stringliteral">&quot;SoundScript limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#ac94a83da980ae8f4c68a8c758f0eabe0" title="maximum number of soundsscripts per truck">MAX_SOUNDSCRIPTS_PER_TRUCK</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07021"></a>07021         <a class="code" href="_ro_r_prerequisites_8h.html#af855c94dc540e943632089ce7496faac">LOG</a>(msg.str());
<a name="l07022"></a>07022         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07023"></a>07023     }
<a name="l07024"></a>07024     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07025"></a>07025 }
<a name="l07026"></a>07026 
<a name="l07027"></a><a class="code" href="class_rig_spawner.html#a93f1179767cf6ef7c2ede9b1c88b281d">07027</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#ad678ba872f2e0a5aa9375575ccb2c9fb">RigSpawner::CheckSoundScriptLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07028"></a>07028 {
<a name="l07029"></a>07029     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07030"></a>07030 
<a name="l07031"></a>07031     <span class="comment">//return CheckSoundScriptLimit(m_rig, count);</span>
<a name="l07032"></a>07032     <span class="keywordflow">if</span> ((m_rig-&gt;free_soundsource + count) &gt; <a class="code" href="_beam_data_8h.html#ac94a83da980ae8f4c68a8c758f0eabe0" title="maximum number of soundsscripts per truck">MAX_SOUNDSCRIPTS_PER_TRUCK</a>)
<a name="l07033"></a>07033     {
<a name="l07034"></a>07034         std::stringstream msg;
<a name="l07035"></a>07035         msg &lt;&lt; <span class="stringliteral">&quot;SoundScript limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#ac94a83da980ae8f4c68a8c758f0eabe0" title="maximum number of soundsscripts per truck">MAX_SOUNDSCRIPTS_PER_TRUCK</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07036"></a>07036         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07037"></a>07037         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07038"></a>07038     }
<a name="l07039"></a>07039     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07040"></a>07040 }
<a name="l07041"></a>07041 
<a name="l07042"></a><a class="code" href="class_rig_spawner.html#a54fcd4311c14b3e1c8635db3b22354eb">07042</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a54fcd4311c14b3e1c8635db3b22354eb">RigSpawner::CheckCabLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07043"></a>07043 {
<a name="l07044"></a>07044     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07045"></a>07045 
<a name="l07046"></a>07046     <span class="keywordflow">if</span> ((m_rig-&gt;free_cab + count) &gt; <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a>)
<a name="l07047"></a>07047     {
<a name="l07048"></a>07048         std::stringstream msg;
<a name="l07049"></a>07049         msg &lt;&lt; <span class="stringliteral">&quot;Cab limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a174231e1c5a17d387b02475bed0e98b9" title="maximum number of cabs per truck">MAX_CABS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07050"></a>07050         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07051"></a>07051         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07052"></a>07052     }
<a name="l07053"></a>07053     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07054"></a>07054 }
<a name="l07055"></a>07055 
<a name="l07056"></a><a class="code" href="class_rig_spawner.html#a20564ecdbd65b230b739847108728061">07056</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a20564ecdbd65b230b739847108728061">RigSpawner::CheckWingLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07057"></a>07057 {
<a name="l07058"></a>07058     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07059"></a>07059 
<a name="l07060"></a>07060     <span class="keywordflow">if</span> ((m_rig-&gt;free_wing + count) &gt; <a class="code" href="_beam_data_8h.html#aabd8726ff4e12bb01fb489f87225151b" title="maximum number of wings per truck">MAX_WINGS</a>)
<a name="l07061"></a>07061     {
<a name="l07062"></a>07062         std::stringstream msg;
<a name="l07063"></a>07063         msg &lt;&lt; <span class="stringliteral">&quot;Wing limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#aabd8726ff4e12bb01fb489f87225151b" title="maximum number of wings per truck">MAX_WINGS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07064"></a>07064         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07065"></a>07065         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07066"></a>07066     }
<a name="l07067"></a>07067     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07068"></a>07068 }
<a name="l07069"></a>07069 
<a name="l07070"></a><a class="code" href="class_rig_spawner.html#aabdcd86d3c15a198ef11e9303e419143">07070</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#aabdcd86d3c15a198ef11e9303e419143">RigSpawner::CheckCameraRailLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07071"></a>07071 {
<a name="l07072"></a>07072     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07073"></a>07073 
<a name="l07074"></a>07074     <span class="keywordflow">if</span> ((m_rig-&gt;free_camerarail + count) &gt; <a class="code" href="_beam_data_8h.html#acf52820476e041c45c762eee5f0dbf88" title="maximum number of camera rail points">MAX_CAMERARAIL</a>)
<a name="l07075"></a>07075     {
<a name="l07076"></a>07076         std::stringstream msg;
<a name="l07077"></a>07077         msg &lt;&lt; <span class="stringliteral">&quot;CameraRail limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#acf52820476e041c45c762eee5f0dbf88" title="maximum number of camera rail points">MAX_CAMERARAIL</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07078"></a>07078         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07079"></a>07079         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07080"></a>07080     }
<a name="l07081"></a>07081     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07082"></a>07082 }
<a name="l07083"></a>07083 
<a name="l07084"></a><a class="code" href="class_rig_spawner.html#a86649ca46089d86f6f5df16bf1dce509">07084</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a86649ca46089d86f6f5df16bf1dce509">RigSpawner::CheckAirBrakeLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07085"></a>07085 {
<a name="l07086"></a>07086     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07087"></a>07087 
<a name="l07088"></a>07088     <span class="keywordflow">if</span> ((m_rig-&gt;free_airbrake + count) &gt; <a class="code" href="_beam_data_8h.html#ae28484a1e4d0ddc88cd0eaae3b0c119e" title="maximum number of airbrakes per truck">MAX_AIRBRAKES</a>)
<a name="l07089"></a>07089     {
<a name="l07090"></a>07090         std::stringstream msg;
<a name="l07091"></a>07091         msg &lt;&lt; <span class="stringliteral">&quot;AirBrake limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#ae28484a1e4d0ddc88cd0eaae3b0c119e" title="maximum number of airbrakes per truck">MAX_AIRBRAKES</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07092"></a>07092         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07093"></a>07093         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07094"></a>07094     }
<a name="l07095"></a>07095     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07096"></a>07096 }
<a name="l07097"></a>07097 
<a name="l07098"></a><a class="code" href="class_rig_spawner.html#afb9854698b71d1ba1c2e9860762794d4">07098</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#afb9854698b71d1ba1c2e9860762794d4">RigSpawner::CheckAeroEngineLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07099"></a>07099 {
<a name="l07100"></a>07100     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07101"></a>07101 
<a name="l07102"></a>07102     <span class="keywordflow">if</span> ((m_rig-&gt;free_aeroengine + count) &gt; <a class="code" href="_beam_data_8h.html#a62b87e1996c61822575d31c11175814c" title="maximum number of aero engines per truck">MAX_AEROENGINES</a>)
<a name="l07103"></a>07103     {
<a name="l07104"></a>07104         std::stringstream msg;
<a name="l07105"></a>07105         msg &lt;&lt; <span class="stringliteral">&quot;AeroEngine limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#a62b87e1996c61822575d31c11175814c" title="maximum number of aero engines per truck">MAX_AEROENGINES</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07106"></a>07106         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07107"></a>07107         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07108"></a>07108     }
<a name="l07109"></a>07109     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07110"></a>07110 }
<a name="l07111"></a>07111 
<a name="l07112"></a><a class="code" href="class_rig_spawner.html#a3fd9d4bf3aac95441d8e7a68fdc88620">07112</a> <span class="keywordtype">bool</span> <a class="code" href="class_rig_spawner.html#a3fd9d4bf3aac95441d8e7a68fdc88620">RigSpawner::CheckScrewpropLimit</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> count)
<a name="l07113"></a>07113 {
<a name="l07114"></a>07114     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07115"></a>07115 
<a name="l07116"></a>07116     <span class="keywordflow">if</span> ((m_rig-&gt;free_screwprop + count) &gt; <a class="code" href="_beam_data_8h.html#ae3fff93b74bdaf9068978b0ae27b5efc" title="maximum number of boat screws per truck">MAX_SCREWPROPS</a>)
<a name="l07117"></a>07117     {
<a name="l07118"></a>07118         std::stringstream msg;
<a name="l07119"></a>07119         msg &lt;&lt; <span class="stringliteral">&quot;Screwprop limit (&quot;</span> &lt;&lt; <a class="code" href="_beam_data_8h.html#ae3fff93b74bdaf9068978b0ae27b5efc" title="maximum number of boat screws per truck">MAX_SCREWPROPS</a> &lt;&lt; <span class="stringliteral">&quot;) exceeded&quot;</span>;
<a name="l07120"></a>07120         AddMessage(Message::TYPE_ERROR, msg.str());
<a name="l07121"></a>07121         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l07122"></a>07122     }
<a name="l07123"></a>07123     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l07124"></a>07124 }
<a name="l07125"></a>07125 
<a name="l07126"></a><a class="code" href="class_rig_spawner.html#ad7071571bcd7d2b8e39ea9594b443d44">07126</a> <a class="code" href="structnode__t.html">node_t</a> &amp;<a class="code" href="class_rig_spawner.html#a8adfa166ff5338107a528d1de6d80ea1">RigSpawner:: GetNode</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_index)
<a name="l07127"></a>07127 {
<a name="l07128"></a>07128     <span class="keywordflow">return</span> m_rig-&gt;nodes[node_index];
<a name="l07129"></a>07129 }
<a name="l07130"></a>07130 
<a name="l07131"></a><a class="code" href="class_rig_spawner.html#a17cdc251ae263aaf7010d905df7f96aa">07131</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#af36d294a9a7c783d542251e41426208a">RigSpawner::InitNode</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> node_index, Ogre::Vector3 <span class="keyword">const</span> &amp; position)
<a name="l07132"></a>07132 {
<a name="l07133"></a>07133     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07134"></a>07134 
<a name="l07135"></a>07135     InitNode(m_rig-&gt;nodes[node_index], position);
<a name="l07136"></a>07136 }
<a name="l07137"></a>07137 
<a name="l07138"></a><a class="code" href="class_rig_spawner.html#a431f4a77a0bc40a4f02532bc5b48fb9c">07138</a> <a class="code" href="structbeam__t.html">beam_t</a> &amp; <a class="code" href="class_rig_spawner.html#a431f4a77a0bc40a4f02532bc5b48fb9c">RigSpawner::GetBeam</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> index)
<a name="l07139"></a>07139 {
<a name="l07140"></a>07140     <span class="keywordflow">return</span> m_rig-&gt;beams[index];
<a name="l07141"></a>07141 }
<a name="l07142"></a>07142 
<a name="l07143"></a><a class="code" href="class_rig_spawner.html#a2f37322027613bfa6b2a6624d1d221fa">07143</a> <a class="code" href="structnode__t.html">node_t</a> &amp; <a class="code" href="class_rig_spawner.html#a2f37322027613bfa6b2a6624d1d221fa">RigSpawner::GetFreeNode</a>()
<a name="l07144"></a>07144 {
<a name="l07145"></a>07145     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07146"></a>07146 
<a name="l07147"></a>07147     CheckNodeLimit(1);
<a name="l07148"></a>07148     <a class="code" href="structnode__t.html">node_t</a> &amp; node = m_rig-&gt;nodes[m_rig-&gt;free_node];
<a name="l07149"></a>07149     node.<a class="code" href="structnode__t.html#a8a7bbab0200d573966ecf8ebe3ce63da" title="This node&#39;s index in rig_t::nodes array.">pos</a> = m_rig-&gt;free_node;
<a name="l07150"></a>07150     m_rig-&gt;free_node++;
<a name="l07151"></a>07151     <span class="keywordflow">return</span> node;
<a name="l07152"></a>07152 }
<a name="l07153"></a>07153 
<a name="l07154"></a><a class="code" href="class_rig_spawner.html#adbb16c9e66981806ee62740dd9e8c9a3">07154</a> <a class="code" href="structbeam__t.html">beam_t</a> &amp; <a class="code" href="class_rig_spawner.html#adbb16c9e66981806ee62740dd9e8c9a3">RigSpawner::GetFreeBeam</a>()
<a name="l07155"></a>07155 {
<a name="l07156"></a>07156     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07157"></a>07157 
<a name="l07158"></a>07158     CheckBeamLimit(1);
<a name="l07159"></a>07159     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = m_rig-&gt;beams[m_rig-&gt;free_beam];
<a name="l07160"></a>07160     m_rig-&gt;free_beam++;
<a name="l07161"></a>07161     <span class="keywordflow">return</span> beam;
<a name="l07162"></a>07162 }
<a name="l07163"></a>07163 
<a name="l07164"></a><a class="code" href="class_rig_spawner.html#acd048ece2df5e6b674b14ba513547ba1">07164</a> <a class="code" href="structshock__t.html">shock_t</a> &amp; <a class="code" href="class_rig_spawner.html#acd048ece2df5e6b674b14ba513547ba1">RigSpawner::GetFreeShock</a>()
<a name="l07165"></a>07165 {
<a name="l07166"></a>07166     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07167"></a>07167 
<a name="l07168"></a>07168     <a class="code" href="structshock__t.html">shock_t</a> &amp; shock = m_rig-&gt;shocks[m_rig-&gt;free_shock];
<a name="l07169"></a>07169     m_rig-&gt;free_shock++;
<a name="l07170"></a>07170     <span class="keywordflow">return</span> shock;
<a name="l07171"></a>07171 }
<a name="l07172"></a>07172 
<a name="l07173"></a><a class="code" href="class_rig_spawner.html#a60f04fbe9bdbe9abc97233690dd28d8c">07173</a> <a class="code" href="structbeam__t.html">beam_t</a> &amp; <a class="code" href="class_rig_spawner.html#a60f04fbe9bdbe9abc97233690dd28d8c">RigSpawner::GetAndInitFreeBeam</a>(<a class="code" href="structnode__t.html">node_t</a> &amp; node_1, <a class="code" href="structnode__t.html">node_t</a> &amp; node_2)
<a name="l07174"></a>07174 {
<a name="l07175"></a>07175     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07176"></a>07176 
<a name="l07177"></a>07177     <a class="code" href="structbeam__t.html">beam_t</a> &amp; beam = GetFreeBeam();
<a name="l07178"></a>07178     beam.<a class="code" href="structbeam__t.html#aa538bf301652ee7537d259656534768d">p1</a> = &amp; node_1;
<a name="l07179"></a>07179     beam.<a class="code" href="structbeam__t.html#afca9a10cbe0d2ba827c5b430b1e1d154">p2</a> = &amp; node_2;
<a name="l07180"></a>07180     <span class="keywordflow">return</span> beam;
<a name="l07181"></a>07181 }
<a name="l07182"></a>07182 
<a name="l07183"></a><a class="code" href="class_rig_spawner.html#a7e2c222807d39b211f85ceabc6bb7970">07183</a> <a class="code" href="structnode__t.html">node_t</a> &amp; <a class="code" href="class_rig_spawner.html#a7e2c222807d39b211f85ceabc6bb7970">RigSpawner::GetAndInitFreeNode</a>(Ogre::Vector3 <span class="keyword">const</span> &amp; position)
<a name="l07184"></a>07184 {
<a name="l07185"></a>07185     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07186"></a>07186 
<a name="l07187"></a>07187     <a class="code" href="structnode__t.html">node_t</a> &amp; node = GetFreeNode();
<a name="l07188"></a>07188     InitNode(node, position);
<a name="l07189"></a>07189     <span class="keywordflow">return</span> node;
<a name="l07190"></a>07190 }
<a name="l07191"></a>07191 
<a name="l07192"></a><a class="code" href="class_rig_spawner.html#a7218547ed657af73f971af554662dfa8">07192</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a7218547ed657af73f971af554662dfa8">RigSpawner::SetBeamSpring</a>(<a class="code" href="structbeam__t.html">beam_t</a> &amp; beam, <span class="keywordtype">float</span> spring)
<a name="l07193"></a>07193 {
<a name="l07194"></a>07194     beam.<a class="code" href="structbeam__t.html#a1bd4aecbb9b87bca751e860e0938f88f" title="tensile spring">k</a> = spring;
<a name="l07195"></a>07195 }
<a name="l07196"></a>07196 
<a name="l07197"></a><a class="code" href="class_rig_spawner.html#a2010f63948fb6123c7970de9ed0f5296">07197</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a2010f63948fb6123c7970de9ed0f5296">RigSpawner::SetBeamDamping</a>(<a class="code" href="structbeam__t.html">beam_t</a> &amp; beam, <span class="keywordtype">float</span> damping)
<a name="l07198"></a>07198 {
<a name="l07199"></a>07199     beam.<a class="code" href="structbeam__t.html#a73dec57764802aa09df7e4193972d148" title="damping factor">d</a> = damping;
<a name="l07200"></a>07200 }
<a name="l07201"></a>07201 
<a name="l07202"></a><a class="code" href="class_rig_spawner.html#ae70ad94ca28e2c700d394f21c1ee20fb">07202</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#ae70ad94ca28e2c700d394f21c1ee20fb">RigSpawner::RecalculateBoundingBoxes</a>(<a class="code" href="structrig__t.html">rig_t</a> *rig)
<a name="l07203"></a>07203 {
<a name="l07204"></a>07204     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07205"></a>07205 
<a name="l07206"></a>07206     Ogre::Vector3 node_0_pos = rig-&gt;<a class="code" href="structrig__t.html#a204ec1dc71c3743a43ebfa278413a582">nodes</a>[0].<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>;
<a name="l07207"></a>07207     rig-&gt;<a class="code" href="structrig__t.html#a32e92217c2a58945fff1f3edc7c2aeab" title="standard bounding box (surrounds all nodes of a truck)">boundingBox</a>.setExtents(
<a name="l07208"></a>07208         node_0_pos.x, node_0_pos.y, node_0_pos.z, 
<a name="l07209"></a>07209         node_0_pos.x, node_0_pos.y, node_0_pos.z
<a name="l07210"></a>07210     );
<a name="l07211"></a>07211     rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>.clear();
<a name="l07212"></a>07212 
<a name="l07213"></a>07213     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; rig-&gt;<a class="code" href="structrig__t.html#ae68ae2f82d9f90766b7a79f91f4d3ac3">free_node</a>; i++)
<a name="l07214"></a>07214     {
<a name="l07215"></a>07215         <a class="code" href="structnode__t.html">node_t</a> &amp; node = rig-&gt;<a class="code" href="structrig__t.html#a204ec1dc71c3743a43ebfa278413a582">nodes</a>[i];
<a name="l07216"></a>07216         Ogre::Vector3 node_position = node.<a class="code" href="structnode__t.html#a5228375ba31ad0e97584638f73744a55" title="absolute position in the world (shaky)">AbsPosition</a>;
<a name="l07217"></a>07217         rig-&gt;<a class="code" href="structrig__t.html#a32e92217c2a58945fff1f3edc7c2aeab" title="standard bounding box (surrounds all nodes of a truck)">boundingBox</a>.merge(node_position);
<a name="l07218"></a>07218         <span class="keywordflow">if</span> (node.<a class="code" href="structnode__t.html#a0e878fe75b80991f48856bc920406b35">collisionBoundingBoxID</a> &gt;= 0)
<a name="l07219"></a>07219         {
<a name="l07220"></a>07220             <span class="keywordflow">if</span> ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>) node.<a class="code" href="structnode__t.html#a0e878fe75b80991f48856bc920406b35">collisionBoundingBoxID</a> &gt;= rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>.size())
<a name="l07221"></a>07221             {
<a name="l07222"></a>07222                 rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>.push_back(
<a name="l07223"></a>07223                     Ogre::AxisAlignedBox(
<a name="l07224"></a>07224                         node_position.x, node_position.y, node_position.z, 
<a name="l07225"></a>07225                         node_position.x, node_position.y, node_position.z
<a name="l07226"></a>07226                     )
<a name="l07227"></a>07227                 );
<a name="l07228"></a>07228             } 
<a name="l07229"></a>07229             <span class="keywordflow">else</span>
<a name="l07230"></a>07230             {
<a name="l07231"></a>07231                 rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>[node.<a class="code" href="structnode__t.html#a0e878fe75b80991f48856bc920406b35">collisionBoundingBoxID</a>].merge(node_position);
<a name="l07232"></a>07232             }
<a name="l07233"></a>07233         }
<a name="l07234"></a>07234     }
<a name="l07235"></a>07235 
<a name="l07236"></a>07236     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i = 0; i &lt; rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>.size(); i++)
<a name="l07237"></a>07237     {
<a name="l07238"></a>07238         rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>[i].setMinimum(rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>[i].getMinimum() - Ogre::Vector3(0.05f, 0.05f, 0.05f));
<a name="l07239"></a>07239         rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>[i].setMaximum(rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>[i].getMaximum() + Ogre::Vector3(0.05f, 0.05f, 0.05f));
<a name="l07240"></a>07240     }
<a name="l07241"></a>07241 
<a name="l07242"></a>07242     rig-&gt;<a class="code" href="structrig__t.html#a32e92217c2a58945fff1f3edc7c2aeab" title="standard bounding box (surrounds all nodes of a truck)">boundingBox</a>.setMinimum(rig-&gt;<a class="code" href="structrig__t.html#a32e92217c2a58945fff1f3edc7c2aeab" title="standard bounding box (surrounds all nodes of a truck)">boundingBox</a>.getMinimum() - Ogre::Vector3(0.05f, 0.05f, 0.05f));
<a name="l07243"></a>07243     rig-&gt;<a class="code" href="structrig__t.html#a32e92217c2a58945fff1f3edc7c2aeab" title="standard bounding box (surrounds all nodes of a truck)">boundingBox</a>.setMaximum(rig-&gt;<a class="code" href="structrig__t.html#a32e92217c2a58945fff1f3edc7c2aeab" title="standard bounding box (surrounds all nodes of a truck)">boundingBox</a>.getMaximum() + Ogre::Vector3(0.05f, 0.05f, 0.05f));
<a name="l07244"></a>07244 
<a name="l07245"></a>07245     rig-&gt;<a class="code" href="structrig__t.html#a871af57096c11cf72771a456766cf109">predictedBoundingBox</a> = rig-&gt;<a class="code" href="structrig__t.html#a32e92217c2a58945fff1f3edc7c2aeab" title="standard bounding box (surrounds all nodes of a truck)">boundingBox</a>;
<a name="l07246"></a>07246     rig-&gt;<a class="code" href="structrig__t.html#a196527bdb22d150aae156d1137df9632">predictedCollisionBoundingBoxes</a> = rig-&gt;<a class="code" href="structrig__t.html#a84c9a37a07976665546267005f35591b" title="smart bounding boxes, used for determining the state of a truck (every box surrounds only a subset of...">collisionBoundingBoxes</a>;
<a name="l07247"></a>07247 }
<a name="l07248"></a>07248 
<a name="l07249"></a>07249 
<a name="l07250"></a><a class="code" href="class_rig_spawner.html#a28bf30353b7f207de13fb15917993c1f">07250</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a28bf30353b7f207de13fb15917993c1f">RigSpawner::SetupDefaultSoundSources</a>(<a class="code" href="class_beam.html">Beam</a> *vehicle)
<a name="l07251"></a>07251 {
<a name="l07252"></a>07252     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07253"></a>07253 
<a name="l07254"></a>07254     <span class="keywordtype">int</span> trucknum = vehicle-&gt;<a class="code" href="structrig__t.html#a7c1e3928db39d4489eb3dbaa4fb0db5b">trucknum</a>;
<a name="l07255"></a>07255     <span class="keywordtype">int</span> smokeId = vehicle-&gt;<a class="code" href="structrig__t.html#ad24bd9ebb48afc06ed219ba70d65562c" title="Old-format exhaust (one per vehicle) emitter node.">smokeId</a>;
<a name="l07256"></a>07256 
<a name="l07257"></a>07257 <span class="preprocessor">#ifdef USE_OPENAL</span>
<a name="l07258"></a>07258 <span class="preprocessor"></span>    <span class="keywordflow">if</span> (SoundScriptManager::getSingleton().isDisabled()) 
<a name="l07259"></a>07259     {
<a name="l07260"></a>07260         <span class="keywordflow">return</span>;
<a name="l07261"></a>07261     }
<a name="l07262"></a>07262 
<a name="l07263"></a>07263     <span class="comment">//engine</span>
<a name="l07264"></a>07264     <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#adf006481b18f529767f0e9735bc9ce4c">engine</a> != <span class="keyword">nullptr</span>) <span class="comment">/* Land vehicle */</span>
<a name="l07265"></a>07265     {
<a name="l07266"></a>07266         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#adf006481b18f529767f0e9735bc9ce4c">engine</a>-&gt;<a class="code" href="class_beam_engine.html#a9813b09c22111c7c066fb32f92653226" title="Engine attribute {&#39;t&#39; = truck (default), &#39;c&#39; = car}.">type</a>==<span class="charliteral">&#39;t&#39;</span>)
<a name="l07267"></a>07267         {
<a name="l07268"></a>07268             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_diesel&quot;</span>, smokeId);
<a name="l07269"></a>07269             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_force&quot;</span>, smokeId);
<a name="l07270"></a>07270             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_brakes&quot;</span>, 0);
<a name="l07271"></a>07271             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_parkbrakes&quot;</span>, 0);
<a name="l07272"></a>07272             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_reverse_beep&quot;</span>, 0);
<a name="l07273"></a>07273         }
<a name="l07274"></a>07274         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#adf006481b18f529767f0e9735bc9ce4c">engine</a>-&gt;<a class="code" href="class_beam_engine.html#a9813b09c22111c7c066fb32f92653226" title="Engine attribute {&#39;t&#39; = truck (default), &#39;c&#39; = car}.">type</a>==<span class="charliteral">&#39;c&#39;</span>)
<a name="l07275"></a>07275             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_car&quot;</span>, smokeId);
<a name="l07276"></a>07276         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#adf006481b18f529767f0e9735bc9ce4c">engine</a>-&gt;<a class="code" href="class_beam_engine.html#a1e044587312c18ca98f87b1d65910161" title="Engine attribute.">hasturbo</a>)
<a name="l07277"></a>07277         {
<a name="l07278"></a>07278             <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#adf006481b18f529767f0e9735bc9ce4c">engine</a>-&gt;<a class="code" href="class_beam_engine.html#a325e27b9d12fe2c57f0806099d2be4dc">turboInertiaFactor</a> &gt;= 3)
<a name="l07279"></a>07279                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbo_big&quot;</span>, smokeId);
<a name="l07280"></a>07280             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#adf006481b18f529767f0e9735bc9ce4c">engine</a>-&gt;<a class="code" href="class_beam_engine.html#a325e27b9d12fe2c57f0806099d2be4dc">turboInertiaFactor</a> &lt;= 0.5)
<a name="l07281"></a>07281                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbo_small&quot;</span>, smokeId);
<a name="l07282"></a>07282             <span class="keywordflow">else</span>
<a name="l07283"></a>07283                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbo_mid&quot;</span>, smokeId);
<a name="l07284"></a>07284 
<a name="l07285"></a>07285             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbo_bov&quot;</span>, smokeId);
<a name="l07286"></a>07286             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_wastegate_flutter&quot;</span>, smokeId);
<a name="l07287"></a>07287         }
<a name="l07288"></a>07288             
<a name="l07289"></a>07289         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#adf006481b18f529767f0e9735bc9ce4c">engine</a>-&gt;<a class="code" href="class_beam_engine.html#ae81184bc95ccb9db899c86f14b852ba5" title="Engine attribute.">hasair</a>)
<a name="l07290"></a>07290             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_air_purge&quot;</span>, 0);
<a name="l07291"></a>07291         <span class="comment">//starter</span>
<a name="l07292"></a>07292         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_starter&quot;</span>, 0);
<a name="l07293"></a>07293         <span class="comment">// turn signals</span>
<a name="l07294"></a>07294         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turn_signal&quot;</span>, 0);
<a name="l07295"></a>07295     }
<a name="l07296"></a>07296     <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#af5cdf2b08da0b98aed6f017ae3177444">driveable</a>==<a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18ad70431030b2ce25863bfad2f593091a6" title="its a truck">TRUCK</a>)
<a name="l07297"></a>07297     {
<a name="l07298"></a>07298         <span class="comment">//horn</span>
<a name="l07299"></a>07299         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#a037cfb4e6e0e9e769909af8ce9d5380d">ispolice</a>)
<a name="l07300"></a>07300             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_police&quot;</span>, 0);
<a name="l07301"></a>07301         <span class="keywordflow">else</span>
<a name="l07302"></a>07302             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_horn&quot;</span>, 0);
<a name="l07303"></a>07303         <span class="comment">//shift</span>
<a name="l07304"></a>07304             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_shift&quot;</span>, 0);
<a name="l07305"></a>07305     }
<a name="l07306"></a>07306     <span class="comment">//pump</span>
<a name="l07307"></a>07307     <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#a7187884a9493207b16698f3636957d14">hascommands</a>)
<a name="l07308"></a>07308     {
<a name="l07309"></a>07309         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_pump&quot;</span>, 0);
<a name="l07310"></a>07310     }
<a name="l07311"></a>07311     <span class="comment">//antilock brake</span>
<a name="l07312"></a>07312     <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#ae4e6401c3e73c9a2c85f67d48d966d84" title="Anti-lock brake attribute: Display the dashboard indicator?">alb_present</a>)
<a name="l07313"></a>07313     {
<a name="l07314"></a>07314         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_antilock&quot;</span>, 0);
<a name="l07315"></a>07315     }
<a name="l07316"></a>07316     <span class="comment">//tractioncontrol</span>
<a name="l07317"></a>07317     <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#a10be504017acb87c67a91e40a6414360" title="Traction control attribute; Display the dashboard indicator?">tc_present</a>)
<a name="l07318"></a>07318     {
<a name="l07319"></a>07319         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_tractioncontrol&quot;</span>, 0);
<a name="l07320"></a>07320     }
<a name="l07321"></a>07321     <span class="comment">//screetch</span>
<a name="l07322"></a>07322     <span class="keywordflow">if</span> ((vehicle-&gt;<a class="code" href="structrig__t.html#af5cdf2b08da0b98aed6f017ae3177444">driveable</a>==<a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18ad70431030b2ce25863bfad2f593091a6" title="its a truck">TRUCK</a> || vehicle-&gt;<a class="code" href="structrig__t.html#af5cdf2b08da0b98aed6f017ae3177444">driveable</a>==<a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18a9e543158d0fa5b033941649d12acdfc1" title="its an airplane">AIRPLANE</a>) &amp;&amp; vehicle-&gt;<a class="code" href="structrig__t.html#a6353dc4ced21c938923882a7a676d190">free_wheel</a> != 0)
<a name="l07323"></a>07323     {
<a name="l07324"></a>07324         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_screetch&quot;</span>, 0);
<a name="l07325"></a>07325     }
<a name="l07326"></a>07326     <span class="comment">//break &amp; creak</span>
<a name="l07327"></a>07327     AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_break&quot;</span>, 0);
<a name="l07328"></a>07328     AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_creak&quot;</span>, 0);
<a name="l07329"></a>07329     <span class="comment">//boat engine</span>
<a name="l07330"></a>07330     <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#af5cdf2b08da0b98aed6f017ae3177444">driveable</a>==<a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18a5fcfdc36f4798fb6ace9348a10f1e1b3" title="its a boat">BOAT</a>)
<a name="l07331"></a>07331     {
<a name="l07332"></a>07332         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="class_beam.html#a7c31c7a270e5aa54f6d8f49b20892116">totalmass</a>&gt;50000.0)
<a name="l07333"></a>07333             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_marine_large&quot;</span>, smokeId);
<a name="l07334"></a>07334         <span class="keywordflow">else</span>
<a name="l07335"></a>07335             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_marine_small&quot;</span>, smokeId);
<a name="l07336"></a>07336         <span class="comment">//no start/stop engine for boats, so set sound always on!</span>
<a name="l07337"></a>07337         SoundScriptManager::getSingleton().trigStart(trucknum, SS_TRIG_ENGINE);
<a name="l07338"></a>07338         SoundScriptManager::getSingleton().modulate(trucknum, SS_MOD_ENGINE, 0.5);
<a name="l07339"></a>07339     }
<a name="l07340"></a>07340     <span class="comment">//airplane warnings</span>
<a name="l07341"></a>07341     <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#af5cdf2b08da0b98aed6f017ae3177444">driveable</a>==<a class="code" href="_beam_data_8h.html#ae4d5251432e1a9e6803c0240cc492e18a9e543158d0fa5b033941649d12acdfc1" title="its an airplane">AIRPLANE</a>)
<a name="l07342"></a>07342     {
<a name="l07343"></a>07343         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_10&quot;</span>, 0);
<a name="l07344"></a>07344         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_20&quot;</span>, 0);
<a name="l07345"></a>07345         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_30&quot;</span>, 0);
<a name="l07346"></a>07346         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_40&quot;</span>, 0);
<a name="l07347"></a>07347         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_50&quot;</span>, 0);
<a name="l07348"></a>07348         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_100&quot;</span>, 0);
<a name="l07349"></a>07349 
<a name="l07350"></a>07350         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_pullup&quot;</span>, 0);
<a name="l07351"></a>07351         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_minimums&quot;</span>, 0);
<a name="l07352"></a>07352         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_gpws_apdisconnect&quot;</span>, 0);
<a name="l07353"></a>07353         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aoa_warning&quot;</span>, 0);
<a name="l07354"></a>07354 
<a name="l07355"></a>07355         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat01&quot;</span>, 0);
<a name="l07356"></a>07356         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat02&quot;</span>, 0);
<a name="l07357"></a>07357         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat03&quot;</span>, 0);
<a name="l07358"></a>07358         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat04&quot;</span>, 0);
<a name="l07359"></a>07359         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat05&quot;</span>, 0);
<a name="l07360"></a>07360         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat06&quot;</span>, 0);
<a name="l07361"></a>07361         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat07&quot;</span>, 0);
<a name="l07362"></a>07362         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat08&quot;</span>, 0);
<a name="l07363"></a>07363         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat09&quot;</span>, 0);
<a name="l07364"></a>07364         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat10&quot;</span>, 0);
<a name="l07365"></a>07365         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat11&quot;</span>, 0);
<a name="l07366"></a>07366         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat12&quot;</span>, 0);
<a name="l07367"></a>07367         AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_aivionic_chat13&quot;</span>, 0);
<a name="l07368"></a>07368     }
<a name="l07369"></a>07369     <span class="comment">//airplane engines</span>
<a name="l07370"></a>07370     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;vehicle-&gt;<a class="code" href="structrig__t.html#a00c8d702ecf34d14693008d12fd079b1">free_aeroengine</a> &amp;&amp; i&lt;8; i++)
<a name="l07371"></a>07371     {
<a name="l07372"></a>07372         <span class="keywordtype">int</span> turbojet_node = vehicle-&gt;<a class="code" href="structrig__t.html#a69488a6ba2ff4c706edaeeb8fd7ee9b4">aeroengines</a>[i]-&gt;<a class="code" href="class_aero_engine.html#afa51837c14b0a0580ed447717ff49c5b">getNoderef</a>();
<a name="l07373"></a>07373         Ogre::String index_str = <a class="code" href="_ro_r_prerequisites_8h.html#a9063e80f8777300c93afde6e6f4c9cea">TOSTRING</a>(i+1);
<a name="l07374"></a>07374 
<a name="l07375"></a>07375         <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#a69488a6ba2ff4c706edaeeb8fd7ee9b4">aeroengines</a>[i]-&gt;<a class="code" href="class_aero_engine.html#a6d67284b994e8fa6b6d2896feee03951">getType</a>()==<a class="code" href="class_aero_engine.html#a266633ea950653f77714a38abb7e6172a39e32c468fcec54df186269fc292eeb9">AeroEngine::AEROENGINE_TYPE_TURBOJET</a>)
<a name="l07376"></a>07376         {
<a name="l07377"></a>07377             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbojet_start&quot;</span> + index_str, turbojet_node);
<a name="l07378"></a>07378             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbojet_lopower&quot;</span> + index_str, turbojet_node);
<a name="l07379"></a>07379             AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbojet_hipower&quot;</span> + index_str, turbojet_node);
<a name="l07380"></a>07380             <span class="keywordflow">if</span> (((<a class="code" href="class_turbojet.html">Turbojet</a>*)(vehicle-&gt;<a class="code" href="structrig__t.html#a69488a6ba2ff4c706edaeeb8fd7ee9b4">aeroengines</a>[i]))-&gt;afterburnable)
<a name="l07381"></a>07381             {
<a name="l07382"></a>07382                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turbojet_afterburner&quot;</span> + index_str, turbojet_node);
<a name="l07383"></a>07383             }
<a name="l07384"></a>07384         }
<a name="l07385"></a>07385         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (vehicle-&gt;<a class="code" href="structrig__t.html#a69488a6ba2ff4c706edaeeb8fd7ee9b4">aeroengines</a>[i]-&gt;<a class="code" href="class_aero_engine.html#a6d67284b994e8fa6b6d2896feee03951">getType</a>()==<a class="code" href="class_aero_engine.html#a266633ea950653f77714a38abb7e6172a8fcbf8713e7c2acd7b1c0e3dcb308ae4">AeroEngine::AEROENGINE_TYPE_TURBOPROP</a>)
<a name="l07386"></a>07386         {
<a name="l07387"></a>07387             <span class="keywordflow">if</span> (((<a class="code" href="class_turboprop.html">Turboprop</a>*)vehicle-&gt;<a class="code" href="structrig__t.html#a69488a6ba2ff4c706edaeeb8fd7ee9b4">aeroengines</a>[i])-&gt;is_piston)
<a name="l07388"></a>07388             {
<a name="l07389"></a>07389                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_pistonprop_start&quot;</span> + index_str, turbojet_node);
<a name="l07390"></a>07390                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_pistonprop_lopower&quot;</span> + index_str, turbojet_node);
<a name="l07391"></a>07391                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_pistonprop_hipower&quot;</span> + index_str, turbojet_node);
<a name="l07392"></a>07392             }
<a name="l07393"></a>07393             <span class="keywordflow">else</span>
<a name="l07394"></a>07394             {
<a name="l07395"></a>07395                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turboprop_start&quot;</span> + index_str, turbojet_node);
<a name="l07396"></a>07396                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turboprop_lopower&quot;</span> + index_str, turbojet_node);
<a name="l07397"></a>07397                 AddSoundSourceInstance(vehicle, <span class="stringliteral">&quot;tracks/default_turboprop_hipower&quot;</span> + index_str, turbojet_node);
<a name="l07398"></a>07398             }
<a name="l07399"></a>07399         }
<a name="l07400"></a>07400     }
<a name="l07401"></a>07401 
<a name="l07402"></a>07402     <span class="comment">// linked sounds</span>
<a name="l07403"></a>07403     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;vehicle-&gt;<a class="code" href="structrig__t.html#a74dd045f22e4cd490779af40487d655f">free_commands</a>; i++)
<a name="l07404"></a>07404     {
<a name="l07405"></a>07405         AddSoundSource(vehicle, SoundScriptManager::getSingleton().createInstance(Ogre::String(<span class="stringliteral">&quot;tracks/linked/default_command/extend&quot;</span>), trucknum, NULL, SL_COMMAND, i), 0);
<a name="l07406"></a>07406         AddSoundSource(vehicle, SoundScriptManager::getSingleton().createInstance(Ogre::String(<span class="stringliteral">&quot;tracks/linked/default_command/retract&quot;</span>), trucknum, NULL, SL_COMMAND, -i), 0);
<a name="l07407"></a>07407     }
<a name="l07408"></a>07408 
<a name="l07409"></a>07409 <span class="preprocessor">#endif //OPENAL</span>
<a name="l07410"></a>07410 <span class="preprocessor"></span>}
<a name="l07411"></a>07411 
<a name="l07412"></a><a class="code" href="class_rig_spawner.html#a4898bf31296ea21c03713fd4b6bff252">07412</a> <span class="keywordtype">void</span> <a class="code" href="class_rig_spawner.html#a4898bf31296ea21c03713fd4b6bff252">RigSpawner::UpdateCollcabContacterNodes</a>()
<a name="l07413"></a>07413 {
<a name="l07414"></a>07414     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07415"></a>07415 
<a name="l07416"></a>07416     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i&lt;m_rig-&gt;free_collcab; i++)
<a name="l07417"></a>07417     {
<a name="l07418"></a>07418         <span class="keywordtype">int</span> tmpv = m_rig-&gt;collcabs[i] * 3;
<a name="l07419"></a>07419         m_rig-&gt;nodes[m_rig-&gt;cabs[tmpv]].contacter = <span class="keyword">true</span>;
<a name="l07420"></a>07420         m_rig-&gt;nodes[m_rig-&gt;cabs[tmpv+1]].contacter = <span class="keyword">true</span>;
<a name="l07421"></a>07421         m_rig-&gt;nodes[m_rig-&gt;cabs[tmpv+2]].contacter = <span class="keyword">true</span>;
<a name="l07422"></a>07422     }
<a name="l07423"></a>07423 }
<a name="l07424"></a>07424 
<a name="l07425"></a><a class="code" href="class_rig_spawner.html#aeec377d1768810665f38c504d5cfb58a">07425</a> std::string <a class="code" href="class_rig_spawner.html#aeec377d1768810665f38c504d5cfb58a">RigSpawner::ProcessMessagesToString</a>()
<a name="l07426"></a>07426 {
<a name="l07427"></a>07427     <a class="code" href="_rig_loading_profiler_control_8h.html#a91d6e92cc5cf33e43944a64c36361e3c">SPAWNER_PROFILE_SCOPED</a>();
<a name="l07428"></a>07428 
<a name="l07429"></a>07429     std::stringstream report;
<a name="l07430"></a>07430 
<a name="l07431"></a>07431     <span class="keyword">auto</span> itor = m_messages.begin();
<a name="l07432"></a>07432     <span class="keyword">auto</span> end  = m_messages.end();
<a name="l07433"></a>07433     <span class="keywordflow">for</span> (; itor != end; ++itor)
<a name="l07434"></a>07434     {
<a name="l07435"></a>07435         <span class="keywordflow">switch</span> (itor-&gt;type)
<a name="l07436"></a>07436         {
<a name="l07437"></a>07437             <span class="keywordflow">case</span> (Message::TYPE_INTERNAL_ERROR): 
<a name="l07438"></a>07438                 report &lt;&lt; <span class="stringliteral">&quot;#FF3300 INTERNAL ERROR #FFFFFF&quot;</span>; 
<a name="l07439"></a>07439                 <span class="keywordflow">break</span>;
<a name="l07440"></a>07440 
<a name="l07441"></a>07441             <span class="keywordflow">case</span> (Message::TYPE_ERROR): 
<a name="l07442"></a>07442                 report &lt;&lt; <span class="stringliteral">&quot;#FF3300 ERROR #FFFFFF&quot;</span>; 
<a name="l07443"></a>07443                 <span class="keywordflow">break</span>;
<a name="l07444"></a>07444 
<a name="l07445"></a>07445             <span class="keywordflow">case</span> (Message::TYPE_WARNING): 
<a name="l07446"></a>07446                 report &lt;&lt; <span class="stringliteral">&quot;#FFFF00 WARNING #FFFFFF&quot;</span>; 
<a name="l07447"></a>07447                 <span class="keywordflow">break</span>;
<a name="l07448"></a>07448 
<a name="l07449"></a>07449             <span class="keywordflow">default</span>:
<a name="l07450"></a>07450                 report &lt;&lt; <span class="stringliteral">&quot;INFO&quot;</span>; 
<a name="l07451"></a>07451                 <span class="keywordflow">break</span>;
<a name="l07452"></a>07452         }
<a name="l07453"></a>07453         report &lt;&lt; <span class="stringliteral">&quot;(Keyword &quot;</span> &lt;&lt; <a class="code" href="struct_rig_def_1_1_file.html#aecfdfd70221c860aebb6edf3f40d78d2">RigDef::File::KeywordToString</a>(itor-&gt;keyword) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; std::endl;
<a name="l07454"></a>07454         report &lt;&lt; <span class="stringliteral">&quot;\t&quot;</span> &lt;&lt; itor-&gt;text &lt;&lt; std::endl;
<a name="l07455"></a>07455     }
<a name="l07456"></a>07456     <span class="keywordflow">return</span> report.str();
<a name="l07457"></a>07457 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated on Mon Oct 12 2015 11:55:31 for Rigs of Rods by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
